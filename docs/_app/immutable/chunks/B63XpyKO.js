import{e as lg,g as Av,i as kv,d as Xi,f as Qe,a as ye,s as lr,c as wr,b as $n,j as Sn}from"./BkPaZSxt.js";import{aM as qp,aN as Pg,aO as zv,C as zp,I as Ig,aP as Mg,P as Jh,E as Pn,aw as pu,J as Np,g as w,a1 as Dv,M as Lv,N as Rv,O as cg,Q as Dp,F as Ul,ac as Eg,aK as Fv,ap as ug,y as ta,aQ as ia,D as Vp,H as Ov,aa as hg,m as Bv,aI as Zp,aR as Nv,aS as Vv,aT as jv,z as Ag,B as kg,aU as Lp,U as Hp,aE as zg,aV as Uv,aW as Gv,aH as qv,A as Zv,t as zt,a2 as Dg,aX as Hv,aL as Wv,aF as Xv,K as Lg,aY as Yv,aA as Kv,R as Rg,aZ as Qv,av as Fg,a8 as Jv,x as Wn,T as id,a_ as Og,a$ as Bg,b0 as $v,b1 as ey,W as ty,b2 as ry,b3 as iy,b4 as ny,b5 as oy,v as $h,S as ay,p as _i,c as oe,a as vi,s as de,r as K,f as $t,u as ne,b6 as Ng,b7 as sy,o as vu,b as Vr,e as St,d as Na,h as vr,b8 as ly,j as yu,w as Vg,i as Ua,n as jg,Y as cy}from"./7KN1XG01.js";import{B as uy,p as Pt,i as xt,c as st,a as Mo,d as vn,b as Zl,r as Hl}from"./jQt6__yx.js";const hy=[];function od(I,_=!1,G=!1){return ed(I,new Map,"",hy,null,G)}function ed(I,_,G,B,me=null,ae=!1){if(typeof I=="object"&&I!==null){var S=_.get(I);if(S!==void 0)return S;if(I instanceof Map)return new Map(I);if(I instanceof Set)return new Set(I);if(qp(I)){var l=Array(I.length);_.set(I,l),me!==null&&_.set(me,l);for(var q=0;q<I.length;q+=1){var xe=I[q];q in I&&(l[q]=ed(xe,_,G,B,null,ae))}return l}if(Pg(I)===zv){l={},_.set(I,l),me!==null&&_.set(me,l);for(var Ie in I)l[Ie]=ed(I[Ie],_,G,B,null,ae);return l}if(I instanceof Date)return structuredClone(I);if(typeof I.toJSON=="function"&&!ae)return ed(I.toJSON(),_,G,B,I)}if(I instanceof EventTarget)return I;try{return structuredClone(I)}catch{return I}}function Ur(I,_){return _}function dy(I,_,G){for(var B=[],me=_.length,ae,S=_.length,l=0;l<me;l++){let qe=_[l];kg(qe,()=>{if(ae){if(ae.pending.delete(qe),ae.done.add(qe),ae.pending.size===0){var Ne=I.outrogroups;jp(Zp(ae.done)),Ne.delete(ae),Ne.size===0&&(I.outrogroups=null)}}else S-=1},!1)}if(S===0){var q=B.length===0&&G!==null;if(q){var xe=G,Ie=xe.parentNode;qv(Ie),Ie.append(xe),I.items.clear()}jp(_,!q)}else ae={pending:new Set(_),done:new Set},(I.outrogroups??=new Set).add(ae)}function jp(I,_=!0){for(var G=0;G<I.length;G++)Zv(I[G],_)}var dg;function Er(I,_,G,B,me,ae=null){var S=I,l=new Map,q=(_&Mg)!==0;if(q){var xe=I;S=Pn?Jh(pu(xe)):xe.appendChild(zp())}Pn&&Np();var Ie=null,qe=Dv(()=>{var Ve=G();return qp(Ve)?Ve:Ve==null?[]:Zp(Ve)}),Ne,Xe=!0;function He(){Z.fallback=Ie,py(Z,Ne,S,_,B),Ie!==null&&(Ne.length===0?(Ie.f&ia)===0?Ag(Ie):(Ie.f^=ia,fu(Ie,null,S)):kg(Ie,()=>{Ie=null}))}var Ee=Ig(()=>{Ne=w(qe);var Ve=Ne.length;let ut=!1;if(Pn){var vt=Lv(S)===Rv;vt!==(Ve===0)&&(S=cg(),Jh(S),Dp(!1),ut=!0)}for(var Ke=new Set,nt=ta,rt=Ov(),Oe=0;Oe<Ve;Oe+=1){Pn&&Ul.nodeType===Eg&&Ul.data===Fv&&(S=Ul,ut=!0,Dp(!1));var Fe=Ne[Oe],lt=B(Fe,Oe),Re=Xe?null:l.get(lt);Re?(Re.v&&ug(Re.v,Fe),Re.i&&ug(Re.i,Oe),rt&&nt.skipped_effects.delete(Re.e)):(Re=fy(l,Xe?S:dg??=zp(),Fe,lt,Oe,me,_,G),Xe||(Re.e.f|=ia),l.set(lt,Re)),Ke.add(lt)}if(Ve===0&&ae&&!Ie&&(Xe?Ie=Vp(()=>ae(S)):(Ie=Vp(()=>ae(dg??=zp())),Ie.f|=ia)),Pn&&Ve>0&&Jh(cg()),!Xe)if(rt){for(const[pt,ft]of l)Ke.has(pt)||nt.skipped_effects.add(ft.e);nt.oncommit(He),nt.ondiscard(()=>{})}else He();ut&&Dp(!0),w(qe)}),Z={effect:Ee,items:l,outrogroups:null,fallback:Ie};Xe=!1,Pn&&(S=Ul)}function hu(I){for(;I!==null&&(I.f&Uv)===0;)I=I.next;return I}function py(I,_,G,B,me){var ae=(B&Gv)!==0,S=_.length,l=I.items,q=hu(I.effect.first),xe,Ie=null,qe,Ne=[],Xe=[],He,Ee,Z,Ve;if(ae)for(Ve=0;Ve<S;Ve+=1)He=_[Ve],Ee=me(He,Ve),Z=l.get(Ee).e,(Z.f&ia)===0&&(Z.nodes?.a?.measure(),(qe??=new Set).add(Z));for(Ve=0;Ve<S;Ve+=1){if(He=_[Ve],Ee=me(He,Ve),Z=l.get(Ee).e,I.outrogroups!==null)for(const Re of I.outrogroups)Re.pending.delete(Z),Re.done.delete(Z);if((Z.f&ia)!==0)if(Z.f^=ia,Z===q)fu(Z,null,G);else{var ut=Ie?Ie.next:q;Z===I.effect.last&&(I.effect.last=Z.prev),Z.prev&&(Z.prev.next=Z.next),Z.next&&(Z.next.prev=Z.prev),Fa(I,Ie,Z),Fa(I,Z,ut),fu(Z,ut,G),Ie=Z,Ne=[],Xe=[],q=hu(Ie.next);continue}if((Z.f&Lp)!==0&&(Ag(Z),ae&&(Z.nodes?.a?.unfix(),(qe??=new Set).delete(Z))),Z!==q){if(xe!==void 0&&xe.has(Z)){if(Ne.length<Xe.length){var vt=Xe[0],Ke;Ie=vt.prev;var nt=Ne[0],rt=Ne[Ne.length-1];for(Ke=0;Ke<Ne.length;Ke+=1)fu(Ne[Ke],vt,G);for(Ke=0;Ke<Xe.length;Ke+=1)xe.delete(Xe[Ke]);Fa(I,nt.prev,rt.next),Fa(I,Ie,nt),Fa(I,rt,vt),q=vt,Ie=rt,Ve-=1,Ne=[],Xe=[]}else xe.delete(Z),fu(Z,q,G),Fa(I,Z.prev,Z.next),Fa(I,Z,Ie===null?I.effect.first:Ie.next),Fa(I,Ie,Z),Ie=Z;continue}for(Ne=[],Xe=[];q!==null&&q!==Z;)(xe??=new Set).add(q),Xe.push(q),q=hu(q.next);if(q===null)continue}(Z.f&ia)===0&&Ne.push(Z),Ie=Z,q=hu(Z.next)}if(I.outrogroups!==null){for(const Re of I.outrogroups)Re.pending.size===0&&(jp(Zp(Re.done)),I.outrogroups?.delete(Re));I.outrogroups.size===0&&(I.outrogroups=null)}if(q!==null||xe!==void 0){var Oe=[];if(xe!==void 0)for(Z of xe)(Z.f&Lp)===0&&Oe.push(Z);for(;q!==null;)(q.f&Lp)===0&&q!==I.fallback&&Oe.push(q),q=hu(q.next);var Fe=Oe.length;if(Fe>0){var lt=(B&Mg)!==0&&S===0?G:null;if(ae){for(Ve=0;Ve<Fe;Ve+=1)Oe[Ve].nodes?.a?.measure();for(Ve=0;Ve<Fe;Ve+=1)Oe[Ve].nodes?.a?.fix()}dy(I,Oe,lt)}}ae&&Hp(()=>{if(qe!==void 0)for(Z of qe)Z.nodes?.a?.apply()})}function fy(I,_,G,B,me,ae,S,l){var q=(S&Nv)!==0?(S&Vv)===0?Bv(G,!1,!1):hg(G):null,xe=(S&jv)!==0?hg(me):null;return{v:q,i:xe,e:Vp(()=>(ae(_,q??G,xe??me,l),()=>{I.delete(B)}))}}function fu(I,_,G){if(I.nodes)for(var B=I.nodes.start,me=I.nodes.end,ae=_&&(_.f&ia)===0?_.nodes.start:G;B!==null;){var S=zg(B);if(ae.before(B),B===me)return;B=S}}function Fa(I,_,G){_===null?I.effect.first=G:_.next=G,G===null?I.effect.last=_:G.prev=_}function Wi(I,_,G=!1,B=!1,me=!1){var ae=I,S="";zt(()=>{var l=Dg;if(S===(S=_()??"")){Pn&&Np();return}if(l.nodes!==null&&(Hv(l.nodes.start,l.nodes.end),l.nodes=null),S!==""){if(Pn){Ul.data;for(var q=Np(),xe=q;q!==null&&(q.nodeType!==Eg||q.data!=="");)xe=q,q=zg(q);if(q===null)throw Wv(),Xv;lg(Ul,xe),ae=Jh(q);return}var Ie=S+"";G?Ie=`<svg>${Ie}</svg>`:B&&(Ie=`<math>${Ie}</math>`);var qe=Av(Ie);if((G||B)&&(qe=pu(qe)),lg(pu(qe),qe.lastChild),G||B)for(;pu(qe);)ae.before(pu(qe));else ae.before(qe)}})}function co(I,_,...G){var B=new uy(I);Ig(()=>{const me=_()??null;B.ensure(me,me&&(ae=>me(ae,...G)))},Lg)}const my=()=>performance.now(),ra={tick:I=>requestAnimationFrame(I),now:()=>my(),tasks:new Set};function Ug(){const I=ra.now();ra.tasks.forEach(_=>{_.c(I)||(ra.tasks.delete(_),_.f())}),ra.tasks.size!==0&&ra.tick(Ug)}function gy(I){let _;return ra.tasks.size===0&&ra.tick(Ug),{promise:new Promise(G=>{ra.tasks.add(_={c:I,f:G})}),abort(){ra.tasks.delete(_)}}}function Yh(I,_){Fg(()=>{I.dispatchEvent(new CustomEvent(_))})}function _y(I){if(I==="float")return"cssFloat";if(I==="offset")return"cssOffset";if(I.startsWith("--"))return I;const _=I.split("-");return _.length===1?_[0]:_[0]+_.slice(1).map(G=>G[0].toUpperCase()+G.slice(1)).join("")}function pg(I){const _={},G=I.split(";");for(const B of G){const[me,ae]=B.split(":");if(!me||ae===void 0)break;const S=_y(me.trim());_[S]=ae.trim()}return _}const vy=I=>I;function Dn(I,_,G,B){var me=(I&Qv)!==0,ae="both",S,l=_.inert,q=_.style.overflow,xe,Ie;function qe(){return Fg(()=>S??=G()(_,B?.()??{},{direction:ae}))}var Ne={is_global:me,in(){_.inert=l,Yh(_,"introstart"),xe=Up(_,qe(),Ie,1,()=>{Yh(_,"introend"),xe?.abort(),xe=S=void 0,_.style.overflow=q})},out(Z){_.inert=!0,Yh(_,"outrostart"),Ie=Up(_,qe(),xe,0,()=>{Yh(_,"outroend"),Z?.()})},stop:()=>{xe?.abort(),Ie?.abort()}},Xe=Dg;if((Xe.nodes.t??=[]).push(Ne),kv){var He=me;if(!He){for(var Ee=Xe.parent;Ee&&(Ee.f&Lg)!==0;)for(;(Ee=Ee.parent)&&(Ee.f&Yv)===0;);He=!Ee||(Ee.f&Kv)!==0}He&&Rg(()=>{id(()=>Ne.in())})}}function Up(I,_,G,B,me){var ae=B===1;if(Jv(_)){var S,l=!1;return Hp(()=>{if(!l){var Z=_({direction:ae?"in":"out"});S=Up(I,Z,G,B,me)}}),{abort:()=>{l=!0,S?.abort()},deactivate:()=>S.deactivate(),reset:()=>S.reset(),t:()=>S.t()}}if(G?.deactivate(),!_?.duration)return me(),{abort:Wn,deactivate:Wn,reset:Wn,t:()=>B};const{delay:q=0,css:xe,tick:Ie,easing:qe=vy}=_;var Ne=[];if(ae&&G===void 0&&(Ie&&Ie(0,1),xe)){var Xe=pg(xe(0,1));Ne.push(Xe,Xe)}var He=()=>1-B,Ee=I.animate(Ne,{duration:q,fill:"forwards"});return Ee.onfinish=()=>{Ee.cancel();var Z=G?.t()??1-B;G?.abort();var Ve=B-Z,ut=_.duration*Math.abs(Ve),vt=[];if(ut>0){var Ke=!1;if(xe)for(var nt=Math.ceil(ut/16.666666666666668),rt=0;rt<=nt;rt+=1){var Oe=Z+Ve*qe(rt/nt),Fe=pg(xe(Oe,1-Oe));vt.push(Fe),Ke||=Fe.overflow==="hidden"}Ke&&(I.style.overflow="hidden"),He=()=>{var lt=Ee.currentTime;return Z+Ve*qe(lt/ut)},Ie&&gy(()=>{if(Ee.playState!=="running")return!1;var lt=He();return Ie(lt,1-lt),!0})}Ee=I.animate(vt,{duration:ut,fill:"forwards"}),Ee.onfinish=()=>{He=()=>B,Ie?.(B,1-B),me()}},{abort:()=>{Ee&&(Ee.cancel(),Ee.effect=null,Ee.onfinish=Wn)},deactivate:()=>{me=Wn},reset:()=>{B===0&&Ie?.(1,0)},t:()=>He()}}function Gg(I){var _,G,B="";if(typeof I=="string"||typeof I=="number")B+=I;else if(typeof I=="object")if(Array.isArray(I)){var me=I.length;for(_=0;_<me;_++)I[_]&&(G=Gg(I[_]))&&(B&&(B+=" "),B+=G)}else for(G in I)I[G]&&(B&&(B+=" "),B+=G);return B}function yy(){for(var I,_,G=0,B="",me=arguments.length;G<me;G++)(I=arguments[G])&&(_=Gg(I))&&(B&&(B+=" "),B+=_);return B}function Zr(I){return typeof I=="object"?yy(I):I??""}const fg=[...` 	
\r\f \v\uFEFF`];function xy(I,_,G){var B=I==null?"":""+I;if(_&&(B=B?B+" "+_:_),G){for(var me in G)if(G[me])B=B?B+" "+me:me;else if(B.length)for(var ae=me.length,S=0;(S=B.indexOf(me,S))>=0;){var l=S+ae;(S===0||fg.includes(B[S-1]))&&(l===B.length||fg.includes(B[l]))?B=(S===0?"":B.substring(0,S))+B.substring(l+1):S=l}}return B===""?null:B}function by(I,_){return I==null?null:String(I)}function Gt(I,_,G,B,me,ae){var S=I.__className;if(Pn||S!==G||S===void 0){var l=xy(G,B,ae);(!Pn||l!==I.getAttribute("class"))&&(l==null?I.removeAttribute("class"):I.className=l),I.__className=G}else if(ae&&me!==ae)for(var q in ae){var xe=!!ae[q];(me==null||xe!==!!me[q])&&I.classList.toggle(q,xe)}return ae}function hi(I,_,G,B){var me=I.__style;if(Pn||me!==_){var ae=by(_);(!Pn||ae!==I.getAttribute("style"))&&(ae==null?I.removeAttribute("style"):I.style.cssText=ae),I.__style=_}return B}function qg(I,_,G=!1){if(I.multiple){if(_==null)return;if(!qp(_))return $v();for(var B of I.options)B.selected=_.includes(mu(B));return}for(B of I.options){var me=mu(B);if(ey(me,_)){B.selected=!0;return}}(!G||_!==void 0)&&(I.selectedIndex=-1)}function wy(I){var _=new MutationObserver(()=>{qg(I,I.__value)});_.observe(I,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),ty(()=>{_.disconnect()})}function Ty(I,_,G=_){var B=new WeakSet,me=!0;Og(I,"change",ae=>{var S=ae?"[selected]":":checked",l;if(I.multiple)l=[].map.call(I.querySelectorAll(S),mu);else{var q=I.querySelector(S)??I.querySelector("option:not([disabled])");l=q&&mu(q)}G(l),ta!==null&&B.add(ta)}),Rg(()=>{var ae=_();if(I===document.activeElement){var S=Bg??ta;if(B.has(S))return}if(qg(I,ae,me),me&&ae===void 0){var l=I.querySelector(":checked");l!==null&&(ae=mu(l),G(ae))}I.__value=ae,me=!1}),wy(I)}function mu(I){return"__value"in I?I.__value:I.value}const Cy=Symbol("is custom element"),Sy=Symbol("is html");function Va(I){if(Pn){var _=!1,G=()=>{if(!_){if(_=!0,I.hasAttribute("value")){var B=I.value;tr(I,"value",null),I.value=B}if(I.hasAttribute("checked")){var me=I.checked;tr(I,"checked",null),I.checked=me}}};I.__on_r=G,Hp(G),oy()}}function gu(I,_){var G=Wp(I);G.value===(G.value=_??void 0)||I.value===_&&(_!==0||I.nodeName!=="PROGRESS")||(I.value=_??"")}function mg(I,_){var G=Wp(I);G.checked!==(G.checked=_??void 0)&&(I.checked=_)}function tr(I,_,G,B){var me=Wp(I);Pn&&(me[_]=I.getAttribute(_),_==="src"||_==="srcset"||_==="href"&&I.nodeName==="LINK")||me[_]!==(me[_]=G)&&(_==="loading"&&(I[ry]=G),G==null?I.removeAttribute(_):typeof G!="string"&&Py(I).includes(_)?I[_]=G:I.setAttribute(_,G))}function Wp(I){return I.__attributes??={[Cy]:I.nodeName.includes("-"),[Sy]:I.namespaceURI===iy}}var gg=new Map;function Py(I){var _=I.getAttribute("is")||I.nodeName,G=gg.get(_);if(G)return G;gg.set(_,G=[]);for(var B,me=I,ae=Element.prototype;ae!==me;){B=ny(me);for(var S in B)B[S].set&&G.push(S);me=Pg(me)}return G}function ql(I,_,G=_){var B=new WeakSet;Og(I,"input",async me=>{var ae=me?I.defaultValue:I.value;if(ae=Rp(I)?Fp(ae):ae,G(ae),ta!==null&&B.add(ta),await $h(),ae!==(ae=_())){var S=I.selectionStart,l=I.selectionEnd,q=I.value.length;if(I.value=ae??"",l!==null){var xe=I.value.length;S===l&&l===q&&xe>q?(I.selectionStart=xe,I.selectionEnd=xe):(I.selectionStart=S,I.selectionEnd=Math.min(l,xe))}}}),(Pn&&I.defaultValue!==I.value||id(_)==null&&I.value)&&(G(Rp(I)?Fp(I.value):I.value),ta!==null&&B.add(ta)),ay(()=>{var me=_();if(I===document.activeElement){var ae=Bg??ta;if(B.has(ae))return}Rp(I)&&me===Fp(I.value)||I.type==="date"&&!me&&!I.value||me!==I.value&&(I.value=me??"")})}function Rp(I){var _=I.type;return _==="number"||_==="range"}function Fp(I){return I===""?null:+I}const Iy=I=>I;function Xp(I){const _=I-1;return _*_*_+1}function _g(I){const _=typeof I=="string"&&I.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return _?[parseFloat(_[1]),_[2]||"px"]:[I,"px"]}function ad(I,{delay:_=0,duration:G=400,easing:B=Iy}={}){const me=+getComputedStyle(I).opacity;return{delay:_,duration:G,easing:B,css:ae=>`opacity: ${ae*me}`}}function sd(I,{delay:_=0,duration:G=400,easing:B=Xp,x:me=0,y:ae=0,opacity:S=0}={}){const l=getComputedStyle(I),q=+l.opacity,xe=l.transform==="none"?"":l.transform,Ie=q*(1-S),[qe,Ne]=_g(me),[Xe,He]=_g(ae);return{delay:_,duration:G,easing:B,css:(Ee,Z)=>`
			transform: ${xe} translate(${(1-Ee)*qe}${Ne}, ${(1-Ee)*Xe}${He});
			opacity: ${q-Ie*Z}`}}function _u(I,{delay:_=0,duration:G=400,easing:B=Xp,axis:me="y"}={}){const ae=getComputedStyle(I),S=+ae.opacity,l=me==="y"?"height":"width",q=parseFloat(ae[l]),xe=me==="y"?["top","bottom"]:["left","right"],Ie=xe.map(Ve=>`${Ve[0].toUpperCase()}${Ve.slice(1)}`),qe=parseFloat(ae[`padding${Ie[0]}`]),Ne=parseFloat(ae[`padding${Ie[1]}`]),Xe=parseFloat(ae[`margin${Ie[0]}`]),He=parseFloat(ae[`margin${Ie[1]}`]),Ee=parseFloat(ae[`border${Ie[0]}Width`]),Z=parseFloat(ae[`border${Ie[1]}Width`]);return{delay:_,duration:G,easing:B,css:Ve=>`overflow: hidden;opacity: ${Math.min(Ve*20,1)*S};${l}: ${Ve*q}px;padding-${xe[0]}: ${Ve*qe}px;padding-${xe[1]}: ${Ve*Ne}px;margin-${xe[0]}: ${Ve*Xe}px;margin-${xe[1]}: ${Ve*He}px;border-${xe[0]}-width: ${Ve*Ee}px;border-${xe[1]}-width: ${Ve*Z}px;min-${l}: 0`}}function My(I,{delay:_=0,duration:G=400,easing:B=Xp,start:me=0,opacity:ae=0}={}){const S=getComputedStyle(I),l=+S.opacity,q=S.transform==="none"?"":S.transform,xe=1-me,Ie=l*(1-ae);return{delay:_,duration:G,easing:B,css:(qe,Ne)=>`
			transform: ${q} scale(${1-xe*Ne});
			opacity: ${l-Ie*Ne}
		`}}const Ey=(I,_)=>{const G=new Array(I.length+_.length);for(let B=0;B<I.length;B++)G[B]=I[B];for(let B=0;B<_.length;B++)G[I.length+B]=_[B];return G},Ay=(I,_)=>({classGroupId:I,validator:_}),Zg=(I=new Map,_=null,G)=>({nextPart:I,validators:_,classGroupId:G}),nd="-",vg=[],ky="arbitrary..",zy=I=>{const _=Ly(I),{conflictingClassGroups:G,conflictingClassGroupModifiers:B}=I;return{getClassGroupId:S=>{if(S.startsWith("[")&&S.endsWith("]"))return Dy(S);const l=S.split(nd),q=l[0]===""&&l.length>1?1:0;return Hg(l,q,_)},getConflictingClassGroupIds:(S,l)=>{if(l){const q=B[S],xe=G[S];return q?xe?Ey(xe,q):q:xe||vg}return G[S]||vg}}},Hg=(I,_,G)=>{if(I.length-_===0)return G.classGroupId;const me=I[_],ae=G.nextPart.get(me);if(ae){const xe=Hg(I,_+1,ae);if(xe)return xe}const S=G.validators;if(S===null)return;const l=_===0?I.join(nd):I.slice(_).join(nd),q=S.length;for(let xe=0;xe<q;xe++){const Ie=S[xe];if(Ie.validator(l))return Ie.classGroupId}},Dy=I=>I.slice(1,-1).indexOf(":")===-1?void 0:(()=>{const _=I.slice(1,-1),G=_.indexOf(":"),B=_.slice(0,G);return B?ky+B:void 0})(),Ly=I=>{const{theme:_,classGroups:G}=I;return Ry(G,_)},Ry=(I,_)=>{const G=Zg();for(const B in I){const me=I[B];Yp(me,G,B,_)}return G},Yp=(I,_,G,B)=>{const me=I.length;for(let ae=0;ae<me;ae++){const S=I[ae];Fy(S,_,G,B)}},Fy=(I,_,G,B)=>{if(typeof I=="string"){Oy(I,_,G);return}if(typeof I=="function"){By(I,_,G,B);return}Ny(I,_,G,B)},Oy=(I,_,G)=>{const B=I===""?_:Wg(_,I);B.classGroupId=G},By=(I,_,G,B)=>{if(Vy(I)){Yp(I(B),_,G,B);return}_.validators===null&&(_.validators=[]),_.validators.push(Ay(G,I))},Ny=(I,_,G,B)=>{const me=Object.entries(I),ae=me.length;for(let S=0;S<ae;S++){const[l,q]=me[S];Yp(q,Wg(_,l),G,B)}},Wg=(I,_)=>{let G=I;const B=_.split(nd),me=B.length;for(let ae=0;ae<me;ae++){const S=B[ae];let l=G.nextPart.get(S);l||(l=Zg(),G.nextPart.set(S,l)),G=l}return G},Vy=I=>"isThemeGetter"in I&&I.isThemeGetter===!0,jy=I=>{if(I<1)return{get:()=>{},set:()=>{}};let _=0,G=Object.create(null),B=Object.create(null);const me=(ae,S)=>{G[ae]=S,_++,_>I&&(_=0,B=G,G=Object.create(null))};return{get(ae){let S=G[ae];if(S!==void 0)return S;if((S=B[ae])!==void 0)return me(ae,S),S},set(ae,S){ae in G?G[ae]=S:me(ae,S)}}},Gp="!",yg=":",Uy=[],xg=(I,_,G,B,me)=>({modifiers:I,hasImportantModifier:_,baseClassName:G,maybePostfixModifierPosition:B,isExternal:me}),Gy=I=>{const{prefix:_,experimentalParseClassName:G}=I;let B=me=>{const ae=[];let S=0,l=0,q=0,xe;const Ie=me.length;for(let Ee=0;Ee<Ie;Ee++){const Z=me[Ee];if(S===0&&l===0){if(Z===yg){ae.push(me.slice(q,Ee)),q=Ee+1;continue}if(Z==="/"){xe=Ee;continue}}Z==="["?S++:Z==="]"?S--:Z==="("?l++:Z===")"&&l--}const qe=ae.length===0?me:me.slice(q);let Ne=qe,Xe=!1;qe.endsWith(Gp)?(Ne=qe.slice(0,-1),Xe=!0):qe.startsWith(Gp)&&(Ne=qe.slice(1),Xe=!0);const He=xe&&xe>q?xe-q:void 0;return xg(ae,Xe,Ne,He)};if(_){const me=_+yg,ae=B;B=S=>S.startsWith(me)?ae(S.slice(me.length)):xg(Uy,!1,S,void 0,!0)}if(G){const me=B;B=ae=>G({className:ae,parseClassName:me})}return B},qy=I=>{const _=new Map;return I.orderSensitiveModifiers.forEach((G,B)=>{_.set(G,1e6+B)}),G=>{const B=[];let me=[];for(let ae=0;ae<G.length;ae++){const S=G[ae],l=S[0]==="[",q=_.has(S);l||q?(me.length>0&&(me.sort(),B.push(...me),me=[]),B.push(S)):me.push(S)}return me.length>0&&(me.sort(),B.push(...me)),B}},Zy=I=>({cache:jy(I.cacheSize),parseClassName:Gy(I),sortModifiers:qy(I),...zy(I)}),Hy=/\s+/,Wy=(I,_)=>{const{parseClassName:G,getClassGroupId:B,getConflictingClassGroupIds:me,sortModifiers:ae}=_,S=[],l=I.trim().split(Hy);let q="";for(let xe=l.length-1;xe>=0;xe-=1){const Ie=l[xe],{isExternal:qe,modifiers:Ne,hasImportantModifier:Xe,baseClassName:He,maybePostfixModifierPosition:Ee}=G(Ie);if(qe){q=Ie+(q.length>0?" "+q:q);continue}let Z=!!Ee,Ve=B(Z?He.substring(0,Ee):He);if(!Ve){if(!Z){q=Ie+(q.length>0?" "+q:q);continue}if(Ve=B(He),!Ve){q=Ie+(q.length>0?" "+q:q);continue}Z=!1}const ut=Ne.length===0?"":Ne.length===1?Ne[0]:ae(Ne).join(":"),vt=Xe?ut+Gp:ut,Ke=vt+Ve;if(S.indexOf(Ke)>-1)continue;S.push(Ke);const nt=me(Ve,Z);for(let rt=0;rt<nt.length;++rt){const Oe=nt[rt];S.push(vt+Oe)}q=Ie+(q.length>0?" "+q:q)}return q},Xy=(...I)=>{let _=0,G,B,me="";for(;_<I.length;)(G=I[_++])&&(B=Xg(G))&&(me&&(me+=" "),me+=B);return me},Xg=I=>{if(typeof I=="string")return I;let _,G="";for(let B=0;B<I.length;B++)I[B]&&(_=Xg(I[B]))&&(G&&(G+=" "),G+=_);return G},Yy=(I,..._)=>{let G,B,me,ae;const S=q=>{const xe=_.reduce((Ie,qe)=>qe(Ie),I());return G=Zy(xe),B=G.cache.get,me=G.cache.set,ae=l,l(q)},l=q=>{const xe=B(q);if(xe)return xe;const Ie=Wy(q,G);return me(q,Ie),Ie};return ae=S,(...q)=>ae(Xy(...q))},Ky=[],Qi=I=>{const _=G=>G[I]||Ky;return _.isThemeGetter=!0,_},Yg=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,Kg=/^\((?:(\w[\w-]*):)?(.+)\)$/i,Qy=/^\d+\/\d+$/,Jy=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,$y=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,e1=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,t1=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,r1=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,jl=I=>Qy.test(I),qr=I=>!!I&&!Number.isNaN(Number(I)),Oa=I=>!!I&&Number.isInteger(Number(I)),Op=I=>I.endsWith("%")&&qr(I.slice(0,-1)),ea=I=>Jy.test(I),i1=()=>!0,n1=I=>$y.test(I)&&!e1.test(I),Qg=()=>!1,o1=I=>t1.test(I),a1=I=>r1.test(I),s1=I=>!nr(I)&&!or(I),l1=I=>Wl(I,e_,Qg),nr=I=>Yg.test(I),Rs=I=>Wl(I,t_,n1),Bp=I=>Wl(I,p1,qr),bg=I=>Wl(I,Jg,Qg),c1=I=>Wl(I,$g,a1),Kh=I=>Wl(I,r_,o1),or=I=>Kg.test(I),du=I=>Xl(I,t_),u1=I=>Xl(I,f1),wg=I=>Xl(I,Jg),h1=I=>Xl(I,e_),d1=I=>Xl(I,$g),Qh=I=>Xl(I,r_,!0),Wl=(I,_,G)=>{const B=Yg.exec(I);return B?B[1]?_(B[1]):G(B[2]):!1},Xl=(I,_,G=!1)=>{const B=Kg.exec(I);return B?B[1]?_(B[1]):G:!1},Jg=I=>I==="position"||I==="percentage",$g=I=>I==="image"||I==="url",e_=I=>I==="length"||I==="size"||I==="bg-size",t_=I=>I==="length",p1=I=>I==="number",f1=I=>I==="family-name",r_=I=>I==="shadow",m1=()=>{const I=Qi("color"),_=Qi("font"),G=Qi("text"),B=Qi("font-weight"),me=Qi("tracking"),ae=Qi("leading"),S=Qi("breakpoint"),l=Qi("container"),q=Qi("spacing"),xe=Qi("radius"),Ie=Qi("shadow"),qe=Qi("inset-shadow"),Ne=Qi("text-shadow"),Xe=Qi("drop-shadow"),He=Qi("blur"),Ee=Qi("perspective"),Z=Qi("aspect"),Ve=Qi("ease"),ut=Qi("animate"),vt=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Ke=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],nt=()=>[...Ke(),or,nr],rt=()=>["auto","hidden","clip","visible","scroll"],Oe=()=>["auto","contain","none"],Fe=()=>[or,nr,q],lt=()=>[jl,"full","auto",...Fe()],Re=()=>[Oa,"none","subgrid",or,nr],pt=()=>["auto",{span:["full",Oa,or,nr]},Oa,or,nr],ft=()=>[Oa,"auto",or,nr],gt=()=>["auto","min","max","fr",or,nr],bt=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],Ue=()=>["start","end","center","stretch","center-safe","end-safe"],Be=()=>["auto",...Fe()],Se=()=>[jl,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...Fe()],Te=()=>[I,or,nr],Ce=()=>[...Ke(),wg,bg,{position:[or,nr]}],we=()=>["no-repeat",{repeat:["","x","y","space","round"]}],be=()=>["auto","cover","contain",h1,l1,{size:[or,nr]}],ie=()=>[Op,du,Rs],ee=()=>["","none","full",xe,or,nr],Q=()=>["",qr,du,Rs],ue=()=>["solid","dashed","dotted","double"],De=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Ge=()=>[qr,Op,wg,bg],ot=()=>["","none",He,or,nr],it=()=>["none",qr,or,nr],It=()=>["none",qr,or,nr],Rt=()=>[qr,or,nr],Ft=()=>[jl,"full",...Fe()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[ea],breakpoint:[ea],color:[i1],container:[ea],"drop-shadow":[ea],ease:["in","out","in-out"],font:[s1],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[ea],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[ea],shadow:[ea],spacing:["px",qr],text:[ea],"text-shadow":[ea],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",jl,nr,or,Z]}],container:["container"],columns:[{columns:[qr,nr,or,l]}],"break-after":[{"break-after":vt()}],"break-before":[{"break-before":vt()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:nt()}],overflow:[{overflow:rt()}],"overflow-x":[{"overflow-x":rt()}],"overflow-y":[{"overflow-y":rt()}],overscroll:[{overscroll:Oe()}],"overscroll-x":[{"overscroll-x":Oe()}],"overscroll-y":[{"overscroll-y":Oe()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:lt()}],"inset-x":[{"inset-x":lt()}],"inset-y":[{"inset-y":lt()}],start:[{start:lt()}],end:[{end:lt()}],top:[{top:lt()}],right:[{right:lt()}],bottom:[{bottom:lt()}],left:[{left:lt()}],visibility:["visible","invisible","collapse"],z:[{z:[Oa,"auto",or,nr]}],basis:[{basis:[jl,"full","auto",l,...Fe()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[qr,jl,"auto","initial","none",nr]}],grow:[{grow:["",qr,or,nr]}],shrink:[{shrink:["",qr,or,nr]}],order:[{order:[Oa,"first","last","none",or,nr]}],"grid-cols":[{"grid-cols":Re()}],"col-start-end":[{col:pt()}],"col-start":[{"col-start":ft()}],"col-end":[{"col-end":ft()}],"grid-rows":[{"grid-rows":Re()}],"row-start-end":[{row:pt()}],"row-start":[{"row-start":ft()}],"row-end":[{"row-end":ft()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":gt()}],"auto-rows":[{"auto-rows":gt()}],gap:[{gap:Fe()}],"gap-x":[{"gap-x":Fe()}],"gap-y":[{"gap-y":Fe()}],"justify-content":[{justify:[...bt(),"normal"]}],"justify-items":[{"justify-items":[...Ue(),"normal"]}],"justify-self":[{"justify-self":["auto",...Ue()]}],"align-content":[{content:["normal",...bt()]}],"align-items":[{items:[...Ue(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...Ue(),{baseline:["","last"]}]}],"place-content":[{"place-content":bt()}],"place-items":[{"place-items":[...Ue(),"baseline"]}],"place-self":[{"place-self":["auto",...Ue()]}],p:[{p:Fe()}],px:[{px:Fe()}],py:[{py:Fe()}],ps:[{ps:Fe()}],pe:[{pe:Fe()}],pt:[{pt:Fe()}],pr:[{pr:Fe()}],pb:[{pb:Fe()}],pl:[{pl:Fe()}],m:[{m:Be()}],mx:[{mx:Be()}],my:[{my:Be()}],ms:[{ms:Be()}],me:[{me:Be()}],mt:[{mt:Be()}],mr:[{mr:Be()}],mb:[{mb:Be()}],ml:[{ml:Be()}],"space-x":[{"space-x":Fe()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":Fe()}],"space-y-reverse":["space-y-reverse"],size:[{size:Se()}],w:[{w:[l,"screen",...Se()]}],"min-w":[{"min-w":[l,"screen","none",...Se()]}],"max-w":[{"max-w":[l,"screen","none","prose",{screen:[S]},...Se()]}],h:[{h:["screen","lh",...Se()]}],"min-h":[{"min-h":["screen","lh","none",...Se()]}],"max-h":[{"max-h":["screen","lh",...Se()]}],"font-size":[{text:["base",G,du,Rs]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[B,or,Bp]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",Op,nr]}],"font-family":[{font:[u1,nr,_]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[me,or,nr]}],"line-clamp":[{"line-clamp":[qr,"none",or,Bp]}],leading:[{leading:[ae,...Fe()]}],"list-image":[{"list-image":["none",or,nr]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",or,nr]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:Te()}],"text-color":[{text:Te()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...ue(),"wavy"]}],"text-decoration-thickness":[{decoration:[qr,"from-font","auto",or,Rs]}],"text-decoration-color":[{decoration:Te()}],"underline-offset":[{"underline-offset":[qr,"auto",or,nr]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Fe()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",or,nr]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",or,nr]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:Ce()}],"bg-repeat":[{bg:we()}],"bg-size":[{bg:be()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},Oa,or,nr],radial:["",or,nr],conic:[Oa,or,nr]},d1,c1]}],"bg-color":[{bg:Te()}],"gradient-from-pos":[{from:ie()}],"gradient-via-pos":[{via:ie()}],"gradient-to-pos":[{to:ie()}],"gradient-from":[{from:Te()}],"gradient-via":[{via:Te()}],"gradient-to":[{to:Te()}],rounded:[{rounded:ee()}],"rounded-s":[{"rounded-s":ee()}],"rounded-e":[{"rounded-e":ee()}],"rounded-t":[{"rounded-t":ee()}],"rounded-r":[{"rounded-r":ee()}],"rounded-b":[{"rounded-b":ee()}],"rounded-l":[{"rounded-l":ee()}],"rounded-ss":[{"rounded-ss":ee()}],"rounded-se":[{"rounded-se":ee()}],"rounded-ee":[{"rounded-ee":ee()}],"rounded-es":[{"rounded-es":ee()}],"rounded-tl":[{"rounded-tl":ee()}],"rounded-tr":[{"rounded-tr":ee()}],"rounded-br":[{"rounded-br":ee()}],"rounded-bl":[{"rounded-bl":ee()}],"border-w":[{border:Q()}],"border-w-x":[{"border-x":Q()}],"border-w-y":[{"border-y":Q()}],"border-w-s":[{"border-s":Q()}],"border-w-e":[{"border-e":Q()}],"border-w-t":[{"border-t":Q()}],"border-w-r":[{"border-r":Q()}],"border-w-b":[{"border-b":Q()}],"border-w-l":[{"border-l":Q()}],"divide-x":[{"divide-x":Q()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":Q()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...ue(),"hidden","none"]}],"divide-style":[{divide:[...ue(),"hidden","none"]}],"border-color":[{border:Te()}],"border-color-x":[{"border-x":Te()}],"border-color-y":[{"border-y":Te()}],"border-color-s":[{"border-s":Te()}],"border-color-e":[{"border-e":Te()}],"border-color-t":[{"border-t":Te()}],"border-color-r":[{"border-r":Te()}],"border-color-b":[{"border-b":Te()}],"border-color-l":[{"border-l":Te()}],"divide-color":[{divide:Te()}],"outline-style":[{outline:[...ue(),"none","hidden"]}],"outline-offset":[{"outline-offset":[qr,or,nr]}],"outline-w":[{outline:["",qr,du,Rs]}],"outline-color":[{outline:Te()}],shadow:[{shadow:["","none",Ie,Qh,Kh]}],"shadow-color":[{shadow:Te()}],"inset-shadow":[{"inset-shadow":["none",qe,Qh,Kh]}],"inset-shadow-color":[{"inset-shadow":Te()}],"ring-w":[{ring:Q()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:Te()}],"ring-offset-w":[{"ring-offset":[qr,Rs]}],"ring-offset-color":[{"ring-offset":Te()}],"inset-ring-w":[{"inset-ring":Q()}],"inset-ring-color":[{"inset-ring":Te()}],"text-shadow":[{"text-shadow":["none",Ne,Qh,Kh]}],"text-shadow-color":[{"text-shadow":Te()}],opacity:[{opacity:[qr,or,nr]}],"mix-blend":[{"mix-blend":[...De(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":De()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[qr]}],"mask-image-linear-from-pos":[{"mask-linear-from":Ge()}],"mask-image-linear-to-pos":[{"mask-linear-to":Ge()}],"mask-image-linear-from-color":[{"mask-linear-from":Te()}],"mask-image-linear-to-color":[{"mask-linear-to":Te()}],"mask-image-t-from-pos":[{"mask-t-from":Ge()}],"mask-image-t-to-pos":[{"mask-t-to":Ge()}],"mask-image-t-from-color":[{"mask-t-from":Te()}],"mask-image-t-to-color":[{"mask-t-to":Te()}],"mask-image-r-from-pos":[{"mask-r-from":Ge()}],"mask-image-r-to-pos":[{"mask-r-to":Ge()}],"mask-image-r-from-color":[{"mask-r-from":Te()}],"mask-image-r-to-color":[{"mask-r-to":Te()}],"mask-image-b-from-pos":[{"mask-b-from":Ge()}],"mask-image-b-to-pos":[{"mask-b-to":Ge()}],"mask-image-b-from-color":[{"mask-b-from":Te()}],"mask-image-b-to-color":[{"mask-b-to":Te()}],"mask-image-l-from-pos":[{"mask-l-from":Ge()}],"mask-image-l-to-pos":[{"mask-l-to":Ge()}],"mask-image-l-from-color":[{"mask-l-from":Te()}],"mask-image-l-to-color":[{"mask-l-to":Te()}],"mask-image-x-from-pos":[{"mask-x-from":Ge()}],"mask-image-x-to-pos":[{"mask-x-to":Ge()}],"mask-image-x-from-color":[{"mask-x-from":Te()}],"mask-image-x-to-color":[{"mask-x-to":Te()}],"mask-image-y-from-pos":[{"mask-y-from":Ge()}],"mask-image-y-to-pos":[{"mask-y-to":Ge()}],"mask-image-y-from-color":[{"mask-y-from":Te()}],"mask-image-y-to-color":[{"mask-y-to":Te()}],"mask-image-radial":[{"mask-radial":[or,nr]}],"mask-image-radial-from-pos":[{"mask-radial-from":Ge()}],"mask-image-radial-to-pos":[{"mask-radial-to":Ge()}],"mask-image-radial-from-color":[{"mask-radial-from":Te()}],"mask-image-radial-to-color":[{"mask-radial-to":Te()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":Ke()}],"mask-image-conic-pos":[{"mask-conic":[qr]}],"mask-image-conic-from-pos":[{"mask-conic-from":Ge()}],"mask-image-conic-to-pos":[{"mask-conic-to":Ge()}],"mask-image-conic-from-color":[{"mask-conic-from":Te()}],"mask-image-conic-to-color":[{"mask-conic-to":Te()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:Ce()}],"mask-repeat":[{mask:we()}],"mask-size":[{mask:be()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",or,nr]}],filter:[{filter:["","none",or,nr]}],blur:[{blur:ot()}],brightness:[{brightness:[qr,or,nr]}],contrast:[{contrast:[qr,or,nr]}],"drop-shadow":[{"drop-shadow":["","none",Xe,Qh,Kh]}],"drop-shadow-color":[{"drop-shadow":Te()}],grayscale:[{grayscale:["",qr,or,nr]}],"hue-rotate":[{"hue-rotate":[qr,or,nr]}],invert:[{invert:["",qr,or,nr]}],saturate:[{saturate:[qr,or,nr]}],sepia:[{sepia:["",qr,or,nr]}],"backdrop-filter":[{"backdrop-filter":["","none",or,nr]}],"backdrop-blur":[{"backdrop-blur":ot()}],"backdrop-brightness":[{"backdrop-brightness":[qr,or,nr]}],"backdrop-contrast":[{"backdrop-contrast":[qr,or,nr]}],"backdrop-grayscale":[{"backdrop-grayscale":["",qr,or,nr]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[qr,or,nr]}],"backdrop-invert":[{"backdrop-invert":["",qr,or,nr]}],"backdrop-opacity":[{"backdrop-opacity":[qr,or,nr]}],"backdrop-saturate":[{"backdrop-saturate":[qr,or,nr]}],"backdrop-sepia":[{"backdrop-sepia":["",qr,or,nr]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":Fe()}],"border-spacing-x":[{"border-spacing-x":Fe()}],"border-spacing-y":[{"border-spacing-y":Fe()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",or,nr]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[qr,"initial",or,nr]}],ease:[{ease:["linear","initial",Ve,or,nr]}],delay:[{delay:[qr,or,nr]}],animate:[{animate:["none",ut,or,nr]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[Ee,or,nr]}],"perspective-origin":[{"perspective-origin":nt()}],rotate:[{rotate:it()}],"rotate-x":[{"rotate-x":it()}],"rotate-y":[{"rotate-y":it()}],"rotate-z":[{"rotate-z":it()}],scale:[{scale:It()}],"scale-x":[{"scale-x":It()}],"scale-y":[{"scale-y":It()}],"scale-z":[{"scale-z":It()}],"scale-3d":["scale-3d"],skew:[{skew:Rt()}],"skew-x":[{"skew-x":Rt()}],"skew-y":[{"skew-y":Rt()}],transform:[{transform:[or,nr,"","none","gpu","cpu"]}],"transform-origin":[{origin:nt()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:Ft()}],"translate-x":[{"translate-x":Ft()}],"translate-y":[{"translate-y":Ft()}],"translate-z":[{"translate-z":Ft()}],"translate-none":["translate-none"],accent:[{accent:Te()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:Te()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",or,nr]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Fe()}],"scroll-mx":[{"scroll-mx":Fe()}],"scroll-my":[{"scroll-my":Fe()}],"scroll-ms":[{"scroll-ms":Fe()}],"scroll-me":[{"scroll-me":Fe()}],"scroll-mt":[{"scroll-mt":Fe()}],"scroll-mr":[{"scroll-mr":Fe()}],"scroll-mb":[{"scroll-mb":Fe()}],"scroll-ml":[{"scroll-ml":Fe()}],"scroll-p":[{"scroll-p":Fe()}],"scroll-px":[{"scroll-px":Fe()}],"scroll-py":[{"scroll-py":Fe()}],"scroll-ps":[{"scroll-ps":Fe()}],"scroll-pe":[{"scroll-pe":Fe()}],"scroll-pt":[{"scroll-pt":Fe()}],"scroll-pr":[{"scroll-pr":Fe()}],"scroll-pb":[{"scroll-pb":Fe()}],"scroll-pl":[{"scroll-pl":Fe()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",or,nr]}],fill:[{fill:["none",...Te()]}],"stroke-w":[{stroke:[qr,du,Rs,Bp]}],stroke:[{stroke:["none",...Te()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},ir=Yy(m1);var g1=Qe("<div><!></div>"),_1=Qe('<div class="p-1"><div><div><button class="flex w-full cursor-pointer items-center justify-between p-4 py-3.5 transition-shadow duration-250"><div class="flex w-full items-center"><span><!></span> <div><span> </span></div></div> <div class="w-10 pl-4"><svg xmlns="http://www.w3.org/2000/svg" class="h-[1.1rem] w-[1.1rem] transition-transform duration-250" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 12.5s-4.419 6-6 6s-6-6-6-6m12-7s-4.419 6-6 6s-6-6-6-6" color="currentColor"></path></svg></div></button> <!></div></div></div>');function iw(I,_){_i(_,!0);let G=Pt(_,"id",19,()=>crypto.randomUUID()),B=Pt(_,"isOpen",7,!1),me=Pt(_,"wrapperClass",3,""),ae=Pt(_,"size",19,()=>({width:1,height:1})),S=Pt(_,"label",19,()=>({name:"",class:"text-left",icon:null})),l=Pt(_,"image",3,"");const q=()=>B(!B());var xe=_1(),Ie=oe(xe),qe=oe(Ie),Ne=oe(qe);Ne.__click=q;var Xe=oe(Ne),He=oe(Xe);Gt(He,1,"flex h-7 w-7 shrink-0 items-center justify-center overflow-visible [&_svg]:h-full [&_svg]:max-h-full [&_svg]:w-full [&_svg]:max-w-full");var Ee=oe(He);{var Z=Fe=>{var lt=wr(),Re=$t(lt);{var pt=gt=>{var bt=wr(),Ue=$t(bt);Wi(Ue,()=>S().icon),ye(gt,bt)},ft=gt=>{const bt=ne(()=>S()?.icon);var Ue=wr(),Be=$t(Ue);st(Be,()=>w(bt),(Se,Te)=>{Te(Se,{})}),ye(gt,Ue)};xt(Re,gt=>{typeof S()?.icon=="string"?gt(pt):gt(ft,!1)})}ye(Fe,lt)};xt(Ee,Fe=>{S()?.icon&&Fe(Z)})}K(He);var Ve=de(He,2),ut=oe(Ve),vt=oe(ut,!0);K(ut),K(Ve),K(Xe);var Ke=de(Xe,2),nt=oe(Ke);K(Ke),K(Ne);var rt=de(Ne,2);{var Oe=Fe=>{var lt=g1(),Re=oe(lt);co(Re,()=>_.children??Wn),K(lt),zt(()=>{Gt(lt,1,`grid w-full p-4 sm:p-3 ${l()?"gap-x-2":"gap-2"} inset-shadow-[0_10px_10px_-15px_rgb(0_0_0_/0.5)]`),hi(lt,`grid-template-columns: repeat(${ae().width||10}, minmax(0, 1fr)); 
          grid-template-rows: repeat(${ae().height||2}, ${l()?"minmax(6.5rem, auto)":"auto"});
          ${l()?`background-image: url(${l()}); background-size: cover; background-position: center;`:""}`)}),Dn(3,lt,()=>_u,()=>({duration:250})),ye(Fe,lt)};xt(rt,Fe=>{B()&&Fe(Oe)})}K(qe),K(Ie),K(xe),zt((Fe,lt,Re,pt)=>{tr(Ie,"id",Fe),Gt(Ie,1,lt),Gt(Ve,1,`${Re??""} `),Gt(ut,1,`${pt??""} text-lg`),lr(vt,S()?.name),hi(nt,`transform: rotate(${B()?180:0}deg)`)},[()=>`${G()}-${crypto.randomUUID().slice(0,6)}`,()=>Zr(ir(`w-full rounded-xl bg-(--container-color) p-0
     transition-shadow duration-250 
     shadow-[0_0_3px_rgb(0_0_0_/0.25)] hover:shadow-[0_0_6px_rgb(0_0_0_/0.25)]`,me())),()=>ir("flex w-full justify-start",S().class?.split(" ").find(Fe=>Fe.startsWith("justify-"))),()=>ir(`m-0 origin-top-left cursor-pointer justify-end px-3 font-semibold transition duration-200 ${B()?"scale-110":""}`,S().class)]),Dn(3,Ie,()=>_u,()=>({duration:250})),ye(I,xe),vi()}Xi(["click"]);const v1={ru:{"common.select_tag":"Сделайте выбор","debug.baud_rate_data":"Данные","constructor.props.action.update":"Обновить","constructor.props.action.save":"Сохранить","constructor.props.action.nosend":"Без отправки","constructor.props.action.custom":"Свой аргумент","constructor.props.height.small":"Авто","constructor.props.height.medium":"Средняя","constructor.props.height.large":"Большая","constructor.props.align.left":"Слева","constructor.props.align.center":"По центру","constructor.props.align.right":"Справа","constructor.props.type.main":"Основной","constructor.props.type.sub":"Вложенный","constructor.props.type.text":"Текст","constructor.props.type.password":"Пароль","constructor.props.type.number":"Число","constructor.props.type.textarea":"Область ","constructor.props.type.single":"Простой","constructor.props.type.range":"Диапазон","constructor.props.type.small":"XS","constructor.props.type.base":"S","constructor.props.type.large":"M","constructor.props.type.huge":"L","constructor.props.type.massive":"XL","constructor.props.type.select":"Список","constructor.props.type.buttons":"Группа кнопок","constructor.props.type.selectput":"Список+ввод","constructor.props.valuetype.text":"Строка","constructor.props.valuetype.number":"Число","constructor.props.type.file":"Файл","constructor.props.type.image":"Изображение","constructor.props.type.cover":"Урезанный","constructor.props.type.contain":"Полный","constructor.props.type.square":"Квадрат","constructor.props.type.circle":"Круг","constructor.props.type.horizontal":"Горизонтально","constructor.props.type.vertical":"Вертикально","constructor.props.type.checkbox":"Галочка","constructor.props.type.full":"Полный","constructor.props.type.viewOnly":"Просмотр","constructor.props.type.hidden":"Скрыто","constructor.props.id":"Идентификатор","constructor.props.label":"Текст надписи","constructor.props.label.class":"Стили надписи","constructor.props.wrapperclass":"Стили обёртки","constructor.props.componentclass":"Стили компонента","constructor.props.svgicon":"SVG-иконка (строка)","constructor.props.open":"Разворачивание","constructor.props.defaultcolor":"Первоначальный цвет","constructor.props.file.accept":"Допустимые файлы","constructor.props.imageSize.height":"Высота, rem","constructor.props.imageSize.width":"Ширина, rem","constructor.props.fitmode":"Вид","constructor.props.form":"Форма","constructor.props.type":"Тип","constructor.props.size":"Размер","constructor.props.footer":"Нижняя панель","constructor.props.header":"Заголовок пакета","constructor.props.argument":"Аргумент","constructor.props.argument.info":"Пользовательский аргумент (a-z, A-Z, 0-9, -_!)","constructor.props.variables":"Перечень переменных","constructor.props.variables.info":"Поле для ввода имён переменных, разделенных пробелами","constructor.props.value":"Значение","constructor.props.value.info":"Поле для ввода Value пакета в формате JSON","constructor.props.align":"Выравнивание надписи","constructor.props.align.header":"Выравнивание заголовка","constructor.props.align.content":"Выравнивание контента","constructor.props.image":"Фоновое изображение","constructor.props.labelicon":"Иконка заголовка","constructor.props.markerIcon":"Иконка маркера","constructor.props.buttonIcon":"Иконка кнопки","constructor.props.removeimage":"Удалить изображение","constructor.props.name":"Текст","constructor.props.height":"Высота","constructor.props.colors":"Цвет фона","constructor.props.outline":"Границы таблицы","constructor.props.textcolors":"Цвет текста","constructor.props.textarea.rows":"Количество строк","constructor.props.autocomplete":"Автозаполнение","constructor.props.maxlength":"Максимальная длина","constructor.props.regexp":"Выражение валидации","constructor.props.regexp.info":"Введите RegExp без /.../ (например: ^\\d+$)","constructor.props.minnum":"Минимальное значение","constructor.props.maxnum":"Максимальное значение","constructor.props.step":"Шаг","constructor.props.rows":"Количество строк","constructor.props.placeholder":"Заполнитель","constructor.props.info":"Подсказка","constructor.props.info.side":"Положение подсказки","constructor.props.info.top":"Вверху","constructor.props.info.bottom":"Внизу","constructor.props.info.left":"Слева","constructor.props.info.right":"Справа","constructor.props.disabled":"Отключить","constructor.props.readonly":"Только для чтения","constructor.props.istest":"Тестовые данные","constructor.props.variable":"Имя переменной","constructor.props.widthMode":"Ширина кнопок","constructor.props.graphdata.title":"Начальные данные ","constructor.props.options.title":"Опции компонента","constructor.props.bits.title":"Биты","constructor.props.tabs.title":"Вкладки меню","constructor.props.valuetype":"Тип значения","constructor.props.action":"Действие при переключении","constructor.props.caption.left":"Надпись слева","constructor.props.caption.right":"Надпись справа","constructor.props.bold":"Жирный","constructor.props.italic":"Курсив","constructor.props.background":"Фон","constructor.props.min":"Минимальное значение","constructor.props.max":"Максимальное значение","constructor.props.units":"Единица измерения","constructor.props.optionclass":"Стили опции","constructor.props.optionvalue":"Значение","constructor.props.optionposition":"Позиция","constructor.props.optionname":"Текст","constructor.props.copy":"Копирование","constructor.props.size.height":"Высота сетки","constructor.props.size.width":"Ширина сетки","constructor.props.range":"Диапазон позиции битов ","constructor.props.icon.text.position":"Положение иконки","constructor.props.equal":"Равные","constructor.props.bitmode":"Битовый режим","constructor.props.access":"Доступ (не для владельца)","constructor.props.map.timeout":"Таймаут маркеров:","constructor.props.joystick.axes":"Названия осей","constructor.props.joystick.axes.info":"Поле для ввода названий осей, разделенных пробелами (2 или 3 названия)","constructor.props.file.select":"Выберите файл","constructor.props.file.notselected":"Файл не выбран","constructor.props.table.type":"Тип таблицы","constructor.props.table.type.table":"Статическая таблица","constructor.props.table.type.logger":"Таблица для логов","constructor.props.table.columns":"Колонки таблицы","constructor.props.table.columns.key":"Ключ","constructor.props.table.columns.label":"Название колонки","constructor.props.table.columns.width":"Ширина, %","constructor.props.table.columns.sortable":"Сортировка","constructor.props.table.columns.truncated":"Скрыть","constructor.props.table.columns.alt":"Альтернативное название иконок","constructor.props.table.columns.class":"Стили иконки","constructor.props.table.columns.defaultIcon":"Иконка по умолчанию","constructor.props.table.columns.image.width":"Ширина иконки, rem","constructor.props.table.columns.image.height":"Высота иконки, rem","constructor.props.table.deletecolumn":"Удалить колонку","constructor.props.table.deletebutton":"Удалить кнопку","constructor.props.table.addaction":"Добавить действие","constructor.props.table.addbutton":"Добавить кнопку","constructor.props.table.keys":"Перечень ключей","constructor.props.table.keys.info":"Ключи таблицы, значения которых будут возвращаться","constructor.props.table.select.keys":"Ключ строки","constructor.props.table.select.keys.info":"Ключ, по которому будет находиться значение поля для текущей строки","constructor.props.table.stashData":"Накопление данных","constructor.props.table.buffersize":"Размер буфера","constructor.props.table.clearButton":"Кнопка очистки","constructor.props.table.action.type.buttons":"Кнопки","constructor.props.table.action.type.select":"Селектор","constructor.props.icon.access":"Доступ","constructor.props.icon.common":"Общее","constructor.props.icon.scenarios":"Сценарии","constructor.props.icon.periphery":"Периферия","constructor.props.icon.media":"Медиа","constructor.props.icon.info":"Информация","constructor.props.icon.network":"Сеть","constructor.props.icon.power":"Питание","constructor.props.icon.settings":"Настройки","constructor.props.autocomplete.on":"Включено","constructor.props.autocomplete.off":"Выключено","constructor.props.autocomplete.name":"Полное имя","constructor.props.autocomplete.honorific-prefix":"Обращение (г-н, г-жа, др.)","constructor.props.autocomplete.given-name":"Имя","constructor.props.autocomplete.additional-name":"Отчество","constructor.props.autocomplete.family-name":"Фамилия","constructor.props.autocomplete.honorific-suffix":"Постфикс (мл., ст.)","constructor.props.autocomplete.nickname":"Псевдоним","constructor.props.autocomplete.username":"Имя пользователя","constructor.props.autocomplete.new-password":"Новый пароль","constructor.props.autocomplete.current-password":"Текущий пароль","constructor.props.autocomplete.one-time-code":"Одноразовый код","constructor.props.autocomplete.organization-title":"Должность","constructor.props.autocomplete.organization":"Организация","constructor.props.autocomplete.street-address":"Адрес, начиная с улицы","constructor.props.autocomplete.address-line1":"Адресная строка 1","constructor.props.autocomplete.address-line2":"Адресная строка 2","constructor.props.autocomplete.address-line3":"Адресная строка 3","constructor.props.autocomplete.address-level4":"Уровень адреса 4","constructor.props.autocomplete.address-level3":"Уровень адреса 3","constructor.props.autocomplete.address-level2":"Населённый пункт","constructor.props.autocomplete.address-level1":"Область, регион или штат","constructor.props.autocomplete.country":"Код страны","constructor.props.autocomplete.country-name":"Страна","constructor.props.autocomplete.postal-code":"Почтовый индекс","constructor.props.autocomplete.cc-name":"Имя владельца карты","constructor.props.autocomplete.cc-given-name":"Имя владельца карты","constructor.props.autocomplete.cc-additional-name":"Отчество владельца карты","constructor.props.autocomplete.cc-family-name":"Фамилия владельца карты","constructor.props.autocomplete.cc-number":"Номер карты","constructor.props.autocomplete.cc-exp":"Срок действия","constructor.props.autocomplete.cc-exp-month":"Месяц срока действия","constructor.props.autocomplete.cc-exp-year":"Год срока действия","constructor.props.autocomplete.cc-csc":"Код безопасности","constructor.props.autocomplete.cc-type":"Тип карты","constructor.props.autocomplete.transaction-currency":"Валюта транзакции","constructor.props.autocomplete.transaction-amount":"Сумма транзакции","constructor.props.autocomplete.language":"Язык","constructor.props.autocomplete.bday":"Дата рождения","constructor.props.autocomplete.bday-day":"День рождения","constructor.props.autocomplete.bday-month":"Месяц рождения","constructor.props.autocomplete.bday-year":"Год рождения","constructor.props.autocomplete.sex":"Пол","constructor.props.autocomplete.url":"URL-адрес","constructor.props.autocomplete.photo":"Фото","constructor.props.autocomplete.email":"Адрес электронной почты","constructor.props.autocomplete.tel":"Полный номер телефона","constructor.props.autocomplete.tel-country-code":"Код страны телефона","constructor.props.autocomplete.tel-national":"Национальный номер телефона","constructor.props.autocomplete.tel-area-code":"Код региона/области","constructor.props.autocomplete.tel-local":"Местный номер","constructor.props.autocomplete.tel-local-prefix":"Префикс местного номера","constructor.props.autocomplete.tel-local-suffix":"Суффикс местного номера","constructor.props.autocomplete.tel-extension":"Добавочный номер","constructor.props.autocomplete.impp":"Мессенджер","constructor.props.autocomplete.fax":"Номер факса"},en:{},zh:{}};var y1=$n('<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 512 512"><mask id="circleFlagsCn0"><circle cx="256" cy="256" r="256" fill="#fff"></circle></mask><g mask="url(#circleFlagsCn0)"><path fill="#d80027" d="M0 0h512v512H0z"></path><path fill="#ffda44" d="m140.1 155.8l22.1 68h71.5l-57.8 42.1l22.1 68l-57.9-42l-57.9 42l22.2-68l-57.9-42.1H118zm163.4 240.7l-16.9-20.8l-25 9.7l14.5-22.5l-16.9-20.9l25.9 6.9l14.6-22.5l1.4 26.8l26 6.9l-25.1 9.6zm33.6-61l8-25.6l-21.9-15.5l26.8-.4l7.9-25.6l8.7 25.4l26.8-.3l-21.5 16l8.6 25.4l-21.9-15.5zm45.3-147.6L370.6 212l19.2 18.7l-26.5-3.8l-11.8 24l-4.6-26.4l-26.6-3.8l23.8-12.5l-4.6-26.5l19.2 18.7zm-78.2-73l-2 26.7l24.9 10.1l-26.1 6.4l-1.9 26.8l-14.1-22.8l-26.1 6.4l17.3-20.5l-14.2-22.7l24.9 10.1z"></path></g></svg>');function x1(I){var _=y1();ye(I,_)}var b1=$n('<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 512 512"><mask id="circleFlagsRu0"><circle cx="256" cy="256" r="256" fill="#fff"></circle></mask><g mask="url(#circleFlagsRu0)"><path fill="#0052b4" d="M512 170v172l-256 32L0 342V170l256-32z"></path><path fill="#eee" d="M512 0v170H0V0Z"></path><path fill="#d80027" d="M512 342v170H0V342Z"></path></g></svg>');function w1(I){var _=b1();ye(I,_)}var T1=$n('<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 512 512"><clipPath id="svgIDa"><circle cx="256" cy="256" r="256"></circle></clipPath><g clip-path="url(#svgIDa)"><path fill="#eee" d="m0 0l8 16l-8 15v16l32 65l-32 64v32l32 48l-32 48v32l32 64l-32 65v47l16-8l15 8h16l65-32l64 32h32l48-32l48 32h32l64-32l65 32h47l-8-15l8-16v-16l-32-65l32-64v-32l-32-48l32-48v-32l-32-64l32-65V0l-15 8l-16-8h-16l-65 32l-64-32h-32l-48 32l-48-32h-32l-64 32L47 0H0z"></path><path fill="#0052b4" d="m47 0l129 129V0Zm289 0v129L465 0ZM0 47v129h129Zm512 0L383 176h129ZM0 336v129l129-129Zm383 0l129 129V336Zm-47 47v129h129zm-160 0L47 512h129Z"></path><path fill="#d80027" d="M208 0v208H0v96h208v208h96V304h208v-96H304V0h-96z"></path><path fill="#d80027" d="m336 336l176 176v-31L367 336Zm0-160L512 0h-31L336 145Zm-160 0L0 0v31l145 145zm0 160L0 512h31l145-145Z"></path></g></svg>');function C1(I){var _=T1();ye(I,_)}let td="ru";typeof window<"u"&&(td=localStorage.getItem("AppLanguage")||navigator.language?.split("-")[0]?.toLowerCase()||"ru",["ru","en","zh"].includes(td)||(td="ru"));const S1=sy(td),nw=[{id:"app-language-ru",name:"Русский",value:"ru",component:w1},{id:"app-language-en",name:"English",value:"en",component:C1},{id:"app-language-zh",name:"中国人",value:"zh",component:x1}];function P1(I,_){return v1[I]?.[_]||_}const po=Ng(S1,I=>_=>P1(I,_)),Tt=(I,_,G,B)=>{const me=JSON.parse(JSON.stringify(G.properties)),ae=I.split(".");let S=me;for(let l=0;l<ae.length-1;l++){const q=ae[l];S[q]||(S[q]={}),S=S[q]}S[ae[ae.length-1]]=_,B({properties:me})},ow=(I,_)=>({...I,access:_.access??I.access,name:_.name??I.name,properties:_.properties?{...I.properties,..._.properties}:I.properties,eventHandler:_.eventHandler?{...I.eventHandler,..._.eventHandler}:I.eventHandler});function at(){return crypto.randomUUID()}const Yl=Ng(po,I=>({HEADER_OPTIONS:[{id:at(),name:"GET",value:"GET"},{id:at(),name:"SET",value:"SET"},{id:at(),name:"OK!",value:"OK!"},{id:at(),name:"ER!",value:"ER!"}],SHORT_ARGUMENT_OPTION:[{id:at(),value:"NoSave",name:I("constructor.props.action.update")},{id:at(),value:"Save",name:I("constructor.props.action.save")},{id:at(),value:"NoSend",name:I("constructor.props.action.nosend")}],FULL_ARGUMENT_OPTION:[{id:at(),value:"NoSave",name:I("constructor.props.action.update")},{id:at(),value:"Save",name:I("constructor.props.action.save")},{id:at(),value:"",name:I("constructor.props.action.custom")}],ACCESS_OPTION:[{id:at(),value:"full",name:I("constructor.props.type.full")},{id:at(),value:"viewOnly",name:I("constructor.props.type.viewOnly")},{id:at(),value:"hidden",name:I("constructor.props.type.hidden")}],INPUT_TYPE_OPTIONS:[{id:at(),value:"text",name:I("constructor.props.type.text")},{id:at(),value:"password",name:I("constructor.props.type.password")},{id:at(),value:"number",name:I("constructor.props.type.number")},{id:at(),value:"text-area",name:I("constructor.props.type.textarea")}],SELECT_TYPE_OPTIONS:[{id:at(),value:"select",name:I("constructor.props.type.select")},{id:at(),value:"buttons",name:I("constructor.props.type.buttons")},{id:at(),value:"input",name:I("constructor.props.type.selectput")}],SELECT_VALUE_TYPE_OPTIONS:[{id:at(),value:"text",name:I("constructor.props.valuetype.text")},{id:at(),value:"number",name:I("constructor.props.valuetype.number")}],SLIDER_TYPE_OPTIONS:[{id:at(),value:"single",name:I("constructor.props.type.single")},{id:at(),value:"range",name:I("constructor.props.type.range")}],TEXTFIELD_SIZE_OPTIONS:[{id:at(),value:"small",name:I("constructor.props.type.small")},{id:at(),value:"base",name:I("constructor.props.type.base")},{id:at(),value:"large",name:I("constructor.props.type.large")},{id:at(),value:"huge",name:I("constructor.props.type.huge")},{id:at(),value:"massive",name:I("constructor.props.type.massive")}],COLOR_OPTIONS:[{id:at(),name:"",value:"bg-max",class:"bg-max"},{id:at(),name:"",value:"bg-red",class:"bg-red"},{id:at(),name:"",value:"bg-yellow",class:"bg-yellow"},{id:at(),name:"",value:"bg-green",class:"bg-green"},{id:at(),name:"",value:"bg-blue",class:"bg-blue"},{id:at(),name:"",value:"bg-purple",class:"bg-purple"},{id:at(),name:"",value:"bg-gray",class:"bg-gray"}],TEXT_COLOR_OPTIONS:[{id:at(),name:"",value:"text-[#333] dark:text-[#e2e3e7]",class:"bg-[var(--shadow-color)] dark:bg-[#e2e3e7] "},{id:at(),name:"",value:"text-red-500 dark:text-red-400",class:"bg-red-500 dark:bg-red-400"},{id:at(),name:"",value:"text-yellow-500 dark:text-yellow-400",class:"bg-yellow-500 dark:bg-yellow-400"},{id:at(),name:"",value:"text-green-500 dark:text-green-400",class:"bg-green-500 dark:bg-green-400"},{id:at(),name:"",value:"text-blue-500 dark:text-blue-400",class:"bg-blue-500 dark:bg-blue-400"},{id:at(),name:"",value:"text-purple-500 dark:text-purple-400",class:"bg-purple-500 dark:bg-purple-400"},{id:at(),name:"",value:"text-gray-500 dark:text-gray-400",class:"bg-gray-500 dark:bg-gray-400"}],TEXT_ALIGN_OPTIONS:[{id:at(),value:"text-left",name:I("constructor.props.align.left")},{id:at(),value:"text-center",name:I("constructor.props.align.center")},{id:at(),value:"text-right",name:I("constructor.props.align.right")}],ALIGN_OPTIONS:[{id:at(),value:"left",name:I("constructor.props.align.left")},{id:at(),value:"center",name:I("constructor.props.align.center")},{id:at(),value:"right",name:I("constructor.props.align.right")}],JUSTIFY_ALIGN_OPTIONS:[{id:at(),value:"justify-start",name:I("constructor.props.align.left")},{id:at(),value:"justify-center",name:I("constructor.props.align.center")},{id:at(),value:"justify-end",name:I("constructor.props.align.right")}],ICON_TEXT_POSITION_OPTIONS:[{id:at(),value:"flex-row",name:"←"},{id:at(),value:"flex-col",name:"↑"},{id:at(),value:"flex-row-reverse",name:"→"},{id:at(),value:"flex-col-reverse",name:"↓"}],HEIGHT_OPTIONS:[{id:at(),value:"py-1",name:I("constructor.props.height.small")},{id:at(),value:"py-2",name:I("constructor.props.height.medium")},{id:at(),value:"py-3",name:I("constructor.props.height.large")}],ACCORDION_TYPE_OPTIONS:[{id:at(),value:!1,name:I("constructor.props.type.main")},{id:at(),value:!0,name:I("constructor.props.type.sub")}],FILE_ATTACH_TYPE_OPTIONS:[{id:at(),value:"file",name:I("constructor.props.type.file")},{id:at(),value:"image",name:I("constructor.props.type.image")}],FITMODE_OPTIONS:[{id:at(),value:"cover",name:I("constructor.props.type.cover")},{id:at(),value:"contain",name:I("constructor.props.type.contain")}],SWITCH_OPTIONS:[{id:at(),value:"horizontal",name:I("constructor.props.type.horizontal")},{id:at(),value:"vertical",name:I("constructor.props.type.vertical")},{id:at(),value:"checkbox",name:I("constructor.props.type.checkbox")}],INFO_SIDE_OPTIONS:[{id:at(),value:"top",name:I("constructor.props.info.top")},{id:at(),value:"bottom",name:I("constructor.props.info.bottom")},{id:at(),value:"left",name:I("constructor.props.info.left")},{id:at(),value:"right",name:I("constructor.props.info.right")}],FORM_OPTIONS:[{id:at(),value:"square",name:I("constructor.props.type.square")},{id:at(),value:"circle",name:I("constructor.props.type.circle")}],TABLE_TYPE_OPTIONS:[{id:at(),value:"table",name:I("constructor.props.table.type.table")},{id:at(),value:"logger",name:I("constructor.props.table.type.logger")}],ACTION_TYPE_OPTIONS:[{id:at(),value:"buttons",name:I("constructor.props.table.action.type.buttons")},{id:at(),value:"select",name:I("constructor.props.table.action.type.select")}],BUFFER_SIFE_OPTIONS:[{id:crypto.randomUUID(),value:10,name:"10"},{id:crypto.randomUUID(),value:50,name:"50"},{id:crypto.randomUUID(),value:100,name:"100"},{id:crypto.randomUUID(),value:500,name:"500"},{id:crypto.randomUUID(),value:1e3,name:"1000"}],AUTOCOMPLETE_CONSTRUCTOR_OPTIONS:[{id:at(),value:"on",name:I("constructor.props.autocomplete.on")},{id:at(),value:"off",name:I("constructor.props.autocomplete.off")},{id:at(),value:"given-name",name:I("constructor.props.autocomplete.given-name")},{id:at(),value:"family-name",name:I("constructor.props.autocomplete.family-name")},{id:at(),value:"nickname",name:I("constructor.props.autocomplete.nickname")},{id:at(),value:"username",name:I("constructor.props.autocomplete.username")},{id:at(),value:"new-password",name:I("constructor.props.autocomplete.new-password")},{id:at(),value:"current-password",name:I("constructor.props.autocomplete.current-password")},{id:at(),value:"organization-title",name:I("constructor.props.autocomplete.organization-title")},{id:at(),value:"country-name",name:I("constructor.props.autocomplete.country-name")},{id:at(),value:"address-level1",name:I("constructor.props.autocomplete.address-level1")},{id:at(),value:"address-level2",name:I("constructor.props.autocomplete.address-level2")},{id:at(),value:"street-address",name:I("constructor.props.autocomplete.street-address")},{id:at(),value:"postal-code",name:I("constructor.props.autocomplete.postal-code")},{id:at(),value:"email",name:I("constructor.props.autocomplete.email")},{id:at(),value:"tel",name:I("constructor.props.autocomplete.tel")}],AUTOCOMPLETE_OPTIONS:[{id:at(),value:"on",name:I("constructor.props.autocomplete.on")},{id:at(),value:"off",name:I("constructor.props.autocomplete.off")},{id:at(),value:"name",name:I("constructor.props.autocomplete.name")},{id:at(),value:"honorific-prefix",name:I("constructor.props.autocomplete.honorific-prefix")},{id:at(),value:"given-name",name:I("constructor.props.autocomplete.given-name")},{id:at(),value:"additional-name",name:I("constructor.props.autocomplete.additional-name")},{id:at(),value:"family-name",name:I("constructor.props.autocomplete.family-name")},{id:at(),value:"honorific-suffix",name:I("constructor.props.autocomplete.honorific-suffix")},{id:at(),value:"nickname",name:I("constructor.props.autocomplete.nickname")},{id:at(),value:"username",name:I("constructor.props.autocomplete.username")},{id:at(),value:"new-password",name:I("constructor.props.autocomplete.new-password")},{id:at(),value:"current-password",name:I("constructor.props.autocomplete.current-password")},{id:at(),value:"one-time-code",name:I("constructor.props.autocomplete.one-time-code")},{id:at(),value:"organization-title",name:I("constructor.props.autocomplete.organization-title")},{id:at(),value:"organization",name:I("constructor.props.autocomplete.organization")},{id:at(),value:"street-address",name:I("constructor.props.autocomplete.street-address")},{id:at(),value:"address-line1",name:I("constructor.props.autocomplete.address-line1")},{id:at(),value:"address-line2",name:I("constructor.props.autocomplete.address-line2")},{id:at(),value:"address-line3",name:I("constructor.props.autocomplete.address-line3")},{id:at(),value:"address-level4",name:I("constructor.props.autocomplete.address-level4")},{id:at(),value:"address-level3",name:I("constructor.props.autocomplete.address-level3")},{id:at(),value:"address-level2",name:I("constructor.props.autocomplete.address-level2")},{id:at(),value:"address-level1",name:I("constructor.props.autocomplete.address-level1")},{id:at(),value:"country",name:I("constructor.props.autocomplete.country")},{id:at(),value:"country-name",name:I("constructor.props.autocomplete.country-name")},{id:at(),value:"postal-code",name:I("constructor.props.autocomplete.postal-code")},{id:at(),value:"cc-name",name:I("constructor.props.autocomplete.cc-name")},{id:at(),value:"cc-given-name",name:I("constructor.props.autocomplete.cc-given-name")},{id:at(),value:"cc-additional-name",name:I("constructor.props.autocomplete.cc-additional-name")},{id:at(),value:"cc-family-name",name:I("constructor.props.autocomplete.cc-family-name")},{id:at(),value:"cc-number",name:I("constructor.props.autocomplete.cc-number")},{id:at(),value:"cc-exp",name:I("constructor.props.autocomplete.cc-exp")},{id:at(),value:"cc-exp-month",name:I("constructor.props.autocomplete.cc-exp-month")},{id:at(),value:"cc-exp-year",name:I("constructor.props.autocomplete.cc-exp-year")},{id:at(),value:"cc-csc",name:I("constructor.props.autocomplete.cc-csc")},{id:at(),value:"cc-type",name:I("constructor.props.autocomplete.cc-type")},{id:at(),value:"transaction-currency",name:I("constructor.props.autocomplete.transaction-currency")},{id:at(),value:"transaction-amount",name:I("constructor.props.autocomplete.transaction-amount")},{id:at(),value:"language",name:I("constructor.props.autocomplete.language")},{id:at(),value:"bday",name:I("constructor.props.autocomplete.bday")},{id:at(),value:"bday-day",name:I("constructor.props.autocomplete.bday-day")},{id:at(),value:"bday-month",name:I("constructor.props.autocomplete.bday-month")},{id:at(),value:"bday-year",name:I("constructor.props.autocomplete.bday-year")},{id:at(),value:"sex",name:I("constructor.props.autocomplete.sex")},{id:at(),value:"url",name:I("constructor.props.autocomplete.url")},{id:at(),value:"photo",name:I("constructor.props.autocomplete.photo")},{id:at(),value:"email",name:I("constructor.props.autocomplete.email")},{id:at(),value:"tel",name:I("constructor.props.autocomplete.tel")},{id:at(),value:"tel-country-code",name:I("constructor.props.autocomplete.tel-country-code")},{id:at(),value:"tel-national",name:I("constructor.props.autocomplete.tel-national")},{id:at(),value:"tel-area-code",name:I("constructor.props.autocomplete.tel-area-code")},{id:at(),value:"tel-local",name:I("constructor.props.autocomplete.tel-local")},{id:at(),value:"tel-local-prefix",name:I("constructor.props.autocomplete.tel-local-prefix")},{id:at(),value:"tel-local-suffix",name:I("constructor.props.autocomplete.tel-local-suffix")},{id:at(),value:"tel-extension",name:I("constructor.props.autocomplete.tel-extension")},{id:at(),value:"impp",name:I("constructor.props.autocomplete.impp")},{id:at(),value:"fax",name:I("constructor.props.autocomplete.fax")}]})),uo=[["access",['<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Qlementine Icons by Olivier Cléro - https://github.com/oclero/qlementine-icons/blob/master/LICENSE --><path fill="currentColor" d="M9.5 5a.5.5 0 0 0 0 1h3a.5.5 0 0 0 0-1zm0 2a.5.5 0 0 0 0 1h3a.5.5 0 0 0 0-1zM9 9.5a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5m-2.39-3C6.61 7.328 5.891 8 5 8s-1.61-.672-1.61-1.5S4.109 5 5 5s1.61.672 1.61 1.5M5 8h-.04c-.92 0-1.72.585-1.94 1.42c-.08.295.16.582.485.582h3c.326 0 .565-.286.486-.582C6.768 8.586 5.971 8 5.051 8h-.04z"/><path fill="currentColor" fill-rule="evenodd" d="M.327 3.64C0 4.282 0 5.12 0 6.8v2.4c0 1.68 0 2.52.327 3.16a3.02 3.02 0 0 0 1.31 1.31c.642.327 1.48.327 3.16.327h6.4c1.68 0 2.52 0 3.16-.327a3 3 0 0 0 1.31-1.31c.327-.642.327-1.48.327-3.16V6.8c0-1.68 0-2.52-.327-3.16a3 3 0 0 0-1.31-1.31c-.642-.327-1.48-.327-3.16-.327h-6.4c-1.68 0-2.52 0-3.16.327a3.02 3.02 0 0 0-1.31 1.31m10.9-.638h-6.4c-.857 0-1.44 0-1.89.038c-.438.035-.663.1-.819.18a2 2 0 0 0-.874.874c-.08.156-.145.38-.18.819c-.037.45-.038 1.03-.038 1.89v2.4c0 .857.001 1.44.038 1.89c.036.438.101.663.18.819c.192.376.498.682.874.874c.156.08.381.145.819.18c.45.036 1.03.037 1.89.037h6.4c.857 0 1.44 0 1.89-.037c.438-.036.663-.101.819-.18c.376-.192.682-.498.874-.874c.08-.156.145-.381.18-.82c.037-.45.038-1.03.038-1.89v-2.4c0-.856-.001-1.44-.038-1.89c-.036-.437-.101-.662-.18-.818a2 2 0 0 0-.874-.874c-.156-.08-.381-.145-.819-.18c-.45-.037-1.03-.038-1.89-.038" clip-rule="evenodd"/></svg>','<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Qlementine Icons by Olivier Cléro - https://github.com/oclero/qlementine-icons/blob/master/LICENSE --><path fill="currentColor" d="M3 8.5a1 1 0 1 0 0-2a1 1 0 0 0 0 2"/><path fill="currentColor" fill-rule="evenodd" d="M4.5 3c1.56 0 2.94.794 3.75 2h5.26a1 1 0 0 1 .807.409l1.49 2.04a.99.99 0 0 1 .033 1.13l-1.26 1.95a.997.997 0 0 1-1.41.276L12.02 10l-1.19.812a1 1 0 0 1-1.13 0L8.51 10h-.258c-.808 1.21-2.18 2-3.75 2a4.5 4.5 0 0 1 0-9zm3.75 6a1 1 0 0 0-.832.444c-.63.94-1.7 1.56-2.91 1.56c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5c1.21 0 2.28.616 2.91 1.56c.186.277.498.444.832.444h5.26L15 8.048l-1.26 1.95l-1.15-.805a1 1 0 0 0-1.14-.005L10.26 10l-1.19-.812a1 1 0 0 0-.566-.175h-.258z" clip-rule="evenodd"/></svg>','<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Qlementine Icons by Olivier Cléro - https://github.com/oclero/qlementine-icons/blob/master/LICENSE --><path fill="currentColor" fill-rule="evenodd" d="M2 8a.997.997 0 0 1 1-1h10a.997.997 0 0 1 1 1v6a.997.997 0 0 1-1 1H3a.997.997 0 0 1-1-1zm3-4c0-.796.316-1.56.879-2.12s1.33-.879 2.12-.879A3 3 0 0 1 10.998 4v2h-6V4zm7 0v2h1a2 2 0 0 1 1.996 1.996v6c0 .53-.211 1.04-.586 1.41s-.884.586-1.41.586H3a2 2 0 0 1-1.996-1.996v-6A2 2 0 0 1 3 6h1V4c0-1.06.421-2.08 1.17-2.83a4.004 4.004 0 0 1 5.66 0C11.58 1.92 12 2.94 12 4" clip-rule="evenodd"/></svg>']],["common",['<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Qlementine Icons by Olivier Cléro - https://github.com/oclero/qlementine-icons/blob/master/LICENSE --><path fill="currentColor" d="M6 7a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v5a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1z"/><path fill="currentColor" fill-rule="evenodd" d="M6 1a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1c1.66 0 3 1.34 3 3v9c0 1.66-1.34 3-3 3H6c-1.66 0-3-1.34-3-3V4c0-1.66 1.34-3 3-3M4 4c0-1.1.895-2 2-2h4c1.1 0 2 .895 2 2v9c0 1.1-.895 2-2 2H6c-1.1 0-2-.895-2-2z" clip-rule="evenodd"/></svg>','<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Qlementine Icons by Olivier Cléro - https://github.com/oclero/qlementine-icons/blob/master/LICENSE --><path fill="currentColor" fill-rule="evenodd" d="M9 3.2c0-1.12 0-1.68.218-2.11c.192-.376.498-.682.874-.874c.428-.218.988-.218 2.11-.218h.6c1.12 0 1.68 0 2.11.218c.376.192.682.498.874.874c.218.428.218.988.218 2.11v.6c0 1.12 0 1.68-.218 2.11a2 2 0 0 1-.874.874c-.428.218-.988.218-2.11.218h-.6c-1.12 0-1.68 0-2.11-.218a2 2 0 0 1-.874-.874C9 5.482 9 4.922 9 3.8zM12.2 1h.6c.577 0 .949 0 1.23.024c.272.022.372.06.422.085c.188.096.341.249.437.437c.025.05.063.15.085.422c.023.283.024.656.024 1.23v.6c0 .577 0 .949-.024 1.23c-.022.272-.06.372-.085.422a1 1 0 0 1-.437.437c-.05.025-.15.063-.422.085c-.283.023-.656.024-1.23.024h-.6c-.577 0-.949 0-1.23-.024c-.272-.022-.372-.06-.422-.085a1 1 0 0 1-.437-.437c-.025-.05-.063-.15-.085-.422a17 17 0 0 1-.024-1.23v-.6c0-.577 0-.949.024-1.23c.022-.272.06-.372.085-.422c.096-.188.249-.341.437-.437c.05-.025.15-.063.422-.085C11.253 1 11.626 1 12.2 1M.218 4.09C0 4.518 0 5.078 0 6.2v6.6c0 1.12 0 1.68.218 2.11c.192.376.498.682.874.874c.428.218.988.218 2.11.218h6.6c1.12 0 1.68 0 2.11-.218c.376-.192.682-.498.874-.874c.218-.428.218-.988.218-2.11v-.6c0-1.12 0-1.68-.218-2.11a2 2 0 0 0-.874-.874c-.428-.218-.988-.218-2.11-.218h-2.8v-2.8c0-1.12 0-1.68-.218-2.11a2 2 0 0 0-.874-.874c-.428-.218-.988-.218-2.11-.218h-.6c-1.12 0-1.68 0-2.11.218a2 2 0 0 0-.874.874zm5.78 2.11V9h-5V6.2c0-.577 0-.949.024-1.23c.022-.272.06-.372.085-.422c.096-.188.249-.341.437-.437c.05-.025.15-.063.422-.085c.283-.023.656-.024 1.23-.024h.6c.577 0 .949 0 1.23.024c.272.022.372.06.422.085c.188.096.341.249.437.437c.025.05.063.15.085.422c.023.283.024.656.024 1.23zm-5 3.8h5v5h-2.8c-.577 0-.949 0-1.23-.024c-.272-.022-.372-.06-.422-.085a1 1 0 0 1-.437-.437c-.025-.05-.063-.15-.085-.422C1 13.749 1 13.376 1 12.802v-2.8zm6 0h2.8c.577 0 .949 0 1.23.024c.272.022.372.06.422.085c.188.096.341.249.437.437c.025.05.063.15.085.422c.023.283.024.656.024 1.23v.6c0 .577 0 .949-.024 1.23c-.022.272-.06.372-.085.422a1 1 0 0 1-.437.437c-.05.025-.15.063-.422.085c-.283.023-.656.024-1.23.024h-2.8v-5z" clip-rule="evenodd"/></svg>',`<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"\r
>\r
  <path\r
    fill="none"\r
    stroke="currentColor"\r
    stroke-linecap="round"\r
    stroke-linejoin="round"\r
    stroke-width="1.5"\r
    d="M14.44 5.78L4.198 16.02a2 2 0 0 0-.565 1.125l-.553 3.774l3.775-.553A2 2 0 0 0 7.98 19.8L18.22 9.56m-3.78-3.78l2.229-2.23a1.6 1.6 0 0 1 2.263 0l1.518 1.518a1.6 1.6 0 0 1 0 2.263l-2.23 2.23M14.44 5.78l3.78 3.78"\r
  />\r
</svg>`,'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Qlementine Icons by Olivier Cléro - https://github.com/oclero/qlementine-icons/blob/master/LICENSE --><path fill="currentColor" fill-rule="evenodd" d="M0 2c0-.465 0-.697.051-.888a1.5 1.5 0 0 1 1.06-1.06C1.302.001 1.534.001 2 .001s.697 0 .888.051c.518.139.922.543 1.06 1.06c.051.191.051.423.051.888s0 .697-.05.888a1.5 1.5 0 0 1-1.06 1.06c-.192.051-.424.051-.889.051s-.697 0-.888-.051a1.5 1.5 0 0 1-1.06-1.06C0 2.697 0 2.465 0 2m2 1c-.242 0-.389 0-.501-.005a1 1 0 0 1-.128-.012a.5.5 0 0 1-.354-.354c.001.004-.007-.021-.012-.128C1 2.389 1 2.24 1 2s0-.389.005-.501c.005-.107.013-.132.012-.128a.5.5 0 0 1 .354-.354c-.004.001.021-.007.128-.012C1.611 1 1.759 1 2 1s.389 0 .501.005c.107.005.132.013.128.012a.5.5 0 0 1 .354.354c-.001-.004.007.021.012.128C3 1.611 3 1.759 3 2s0 .389-.005.501a1 1 0 0 1-.012.128a.5.5 0 0 1-.354.354c.004-.001-.021.007-.128.012C2.389 3 2.241 3 2 3M0 8c0-.465 0-.697.051-.888a1.5 1.5 0 0 1 1.06-1.06c.191-.051.423-.051.888-.051s.697 0 .888.051c.518.139.922.543 1.06 1.06c.051.191.051.423.051.888s0 .697-.05.888a1.5 1.5 0 0 1-1.06 1.06c-.192.051-.424.051-.889.051s-.697 0-.888-.051a1.5 1.5 0 0 1-1.06-1.06C0 8.697 0 8.465 0 8m2 1c-.242 0-.389 0-.501-.005a1 1 0 0 1-.128-.012a.5.5 0 0 1-.354-.354c.001.004-.007-.021-.012-.128C1 8.389 1 8.241 1 8s0-.389.005-.501c.005-.107.013-.132.012-.128a.5.5 0 0 1 .354-.354s.028-.007.128-.012C1.611 7 1.759 7 2 7s.389 0 .501.005c.107.005.132.013.128.012a.5.5 0 0 1 .354.354s.007.028.012.128C3 7.611 3 7.759 3 8s0 .389-.005.501a1 1 0 0 1-.012.128a.5.5 0 0 1-.354.354s-.028.007-.128.012C2.389 9 2.241 9 2 9M.051 13.1C0 13.291 0 13.523 0 13.988s0 .698.051.888a1.5 1.5 0 0 0 1.06 1.06c.191.051.423.051.888.051s.697 0 .888-.051a1.5 1.5 0 0 0 1.06-1.06c.051-.191.051-.423.051-.888s0-.698-.05-.888a1.5 1.5 0 0 0-1.06-1.06c-.192-.051-.424-.051-.889-.051s-.697 0-.888.051a1.5 1.5 0 0 0-1.06 1.06m1.45 1.88c.112.005.26.005.501.005s.39 0 .501-.005a.6.6 0 0 0 .128-.012a.5.5 0 0 0 .353-.354c0-.003.007-.034.012-.128c.005-.112.005-.26.005-.5s0-.39-.005-.502c-.005-.1-.012-.128-.012-.128a.5.5 0 0 0-.353-.353s-.028-.007-.128-.011c-.112-.005-.26-.006-.501-.006s-.389 0-.501.006a1 1 0 0 0-.128.011a.5.5 0 0 0-.353.354s-.007.028-.012.128c-.005.112-.005.26-.005.501s0 .39.005.501c.005.107.013.132.012.128a.5.5 0 0 0 .354.354a1 1 0 0 0 .128.012z" clip-rule="evenodd"/><path fill="currentColor" d="M6.5 2a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1zM6 8.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m.5 5.5a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1z"/></svg>','<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Qlementine Icons by Olivier Cléro - https://github.com/oclero/qlementine-icons/blob/master/LICENSE --><path fill="currentColor" fill-rule="evenodd" d="M10.5 11.9a6.005 6.005 0 0 1-9.48-4.89c0-3.31 2.69-6 6-6a6.005 6.005 0 0 1 4.89 9.48l2.82 2.82a.996.996 0 0 1 0 1.41a.994.994 0 0 1-1.41 0zm1.52-4.89c0 2.76-2.24 5-5 5s-5-2.24-5-5s2.24-5 5-5s5 2.24 5 5" clip-rule="evenodd"/></svg>','<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Qlementine Icons by Olivier Cléro - https://github.com/oclero/qlementine-icons/blob/master/LICENSE --><path fill="currentColor" d="M6.5 7a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0v-4a.5.5 0 0 1 .5-.5m3.5.5a.5.5 0 0 0-1 0v4a.5.5 0 0 0 1 0z"/><path fill="currentColor" fill-rule="evenodd" d="M8.12 0h-.241c-.402 0-.735 0-1.01.022c-.281.023-.539.072-.782.196a2 2 0 0 0-.874.874c-.124.243-.173.501-.196.782c-.022.271-.022.603-.022 1.01v.121h-3.5a.5.5 0 0 0 0 1h.54l.597 7.16c.063.758.113 1.36.192 1.84c.08.492.196.9.41 1.27c.354.604.88 1.09 1.51 1.39c.386.184.803.265 1.3.304c.487.038 1.09.038 1.85.038h.21c.76 0 1.36 0 1.85-.038c.497-.039.913-.12 1.3-.304a3.5 3.5 0 0 0 1.51-1.39c.216-.368.33-.777.41-1.27c.08-.48.129-1.08.193-1.84l.597-7.16h.54a.5.5 0 0 0 0-1h-3.5v-.12c0-.403 0-.736-.022-1.01c-.023-.282-.072-.54-.196-.783a2 2 0 0 0-.874-.874C9.669.094 9.41.045 9.13.022C8.859 0 8.527 0 8.12 0M3.04 4l.588 7.06c.065.784.112 1.34.184 1.78c.07.432.159.705.287.924a2.5 2.5 0 0 0 1.08.992c.229.11.509.175.945.21c.442.035 1 .035 1.79.035h.167c.787 0 1.35 0 1.79-.035c.436-.034.716-.1.945-.21a2.5 2.5 0 0 0 1.08-.992c.128-.219.217-.493.288-.924c.071-.438.118-.997.184-1.78L12.956 4h-9.91zM6 3h4v-.1c0-.428 0-.719-.019-.944c-.018-.219-.05-.331-.09-.41a1 1 0 0 0-.437-.437c-.078-.04-.19-.072-.41-.09A13 13 0 0 0 8.1 1h-.2c-.428 0-.719 0-.944.019c-.219.018-.331.05-.41.09a1 1 0 0 0-.437.437c-.04.078-.072.19-.09.41C6 2.181 6 2.472 6 2.9z" clip-rule="evenodd"/></svg>','<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Qlementine Icons by Olivier Cléro - https://github.com/oclero/qlementine-icons/blob/master/LICENSE --><path fill="currentColor" d="M8 9a.75.75 0 0 1-.75-.75v-3.5a.75.75 0 0 1 1.5 0v3.5A.75.75 0 0 1 8 9m-1 3a1 1 0 1 1 2 0a1 1 0 0 1-2 0"/><path fill="currentColor" fill-rule="evenodd" d="m.325 11.6l5.02-9.99c1.1-2.19 4.21-2.19 5.31 0l5.02 9.99c1 2-.436 4.36-2.66 4.36h-10c-2.22 0-3.66-2.36-2.66-4.36zm.894.449l5.02-9.99c.733-1.46 2.79-1.46 3.52 0l5.02 9.99c.676 1.35-.301 2.91-1.76 2.91h-10c-1.46 0-2.44-1.57-1.76-2.91z" clip-rule="evenodd"/></svg>']],["info",['<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Qlementine Icons by Olivier Cléro - https://github.com/oclero/qlementine-icons/blob/master/LICENSE --><path fill="currentColor" d="m14.9 11.1l-.062-.07a4 4 0 0 1-.201-.255l-.16-.233a7 7 0 0 1-.48-.865c-.47-1-.952-2.55-.952-4.72a4.97 4.97 0 0 0-1.43-3.49a5 5 0 0 0-3.46-1.5a4.97 4.97 0 0 0-3.52 1.35a5 5 0 0 0-1.58 3.43l-.005.217c0 2.17-.482 3.73-.952 4.72c-.236.5-.47.864-.64 1.1l-.06.082l-.171.208l-.032.035a.5.5 0 0 0 .354.852h13a.498.498 0 0 0 .354-.852zM4 5.36l.005-.404c0-1.06.421-2.08 1.17-2.83a4.004 4.004 0 0 1 5.66 0c.75.75 1.17 1.77 1.17 2.83c0 2.33.518 4.02 1.05 5.15c.157.334.314.617.46.85h-11a9 9 0 0 0 .46-.85c.498-1.06.987-2.62 1.04-4.75zm6.4 9.4a.497.497 0 0 0-.1-.7a.5.5 0 0 0-.7.1a1.995 1.995 0 0 1-2.495.589a2 2 0 0 1-.705-.59a.501.501 0 0 0-.895.23a.5.5 0 0 0 .095.37a3 3 0 0 0 2.4 1.2a3 3 0 0 0 2.4-1.2z"/></svg>','<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Qlementine Icons by Olivier Cléro - https://github.com/oclero/qlementine-icons/blob/master/LICENSE --><path fill="currentColor" d="M8 3.5a.5.5 0 0 0-1 0V8a.5.5 0 0 0 .276.447l3 1.5a.5.5 0 0 0 .447-.895l-2.72-1.36v-4.19z"/><path fill="currentColor" fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8s3.58 8 8 8s8-3.58 8-8s-3.58-8-8-8M1 8c0-3.87 3.13-7 7-7s7 3.13 7 7s-3.13 7-7 7s-7-3.13-7-7" clip-rule="evenodd"/></svg>','<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><!-- Icon from Ultimate free icons by Streamline - https://creativecommons.org/licenses/by/4.0/ --><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"><path d="M.75.75v22.5h22.5"/><path d="M14.15 17.358a5.5 5.5 0 0 0 1.487 1.623l.713.519m-12.6 0l.713-.519A5.39 5.39 0 0 0 6.7 14.939l.4-6.979a2.92 2.92 0 0 1 2.95-2.71h.137"/><path d="m9.15 19.5l.713-.519a5.39 5.39 0 0 0 2.237-4.042l.4-6.979a2.92 2.92 0 0 1 2.95-2.71a2.92 2.92 0 0 1 2.955 2.71l.4 6.979a5.39 5.39 0 0 0 2.232 4.042l.713.519"/></g></svg>','<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Qlementine Icons by Olivier Cléro - https://github.com/oclero/qlementine-icons/blob/master/LICENSE --><path fill="currentColor" d="M8 7a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 8 7m0-1a1 1 0 1 0 0-2a1 1 0 0 0 0 2"/><path fill="currentColor" fill-rule="evenodd" d="M8 16c4.42 0 8-3.58 8-8s-3.58-8-8-8s-8 3.58-8 8s3.58 8 8 8m0-1c3.87 0 7-3.13 7-7s-3.13-7-7-7s-7 3.13-7 7s3.13 7 7 7" clip-rule="evenodd"/></svg>']],["media",['<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Qlementine Icons by Olivier Cléro - https://github.com/oclero/qlementine-icons/blob/master/LICENSE --><path fill="currentColor" fill-rule="evenodd" d="M8 5C6.34 5 5 6.34 5 8s1.34 3 3 3s3-1.34 3-3s-1.34-3-3-3M6 8a2 2 0 1 1 4.001-.001A2 2 0 0 1 6 8" clip-rule="evenodd"/><path fill="currentColor" fill-rule="evenodd" d="M5.6 1.2A.5.5 0 0 1 6 1h4.5a.5.5 0 0 1 .4.2L12.25 3h1.25A2.5 2.5 0 0 1 16 5.5v6a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 0 11.5v-6A2.5 2.5 0 0 1 2.5 3h1.75zm.65.8L4.9 3.8a.5.5 0 0 1-.4.2h-2A1.5 1.5 0 0 0 1 5.5v6A1.5 1.5 0 0 0 2.5 13h11a1.5 1.5 0 0 0 1.5-1.5v-6A1.5 1.5 0 0 0 13.5 4H12a.5.5 0 0 1-.4-.2L10.25 2z" clip-rule="evenodd"/></svg>','<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Qlementine Icons by Olivier Cléro - https://github.com/oclero/qlementine-icons/blob/master/LICENSE --><path fill="currentColor" fill-rule="evenodd" d="M4 1C2.34 1 1 2.34 1 4v7c0 1.66 1.34 3 3 3h8c1.66 0 3-1.34 3-3V4c0-1.66-1.34-3-3-3zM2 7V5h2v2zm0-3h2V2c-1.1 0-2 .895-2 2m3-2h6v5H5zm7 2V2c1.1 0 2 .895 2 2zm0 1h2v2h-2zm0 3h2v2h-2zm0 3h2c0 1.1-.895 2-2 2zm-1 2H5V8h6zm-7-2v2c-1.1 0-2-.895-2-2zm0-1H2V8h2z" clip-rule="evenodd"/></svg>','<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Qlementine Icons by Olivier Cléro - https://github.com/oclero/qlementine-icons/blob/master/LICENSE --><path fill="currentColor" fill-rule="evenodd" d="M9 3a.999.999 0 0 0-1.582-.814l-2.54 1.81h-2.38a2.5 2.5 0 0 0-2.5 2.5v3a2.5 2.5 0 0 0 2.5 2.5h2.38l2.54 1.81A1.001 1.001 0 0 0 9 12.993v-10zM2.5 5h2.38a1 1 0 0 0 .581-.186l2.54-1.81v10l-2.54-1.81a1 1 0 0 0-.581-.186H2.5a1.5 1.5 0 0 1-1.5-1.5v-3a1.5 1.5 0 0 1 1.5-1.5z" clip-rule="evenodd"/><path fill="currentColor" d="M11.5 2.34a.5.5 0 0 1 .663-.246a6.51 6.51 0 0 1 3.79 5.91c0 1.24-.356 2.46-1.03 3.51a6.5 6.5 0 0 1-2.76 2.4a.5.5 0 1 1-.417-.909a5.4 5.4 0 0 0 2.33-2.03a5.51 5.51 0 0 0-.002-5.94a5.5 5.5 0 0 0-2.34-2.03a.5.5 0 0 1-.246-.663z"/><path fill="currentColor" d="M10.6 5.15a.5.5 0 0 1 .683-.183a3.498 3.498 0 0 1 .003 6.06a.5.5 0 0 1-.501-.865a2.5 2.5 0 0 0 1.247-2.165a2.5 2.5 0 0 0-1.251-2.164a.5.5 0 0 1-.183-.683z"/></svg>','<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Qlementine Icons by Olivier Cléro - https://github.com/oclero/qlementine-icons/blob/master/LICENSE --><path fill="currentColor" fill-rule="evenodd" d="M8 9c1.66 0 3-1.34 3-3S9.66 3 8 3S5 4.34 5 6s1.34 3 3 3m0-1a2 2 0 1 0 .001-4.001A2 2 0 0 0 8 8" clip-rule="evenodd"/><path fill="currentColor" fill-rule="evenodd" d="M10 11h1.2c1.68 0 2.52 0 3.16-.327a3.02 3.02 0 0 0 1.31-1.31c.327-.642.327-1.48.327-3.16v-.4c0-1.68 0-2.52-.327-3.16a3 3 0 0 0-1.31-1.31c-.642-.327-1.48-.327-3.16-.327H4.8c-1.68 0-2.52 0-3.16.327a3.02 3.02 0 0 0-1.31 1.31c-.327.642-.327 1.48-.327 3.16v.4c0 1.68 0 2.52.327 3.16a3.02 3.02 0 0 0 1.31 1.31C2.282 11 3.12 11 4.8 11H6v3H2.5a.5.5 0 0 0 0 1h11a.5.5 0 0 0 0-1H10zm1.2-9H4.8c-.857 0-1.44 0-1.89.038c-.438.035-.663.1-.819.18a2 2 0 0 0-.874.874c-.08.156-.145.38-.18.819C1 4.36.999 4.94.999 5.8v.4c0 .857.001 1.44.038 1.89c.036.438.101.663.18.819c.192.376.498.682.874.874c.156.08.381.145.819.18C3.36 10 3.94 10 4.8 10h6.4c.857 0 1.44 0 1.89-.037c.438-.036.663-.101.819-.18c.376-.192.682-.498.874-.874c.08-.156.145-.381.18-.82c.037-.45.038-1.03.038-1.89v-.4c0-.856-.001-1.44-.038-1.89c-.036-.437-.101-.662-.18-.818a2 2 0 0 0-.874-.874c-.156-.08-.381-.145-.819-.18C12.64 2 12.06 2 11.2 2M9 11H7v3h2z" clip-rule="evenodd"/></svg>']],["network",[`<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><!-- Icon from\r
    Huge Icons by Hugeicons - undefined -->\r
    <g fill="none" stroke="currentColor" stroke-width="1.5">\r
        <path stroke-linecap="round" d="M12 11v9" />\r
        <path d="M14 9a2 2 0 1 1-4 0a2 2 0 0 1 4 0Z" />\r
        <path stroke-linecap="round" stroke-linejoin="round"\r
            d="M16.959 6C17.619 6.87 18 7.898 18 9s-.381 2.13-1.041 3M7.04 6C6.381 6.87 6 7.898 6 9s.381 2.13 1.041 3m13.275-8C21.38 5.43 22 7.15 22 9s-.62 3.57-1.684 5M3.684 4C2.62 5.43 2 7.15 2 9s.62 3.57 1.684 5" />\r
    </g>\r
</svg>`,'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Qlementine Icons by Olivier Cléro - https://github.com/oclero/qlementine-icons/blob/master/LICENSE --><path fill="currentColor" d="M0 6c0-3.31 2.69-6 6-6c2.62 0 4.84 1.68 5.66 4.01q.166-.014.337-.014c2.21 0 4 1.79 4 4c0 1.63-.97 3.03-2.36 3.65c-.312.14-.636-.11-.636-.452c0-.222.142-.415.34-.514a2.999 2.999 0 0 0-1.931-5.622a.5.5 0 0 1-.581-.36a5.002 5.002 0 1 0-8.942 4.15a.6.6 0 0 1 .112.346c0 .495-.566.732-.857.332a5.97 5.97 0 0 1-1.14-3.52z"/><path fill="currentColor" d="M5 15.5V8.71L3.85 9.86a.5.5 0 0 1-.707-.707l2-2a.5.5 0 0 1 .35-.147h.006a.5.5 0 0 1 .351.146l2 2a.5.5 0 0 1-.707.707l-1.15-1.15v6.79a.5.5 0 0 1-1 0zM10.5 7a.5.5 0 0 1 .5.5v6.79l1.15-1.15a.5.5 0 0 1 .707.707l-2 2a.5.5 0 0 1-.351.146H10.5a.5.5 0 0 1-.35-.147l-2-2a.5.5 0 0 1 .707-.707l1.15 1.15V7.5a.5.5 0 0 1 .5-.5z"/></svg>','<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Qlementine Icons by Olivier Cléro - https://github.com/oclero/qlementine-icons/blob/master/LICENSE --><path fill="currentColor" d="M8 0c2.12 0 4.16.843 5.66 2.34C15.16 3.84 16 5.88 16 8a8.02 8.02 0 0 1-2.34 5.66A8 8 0 0 1 8 16a8.02 8.02 0 0 1-5.66-2.34A8 8 0 0 1 0 8c0-2.12.843-4.16 2.34-5.66C3.84.84 5.88 0 8 0m1.76 11H6.23l.05.305c.119.655.266 1.24.43 1.75l.127.365c.365.988.792 1.58 1.16 1.58s.792-.59 1.16-1.58l.126-.365q.274-.863.43-1.75l.05-.305zm-4.54 0H1.68a7.14 7.14 0 0 0 1.94 2.46a7.1 7.1 0 0 0 2.82 1.37c-.531-.868-.953-2.16-1.2-3.71l-.017-.114zm9.11 0h-3.55l-.016.114c-.245 1.54-.667 2.84-1.2 3.71a7 7 0 0 0 2.82-1.37a6.9 6.9 0 0 0 1.94-2.46v-.001zM5.1 6H1.3a7 7 0 0 0-.29 2c0 .695.101 1.37.29 2l3.8-.001l-.038-.459Q4.932 7.77 5.1 6m4.8 0H6.11a19.4 19.4 0 0 0 0 4H9.9c.138-1.33.138-2.67 0-4m4.81 0h-3.8l.04.459q.129 1.77-.04 3.54h3.8a7 7 0 0 0 0-4zM6.43 1.18l-.071.018a7.1 7.1 0 0 0-2.78 1.37a6.9 6.9 0 0 0-1.91 2.43h3.55l.017-.114c.245-1.54.667-2.84 1.2-3.71l-.001-.001zM8 1.005c-.365 0-.792.59-1.16 1.58l-.126.365a14 14 0 0 0-.43 1.75l-.051.305h3.53l-.05-.305a13 13 0 0 0-.43-1.75l-.126-.365c-.341-.922-.736-1.5-1.08-1.57l-.074-.007zm1.57.176l.065.108c.5.866.898 2.12 1.13 3.6l.016.114h3.55a7.14 7.14 0 0 0-1.94-2.46a7.1 7.1 0 0 0-2.82-1.37z"/></svg>',`<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">\r
<path     stroke-width="1" fill="currentColor" d="M17 17h5.142a4 4 0 1 0 0-2H17V7h5.142a4 4 0 1 0 0-2H17a2 2 0 0 0-2 2v8H9.858a4 4 0 1 0 0 2H15v8a2 2 0 0 0 2 2h5.142a4 4 0 1 0 0-2H17Zm9-3a2 2 0 1 1-2 2a2 2 0 0 1 2-2m0-10a2 2 0 1 1-2 2a2 2 0 0 1 2-2M6 18a2 2 0 1 1 2-2a2 2 0 0 1-2 2m20 6a2 2 0 1 1-2 2a2 2 0 0 1 2-2"/></svg>`,'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Qlementine Icons by Olivier Cléro - https://github.com/oclero/qlementine-icons/blob/master/LICENSE --><path fill="currentColor" d="M13 7.5a.5.5 0 0 0-1 0v4a.5.5 0 0 0 1 0zM10.5 7a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0v-4a.5.5 0 0 1 .5-.5m-7.42.62c-.076.184-.076.417-.076.883s0 .699.076.883c.101.245.296.44.541.541c.184.076.417.076.883.076h2c.466 0 .699 0 .883-.076a1 1 0 0 0 .541-.541c.076-.184.076-.417.076-.883s0-.699-.076-.883a1 1 0 0 0-.541-.541c-.184-.076-.417-.076-.883-.076h-2c-.466 0-.699 0-.883.076a1 1 0 0 0-.541.541"/><path fill="currentColor" fill-rule="evenodd" d="M12.9.223a.5.5 0 0 1-.139.693l-4.63 3.08h3.05c1.68 0 2.52 0 3.16.327a3.02 3.02 0 0 1 1.31 1.31c.327.642.327 1.48.327 3.16v1.4c0 1.68 0 2.52-.327 3.16a3 3 0 0 1-1.31 1.31c-.642.327-1.48.327-3.16.327h-6.4c-1.68 0-2.52 0-3.16-.327a3 3 0 0 1-1.31-1.31c-.327-.642-.327-1.48-.327-3.16v-1.4c0-1.68 0-2.52.327-3.16a3.02 3.02 0 0 1 1.31-1.31c.642-.327 1.48-.327 3.16-.327h1.55l5.87-3.92a.5.5 0 0 1 .693.139zm-8.12 4.78c-.857 0-1.44 0-1.89.038c-.438.035-.663.1-.819.18a2 2 0 0 0-.874.874c-.08.156-.145.38-.18.819c-.037.45-.038 1.03-.038 1.89v1.4c0 .857.001 1.44.038 1.89c.036.438.101.663.18.819c.192.376.498.682.874.874c.156.08.381.145.819.18c.45.036 1.03.037 1.89.037h6.4c.857 0 1.44 0 1.89-.037c.438-.036.663-.101.819-.18c.376-.192.682-.498.874-.874c.08-.156.145-.381.18-.82c.037-.45.038-1.03.038-1.89v-1.4c0-.856-.001-1.44-.038-1.89c-.036-.437-.101-.662-.18-.818a2 2 0 0 0-.874-.874c-.156-.08-.381-.145-.819-.18c-.45-.037-1.03-.038-1.89-.038z" clip-rule="evenodd"/></svg>','<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Qlementine Icons by Olivier Cléro - https://github.com/oclero/qlementine-icons/blob/master/LICENSE --><path fill="currentColor" fill-rule="evenodd" d="M15 3a2.996 2.996 0 0 1-5.34 1.87L5.83 7c.111.313.171.649.171 1s-.06.687-.171 1l3.83 2.13A2.996 2.996 0 0 1 15 13c0 1.66-1.34 3-3 3a2.996 2.996 0 0 1-2.829-4l-3.83-2.13A2.996 2.996 0 0 1 .001 8a2.996 2.996 0 0 1 5.34-1.87L9.171 4A2.996 2.996 0 0 1 12 0c1.66 0 3 1.34 3 3m-1 0a2 2 0 1 1-4.001.001A2 2 0 0 1 14 3M5 8a2 2 0 1 1-4.001.001A2 2 0 0 1 5 8m7 7a2 2 0 1 0 .001-4.001A2 2 0 0 0 12 15" clip-rule="evenodd"/></svg>','<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Qlementine Icons by Olivier Cléro - https://github.com/oclero/qlementine-icons/blob/master/LICENSE --><path fill="currentColor" d="M.9 6.55C2.52 4.39 5.1 3 8 3s5.48 1.39 7.1 3.55a.5.5 0 0 0 .8-.6A9.85 9.85 0 0 0 8 2C4.77 2 1.9 3.55.1 5.95a.5.5 0 0 0 .799.6z"/><path fill="currentColor" d="M2.9 8.55A6.36 6.36 0 0 1 8 6c2.09 0 3.94 1 5.1 2.55a.5.5 0 0 0 .8-.6A7.36 7.36 0 0 0 8 5C5.59 5 3.44 6.16 2.1 7.95a.5.5 0 0 0 .799.6z"/><path fill="currentColor" d="M8 9c-1.27 0-2.39.608-3.1 1.55a.5.5 0 0 1-.8-.6A4.87 4.87 0 0 1 8 8c1.6 0 3.01.767 3.9 1.95a.5.5 0 0 1-.799.6A3.87 3.87 0 0 0 8.001 9zm0 5a1 1 0 1 0 0-2a1 1 0 0 0 0 2"/></svg>']],["periphery",['<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Qlementine Icons by Olivier Cléro - https://github.com/oclero/qlementine-icons/blob/master/LICENSE --><path fill="currentColor" fill-rule="evenodd" d="M4 1a2.01 2.01 0 0 0-1.74 1.01A2.5 2.5 0 0 0 0 4.5V11c0 1.66 1.34 3 3 3h10c1.66 0 3-1.34 3-3V4.5c0-1.3-.992-2.37-2.26-2.49A2 2 0 0 0 12 1h-1c-.74 0-1.39.402-1.73 1H6.73C6.384 1.402 5.738 1 5 1zm0 1a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2zm5 1H7v2.5a.5.5 0 0 1-1 0v-.768C5.706 4.902 5.364 5 5 5H4c-.364 0-.706-.097-1-.268V5.5a.5.5 0 0 1-1 0V3.09A1.5 1.5 0 0 0 1 4.5v2A1.5 1.5 0 0 0 2.5 8h11A1.5 1.5 0 0 0 15 6.5v-2c0-.653-.417-1.21-1-1.41V5.5a.5.5 0 0 1-1 0v-.768c-.294.17-.636.268-1 .268h-1c-.364 0-.706-.097-1-.268V5.5a.5.5 0 0 1-1 0zm1 0a1 1 0 0 0 1 1h1a1 1 0 0 0 0-2h-1a1 1 0 0 0-1 1m5 5.5c-.418.314-.937.5-1.5.5h-11c-.563 0-1.08-.186-1.5-.5V11c0 1.1.895 2 2 2h10c1.1 0 2-.895 2-2z" clip-rule="evenodd"/></svg>','<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Qlementine Icons by Olivier Cléro - https://github.com/oclero/qlementine-icons/blob/master/LICENSE --><path fill="currentColor" d="M12.5 0a.5.5 0 0 1 .5.5v2.26q.125.11.236.235h2.26a.5.5 0 0 1 .492.41l.008.09a.5.5 0 0 1-.5.5h-1.67c.11.313.17.65.17 1v1h1.5a.5.5 0 0 1 .5.5a.5.5 0 0 1-.5.5h-1.5v2h1.5a.5.5 0 0 1 .5.5a.5.5 0 0 1-.5.5h-1.5v1c0 .351-.06.688-.171 1h1.67a.5.5 0 0 1 .5.5a.5.5 0 0 1-.5.5h-2.26a3 3 0 0 1-.234.235L13 15.49a.5.5 0 0 1-.5.5a.5.5 0 0 1-.5-.5v-1.67c-.312.11-.649.171-1 .171h-1v1.5a.5.5 0 0 1-.5.5a.5.5 0 0 1-.5-.5v-1.5H7v1.5a.5.5 0 0 1-.5.5a.5.5 0 0 1-.5-.5v-1.5H5c-.35 0-.687-.06-1-.17v1.67a.5.5 0 0 1-.5.5a.5.5 0 0 1-.5-.5v-2.26a3 3 0 0 1-.235-.235l-2.26-.001a.5.5 0 0 1-.5-.5a.5.5 0 0 1 .5-.5h1.67a3 3 0 0 1-.171-1v-1h-1.5a.5.5 0 0 1-.5-.5a.5.5 0 0 1 .5-.5h1.5v-2h-1.5a.5.5 0 0 1-.5-.5a.5.5 0 0 1 .5-.5h1.5v-1c0-.35.06-.687.17-1H.504a.5.5 0 0 1-.5-.5a.5.5 0 0 1 .5-.5h2.26A3 3 0 0 1 3 2.759V.499a.5.5 0 0 1 .5-.5a.5.5 0 0 1 .5.5v1.67c.313-.11.65-.17 1-.17h1v-1.5a.5.5 0 0 1 .5-.5a.5.5 0 0 1 .5.5v1.5h2v-1.5a.5.5 0 0 1 .5-.5a.5.5 0 0 1 .5.5v1.5h1c.351 0 .688.06 1 .171V.5a.5.5 0 0 1 .5-.5M11 3H5a2 2 0 0 0-1.996 1.996v6A2 2 0 0 0 5 12.992h6c.53 0 1.04-.211 1.41-.586s.586-.884.586-1.41v-6A2 2 0 0 0 11 3m0 1a.997.997 0 0 1 1 1v6a.997.997 0 0 1-1 1H5a.997.997 0 0 1-1-1V5a.997.997 0 0 1 1-1zm0 1H5v6h6z"/></svg>','<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Qlementine Icons by Olivier Cléro - https://github.com/oclero/qlementine-icons/blob/master/LICENSE --><path fill="currentColor" fill-rule="evenodd" d="M2.28 0h2.49c.098 0 .193 0 .275.005c.089.006.194.02.305.061a1 1 0 0 1 .575.575c.042.11.056.216.061.305c.005.082.005.177.005.275v7.78a2 2 0 1 0 4 0v-7.78c0-.098 0-.193.006-.275c.005-.088.019-.194.06-.305a1 1 0 0 1 .576-.575a1 1 0 0 1 .305-.06C11.019 0 11.115 0 11.213 0h2.5c.126 0 .249 0 .353.008c.114.01.249.032.385.101c.188.096.34.25.437.437c.07.136.091.271.1.385c.008.104.008.227.008.353v7.72c0 3.87-3.13 7-7 7s-7-3.13-7-7v-7.72c0-.126 0-.249.009-.353c.01-.114.031-.249.1-.385c.097-.188.25-.34.438-.437c.136-.069.27-.09.385-.1C2.032 0 2.155 0 2.28 0m-.278 1.01v.007a4 4 0 0 0-.006.288v2.7h3v-2.77c0-.115 0-.178-.003-.224v-.007h-.007A4 4 0 0 0 4.762 1h-2.47c-.148 0-.229 0-.288.005h-.006zM1.996 9V5h3v4c0 1.66 1.34 3 3 3s3-1.34 3-3V5h3v4c0 3.31-2.69 6-6 6s-6-2.69-6-6m12-5V1.3c0-.148 0-.229-.005-.288v-.007h-.007A4 4 0 0 0 13.696 1h-2.47c-.115 0-.178 0-.224.003h-.006v.006a4 4 0 0 0-.004.224v2.77h3z" clip-rule="evenodd"/></svg>','<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Qlementine Icons by Olivier Cléro - https://github.com/oclero/qlementine-icons/blob/master/LICENSE --><path fill="currentColor" fill-rule="evenodd" d="M2 7.5A1.5 1.5 0 0 1 3.5 6h9A1.5 1.5 0 0 1 14 7.5v1a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 8.5zM3.5 7a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h9a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5z" clip-rule="evenodd"/><path fill="currentColor" fill-rule="evenodd" d="M4 2.5a.5.5 0 0 0-1 0V4C1.34 4 0 5.34 0 7v2c0 1.66 1.34 3 3 3v1.5a.5.5 0 0 0 1 0V12h2v1.5a.5.5 0 0 0 1 0V12h2v1.5a.5.5 0 0 0 1 0V12h2v1.5a.5.5 0 0 0 1 0V12c1.66 0 3-1.34 3-3V7c0-1.66-1.34-3-3-3V2.5a.5.5 0 0 0-1 0V4h-2V2.5a.5.5 0 0 0-1 0V4H7V2.5a.5.5 0 0 0-1 0V4H4zM3 5c-1.1 0-2 .895-2 2v2c0 1.1.895 2 2 2h10c1.1 0 2-.895 2-2V7c0-1.1-.895-2-2-2z" clip-rule="evenodd"/></svg>','<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Qlementine Icons by Olivier Cléro - https://github.com/oclero/qlementine-icons/blob/master/LICENSE --><path fill="currentColor" fill-rule="evenodd" d="M11.5 1a2.5 2.5 0 0 1 2.385 1.756l1.76 6.14q.134.428.212.866q.107.352.109.738v1c0 .663-.263 1.3-.732 1.77c-.469.469-1.1.732-1.77.732h-11c-.663 0-1.3-.263-1.77-.732a2.5 2.5 0 0 1-.732-1.77v-1c0-.25.037-.499.11-.738a7 7 0 0 1 .211-.866l1.76-6.14A2.5 2.5 0 0 1 4.428 1h7.06zm1.97 8h-11a1.495 1.495 0 0 0-1.418 1.01A6 6 0 0 0 .97 11v.5a1.5 1.5 0 0 0 1.499 1.499h11a1.5 1.5 0 0 0 1.499-1.499V11q0-.499-.081-.99A1.5 1.5 0 0 0 13.468 9zm-.5 1a.997.997 0 0 1 1 1a.997.997 0 0 1-1 1a.997.997 0 0 1-1-1a.997.997 0 0 1 1-1M11.5 2H4.44a1.5 1.5 0 0 0-1.43 1.053l-1.44 5.12c.28-.11.584-.169.904-.169h11c.319 0 .624.06.904.169l-1.44-5.12A1.495 1.495 0 0 0 11.507 2z" clip-rule="evenodd"/></svg>']],["power",['<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Qlementine Icons by Olivier Cléro - https://github.com/oclero/qlementine-icons/blob/master/LICENSE --><path fill="currentColor" d="M15.8.195a.664.664 0 0 0-.94 0l-.293.293a.25.25 0 0 0 0 .354l.587.587a.25.25 0 0 0 .354 0l.293-.293c.26-.26.26-.68 0-.94zM13.3 1.78a.25.25 0 0 1 .354 0l.587.587a.25.25 0 0 1 0 .354l-.587.587a.25.25 0 0 1-.354 0l-.586-.587a.25.25 0 0 1 0-.354zm-1.5 1.88a.25.25 0 0 0-.354 0l-1.53 1.53a.25.25 0 0 0 0 .354l.587.587a.25.25 0 0 0 .354 0l1.53-1.53a.25.25 0 0 0 0-.354zM8.52 6.07a.994.994 0 0 0-1.41 0L3.59 9.59a1.994 1.994 0 1 0 2.82 2.82l3.52-3.52a.994.994 0 0 0 0-1.41zM2.78 13.9a.5.5 0 1 0-.554-.832c-1.31.874-.692 2.92.883 2.92h8.39a.5.5 0 0 0 0-1h-8.39c-.585 0-.815-.759-.328-1.08z"/></svg>','<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><!-- Icon from Ultimate free icons by Streamline - https://creativecommons.org/licenses/by/4.0/ --><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"><path d="M12 17.25a6 6 0 0 1-6-6v-4.5a1.5 1.5 0 0 1 1.5-1.5h9a1.5 1.5 0 0 1 1.5 1.5v4.5a6 6 0 0 1-6 6"/><path d="M9 16.447v2.3a1.5 1.5 0 0 0 1.5 1.5h3a1.5 1.5 0 0 0 1.5-1.5v-2.3M9 5.25V.75m6 4.5V.75m-3 19.5v3"/></g></svg>']],["scenarios",['<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Qlementine Icons by Olivier Cléro - https://github.com/oclero/qlementine-icons/blob/master/LICENSE --><path fill="currentColor" fill-rule="evenodd" d="M10.5 7a2.5 2.5 0 0 1-5 0a2.5 2.5 0 0 1 5 0m-1 0a1.5 1.5 0 1 1-3.001-.001A1.5 1.5 0 0 1 9.5 7" clip-rule="evenodd"/><path fill="currentColor" fill-rule="evenodd" d="M14 7c0 4.5-5 9-6 9s-6-4.5-6-9c0-3.31 2.69-6 6-6s6 2.69 6 6m-1 0c0 1.91-1.08 3.94-2.4 5.56c-.647.794-1.32 1.45-1.87 1.89a5.3 5.3 0 0 1-.731.507l-.052-.028a5.5 5.5 0 0 1-.68-.479c-.552-.446-1.22-1.1-1.87-1.89c-1.32-1.62-2.4-3.65-2.4-5.56c0-2.76 2.24-5 5-5s5 2.24 5 5z" clip-rule="evenodd"/></svg>','<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Qlementine Icons by Olivier Cléro - https://github.com/oclero/qlementine-icons/blob/master/LICENSE --><path fill="currentColor" d="M14.2 5.13a.5.5 0 0 1 .686.02a.5.5 0 0 1 .022.685l-4.93 5.59a2.002 2.002 0 1 1-1.353-1.355l5.57-4.95zM8 2c1.82 0 3.5.608 4.84 1.63l-.765.68A6.96 6.96 0 0 0 7.995 3c-3.87 0-7 3.13-7 7c0 1.1.895 2 2 2h1.03c0 .336.043.672.128 1h-1.16l-.154-.004a3 3 0 0 1-2.85-3c0-4.42 3.58-8 8-8zm7.7 5.9c.182.67.281 1.37.281 2.1c0 1.66-1.34 3-3 3h-1.1q.116-.45.127-.91l.08-.09h.893c1.1 0 2-.895 2-2q-.002-.6-.1-1.17z"/><path fill="currentColor" d="M8 5c.925 0 1.8.251 2.54.671l-.799.71A4.2 4.2 0 0 0 7.991 6c-2.26 0-4 1.81-4 3.5a.5.5 0 0 1-1 0c0-2.31 2.26-4.5 5-4.5z"/></svg>']],["settings",[`<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"\r
>\r
  <path\r
    fill="currentColor"\r
    fill-rule="evenodd"\r
    d="M5.85.146a.5.5 0 0 0-.707.707l.628.628a5.38 5.38 0 0 0-2.64 2.62l-1.33-.999a.5.5 0 1 0-.6.8l1.58 1.19a5.4 5.4 0 0 0-.141.899l-.144 2.01h-2a.5.5 0 0 0 0 1h1.93l-.001.015c-.08 1.13.18 2.2.69 3.12l-1.84.921a.5.5 0 0 0 .448.895l1.96-.982c1.02 1.24 2.57 2.03 4.31 2.03s3.29-.796 4.31-2.03l1.96.982a.5.5 0 1 0 .447-.895l-1.84-.92c.51-.916.77-1.99.69-3.12V9h1.93a.5.5 0 0 0 0-1h-2l-.144-2.01a5.4 5.4 0 0 0-.141-.899l1.58-1.19a.5.5 0 1 0-.6-.8l-1.33.999a5.4 5.4 0 0 0-2.64-2.62l.628-.628a.5.5 0 0 0-.707-.707l-.981.981Q8.59 1.001 7.985 1c-.606-.001-.79.044-1.17.127L5.834.146zm6.51 5.91l.216 3.03a4.58 4.58 0 0 1-4.58 4.91c-2.66 0-4.76-2.26-4.58-4.91l.216-3.03q.01-.145.03-.288c.191.13.434.279.73.427c.811.406 2.01.803 3.6.803s2.79-.397 3.6-.803c.296-.148.54-.297.73-.427q.02.143.03.288zm-.307-1.33a4.37 4.37 0 0 0-8.1 0q.053.044.133.104c.166.125.422.296.767.468c.689.344 1.74.697 3.15.697s2.46-.353 3.15-.697a5 5 0 0 0 .9-.572"\r
    clip-rule="evenodd"\r
  />\r
</svg>`,'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Qlementine Icons by Olivier Cléro - https://github.com/oclero/qlementine-icons/blob/master/LICENSE --><path fill="currentColor" d="M8.39 1c.699 0 1.4.2 2 .7l2.1 1.8c.1.1.1.3 0 .4s-.1.3 0 .4l.51.45c.098.094.259.08.388-.05c.158-.158.2-.173.399 0l1 .911c.185.181.196.289.096.389l-1.6 1.9c-.11.139-.27.198-.4.1l-.897-.8c-.1-.1-.088-.276 0-.4s.107-.304 0-.4l-.522-.431c-.156-.121-.226-.148-.45.031c-.15.121-.251.105-.351.031c-.1-.073-.086-.062-.195-.152c-.135-.11-.238-.132-.38.021l-2.6 3.2c.3.2.3.6.1.9l-3.79 4.5c-.398.3-.798.5-1.2.5s-.698-.1-.997-.4c-.7-.6-.7-1.5-.2-2.2l3.79-4.5c.1-.1.299-.2.499-.2c.1 0 .299 0 .399.1l2.2-2.6c.399-.4.25-.9-.15-1.3l-.23-.215C7.412 3.185 6.69 3 5.89 3h-.398c-.1 0-.154-.12-.1-.2l.599-.7c.599-.7 1.5-1.1 2.4-1.1zm0-1c-1.2 0-2.4.5-3.09 1.5l-.599.7c-.299.3-.399.8-.2 1.2c.2.4.599.6.998.6h.499c.499 0 .998.2 1.3.5l.2.2l-1.8 2h-.1q-.748 0-1.2.6l-3.79 4.5c-.898 1.1-.799 2.7.3 3.6c.498.4.997.6 1.7.6c.798 0 1.5-.3 1.9-.9l3.79-4.5c.298-.4.398-.9.298-1.4l1.9-2.2c.105-.119.3-.113.3 0c0 .3.2.7.5.9l.897.8q.45.3.898.3c.4 0 .8-.2.998-.5l1.6-1.9c.5-.5.33-1.32-.2-1.8l-.898-.8q-.3-.3-.898-.3h-.1c0-.3-.2-.7-.499-.9l-2.1-1.8c-.699-.7-1.6-1-2.6-1z"/></svg>','<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Qlementine Icons by Olivier Cléro - https://github.com/oclero/qlementine-icons/blob/master/LICENSE --><path fill="currentColor" d="M8.2 1H4.8c-.857 0-1.44 0-1.89.038c-.438.035-.663.1-.819.18a2 2 0 0 0-.874.874c-.08.156-.145.38-.18.819C1 3.36.999 3.94.999 4.8v5.4c0 .857.001 1.44.038 1.89c.036.438.101.663.18.819c.192.376.498.682.874.874c.156.08.381.145.819.18c.25.02.54.03.895.034c.13.36.328.702.596 1c-1.42-.002-2.17-.027-2.76-.327a3 3 0 0 1-1.31-1.31c-.327-.642-.327-1.48-.327-3.16V4.8c0-1.68 0-2.52.327-3.16A3.02 3.02 0 0 1 1.641.33c.642-.327 1.48-.327 3.16-.327h3.4c1.68 0 2.52 0 3.16.327a3.02 3.02 0 0 1 1.31 1.31c.24.47.304 1.05.321 1.99a3 3 0 0 0-.359.015a3.1 3.1 0 0 0-.664-.607l-.009-.12c-.036-.438-.1-.663-.18-.82a2 2 0 0 0-.874-.873c-.156-.08-.38-.145-.819-.18c-.45-.037-1.03-.038-1.89-.038z"/><path fill="currentColor" d="M8.07 3H2.5a.5.5 0 0 0 0 1h3.07a3.1 3.1 0 0 1 1.8-.362c.202-.247.441-.463.71-.638zM2.5 6h1.31a3 3 0 0 0-.183 1h-1.12a.5.5 0 0 1 0-1zm.09 3h-.094a.5.5 0 0 0 0 1v-.238q0-.395.094-.762"/><path fill="currentColor" fill-rule="evenodd" d="M10 12c1.1 0 2-.895 2-2c0-1.1-.895-2-2-2c-1.1 0-2 .895-2 2c0 1.1.895 2 2 2m0-1a1 1 0 1 0 0-2a1 1 0 0 0 0 2" clip-rule="evenodd"/><path fill="currentColor" fill-rule="evenodd" d="M10.2 4h-.474c-.79 0-1.45.575-1.57 1.33a5 5 0 0 0-.211.087a1.59 1.59 0 0 0-2.05.173l-.337.337a1.594 1.594 0 0 0-.173 2.05q-.046.105-.087.211a1.596 1.596 0 0 0-1.33 1.57v.474c0 .793.577 1.45 1.33 1.58q.04.104.085.206a1.6 1.6 0 0 0 .171 2.06l.33.33c.562.562 1.44.62 2.07.168q.098.045.198.083a1.6 1.6 0 0 0 1.58 1.34h.458c.8 0 1.46-.584 1.59-1.35q.098-.039.194-.081c.628.454 1.51.398 2.08-.167l.321-.321c.565-.565.621-1.45.167-2.08q.043-.097.081-.194a1.61 1.61 0 0 0 1.35-1.59v-.458c0-.797-.581-1.46-1.34-1.58a5 5 0 0 0-.082-.2c.45-.625.394-1.5-.17-2.07l-.328-.328a1.6 1.6 0 0 0-2.06-.171a5 5 0 0 0-.206-.086a1.596 1.596 0 0 0-1.58-1.33zM9.13 5.6c0-.329.266-.595.595-.595h.474c.33 0 .598.268.598.598c0 .282.199.521.466.613q.236.081.458.191c.254.125.566.097.766-.103a.6.6 0 0 1 .847 0l.329.329a.603.603 0 0 1 0 .852c-.201.201-.23.513-.106.768q.105.217.184.447c.093.27.334.472.619.472c.333 0 .603.27.603.603v.458a.606.606 0 0 1-.606.606c-.286 0-.528.202-.622.471q-.078.226-.182.439c-.125.257-.097.572.106.774a.605.605 0 0 1 0 .857l-.321.321a.605.605 0 0 1-.857 0c-.202-.202-.517-.231-.774-.106q-.213.104-.439.182c-.27.094-.472.336-.472.622a.606.606 0 0 1-.606.606h-.458a.603.603 0 0 1-.603-.603c0-.285-.202-.527-.472-.619a4 4 0 0 1-.447-.184c-.255-.124-.567-.095-.768.105a.603.603 0 0 1-.852 0l-.329-.329a.6.6 0 0 1 0-.847c.2-.2.228-.512.103-.766a4 4 0 0 1-.191-.458c-.092-.267-.331-.466-.613-.466a.6.6 0 0 1-.598-.598v-.474c0-.329.266-.595.595-.595c.282 0 .52-.199.611-.466a4 4 0 0 1 .193-.466c.124-.252.096-.561-.103-.76a.596.596 0 0 1 0-.842l.337-.337a.596.596 0 0 1 .842 0c.199.199.508.227.76.103q.225-.11.466-.193c.267-.09.466-.329.466-.611z" clip-rule="evenodd"/></svg>',`<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"\r
>\r
  <path\r
    fill="currentColor"\r
    d="M3 5.75A2.75 2.75 0 0 1 5.75 3h9.965a3.25 3.25 0 0 1 2.298.952l2.035 2.035c.61.61.952 1.437.952 2.299v9.964A2.75 2.75 0 0 1 18.25 21H5.75A2.75 2.75 0 0 1 3 18.25zM5.75 4.5c-.69 0-1.25.56-1.25 1.25v12.5c0 .69.56 1.25 1.25 1.25H6v-5.25A2.25 2.25 0 0 1 8.25 12h7.5A2.25 2.25 0 0 1 18 14.25v5.25h.25c.69 0 1.25-.56 1.25-1.25V8.286c0-.465-.184-.91-.513-1.238l-2.035-2.035a1.75 1.75 0 0 0-.952-.49V7.25a2.25 2.25 0 0 1-2.25 2.25h-4.5A2.25 2.25 0 0 1 7 7.25V4.5zm10.75 15v-5.25a.75.75 0 0 0-.75-.75h-7.5a.75.75 0 0 0-.75.75v5.25zm-8-15v2.75c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75V4.5z"\r
  />\r
</svg>`,'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Qlementine Icons by Olivier Cléro - https://github.com/oclero/qlementine-icons/blob/master/LICENSE --><path fill="currentColor" fill-rule="evenodd" d="M8 5C6.34 5 5 6.34 5 8s1.34 3 3 3s3-1.34 3-3s-1.34-3-3-3M6 8a2 2 0 1 1 4.001-.001A2 2 0 0 1 6 8" clip-rule="evenodd"/><path fill="currentColor" fill-rule="evenodd" d="M8 0C6.9 0 6 .895 6 2v.068a.46.46 0 0 1-.285.423a.45.45 0 0 1-.492-.096a1.924 1.924 0 0 0-2.72 0l-.109.11a1.924 1.924 0 0 0 0 2.72a.45.45 0 0 1 .096.491a.46.46 0 0 1-.424.285h-.068a2 2 0 1 0 0 4h.068c.183 0 .352.112.424.285a.45.45 0 0 1-.096.492a1.924 1.924 0 0 0 0 2.72l.109.11c.751.75 1.97.75 2.72 0a.45.45 0 0 1 .492-.097c.172.072.285.24.285.424v.068a2 2 0 1 0 4 0v-.068c0-.183.112-.352.285-.424a.45.45 0 0 1 .492.096c.751.751 1.97.751 2.72 0l.109-.109a1.924 1.924 0 0 0 0-2.72a.45.45 0 0 1-.096-.492a.46.46 0 0 1 .424-.285H14a2 2 0 1 0 0-4h-.067a.46.46 0 0 1-.424-.285a.45.45 0 0 1 .096-.492a1.924 1.924 0 0 0 0-2.72l-.109-.109a1.924 1.924 0 0 0-2.72 0a.45.45 0 0 1-.492.096a.46.46 0 0 1-.285-.424V2c0-1.1-.895-2-2-2M7 2a1 1 0 0 1 2 0v.068c0 .59.359 1.12.902 1.35c.54.223 1.17.102 1.58-.314a.917.917 0 0 1 1.3 0l.109.11a.93.93 0 0 1 0 1.31a1.45 1.45 0 0 0-.313 1.58c.225.543.756.902 1.35.902h.067a1 1 0 0 1 0 2h-.067a1.47 1.47 0 0 0-1.35.902c-.224.54-.103 1.17.313 1.58c.36.36.36.945 0 1.3l-.109.109a.917.917 0 0 1-1.3 0a1.45 1.45 0 0 0-1.58-.313A1.46 1.46 0 0 0 9 13.934V14a1 1 0 0 1-2 0v-.067a1.47 1.47 0 0 0-.902-1.35a1.45 1.45 0 0 0-1.58.313a.917.917 0 0 1-1.3 0l-.109-.11a.93.93 0 0 1 0-1.31a1.45 1.45 0 0 0 .313-1.58a1.46 1.46 0 0 0-1.35-.901h-.068a1 1 0 0 1 0-2h.068a1.47 1.47 0 0 0 1.35-.902c.224-.54.103-1.17-.313-1.58a.917.917 0 0 1 0-1.3l.109-.11a.93.93 0 0 1 1.31 0a1.45 1.45 0 0 0 1.58.314c.543-.225.902-.756.902-1.35V2z" clip-rule="evenodd"/></svg>','<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Qlementine Icons by Olivier Cléro - https://github.com/oclero/qlementine-icons/blob/master/LICENSE --><path fill="currentColor" fill-rule="evenodd" d="M15.1 3.12a1 1 0 0 1 .706.71c.452 1.71.032 3.62-1.32 4.97a5.14 5.14 0 0 1-4.87 1.36a.34.34 0 0 0-.148-.006l-.025.008l-5.08 5.08a2.563 2.563 0 0 1-3.62 0a2.563 2.563 0 0 1 0-3.62l5.08-5.08l.008-.025a.34.34 0 0 0-.006-.148a5.16 5.16 0 0 1 1.366-4.88a5.11 5.11 0 0 1 4.97-1.32a1 1 0 0 1 .452 1.674l-2.1 2.1l.383 1.15l1.15.383l2.1-2.1a1 1 0 0 1 .968-.258zM5.81 6.55l.001-.002zm3.62 3.62l.002-.001zm4.34-2.07a4.16 4.16 0 0 1-3.93 1.1c-.396-.096-.827-.023-1.12.265l-5.08 5.08c-.607.608-1.6.608-2.21 0a1.57 1.57 0 0 1 0-2.21l5.08-5.08c.288-.288.361-.721.265-1.12a4.2 4.2 0 0 1-.043-1.78a4.2 4.2 0 0 1 1.14-2.15c.76-.76 1.74-1.16 2.73-1.2a4.3 4.3 0 0 1 1.28.137l-2.1 2.1a1 1 0 0 0-.242 1.02l.383 1.15c.1.299.334.533.632.632l1.15.383a.99.99 0 0 0 1.02-.242l2.1-2.1c.11.418.156.849.137 1.28a4.1 4.1 0 0 1-1.2 2.73z" clip-rule="evenodd"/></svg>','<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Qlementine Icons by Olivier Cléro - https://github.com/oclero/qlementine-icons/blob/master/LICENSE --><path fill="currentColor" fill-rule="evenodd" d="m2.56 3.42l-1.55 9c-.045.263.165.577.546.577h11.3a.54.54 0 0 0 .546-.423l1.55-9c.045-.263-.165-.577-.546-.577h-11.3a.54.54 0 0 0-.546.423M.02 12.25C-.138 13.164.592 14 1.55 14h11.3c.759 0 1.41-.53 1.53-1.25l1.55-9C16.088 2.836 15.358 2 14.4 2H3.1c-.759 0-1.41.53-1.53 1.25z" clip-rule="evenodd"/><path fill="currentColor" fill-rule="evenodd" d="m7 11l.167-1h5L12 11zM5.09 4.53a.746.746 0 0 0-1.05-.117a.746.746 0 0 0-.117 1.05l1.54 1.93l-2.44 2.03a.754.754 0 0 0-.096 1.06a.754.754 0 0 0 1.06.096l3-2.5a.745.745 0 0 0 .106-1.04l-2-2.5z" clip-rule="evenodd"/></svg>']]];var I1=$n('<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24"><g fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"><path d="M5.47 5.47a.75.75 0 0 1 1.06 0l12 12a.75.75 0 1 1-1.06 1.06l-12-12a.75.75 0 0 1 0-1.06"></path><path d="M18.53 5.47a.75.75 0 0 1 0 1.06l-12 12a.75.75 0 0 1-1.06-1.06l12-12a.75.75 0 0 1 1.06 0"></path></g></svg>');function _n(I){var _=I1();ye(I,_)}var M1=Qe('<div class="flex flex-row-reverse justify-between bg-(--field-color) p-1.5"><!></div>'),E1=Qe('<div class="fixed inset-0 z-100 flex items-center justify-center bg-black/50"><div><div class="flex items-end justify-between bg-(--field-color) px-6 py-3"><h4> </h4> <button class="h-6 w-6 cursor-pointer"><!></button></div> <div><!></div> <!></div></div>');function ho(I,_){_i(_,!0);let G=Pt(_,"isOpen",15,!1),B=Pt(_,"wrapperClass",3,""),me=Pt(_,"mainClass",3,""),ae=Pt(_,"onCancel",3,()=>G(!1));const S=Ie=>{Ie.key==="Escape"&&(G(!1),ae()())};vu(()=>(document.addEventListener("keydown",S),()=>document.removeEventListener("keydown",S)));var l=wr(),q=$t(l);{var xe=Ie=>{var qe=E1(),Ne=oe(qe),Xe=oe(Ne),He=oe(Xe),Ee=oe(He,!0);K(He);var Z=de(He,2);Z.__click=function(...rt){ae()?.apply(this,rt)};var Ve=oe(Z);_n(Ve),K(Z),K(Xe);var ut=de(Xe,2),vt=oe(ut);co(vt,()=>_.main??Wn),K(ut);var Ke=de(ut,2);{var nt=rt=>{var Oe=M1(),Fe=oe(Oe);co(Fe,()=>_.footer??Wn),K(Oe),ye(rt,Oe)};xt(Ke,rt=>{_.footer&&rt(nt)})}K(Ne),K(qe),zt((rt,Oe)=>{Gt(Ne,1,rt),lr(Ee,_.title),Gt(ut,1,Oe)},[()=>Zr(ir("flex w-300 flex-col overflow-hidden rounded-2xl bg-(--back-color) text-center",B())),()=>Zr(ir("flex h-full w-full flex-col overflow-auto p-2",me()))]),Dn(3,Ne,()=>My,()=>({duration:250,start:.8})),Dn(3,qe,()=>ad,()=>({duration:200,delay:1})),ye(Ie,qe)};xt(q,Ie=>{G()&&Ie(xe)})}ye(I,l),vi()}Xi(["click"]);var A1=Qe("<span><!></span>"),k1=Qe('<div class="text-xs opacity-70"> </div>'),z1=Qe('<div class="flex-1"> <!></div>'),D1=Qe("<div> <div></div></div>"),L1=Qe('<div><button><div class=" flex flex-row items-center justify-center gap-2"><!> <!></div></button> <!></div>');function jr(I,_){_i(_,!0);let G=Pt(_,"id",19,()=>crypto.randomUUID()),B=Pt(_,"wrapperClass",3,""),me=Pt(_,"componentClass",3,""),ae=Pt(_,"disabled",3,!1),S=Pt(_,"content",19,()=>({name:"",info:{text:"",side:"top"},icon:null})),l=Vr(!1),q=ne(()=>({top:{pos:"bottom-full left-1/2 mb-2",tr:"translateX(-50%)",arr:"top-full left-1/2 -translate-x-1/2 -translate-y-1/2 rotate-45",off:"y:-15"},bottom:{pos:"top-full left-1/2 mt-2",tr:"translateX(-50%)",arr:"bottom-full left-1/2 -translate-x-1/2 translate-y-1/2 rotate-45",off:"y:15"},left:{pos:"top-1/2 right-full mr-2",tr:"translateY(-50%)",arr:"top-1/2 -right-2 -translate-x-1/2 -translate-y-1/2 rotate-45",off:"x:15"},right:{pos:"top-1/2 left-full ml-2",tr:"translateY(-50%)",arr:"top-1/2 -left-2 translate-x-1/2 -translate-y-1/2 rotate-45 ",off:"x:-15"}}));const xe=ne(()=>()=>{const nt=ir(B().split(" ").find(Oe=>Oe.startsWith("w-")),me().split(" ").find(Oe=>Oe.startsWith("w-"))),rt=ir(B().split(" ").find(Oe=>Oe.startsWith("h-")),me().split(" ").find(Oe=>Oe.startsWith("h-")));return`${nt} ${rt}`}),Ie=()=>{ae()||!_.onClick||_.onClick()},qe=nt=>{if(ae()||!_.keyBind||!_.onClick)return;const rt=nt.key===_.keyBind.key,Oe=_.keyBind.ctrlKey===void 0||nt.ctrlKey===_.keyBind.ctrlKey,Fe=_.keyBind.shiftKey===void 0||nt.shiftKey===_.keyBind.shiftKey,lt=_.keyBind.altKey===void 0||nt.altKey===_.keyBind.altKey,Re=_.keyBind.metaKey===void 0||nt.metaKey===_.keyBind.metaKey;rt&&Oe&&Fe&&lt&&Re&&(nt.preventDefault(),_.onClick())};vu(()=>(_.keyBind&&window.addEventListener("keydown",qe),()=>{_.keyBind&&window.removeEventListener("keydown",qe)}));var Ne=L1(),Xe=oe(Ne);Xe.__click=Ie;var He=oe(Xe),Ee=oe(He);{var Z=nt=>{var rt=A1(),Oe=oe(rt);{var Fe=Re=>{var pt=wr(),ft=$t(pt);Wi(ft,()=>S().icon),ye(Re,pt)},lt=Re=>{const pt=ne(()=>S()?.icon);var ft=wr(),gt=$t(ft);st(gt,()=>w(pt),(bt,Ue)=>{Ue(bt,{})}),ye(Re,ft)};xt(Oe,Re=>{typeof S()?.icon=="string"?Re(Fe):Re(lt,!1)})}K(rt),zt(Re=>Gt(rt,1,Re),[()=>` ${S().name?"absolute left-3":""} ${typeof S()?.icon=="string"?"p-0.5":""}  flex items-center justify-center overflow-visible 
            ${S().name?"h-8 w-8":`${w(xe)()}`} [&_svg]:h-full [&_svg]:max-h-full [&_svg]:w-full [&_svg]:max-w-full`]),ye(nt,rt)};xt(Ee,nt=>{S()?.icon&&nt(Z)})}var Ve=de(Ee,2);{var ut=nt=>{var rt=z1(),Oe=oe(rt),Fe=de(Oe);{var lt=Re=>{var pt=k1(),ft=oe(pt);K(pt),zt(()=>lr(ft,`(${_.keyBind.ctrlKey?"Ctrl+":""}${_.keyBind.shiftKey?"Shift+":""}${_.keyBind.altKey?"Alt+":""}${_.keyBind.key??""})`)),ye(Re,pt)};xt(Fe,Re=>{_.keyBind&&Re(lt)})}K(rt),zt(()=>lr(Oe,`${S().name??""} `)),ye(nt,rt)};xt(Ve,nt=>{S().name&&nt(ut)})}K(He),K(Xe);var vt=de(Xe,2);{var Ke=nt=>{const rt=ne(()=>w(q)[S().info?.side]);var Oe=D1(),Fe=oe(Oe),lt=de(Fe);K(Oe),zt(()=>{Gt(Oe,1,`absolute z-50 w-max max-w-xs rounded-md bg-(--container-color) px-3 py-1 text-sm shadow-lg ${w(rt).pos}`),hi(Oe,`transform: ${w(rt).tr};`),lr(Fe,`${S().info?.text??""} `),Gt(lt,1,`absolute ${w(rt).arr} h-2 w-2 transform bg-(--container-color)`)}),Dn(3,Oe,()=>sd,()=>({[w(rt).off.split(":")[0]]:parseInt(w(rt).off.split(":")[1]),duration:300})),ye(nt,Oe)};xt(vt,nt=>{w(l)&&S().info?.side&&w(q)[S().info?.side]&&nt(Ke)})}K(Ne),zt((nt,rt,Oe)=>{Gt(Ne,1,nt),tr(Xe,"id",rt),Gt(Xe,1,`${Oe??""} bg-(--bg-color)`),Xe.disabled=ae(),tr(Xe,"aria-label",S().name)},[()=>Zr(ir("relative flex w-full flex-col items-center ",B())),()=>`${G()}-${crypto.randomUUID().slice(0,6)}`,()=>ir(`relative m-0 inline-block w-full items-center rounded-2xl px-2
        py-1 font-semibold  transition duration-200 select-none 
        ${S().icon&&!S().name?"bg-transparent p-0":"bg-blue border border-(--bg-color) shadow-sm hover:shadow-md"}
        ${ae()?"cursor-not-allowed opacity-50 hover:shadow-none":"cursor-pointer   active:scale-97"} `,me())]),Sn("mouseenter",Xe,()=>{S().info?.text&&St(l,!0)}),Sn("mouseleave",Xe,()=>{S().info?.text&&St(l,!1)}),ye(I,Ne),vi()}Xi(["click"]);var R1=Qe('<button class="h-8 w-8 cursor-pointer [&amp;_svg]:h-full [&amp;_svg]:max-h-full [&amp;_svg]:w-full [&amp;_svg]:max-w-full"><!></button>'),F1=Qe('<div class="relative m-1.5 rounded-xl border-2 border-(--border-color) p-3"><div class="absolute -top-3.5 bg-(--back-color) px-1"> </div> <div class="grid grid-cols-3 place-items-center gap-2"></div></div>'),O1=Qe('<div class="grid grid-cols-3"></div>'),B1=Qe('<div class="flex items-start justify-center gap-8"><div class="flex w-1/3 flex-col items-center px-2"><!> <!> <!></div> <div class="flex w-1/3 flex-col items-center px-2"><div class="relative mt-6 flex w-full gap-2"><!> <!> <!></div></div> <div class="flex w-1/3 flex-col items-center gap-2 px-2"><div class="flex"><!> <!></div></div></div>'),N1=Qe('<button class="h-8 w-8 cursor-pointer [&amp;_svg]:h-full [&amp;_svg]:max-h-full [&amp;_svg]:w-full [&amp;_svg]:max-w-full"><!></button>'),V1=Qe('<div class="relative m-1.5 rounded-xl border-2 border-(--border-color) p-3"><div class="absolute -top-3.5 bg-(--back-color) px-1"> </div> <div class="grid grid-cols-3 place-items-center gap-2"></div></div>'),j1=Qe('<div class="grid grid-cols-3"></div>'),U1=Qe('<div class="flex items-start justify-center gap-8"><div class="flex w-1/3 flex-col items-center px-2"><!> <!> <div class="flex w-full gap-4"><!> <!></div> <!></div> <div class="flex w-1/3 flex-col px-2"><!> <div class="relative mt-5 flex w-full gap-2"><!> <!> <!></div> <!> <!></div> <div class="flex w-1/3 flex-col items-center gap-2 px-2"><div class="flex"><!> <!></div></div></div>');function aw(I,_){_i(_,!0);const G=()=>vn(Yl,"$optionsStore",me),B=()=>vn(po,"$t",me),[me,ae]=Mo(),S=Pt(_,"forConstructor",3,!0);let l=Vr(!1);const q=ne(()=>G().JUSTIFY_ALIGN_OPTIONS.find(Ee=>Ee.value.includes(_.component.properties.label?.class?.split(" ").find(Z=>Z.startsWith("justify-"))))),xe=Ee=>{const Z=Ee.target;if(!Z.files||Z.files.length===0)return;const Ve=Z.files[0],ut=new FileReader;ut.onload=vt=>{const Ke=vt.target?.result;Tt("image",Ke,_.component,_.onPropertyChange)},ut.readAsDataURL(Ve)};let Ie=ne(()=>_.component.properties.image??"");var qe=wr(),Ne=$t(qe);{var Xe=Ee=>{var Z=B1(),Ve=oe(Z),ut=oe(Ve);{let Se=ne(()=>({name:B()("constructor.props.access")})),Te=ne(()=>G().ACCESS_OPTION.find(Ce=>Ce.value===_.component.access));st(ut,()=>Nr,(Ce,we)=>{we(Ce,{get label(){return w(Se)},type:"buttons",get options(){return G().ACCESS_OPTION},get value(){return w(Te)},onUpdate:be=>_.onPropertyChange({access:be.value})})})}var vt=de(ut,2);{let Se=ne(()=>({name:B()("constructor.props.label")}));st(vt,()=>_r,(Te,Ce)=>{Ce(Te,{get label(){return w(Se)},get value(){return _.component.properties.label.name},onUpdate:we=>Tt("label.name",we,_.component,_.onPropertyChange)})})}var Ke=de(vt,2);{let Se=ne(()=>({name:B()("constructor.props.align")}));st(Ke,()=>Nr,(Te,Ce)=>{Ce(Te,{get label(){return w(Se)},type:"buttons",get value(){return w(q)},get options(){return G().JUSTIFY_ALIGN_OPTIONS},onUpdate:we=>Tt("label.class",we.value,_.component,_.onPropertyChange)})})}K(Ve);var nt=de(Ve,2),rt=oe(nt),Oe=oe(rt);{let Se=ne(()=>({name:B()("constructor.props.labelicon")}));st(Oe,()=>jr,(Te,Ce)=>{Ce(Te,{get content(){return w(Se)},onClick:()=>St(l,!0)})})}var Fe=de(Oe,2);{var lt=Se=>{ho(Se,{wrapperClass:"w-130",get isOpen(){return w(l)},set isOpen(Ce){St(l,Ce,!0)},main:Ce=>{var we=O1();Er(we,21,()=>uo,Ur,(be,ie)=>{var ee=F1(),Q=oe(ee),ue=oe(Q,!0);K(Q);var De=de(Q,2);Er(De,21,()=>w(ie)[1],Ur,(Ge,ot)=>{var it=R1();it.__click=()=>{Tt("label.icon",w(ot),_.component,_.onPropertyChange)};var It=oe(it);Wi(It,()=>w(ot)),K(it),ye(Ge,it)}),K(De),K(ee),zt(Ge=>lr(ue,Ge),[()=>B()(`constructor.props.icon.${w(ie)[0]}`)]),ye(be,ee)}),K(we),ye(Ce,we)},$$slots:{main:!0}})};xt(Fe,Se=>{w(l)&&Se(lt)})}var Re=de(Fe,2);{var pt=Se=>{{let Te=ne(()=>({icon:_n}));jr(Se,{wrapperClass:"w-8.5 ",componentClass:"p-0.5 bg-red",get content(){return w(Te)},onClick:()=>{Tt("label.icon","",_.component,_.onPropertyChange)}})}};xt(Re,Se=>{_.component.properties.label.icon&&Se(pt)})}K(rt),K(nt);var ft=de(nt,2),gt=oe(ft),bt=oe(gt);{let Se=ne(()=>({name:B()("constructor.props.image")}));st(bt,()=>Tg,(Te,Ce)=>{Ce(Te,{type:"image",get label(){return w(Se)},accept:"image/png, image/jpeg, image/webp",onChange:xe,get currentImage(){return w(Ie)},set currentImage(we){St(Ie,we)}})})}var Ue=de(bt,2);{var Be=Se=>{{let Te=ne(()=>({icon:_n}));jr(Se,{wrapperClass:"w-8.5 mt-6",componentClass:"p-0.5 bg-red",get content(){return w(Te)},onClick:()=>{Tt("image","",_.component,_.onPropertyChange)}})}};xt(Ue,Se=>{w(Ie)&&Se(Be)})}K(gt),K(ft),K(Z),ye(Ee,Z)},He=Ee=>{var Z=U1(),Ve=oe(Z),ut=oe(Ve);{let ee=ne(()=>({name:B()("constructor.props.id")}));st(ut,()=>_r,(Q,ue)=>{ue(Q,{get label(){return w(ee)},get value(){return _.component.properties.id},onUpdate:De=>Tt("id",De,_.component,_.onPropertyChange)})})}var vt=de(ut,2);{let ee=ne(()=>({name:B()("constructor.props.access")})),Q=ne(()=>G().ACCESS_OPTION.find(ue=>ue.value===_.component.access));st(vt,()=>Nr,(ue,De)=>{De(ue,{get label(){return w(ee)},type:"buttons",get options(){return G().ACCESS_OPTION},get value(){return w(Q)},onUpdate:Ge=>_.onPropertyChange({access:Ge.value})})})}var Ke=de(vt,2),nt=oe(Ke);{let ee=ne(()=>({name:B()("constructor.props.size.height")}));st(nt,()=>_r,(Q,ue)=>{ue(Q,{get label(){return w(ee)},get value(){return _.component.properties.size.height},onUpdate:De=>Tt("size.height",De,_.component,_.onPropertyChange),number:{minNum:1,maxNum:1e3,step:1},type:"number"})})}var rt=de(nt,2);{let ee=ne(()=>({name:B()("constructor.props.size.width")}));st(rt,()=>_r,(Q,ue)=>{ue(Q,{get label(){return w(ee)},get value(){return _.component.properties.size.width},onUpdate:De=>Tt("size.width",De,_.component,_.onPropertyChange),number:{minNum:1,maxNum:1e3,step:1},type:"number"})})}K(Ke);var Oe=de(Ke,2);{let ee=ne(()=>({name:B()("constructor.props.open")}));st(Oe,()=>Hn,(Q,ue)=>{ue(Q,{get label(){return w(ee)},get value(){return _.component.properties.isOpen},options:[{id:crypto.randomUUID(),value:0,class:""}],onChange:De=>Tt("isOpen",De,_.component,_.onPropertyChange)})})}K(Ve);var Fe=de(Ve,2),lt=oe(Fe);{let ee=ne(()=>({name:B()("constructor.props.wrapperclass")}));st(lt,()=>_r,(Q,ue)=>{ue(Q,{get label(){return w(ee)},get value(){return _.component.properties.wrapperClass},onUpdate:De=>Tt("wrapperClass",De,_.component,_.onPropertyChange)})})}var Re=de(lt,2),pt=oe(Re);{let ee=ne(()=>({name:B()("constructor.props.labelicon")}));st(pt,()=>jr,(Q,ue)=>{ue(Q,{get content(){return w(ee)},onClick:()=>St(l,!0)})})}var ft=de(pt,2);{var gt=ee=>{ho(ee,{wrapperClass:"w-130",get isOpen(){return w(l)},set isOpen(ue){St(l,ue,!0)},main:ue=>{var De=j1();Er(De,21,()=>uo,Ur,(Ge,ot)=>{var it=V1(),It=oe(it),Rt=oe(It,!0);K(It);var Ft=de(It,2);Er(Ft,21,()=>w(ot)[1],Ur,(Kt,Yt)=>{var Tr=N1();Tr.__click=()=>{Tt("label.icon",w(Yt),_.component,_.onPropertyChange)};var Qt=oe(Tr);Wi(Qt,()=>w(Yt)),K(Tr),ye(Kt,Tr)}),K(Ft),K(it),zt(Kt=>lr(Rt,Kt),[()=>B()(`constructor.props.icon.${w(ot)[0]}`)]),ye(Ge,it)}),K(De),ye(ue,De)},$$slots:{main:!0}})};xt(ft,ee=>{w(l)&&ee(gt)})}var bt=de(ft,2);{var Ue=ee=>{{let Q=ne(()=>({icon:_n}));jr(ee,{wrapperClass:"w-8.5 ",componentClass:"p-0.5 bg-red",get content(){return w(Q)},onClick:()=>{Tt("label.icon","",_.component,_.onPropertyChange)}})}};xt(bt,ee=>{_.component.properties.label.icon&&ee(Ue)})}K(Re);var Be=de(Re,2);{let ee=ne(()=>({name:B()("constructor.props.label")}));st(Be,()=>_r,(Q,ue)=>{ue(Q,{get label(){return w(ee)},get value(){return _.component.properties.label.name},onUpdate:De=>Tt("label.name",De,_.component,_.onPropertyChange)})})}var Se=de(Be,2);{let ee=ne(()=>({name:B()("constructor.props.label.class")}));st(Se,()=>_r,(Q,ue)=>{ue(Q,{get label(){return w(ee)},get value(){return _.component.properties.label.class},onUpdate:De=>Tt("label.class",De,_.component,_.onPropertyChange)})})}K(Fe);var Te=de(Fe,2),Ce=oe(Te),we=oe(Ce);{let ee=ne(()=>({name:B()("constructor.props.image")}));st(we,()=>Tg,(Q,ue)=>{ue(Q,{type:"image",get label(){return w(ee)},accept:"image/png, image/jpeg, image/webp",onChange:xe,get currentImage(){return w(Ie)},set currentImage(De){St(Ie,De)}})})}var be=de(we,2);{var ie=ee=>{{let Q=ne(()=>({icon:_n}));jr(ee,{wrapperClass:"w-8.5 mt-6",componentClass:"p-0.5 bg-red",get content(){return w(Q)},onClick:()=>{Tt("image","",_.component,_.onPropertyChange)}})}};xt(be,ee=>{w(Ie)&&ee(ie)})}K(Ce),K(Te),K(Z),ye(Ee,Z)};xt(Ne,Ee=>{S()?Ee(Xe):Ee(He,!1)})}ye(I,qe),vi(),ae()}Xi(["click"]);var G1=Qe('<button class="h-8 w-8 cursor-pointer [&amp;_svg]:h-full [&amp;_svg]:max-h-full [&amp;_svg]:w-full [&amp;_svg]:max-w-full"><!></button>'),q1=Qe('<div class="relative m-1.5 rounded-xl border-2 border-(--border-color) p-3"><div class="absolute -top-3.5 bg-(--back-color) px-1"> </div> <div class="grid grid-cols-3 place-items-center gap-2"></div></div>'),Z1=Qe('<div class="grid grid-cols-3"></div>'),H1=Qe('<div class="relative flex flex-row items-start justify-center"><div class="flex w-1/3 flex-col items-center px-2"><!> <!> <!></div> <div class="flex w-1/3 flex-col items-center px-2"><!> <!> <!> <div class="relative mt-6 flex w-full gap-2"><!> <!> <!></div></div> <div class="flex w-1/3 flex-col items-center px-2"><!> <!> <!></div></div>'),W1=Qe('<button class="h-8 w-8 cursor-pointer [&amp;_svg]:h-full [&amp;_svg]:max-h-full [&amp;_svg]:w-full [&amp;_svg]:max-w-full"><!></button>'),X1=Qe('<div class="relative m-1.5 rounded-xl border-2 border-(--border-color) p-3"><div class="absolute -top-3.5 bg-(--back-color) px-1"> </div> <div class="grid grid-cols-3 place-items-center gap-2"></div></div>'),Y1=Qe('<div class="grid grid-cols-3"></div>'),K1=Qe('<div class="relative flex flex-row items-start justify-center"><div class="flex w-1/3 flex-col items-center px-2"><!> <!> <!> <!></div> <div class="flex w-1/3 flex-col px-2"><!> <!> <!></div> <div class="flex w-1/3 flex-col px-2"><!> <!> <div class="relative mt-6 flex w-full gap-2"><!> <!> <!></div></div></div>');function sw(I,_){_i(_,!0);const G=()=>vn(Yl,"$optionsStore",me),B=()=>vn(po,"$t",me),[me,ae]=Mo(),S=Pt(_,"forConstructor",3,!0);let l=Vr(!1),q=ne(()=>_.component.eventHandler.Value),xe=ne(()=>G().HEADER_OPTIONS.find(Z=>Z.value===_.component.eventHandler.Header)??{id:"",name:"",value:"",class:"!w-1/4"});const Ie=ne(()=>G().COLOR_OPTIONS.find(Z=>Z.value.includes(_.component.properties.componentClass?.split(" ").find(Ve=>Ve.startsWith("bg-"))))),qe=ne(()=>G().HEIGHT_OPTIONS.find(Z=>Z.value.includes(_.component.properties.componentClass?.split(" ").find(Ve=>Ve.startsWith("py-")))));var Ne=wr(),Xe=$t(Ne);{var He=Z=>{var Ve=H1(),ut=oe(Ve),vt=oe(ut);{let ie=ne(()=>({name:B()("constructor.props.header")}));st(vt,()=>Nr,(ee,Q)=>{Q(ee,{get label(){return w(ie)},type:"buttons",get value(){return w(xe)},get options(){return G().HEADER_OPTIONS},onUpdate:ue=>{St(xe,{...ue}),_.onPropertyChange({eventHandler:{Header:w(xe).value}})}})})}var Ke=de(vt,2);{var nt=ie=>{var ee=wr(),Q=$t(ee);{let ue=ne(()=>({name:B()("constructor.props.argument")})),De=ne(()=>G().FULL_ARGUMENT_OPTION.find(Ge=>Ge.value===_.component.eventHandler.Argument)??G().FULL_ARGUMENT_OPTION.find(Ge=>Ge.value===""));st(Q,()=>Nr,(Ge,ot)=>{ot(Ge,{get label(){return w(ue)},type:"buttons",get value(){return w(De)},get options(){return G().FULL_ARGUMENT_OPTION},onUpdate:it=>{_.onPropertyChange({eventHandler:{Argument:it.value}})}})})}ye(ie,ee)};xt(Ke,ie=>{w(xe).value==="SET"&&ie(nt)})}var rt=de(Ke,2);{let ie=ne(()=>({name:w(xe).value!=="SET"?B()("constructor.props.argument"):""})),ee=ne(()=>w(xe).value==="SET"?"mt-1":""),Q=ne(()=>w(xe).value==="SET"&&(_.component.eventHandler.Argument=="Save"||_.component.eventHandler.Argument=="NoSave")),ue=ne(()=>({info:B()("constructor.props.argument.info"),autocomplete:"on",regExp:/^[a-zA-Z0-9\-_]{0,32}$/}));st(rt,()=>_r,(De,Ge)=>{Ge(De,{get label(){return w(ie)},get wrapperClass(){return`${w(ee)??""} `},get value(){return _.component.eventHandler.Argument},maxlength:32,get disabled(){return w(Q)},get help(){return w(ue)},onUpdate:ot=>_.onPropertyChange({eventHandler:{Argument:ot}})})})}K(ut);var Oe=de(ut,2),Fe=oe(Oe);{var lt=ie=>{var ee=wr(),Q=$t(ee);{let ue=ne(()=>({name:B()("constructor.props.value")})),De=ne(()=>({info:B()("constructor.props.value.info")}));st(Q,()=>_r,(Ge,ot)=>{ot(Ge,{get label(){return w(ue)},get value(){return _.component.eventHandler.Value},get help(){return w(De)},maxlength:500,onUpdate:it=>_.onPropertyChange({eventHandler:{Value:it}})})})}ye(ie,ee)};xt(Fe,ie=>{(_.component.eventHandler.Argument!=="Save"&&_.component.eventHandler.Argument!=="NoSave"||w(xe).value==="SET")&&ie(lt)})}var Re=de(Fe,2);{let ie=ne(()=>({name:B()("constructor.props.variables")})),ee=ne(()=>_.component.eventHandler.Variables.join(" ")),Q=ne(()=>({info:B()("constructor.props.variables.info"),autocomplete:"on",regExp:/^[a-zA-Z0-9\-_ ":{}]{0,500}$/}));st(Re,()=>_r,(ue,De)=>{De(ue,{get label(){return w(ie)},get disabled(){return w(q)},get value(){return w(ee)},get help(){return w(Q)},maxlength:500,onUpdate:Ge=>{const ot=Ge.trim().split(/\s+/);_.onPropertyChange({eventHandler:{Variables:ot}})}})})}var pt=de(Re,2);{let ie=ne(()=>({name:B()("constructor.props.access")})),ee=ne(()=>G().ACCESS_OPTION.find(Q=>Q.value===_.component.access));st(pt,()=>Nr,(Q,ue)=>{ue(Q,{get label(){return w(ie)},type:"buttons",get options(){return G().ACCESS_OPTION},get value(){return w(ee)},onUpdate:De=>_.onPropertyChange({access:De.value})})})}var ft=de(pt,2),gt=oe(ft);{let ie=ne(()=>({name:B()("constructor.props.buttonIcon")}));st(gt,()=>jr,(ee,Q)=>{Q(ee,{get content(){return w(ie)},onClick:()=>St(l,!0)})})}var bt=de(gt,2);{var Ue=ie=>{ho(ie,{wrapperClass:"w-130",get isOpen(){return w(l)},set isOpen(Q){St(l,Q,!0)},main:Q=>{var ue=Z1();Er(ue,21,()=>uo,Ur,(De,Ge)=>{var ot=q1(),it=oe(ot),It=oe(it,!0);K(it);var Rt=de(it,2);Er(Rt,21,()=>w(Ge)[1],Ur,(Ft,Kt)=>{var Yt=G1();Yt.__click=()=>{Tt("content.icon",w(Kt),_.component,_.onPropertyChange)};var Tr=oe(Yt);Wi(Tr,()=>w(Kt)),K(Yt),ye(Ft,Yt)}),K(Rt),K(ot),zt(Ft=>lr(It,Ft),[()=>B()(`constructor.props.icon.${w(Ge)[0]}`)]),ye(De,ot)}),K(ue),ye(Q,ue)},$$slots:{main:!0}})};xt(bt,ie=>{w(l)&&ie(Ue)})}var Be=de(bt,2);{var Se=ie=>{{let ee=ne(()=>({icon:_n}));jr(ie,{wrapperClass:"w-8.5 ",componentClass:"p-0.5 bg-red",get content(){return w(ee)},onClick:()=>{Tt("content.icon","",_.component,_.onPropertyChange)}})}};xt(Be,ie=>{_.component.properties.content.icon&&ie(Se)})}K(ft),K(Oe);var Te=de(Oe,2),Ce=oe(Te);{let ie=ne(()=>({name:B()("constructor.props.name")}));st(Ce,()=>_r,(ee,Q)=>{Q(ee,{get label(){return w(ie)},get value(){return _.component.properties.content.name},onUpdate:ue=>Tt("content.name",ue,_.component,_.onPropertyChange)})})}var we=de(Ce,2);{let ie=ne(()=>({name:B()("constructor.props.height")}));st(we,()=>Nr,(ee,Q)=>{Q(ee,{get label(){return w(ie)},type:"buttons",get options(){return G().HEIGHT_OPTIONS},get value(){return w(qe)},onUpdate:ue=>Tt("componentClass",ir(_.component.properties.componentClass,ue.value),_.component,_.onPropertyChange)})})}var be=de(we,2);{let ie=ne(()=>({name:B()("constructor.props.colors")}));st(be,()=>Nr,(ee,Q)=>{Q(ee,{wrapperClass:"h-14",get label(){return w(ie)},type:"buttons",get options(){return G().COLOR_OPTIONS},get value(){return w(Ie)},onUpdate:ue=>Tt("componentClass",ir(_.component.properties.componentClass,ue.value),_.component,_.onPropertyChange)})})}K(Te),K(Ve),ye(Z,Ve)},Ee=Z=>{var Ve=K1(),ut=oe(Ve),vt=oe(ut);{let we=ne(()=>({name:B()("constructor.props.id")}));st(vt,()=>_r,(be,ie)=>{ie(be,{get label(){return w(we)},get value(){return _.component.properties.id},onUpdate:ee=>Tt("id",ee,_.component,_.onPropertyChange)})})}var Ke=de(vt,2);{let we=ne(()=>({name:B()("constructor.props.access")})),be=ne(()=>G().ACCESS_OPTION.find(ie=>ie.value===_.component.access));st(Ke,()=>Nr,(ie,ee)=>{ee(ie,{get label(){return w(we)},type:"buttons",get options(){return G().ACCESS_OPTION},get value(){return w(be)},onUpdate:Q=>_.onPropertyChange({access:Q.value})})})}var nt=de(Ke,2);{let we=ne(()=>({name:B()("constructor.props.wrapperclass")}));st(nt,()=>_r,(be,ie)=>{ie(be,{get label(){return w(we)},get value(){return _.component.properties.wrapperClass},onUpdate:ee=>Tt("wrapperClass",ee,_.component,_.onPropertyChange)})})}var rt=de(nt,2);{let we=ne(()=>({name:B()("constructor.props.disabled")}));st(rt,()=>Hn,(be,ie)=>{ie(be,{wrapperClass:"bg-blue",get label(){return w(we)},get value(){return _.component.properties.disabled},options:[{id:crypto.randomUUID(),value:0,class:""}],onChange:ee=>Tt("disabled",ee,_.component,_.onPropertyChange)})})}K(ut);var Oe=de(ut,2),Fe=oe(Oe);{let we=ne(()=>({name:B()("constructor.props.name")}));st(Fe,()=>_r,(be,ie)=>{ie(be,{get label(){return w(we)},get value(){return _.component.properties.content.name},onUpdate:ee=>Tt("content.name",ee,_.component,_.onPropertyChange)})})}var lt=de(Fe,2);{let we=ne(()=>({name:B()("constructor.props.info")}));st(lt,()=>_r,(be,ie)=>{ie(be,{get label(){return w(we)},get value(){return _.component.properties.content.info.text},onUpdate:ee=>Tt("content.info.text",ee,_.component,_.onPropertyChange)})})}var Re=de(lt,2);{let we=ne(()=>({name:B()("constructor.props.info.side")})),be=ne(()=>G().INFO_SIDE_OPTIONS.find(ie=>ie.value===_.component.properties.content.info.side));st(Re,()=>Nr,(ie,ee)=>{ee(ie,{get label(){return w(we)},type:"buttons",get options(){return G().INFO_SIDE_OPTIONS},get value(){return w(be)},onUpdate:Q=>Tt("content.info.side",Q.value,_.component,_.onPropertyChange)})})}K(Oe);var pt=de(Oe,2),ft=oe(pt);{let we=ne(()=>({name:B()("constructor.props.componentclass")}));st(ft,()=>_r,(be,ie)=>{ie(be,{get label(){return w(we)},get value(){return _.component.properties.componentClass},onUpdate:ee=>Tt("componentClass",ee,_.component,_.onPropertyChange)})})}var gt=de(ft,2);{let we=ne(()=>({name:B()("constructor.props.colors")}));st(gt,()=>Nr,(be,ie)=>{ie(be,{wrapperClass:"h-14",get label(){return w(we)},type:"buttons",get options(){return G().COLOR_OPTIONS},get value(){return w(Ie)},onUpdate:ee=>Tt("componentClass",ir(_.component.properties.componentClass,ee.value),_.component,_.onPropertyChange)})})}var bt=de(gt,2),Ue=oe(bt);{let we=ne(()=>({name:B()("constructor.props.buttonIcon")}));st(Ue,()=>jr,(be,ie)=>{ie(be,{get content(){return w(we)},onClick:()=>St(l,!0)})})}var Be=de(Ue,2);{var Se=we=>{ho(we,{wrapperClass:"w-130",get isOpen(){return w(l)},set isOpen(ie){St(l,ie,!0)},main:ie=>{var ee=Y1();Er(ee,21,()=>uo,Ur,(Q,ue)=>{var De=X1(),Ge=oe(De),ot=oe(Ge,!0);K(Ge);var it=de(Ge,2);Er(it,21,()=>w(ue)[1],Ur,(It,Rt)=>{var Ft=W1();Ft.__click=()=>{Tt("content.icon",w(Rt),_.component,_.onPropertyChange)};var Kt=oe(Ft);Wi(Kt,()=>w(Rt)),K(Ft),ye(It,Ft)}),K(it),K(De),zt(It=>lr(ot,It),[()=>B()(`constructor.props.icon.${w(ue)[0]}`)]),ye(Q,De)}),K(ee),ye(ie,ee)},$$slots:{main:!0}})};xt(Be,we=>{w(l)&&we(Se)})}var Te=de(Be,2);{var Ce=we=>{{let be=ne(()=>({icon:_n}));jr(we,{wrapperClass:"w-8.5 ",componentClass:"p-0.5 bg-red",get content(){return w(be)},onClick:()=>{Tt("content.icon","",_.component,_.onPropertyChange)}})}};xt(Te,we=>{_.component.properties.content.icon&&we(Ce)})}K(bt),K(pt),K(Ve),ye(Z,Ve)};xt(Xe,Z=>{S()?Z(He):Z(Ee,!1)})}ye(I,Ne),vi(),ae()}Xi(["click"]);Xi(["click"]);var Q1=Qe("<h5> </h5>"),J1=Qe('<div class="pointer-events-none absolute top-1/2 h-7 w-1 -translate-x-1/2 -translate-y-1/2 rounded-full border-2 border-white"></div>'),$1=Qe('<div class="absolute inset-0"></div> <div class="pointer-events-none absolute top-1/2 h-7 w-1 -translate-x-1/2 -translate-y-1/2 rounded-full border-2 border-white"></div>',1),ex=Qe('<div class="pointer-events-none absolute top-1/2 h-7 w-1 -translate-x-1/2 -translate-y-1/2 rounded-full border-2 border-white"></div>'),tx=Qe('<div><!> <div class="flex w-full flex-row items-center gap-2"><div class="flex w-full flex-col gap-2"><div class="hue-slider relative h-7 w-full cursor-pointer overflow-hidden rounded-full shadow-sm transition duration-200 hover:shadow-md" role="slider"><div class="absolute inset-0"></div> <!></div> <div role="slider"><!></div> <div class="white-slider relative mt-4 h-4 w-full cursor-pointer overflow-hidden rounded-full shadow-sm transition duration-200 hover:shadow-md" role="slider"><div class="absolute inset-0 bg-linear-to-r from-black to-white"></div> <!></div></div> <div class="flex flex-col items-center" style="width: 7rem;"><div></div> <div class="w-full text-center font-semibold"> </div></div></div></div>');function lw(I,_){_i(_,!0);let G=Pt(_,"id",19,()=>crypto.randomUUID()),B=Pt(_,"wrapperClass",3,""),me=Pt(_,"label",19,()=>({name:"",class:""})),ae=Pt(_,"value",19,()=>[0,0,0]),S=Pt(_,"onChange",3,()=>{});const l=Na({h:0,s:100,v:100});let q=Vr(0),xe=Vr(100),Ie=Vr("hsv"),qe=Vr(100);vr(()=>{if(ae().length!==3)return;const[be,ie,ee]=ae(),Q=be===ie&&ie===ee;if(St(Ie,Q?"white":"hsv",!0),Q){St(qe,Math.round(be/255*100),!0);return}const ue=ae().map(Ft=>Ft/255),De=Math.max(...ue),Ge=Math.min(...ue),ot=De-Ge;let it=0;if(ot!==0){const[Ft,Kt,Yt]=ue;De===Ft?it=(Kt-Yt)/ot%6:De===Kt?it=(Yt-Ft)/ot+2:it=(Ft-Kt)/ot+4,it*=60,it<0&&(it+=360)}const It=De?ot/De*100:0,Rt=De*100;l.h=Math.round(it),l.s=Math.round(It),l.v=Math.round(Rt),St(q,it/360*100),St(xe,Rt)});const Ne=(be,ie,ee)=>{ie/=100,ee/=100;const Q=ee*ie,ue=Q*(1-Math.abs(be/60%2-1)),De=ee-Q;let Ge=0,ot=0,it=0;return be<60?[Ge,ot,it]=[Q,ue,0]:be<120?[Ge,ot,it]=[ue,Q,0]:be<180?[Ge,ot,it]=[0,Q,ue]:be<240?[Ge,ot,it]=[0,ue,Q]:be<300?[Ge,ot,it]=[ue,0,Q]:[Ge,ot,it]=[Q,0,ue],[Math.round((Ge+De)*255),Math.round((ot+De)*255),Math.round((it+De)*255)]},Xe=(be,ie)=>{const Q=document.querySelector(`.${ie}-slider`).getBoundingClientRect();let ue={...l},De=w(qe);ie==="hue"||ie==="brightness"?(w(Ie)==="white"&&(l.s=100),St(Ie,"hsv")):St(Ie,"white");const Ge=it=>{const It=Math.max(0,Math.min(it.clientX-Q.left,Q.width)),Rt=It/Q.width*100;ie==="hue"?(St(q,Rt),ue.h=It/Q.width*360,l.h=ue.h):ie==="brightness"?(St(xe,Rt),ue.v=Rt,l.v=ue.v):ie==="white"&&(De=Rt,St(qe,De,!0))},ot=()=>{if(window.removeEventListener("mousemove",Ge),window.removeEventListener("mouseup",ot),w(Ie)==="hsv")S()(Ne(ue.h,l.s,ue.v));else{const it=Math.round(De/100*255);S()([it,it,it])}};Ge(be),window.addEventListener("mousemove",Ge),window.addEventListener("mouseup",ot)},He=ne(()=>()=>w(Ie)==="white"?[w(qe),w(qe),w(qe)].map(be=>Math.round(be/100*255)):Ne(l.h,l.s,l.v)),Ee=ne(()=>()=>w(He)().map(be=>be.toString(16).padStart(2,"0")).join(" ").toUpperCase()),Z=ne(()=>()=>w(Ie)==="white"?[255,255,255].map(be=>Math.round(w(qe)/100*be)):Ne(l.h,l.s,100)),Ve=ne(()=>()=>{const[be,ie,ee]=w(He)();return(be*299+ie*587+ee*114)/1e3>128?"text-black":"text-white"});var ut=tx(),vt=oe(ut);{var Ke=be=>{var ie=Q1(),ee=oe(ie,!0);K(ie),zt(Q=>{Gt(ie,1,Q),lr(ee,me().name)},[()=>Zr(ir("w-full px-4 text-center",me().class))]),ye(be,ie)};xt(vt,be=>{me().name&&be(Ke)})}var nt=de(vt,2),rt=oe(nt),Oe=oe(rt);tr(Oe,"aria-valuenow",null),tr(Oe,"tabindex",null),Oe.__mousedown=be=>Xe(be,"hue");var Fe=oe(Oe),lt=de(Fe,2);{var Re=be=>{var ie=J1();zt(ee=>hi(ie,ee),[()=>`left: ${w(q)}%; background: rgb(${Ne(l.h,100,100).join(",")})`]),ye(be,ie)};xt(lt,be=>{w(Ie)==="hsv"&&be(Re)})}K(Oe);var pt=de(Oe,2);tr(pt,"aria-valuenow",null),tr(pt,"tabindex",null),pt.__mousedown=be=>Xe(be,"brightness");var ft=oe(pt);{var gt=be=>{var ie=$1(),ee=$t(ie),Q=de(ee,2);zt((ue,De)=>{hi(ee,ue),hi(Q,De)},[()=>`background: linear-gradient(to right, rgb(0,0,0), rgb(${Ne(l.h,l.s,100).join(",")}))`,()=>`left: ${w(xe)}%; background: rgb(${Ne(l.h,l.s,l.v).join(",")})`]),ye(be,ie)};xt(ft,be=>{w(Ie)==="hsv"&&be(gt)})}K(pt);var bt=de(pt,2);tr(bt,"aria-valuenow",null),tr(bt,"tabindex",null),bt.__mousedown=be=>Xe(be,"white");var Ue=de(oe(bt),2);{var Be=be=>{var ie=ex();zt(ee=>hi(ie,ee),[()=>`left: ${w(qe)}%; background: rgb(${[255,255,255].map(ee=>Math.round(w(qe)/100*ee)).join(",")})`]),ye(be,ie)};xt(Ue,be=>{w(Ie)==="white"&&be(Be)})}K(bt),K(rt);var Se=de(rt,2),Te=oe(Se),Ce=de(Te,2),we=oe(Ce,!0);K(Ce),K(Se),K(nt),K(ut),zt((be,ie,ee,Q,ue,De)=>{tr(ut,"id",be),Gt(ut,1,ie),hi(Fe,ee),Gt(pt,1,`brightness-slider relative h-4 w-full cursor-pointer overflow-hidden rounded-full ${w(Ie)==="hsv"?"shadow-sm transition duration-200 hover:shadow-md":""}`),Gt(Te,1,Q),hi(Te,ue),lr(we,De)},[()=>`${G()}-${crypto.randomUUID().slice(0,6)}`,()=>Zr(ir("relative flex w-full flex-col items-center",B())),()=>`background: linear-gradient(to right, ${Array.from({length:7},(be,ie)=>{const[ee,Q,ue]=Ne(ie*60,100,100);return`rgb(${ee},${Q},${ue})`}).join(", ")})`,()=>`flex size-15 flex-col justify-center gap-1 rounded-full px-2 font-mono text-sm shadow-sm transition duration-200 select-none ${w(Ve)()}`,()=>`background: rgb(${w(Z)().join(",")})`,()=>w(Ee)()]),ye(I,ut),vi()}Xi(["mousedown"]);var rx=Qe("<h5> </h5>"),ix=Qe('<img alt="Preview"/>'),nx=Qe('<span class="text-sm text-gray-500">Image</span>'),ox=Qe('<div class="relative"><button><!></button> <input type="file" class="absolute -z-10 h-0 w-0 overflow-hidden opacity-0"/></div>'),ax=Qe('<label class="relative inline-block w-full"><input type="file"/> <div><div> </div> <div><p class="truncate"> </p></div></div></label>'),sx=Qe("<div><!> <!></div>");function Tg(I,_){_i(_,!0);const G=()=>vn(po,"$t",B),[B,me]=Mo();let ae=Pt(_,"id",19,()=>crypto.randomUUID()),S=Pt(_,"wrapperClass",3,""),l=Pt(_,"label",19,()=>({name:"",class:""})),q=Pt(_,"type",3,"file"),xe=Pt(_,"accept",3,"*/*"),Ie=Pt(_,"imageSize",19,()=>({height:"10rem",width:"10rem",fitMode:"cover",form:"square"})),qe=Pt(_,"disabled",3,!1),Ne=Pt(_,"currentImage",11,""),Xe=Pt(_,"onChange",3,()=>{}),He=ne(()=>`${ae()}-${crypto.randomUUID().slice(0,6)}`),Ee=Vr(null),Z=ne(()=>Ne()?Ne().startsWith("data:")?Ne():`data:image/png;base64,${Ne()}`:null),Ve=Vr("");const ut=Re=>{const pt=Re.target;if(!pt.files||pt.files.length===0){Xe()(Re,null);return}const ft=pt.files[0];St(Ee,ft,!0),St(Ve,ft.name,!0),ft.type.startsWith("image/")&&St(Z,URL.createObjectURL(ft)),Xe()(Re,ft)},vt=()=>{document.getElementById(w(He))?.click()};var Ke=sx(),nt=oe(Ke);{var rt=Re=>{var pt=rx(),ft=oe(pt,!0);K(pt),zt(()=>{Gt(pt,1,`${l().class}`),lr(ft,l().name)}),ye(Re,pt)};xt(nt,Re=>{l().name&&Re(rt)})}var Oe=de(nt,2);{var Fe=Re=>{var pt=ox(),ft=oe(pt);ft.__click=vt;var gt=oe(ft);{var bt=Se=>{var Te=ix();zt(Ce=>{tr(Te,"src",Ce),Gt(Te,1,`
              h-full w-full
              ${Ie().fitMode==="cover"?"object-cover":"object-contain"}
            `)},[()=>w(Z)??(Ne()?.startsWith("data:")?Ne():`data:image/png;base64,${Ne()}`)]),ye(Se,Te)},Ue=Se=>{var Te=nx();ye(Se,Te)};xt(gt,Se=>{w(Z)||Ne()?Se(bt):Se(Ue,!1)})}K(ft);var Be=de(ft,2);Be.__change=ut,K(pt),zt(()=>{Gt(ft,1,`flex items-center justify-center overflow-hidden ${Ie().form==="circle"?"rounded-full":"rounded-2xl"} 
        bg-(--back-color) shadow-sm transition duration-250
        ${qe()?"cursor-not-allowed opacity-50":"cursor-pointer hover:shadow-md"}`),hi(ft,`height: ${Ie().height}; width: ${Ie().width}`),ft.disabled=qe(),tr(Be,"id",w(He)),tr(Be,"accept",xe()),Be.disabled=qe()}),ye(Re,pt)},lt=Re=>{var pt=ax(),ft=oe(pt);ft.__change=ut;var gt=de(ft,2),bt=oe(gt),Ue=oe(bt,!0);K(bt);var Be=de(bt,2),Se=oe(Be),Te=oe(Se,!0);K(Se),K(Be),K(gt),K(pt),zt((Ce,we)=>{tr(ft,"id",w(He)),Gt(ft,1,`absolute left-0 z-1 h-8.5 w-full opacity-0 ${qe()?"cursor-not-allowed":"cursor-pointer"}`),tr(ft,"accept",xe()),ft.disabled=qe(),Gt(gt,1,`flex w-full overflow-hidden rounded-2xl font-semibold shadow-sm transition duration-250 ${qe()?"":"hover:shadow-md"}
             `),Gt(bt,1,`flex w-1/3 items-center justify-center bg-(--blue-color) p-2 py-1 ${qe()?"opacity-50":""}`),lr(Ue,Ce),Gt(Be,1,`flex flex-1 items-center justify-start truncate bg-(--back-color) px-2 ${qe()?"opacity-50":""}`),lr(Te,we)},[()=>G()("constructor.props.file.select"),()=>w(Ve)||G()("constructor.props.file.notselected")]),ye(Re,pt)};xt(Oe,Re=>{q()==="image"?Re(Fe):Re(lt,!1)})}K(Ke),zt(Re=>Gt(Ke,1,Re),[()=>Zr(ir("flex flex-col items-center",S()))]),ye(I,Ke),vi(),me()}Xi(["click","change"]);var lx=Qe("<h5> </h5>"),cx=Qe(`<button style="background: color-mix(in srgb, var(--bg-color), var(--back-color) 70%); 
            "> </button>`),ux=Qe('<div class="absolute top-full left-1/2 z-50 -translate-x-1/2 rounded-b-2xl shadow-[0_0_3px_rgb(0_0_0_/0.25)]" style="width: calc(100% - 1.8rem);"></div>'),hx=Qe('<button style="background: color-mix(in srgb, var(--bg-color), var(--back-color) 70%); " aria-haspopup="true"> </button> <!>',1),dx=Qe('<div class="flex-1"> </div>'),px=Qe('<button><span class="flex flex-row items-center justify-center gap-4"><!></span></button>'),fx=Qe('<div class="flex h-full w-full flex-row justify-center rounded-full"></div>'),mx=Qe(`<button style="background: color-mix(in srgb, var(--bg-color), var(--back-color) 70%); 
            "> </button>`),gx=Qe('<div class="absolute top-full left-1/2 z-50 -translate-x-1/2 rounded-b-2xl border border-t-0 border-(--bg-color) shadow-[0_0_3px_rgb(0_0_0_/0.25)]" style="width: calc(100% - 1.8rem);"></div>'),_x=Qe('<input style="background: color-mix(in srgb, var(--bg-color), var(--back-color) 70%);"/> <!>',1),vx=Qe("<div><!> <!></div>");function Nr(I,_){_i(_,!0);const G=()=>vn(po,"$t",B),[B,me]=Mo();let ae=Vr(!1),S,l=Pt(_,"id",19,()=>crypto.randomUUID()),q=Pt(_,"wrapperClass",3,""),xe=Pt(_,"disabled",3,!1),Ie=Pt(_,"label",19,()=>({name:"",class:""})),qe=Pt(_,"type",3,"select"),Ne=Pt(_,"value",15),Xe=Pt(_,"options",19,()=>[]),He=Vr(""),Ee=Vr(Na([]));const Z=Re=>{S&&!S.contains(Re.target)&&St(ae,!1)};vr(()=>{if(Ne()?.name)St(He,Ne()?.name,!0);else if(Ne()==null){const Re={id:`input-${w(He)}`,name:w(He),value:w(He)};St(He,Re.value,!0)}}),vu(()=>((qe()==="select"||qe()==="input")&&document.addEventListener("click",Z),qe()==="input"&&St(He,Ne()?.name??"",!0),()=>{(qe()==="select"||qe()==="input")&&document.removeEventListener("click",Z)}));const Ve=Re=>{Re.stopPropagation(),xe()||(St(ae,!w(ae)),St(Ee,[],!0))},ut=(Re,pt)=>{pt.stopPropagation(),xe()||(Ne(Re),St(ae,!1),St(He,Re.name?.toString()??"",!0),St(Ee,[],!0),_.onUpdate?.(Ne()))},vt=Re=>{if(St(He,Re,!0),Re.trim()==="")St(ae,!1),St(Ee,[],!0);else{St(Ee,Xe().filter(ft=>(ft.name?.toString()||"").toLowerCase().includes(Re.toLowerCase())),!0),St(ae,w(Ee).length>0);const pt=Xe().find(ft=>ft.name?.toString()===w(He));if(pt)Ne(pt),_.onUpdate?.(pt);else{const ft={id:`input-${w(He)}`,name:w(He),value:w(He)};Ne(ft),_.onUpdate?.(ft)}}};var Ke=vx(),nt=oe(Ke);{var rt=Re=>{var pt=lx(),ft=oe(pt,!0);K(pt),zt(gt=>{Gt(pt,1,gt),lr(ft,Ie().name)},[()=>Zr(ir("w-full px-4",Ie().class))]),ye(Re,pt)};xt(nt,Re=>{Ie().name&&Re(rt)})}var Oe=de(nt,2);{var Fe=Re=>{var pt=hx(),ft=$t(pt);ft.__click=Ve;var gt=oe(ft,!0);K(ft);var bt=de(ft,2);{var Ue=Be=>{var Se=ux();Er(Se,23,Xe,Te=>Te.id,(Te,Ce,we)=>{var be=cx();be.__click=ee=>ut(w(Ce),ee);var ie=oe(be,!0);K(be),zt((ee,Q)=>{tr(be,"id",w(Ce).id),gu(be,ee),Gt(be,1,Q),be.disabled=xe(),lr(ie,w(Ce).name)},[()=>w(Ce)?.value?String(w(Ce).value):"",()=>Zr(ir(`flex h-full w-full cursor-pointer items-center justify-center p-1 inset-shadow-[0_10px_10px_-15px_rgb(0_0_0_/0.5)] duration-250 hover:bg-(--field-color)!
              ${w(we)===Xe().length-1?"rounded-b-2xl":""} `,w(Ce).class))]),ye(Te,be)}),K(Se),Dn(3,Se,()=>_u,()=>({duration:250})),ye(Be,Se)};xt(bt,Be=>{w(ae)&&Be(Ue)})}zt((Be,Se,Te,Ce)=>{tr(ft,"id",Be),gu(ft,Se),Gt(ft,1,Te),tr(ft,"aria-expanded",w(ae)),ft.disabled=xe(),lr(gt,Ce)},[()=>`${l()}-${crypto.randomUUID().slice(0,6)}`,()=>Ne()?.value?String(Ne().value):"",()=>Zr(ir(`w-full rounded-2xl border border-(--bg-color) p-1 text-center shadow-[0_0_3px_rgb(0_0_0_/0.25)] transition duration-200
        ${xe()?"opacity-50":"cursor-pointer hover:shadow-[0_0_6px_rgb(0_0_0_/0.25)]"}`,Ne()?.class)),()=>Ne()?.name||G()("common.select_tag")]),ye(Re,pt)},lt=Re=>{var pt=wr(),ft=$t(pt);{var gt=Ue=>{var Be=fx();Er(Be,23,Xe,Se=>Se.id,(Se,Te,Ce)=>{var we=px();we.__click=Q=>ut(w(Te),Q);var be=oe(we),ie=oe(be);{var ee=Q=>{var ue=dx(),De=oe(ue,!0);K(ue),zt(()=>lr(De,w(Te).name)),ye(Q,ue)};xt(ie,Q=>{w(Te).name&&Q(ee)})}K(be),K(we),zt(Q=>{tr(we,"id",w(Te).id),Gt(we,1,`${Q??""} bg-(--bg-color)`),we.disabled=w(Te).disabled},[()=>ir(`m-0 inline-block min-w-0 flex-1 items-center px-2 py-1 font-semibold shadow-[0_0_3px_rgb(0_0_0_/0.25)] transition duration-300 select-none border border-(--bg-color)
            ${w(Te).disabled||xe()?"opacity-50":"cursor-pointer hover:shadow-[0_0_6px_rgb(0_0_0_/0.25)]"}
            ${w(Te).value===Ne()?.value&&Ne()!==null?"z-10 py-1 shadow-[0_0_10px_var(--shadow-color)] hover:shadow-[0_0_15px_var(--shadow-color)]":""}  
            ${Xe().length>0&&w(Ce)===0?"rounded-l-2xl":""} ${w(Ce)===Xe().length-1?"rounded-r-2xl":""}`,w(Te).class)]),ye(Se,we)}),K(Be),zt(Se=>tr(Be,"id",Se),[()=>`${l()}-${crypto.randomUUID().slice(0,6)}`]),ye(Ue,Be)},bt=Ue=>{var Be=wr(),Se=$t(Be);{var Te=Ce=>{var we=_x(),be=$t(we);Va(be),be.__input=Q=>vt(Q.currentTarget.value),be.__click=Q=>{w(He)==""&&(St(Ee,Xe(),!0),St(ae,!0))};var ie=de(be,2);{var ee=Q=>{var ue=gx();Er(ue,23,()=>w(Ee),De=>De.id,(De,Ge,ot)=>{var it=mx();it.__click=Rt=>ut(w(Ge),Rt);var It=oe(it,!0);K(it),zt((Rt,Ft)=>{tr(it,"id",w(Ge).id),gu(it,Rt),Gt(it,1,Ft),it.disabled=xe(),lr(It,w(Ge).name)},[()=>w(Ge)?.value?String(w(Ge).value):"",()=>Zr(ir(`flex h-full w-full cursor-pointer items-center justify-center p-1 inset-shadow-[0_10px_10px_-15px_rgb(0_0_0_/0.5)] duration-250 hover:bg-(--field-color)!
              ${w(ot)===w(Ee).length-1?"rounded-b-2xl":""} `,w(Ge).class))]),ye(De,it)}),K(ue),Dn(3,ue,()=>_u,()=>({duration:250})),ye(Q,ue)};xt(ie,Q=>{w(ae)&&Q(ee)})}zt(Q=>{Gt(be,1,`w-full appearance-none rounded-2xl border px-4 py-1 text-center shadow-[0_0_3px_rgb(0_0_0_/0.25)]
          transition duration-200 outline-none focus:shadow-[0_0_6px_var(--blue-color)]
          [&::-webkit-inner-spin-button]:hidden [&::-webkit-outer-spin-button]:hidden
          ${xe()?"cursor-not-allowed opacity-50":"cursor-text"} border-(--bg-color) focus:border-(--blue-color) hover:shadow-[0_0_6px_rgb(0_0_0_/0.25)]`),tr(be,"id",Q),be.disabled=xe()},[()=>`${l()}-${crypto.randomUUID().slice(0,6)}`]),ql(be,()=>w(He),Q=>St(He,Q)),ye(Ce,we)};xt(Se,Ce=>{qe()==="input"&&Ce(Te)},!0)}ye(Ue,Be)};xt(ft,Ue=>{qe()==="buttons"?Ue(gt):Ue(bt,!1)},!0)}ye(Re,pt)};xt(Oe,Re=>{qe()==="select"?Re(Fe):Re(lt,!1)})}K(Ke),Zl(Ke,Re=>S=Re,()=>S),zt(Re=>Gt(Ke,1,Re),[()=>Zr(ir("bg-max relative flex w-full flex-col items-center px-1",q()))]),ye(I,Ke),vi(),me()}Xi(["click","input"]);var yx=Qe("<h5> </h5>"),xx=Qe('<input style="background: color-mix(in srgb, var(--bg-color), var(--back-color) 70%);"/>'),bx=Qe('<textarea style="background: color-mix(in srgb, var(--bg-color), var(--back-color) 70%);"></textarea>'),wx=$n('<svg xmlns="http://www.w3.org/2000/svg" width="1.5rem" height="1.5rem" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"><path d="M15 12a3 3 0 1 1-6 0a3 3 0 0 1 6 0"></path><path d="M2 12c1.6-4.097 5.336-7 10-7s8.4 2.903 10 7c-1.6 4.097-5.336 7-10 7s-8.4-2.903-10-7"></path></g></svg>'),Tx=$n('<svg xmlns="http://www.w3.org/2000/svg" width="1.5rem" height="1.5rem" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"><path stroke-linejoin="round" d="M10.73 5.073A11 11 0 0 1 12 5c4.664 0 8.4 2.903 10 7a11.6 11.6 0 0 1-1.555 2.788M6.52 6.519C4.48 7.764 2.9 9.693 2 12c1.6 4.097 5.336 7 10 7a10.44 10.44 0 0 0 5.48-1.52m-7.6-7.6a3 3 0 1 0 4.243 4.243"></path><path d="m4 4l16 16"></path></g></svg>'),Cx=Qe('<button type="button" class="absolute right-2 flex cursor-pointer border-none bg-transparent"><!></button>'),Sx=Qe('<div class="right-1..5 absolute top-1/2 -translate-y-1/2 transform rounded-md bg-(--green-color) px-1.5 py-1 shadow-lg">✓</div>'),Px=$n('<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M6 11c0-2.828 0-4.243.879-5.121C7.757 5 9.172 5 12 5h3c2.828 0 4.243 0 5.121.879C21 6.757 21 8.172 21 11v5c0 2.828 0 4.243-.879 5.121C19.243 22 17.828 22 15 22h-3c-2.828 0-4.243 0-5.121-.879C6 20.243 6 18.828 6 16z"></path><path d="M6 19a3 3 0 0 1-3-3v-6c0-3.771 0-5.657 1.172-6.828S7.229 2 11 2h4a3 3 0 0 1 3 3"></path></g></svg>'),Ix=Qe('<button aria-label="Копировать текст"><div class=" size-5 text-sm [&amp;_svg]:h-full [&amp;_svg]:max-h-full [&amp;_svg]:w-full [&amp;_svg]:max-w-full"><!></div></button>'),Mx=Qe('<div class="absolute right-0 flex h-full w-8 flex-col items-center justify-center rounded-r-2xl border-l border-(--border-color)"><button class="flex h-1/2 w-full items-center rounded-tr-2xl border-b border-(--border-color) pl-2 transition-colors duration-150 hover:bg-(--gray-color)/30 active:bg-(--gray-color)/10" aria-label="Увеличить">+</button> <button class="flex h-1/2 w-full items-center rounded-br-2xl pl-2 transition-colors duration-150 hover:bg-(--gray-color)/30 active:bg-(--gray-color)/10" aria-label="Уменьшить">−</button></div>'),Ex=Qe('<div class="absolute top-5 left-10 z-50 w-auto -translate-y-1/2 rounded bg-(--container-color) px-2 py-1 shadow-lg"> </div>'),Ax=Qe('<button type="button"><svg xmlns="http://www.w3.org/2000/svg" width="1.5rem" height="1.5rem" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10" stroke-width="1.3"></circle><path stroke-width="1.5" d="M12 16v-4.5"></path><path stroke-width="1.8" d="M12 8.012v-.01"></path></g></svg></button> <!>',1),kx=Qe("<div><!> <div><!> <!> <!> <!> <!></div></div>");function _r(I,_){_i(_,!0);let G=Pt(_,"id",19,()=>crypto.randomUUID()),B=Pt(_,"wrapperClass",3,""),me=Pt(_,"label",19,()=>({name:"",class:""})),ae=Pt(_,"disabled",3,!1),S=Pt(_,"readonly",3,!1),l=Pt(_,"value",15),q=Pt(_,"type",3,"text"),xe=Pt(_,"placeholder",3,""),Ie=Pt(_,"componentClass",3,""),qe=Pt(_,"maxlength",3,100),Ne=Pt(_,"textareaRows",3,3),Xe=Pt(_,"isValid",15,!0),He=Pt(_,"number",19,()=>({minNum:-1e6,maxNum:1e6,step:1})),Ee=Pt(_,"help",19,()=>({info:"",autocomplete:"off",copyButton:!1,regExp:"^[\\s\\S]*$"})),Z=Pt(_,"onUpdate",3,()=>{}),Ve=Vr(!1),ut=Vr(!1),vt=Vr(!1);const Ke=Q=>{if(Q instanceof RegExp)return Q;const ue=Q.match(/^\/(.*)\/([gimsuy]*)$/);return ue?new RegExp(ue[1],ue[2]):new RegExp(Q)};let nt=ne(()=>()=>Ke(Ee().regExp??""));vr(()=>{Xe(w(nt)().test(typeof l()=="string"?l():String(l())))});const rt=Q=>{if(q()==="number"){const ue=typeof Q=="string"?parseFloat(Q.replace(",",".")):Number(Q);isNaN(ue)?Z()?.(Q):Z()?.(ue)}else Z()?.(Q)},Oe=Q=>{q()==="number"&&Q.key==="."&&Q.preventDefault()};vr(()=>{q()==="number"&&typeof l()=="number"&&l(Fe(l()))});const Fe=Q=>{if(Number.isInteger(Q))return Q;const ue=Number(Q.toFixed(1));if(Math.abs(ue-Q)<1e-10)return ue;const De=Number(Q.toFixed(2));return Math.abs(De-Q)<1e-10,De};var lt=kx(),Re=oe(lt);{var pt=Q=>{var ue=yx(),De=oe(ue,!0);K(ue),zt(Ge=>{Gt(ue,1,Ge),lr(De,me().name)},[()=>Zr(ir("w-full px-4 text-center",me().class))]),ye(Q,ue)};xt(Re,Q=>{me().name&&Q(pt)})}var ft=de(Re,2),gt=oe(ft);{var bt=Q=>{var ue=xx();Va(ue),ue.__input=De=>rt(De.currentTarget.value),ue.__keydown=Oe,zt((De,Ge)=>{Gt(ue,1,De),tr(ue,"id",Ge),tr(ue,"placeholder",xe()),ue.disabled=ae(),tr(ue,"autocomplete",Ee()?.autocomplete),tr(ue,"type",q()==="password"?w(Ve)?"text":"password":q()==="number"?"number":"text"),tr(ue,"maxlength",qe()),tr(ue,"min",He()?.minNum),tr(ue,"max",He()?.maxNum),tr(ue,"step",He()?.step),ue.readOnly=S()},[()=>Zr(ir(`w-full rounded-2xl border px-4 py-1 text-center shadow-[0_0_3px_rgb(0_0_0_/0.25)] transition duration-200
              outline-none focus:shadow-[0_0_6px_var(--blue-color)] focus:border-(--blue-color) [&::-webkit-inner-spin-button]:hidden [&::-webkit-outer-spin-button]:hidden
              ${Xe()?"border-(--bg-color)":"border-red-400 shadow-[0_0_6px_var(--red-color)] focus:shadow-[0_0_6px_var(--red-color)] focus:border-red-400"}
              ${ae()?"opacity-50":"hover:shadow-[0_0_6px_rgb(0_0_0_/0.25)]"} 
              ${S()?"":"hover:shadow-[0_0_6px_rgb(0_0_0_/0.25)]"}
              ${Ee()?.info?"pl-8":""} 
              ${Ee().copyButton||q()==="password"||q()==="number"&&!S()?"pr-8":""}`,Ie())),()=>`${G()}-${crypto.randomUUID().slice(0,6)}`]),ql(ue,l),ye(Q,ue)},Ue=Q=>{var ue=wr(),De=$t(ue);{var Ge=ot=>{var it=bx();ly(it),it.__input=It=>rt(It.currentTarget.value),zt((It,Rt)=>{Gt(it,1,It),tr(it,"id",Rt),it.disabled=ae(),tr(it,"maxlength",qe()),tr(it,"rows",Ne()),tr(it,"placeholder",xe()),it.readOnly=S()},[()=>Zr(ir(`h-full w-full resize-y rounded-2xl border border-(--border-color) px-2 py-1 text-center shadow-[0_0_3px_rgb(0_0_0_/0.25)] transition
          duration-200 outline-none focus:border-blue-400
            ${Xe()?"border-(--bg-color)":"border-red-400 shadow-[0_0_6px_var(--red-color)] focus:shadow-[0_0_6px_var(--red-color)] focus:border-red-400"}
            ${ae()?"cursor-not-allowed opacity-50":"hover:shadow-[0_0_6px_rgb(0_0_0_/0.25)]"} 
            ${S()?"":"hover:shadow-[0_0_6px_rgb(0_0_0_/0.25)]"}
            ${Ee()?.info?"pl-8":""}
            ${Ee().copyButton?"pr-8":""}`,Ie())),()=>`${G()}-${crypto.randomUUID().slice(0,6)}`]),ql(it,l),ye(ot,it)};xt(De,ot=>{q()==="text-area"&&ot(Ge)},!0)}ye(Q,ue)};xt(gt,Q=>{q()==="text"||q()==="password"||q()==="number"?Q(bt):Q(Ue,!1)})}var Be=de(gt,2);{var Se=Q=>{var ue=Cx();ue.__click=()=>St(Ve,!w(Ve));var De=oe(ue);{var Ge=it=>{var It=wx();ye(it,It)},ot=it=>{var It=Tx();ye(it,It)};xt(De,it=>{w(Ve)?it(Ge):it(ot,!1)})}K(ue),zt(()=>tr(ue,"aria-label",w(Ve)?"Скрыть пароль":"Показать пароль")),ye(Q,ue)};xt(Be,Q=>{q()==="password"&&!ae()&&Q(Se)})}var Te=de(Be,2);{var Ce=Q=>{var ue=Ix();ue.__click=It=>{It.preventDefault(),navigator.clipboard.writeText(l()),St(vt,!0),setTimeout(()=>St(vt,!1),1e3)};var De=oe(ue),Ge=oe(De);{var ot=It=>{var Rt=Sx();Dn(3,Rt,()=>ad,()=>({duration:200})),ye(It,Rt)},it=It=>{var Rt=Px();ye(It,Rt)};xt(Ge,It=>{w(vt)?It(ot):It(it,!1)})}K(De),K(ue),zt(()=>Gt(ue,1,`absolute right-3 flex border-none bg-transparent ${q()==="text-area"?"top-2":""} cursor-pointer`)),ye(Q,ue)};xt(Te,Q=>{Ee().copyButton&&(q()==="text"||q()==="text-area")&&!ae()&&Q(Ce)})}var we=de(Te,2);{var be=Q=>{var ue=Mx(),De=oe(ue);De.__click=()=>{if(!(!He().maxNum||!He().step||!l())){if(Number(l())+He().step>=He().maxNum){l(He().maxNum),Z()(l());return}l(Number(l())+(He().step??1)),Z()(l())}};var Ge=de(De,2);Ge.__click=()=>{if(!(!He().minNum||!He().step||!l())){if(Number(l())-He().step<=He().minNum){l(He().minNum),Z()(l());return}l(Number(l())-(He().step??1)),Z()(l())}},K(ue),ye(Q,ue)};xt(we,Q=>{q()==="number"&&!S()&&!ae()&&Q(be)})}var ie=de(we,2);{var ee=Q=>{var ue=Ax(),De=$t(ue),Ge=de(De,2);{var ot=it=>{var It=Ex(),Rt=oe(It,!0);K(It),zt(()=>lr(Rt,Ee()?.info)),Dn(3,It,()=>sd,()=>({x:-15,duration:250})),ye(it,It)};xt(Ge,it=>{w(ut)&&it(ot)})}zt(()=>{Gt(De,1,`button-info absolute left-2 flex border-none bg-transparent ${q()==="text-area"?"top-2":""} ${ae()?"opacity-50":"cursor-pointer"}`),tr(De,"aria-label",w(ut)?"Скрыть инфо":"Показать инфо")}),Sn("mouseenter",De,()=>St(ut,!0)),Sn("mouseleave",De,()=>St(ut,!1)),ye(Q,ue)};xt(ie,Q=>{Ee().info&&Q(ee)})}K(ft),K(lt),zt(Q=>{Gt(lt,1,Q),Gt(ft,1,`relative flex w-full items-center ${q()==="text-area"?"h-full":""}`)},[()=>Zr(ir(`bg-max ${q()==="text-area"?"h-full":""} relative flex w-full flex-col px-1 items-center`,B()))]),ye(I,lt),vi()}Xi(["input","keydown","click"]);var zx=Qe("<h5> </h5>"),Dx=Qe('<button class="pointer-events-none absolute top-1/2 left-1/2 block w-1/2 -translate-y-1/2 cursor-pointer" title=""><span role="application"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M12.6 12L8.7 8.1q-.275-.275-.275-.7t.275-.7t.7-.275t.7.275l4.6 4.6q.15.15.213.325t.062.375t-.062.375t-.213.325l-4.6 4.6q-.275.275-.7.275t-.7-.275t-.275-.7t.275-.7z"></path></svg></span></button>'),Lx=Qe("<span></span>"),Rx=$n('<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M6 19h3v-5q0-.425.288-.712T10 13h4q.425 0 .713.288T15 14v5h3v-9l-6-4.5L6 10zm-2 0v-9q0-.475.213-.9t.587-.7l6-4.5q.525-.4 1.2-.4t1.2.4l6 4.5q.375.275.588.7T20 10v9q0 .825-.588 1.413T18 21h-4q-.425 0-.712-.288T13 20v-5h-2v5q0 .425-.288.713T10 21H6q-.825 0-1.412-.587T4 19m8-6.75"></path></svg>'),Fx=Qe('<div class="absolute flex h-15 w-65 items-center justify-between rounded-full shadow-[0_0_15px_rgb(0_0_0_/0.25)]" style="background: color-mix(in srgb, var(--bg-color), var(--shadow-color) 10%)"><button class="h-full cursor-pointer rounded-l-full px-3.5" title=""><div class="rotate-270"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5"><path stroke-miterlimit="10" d="M6.395 7.705A7.9 7.9 0 0 1 12 5.382a7.93 7.93 0 0 1 7.929 7.929A7.94 7.94 0 0 1 12 21.25a7.94 7.94 0 0 1-7.929-7.94"></path><path stroke-linejoin="round" d="m7.12 2.75l-.95 3.858a1.33 1.33 0 0 0 .97 1.609l3.869.948"></path></g></svg></div></button> <button class="h-full cursor-pointer rounded-r-full px-3.5" title=""><div class="rotate-90"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5"><path stroke-miterlimit="10" d="M17.605 7.705A7.9 7.9 0 0 0 12 5.382a7.93 7.93 0 0 0-7.929 7.929A7.94 7.94 0 0 0 12 21.25a7.94 7.94 0 0 0 7.929-7.94"></path><path stroke-linejoin="round" d="m16.88 2.75l.95 3.858a1.33 1.33 0 0 1-.97 1.609l-3.869.948"></path></g></svg></div></button></div>'),Ox=Qe('<div class="flex-1"> </div>'),Bx=Qe('<button><span class="flex flex-row items-center justify-center gap-4"><!></span></button>'),Nx=Qe('<div><h5 class=" px-4 text-center"> </h5> <input style="background: color-mix(in srgb, var(--bg-color), var(--back-color) 70%);" readonly=""/></div>'),Vx=Qe('<div><!> <div class="flex w-1/2 items-center justify-center"><div class="relative z-10 flex size-40 min-h-40 min-w-40 items-center justify-center rounded-full bg-(--bg-color) shadow-[0_0_20px_rgb(0_0_0_/0.25)]"><div class="absolute h-full w-full overflow-hidden rounded-full"></div> <div class="pointer-events-none absolute h-full w-full overflow-hidden rounded-full"></div> <div class="z-20 flex size-20 items-center justify-center rounded-full bg-(--bg-color) shadow-[0_0_15px_rgb(0_0_0_/0.25)] transition hover:scale-103"><button class="flex size-18 cursor-pointer items-center justify-center rounded-full p-3.5 [&amp;_svg]:h-full [&amp;_svg]:max-h-full [&amp;_svg]:w-full [&amp;_svg]:max-w-full"><!></button></div></div> <!></div> <div class="mt-3 flex w-80 flex-col gap-1"><div class="flex w-full justify-center rounded-full"></div> <div class="flex justify-around"></div></div></div>');function cw(I,_){_i(_,!0);let G=Pt(_,"id",19,()=>crypto.randomUUID()),B=Pt(_,"wrapperClass",3,""),me=Pt(_,"label",19,()=>({name:"",class:""})),ae=Pt(_,"value",31,()=>Na([0,0,0,0])),S=Pt(_,"axes",19,()=>[{name:"Roll",minNum:-360,maxNum:360},{name:"Pitch",minNum:-360,maxNum:360},{name:"Yaw",minNum:-360,maxNum:360}]),l=Pt(_,"onUpdate",3,()=>{});const q=[{id:"right",angle:30.5,mainButton:!0,onClick:()=>{xe(2,+w(qe)),l()(ae())}},{id:"bottom-right",angle:58,mainButton:!1,onClick:()=>{xe(2,+w(qe)),xe(1,-w(qe)),l()(ae())}},{id:"bottom",angle:122,mainButton:!0,onClick:()=>{xe(1,-w(qe)),l()(ae())}},{id:"bottom-left",angle:149.5,mainButton:!1,onClick:()=>{xe(2,-w(qe)),xe(1,-w(qe)),l()(ae())}},{id:"left",angle:212,mainButton:!0,onClick:()=>{xe(2,-w(qe)),l()(ae())}},{id:"top-left",angle:239,mainButton:!1,onClick:()=>{xe(1,+w(qe)),xe(2,-w(qe)),l()(ae())}},{id:"top",angle:301,mainButton:!0,onClick:()=>{xe(1,+w(qe)),l()(ae())}},{id:"top-right",angle:328,mainButton:!1,onClick:()=>{xe(1,+w(qe)),xe(2,+w(qe)),l()(ae())}}],xe=(Be,Se)=>{const Te=S()[S().length==2?Be-1:Be],Ce=Te.minNum??-360,we=Te.maxNum??360;ae(ae()[Be]=Math.min(we,Math.max(Ce,He(ae()[Be]+Se))),!0)},Ie=[.01,.1,1,10,100];let qe=Vr(1),Ne=Math.cos(Math.PI/q.length)*100,Xe=360/q.length;const He=Be=>{if(Number.isInteger(Be))return Be;const Se=Number(Be.toFixed(1));if(Math.abs(Se-Be)<1e-10)return Se;const Te=Number(Be.toFixed(2));return Math.abs(Te-Be)<1e-10,Te};var Ee=Vx(),Z=oe(Ee);{var Ve=Be=>{var Se=zx(),Te=oe(Se,!0);K(Se),zt(Ce=>{Gt(Se,1,Ce),lr(Te,me().name)},[()=>Zr(ir("w-full px-4 text-center",me().class))]),ye(Be,Se)};xt(Z,Be=>{me().name&&Be(Ve)})}var ut=de(Z,2),vt=oe(ut),Ke=oe(vt);Er(Ke,21,()=>q,Ur,(Be,Se,Te)=>{var Ce=Dx();Ce.__click=function(...ie){w(Se).onClick?.apply(this,ie)};var we=oe(Ce),be=oe(we);K(we),K(Ce),zt(ie=>{Gt(we,1,`relative flex w-full origin-left items-center justify-center pl-[60%] pointer-events-auto
            ${w(Se).mainButton?"bg-(--bg-color)":""}
            `),hi(we,` height: ${ie??""}rem; transform: rotate(${Xe*Te}deg); clip-path: polygon(100% 0, ${Ne}% 0, 0 50%, ${Ne}% 100%, 100% 100%)
              `),tr(be,"width",w(Se).mainButton?32:16),tr(be,"height",w(Se).mainButton?32:16)},[()=>w(Se).mainButton?10*Math.sin(Math.PI*65/360):10*Math.sin(Math.PI*25/360)]),Sn("mouseenter",we,ie=>ie.currentTarget.style.backgroundColor="color-mix(in srgb, var(--bg-color), var(--shadow-color) 20%)"),Sn("mouseleave",we,ie=>ie.currentTarget.style.backgroundColor="var(--bg-color)"),ye(Be,Ce)}),K(Ke);var nt=de(Ke,2);Er(nt,21,()=>q,Ur,(Be,Se,Te)=>{var Ce=Lx();Gt(Ce,1,` absolute top-1/2 left-1/2 h-0 w-[52%] origin-left border-b border-(--bg-color) ${Te%2==0?"shadow-[0_3px_5px_rgb(0_0_0_/0.5)] ":"shadow-[0_-3px_5px_rgb(0_0_0_/0.5)]"}`),zt(()=>hi(Ce,`transform: rotate(${w(Se).angle??""}deg);`)),ye(Be,Ce)}),K(nt);var rt=de(nt,2),Oe=oe(rt);Oe.__click=()=>{ae(ae()[3]=ae()[3]==0?1:0,!0)};var Fe=oe(Oe);{var lt=Be=>{var Se=wr(),Te=$t(Se);{var Ce=be=>{var ie=wr(),ee=$t(ie);Wi(ee,()=>_.buttonIcon),ye(be,ie)},we=be=>{const ie=ne(()=>_.buttonIcon);var ee=wr(),Q=$t(ee);st(Q,()=>w(ie),(ue,De)=>{De(ue,{})}),ye(be,ee)};xt(Te,be=>{typeof _.buttonIcon=="string"?be(Ce):be(we,!1)})}ye(Be,Se)},Re=Be=>{var Se=Rx();ye(Be,Se)};xt(Fe,Be=>{_.buttonIcon?Be(lt):Be(Re,!1)})}K(Oe),K(rt),K(vt);var pt=de(vt,2);{var ft=Be=>{var Se=Fx(),Te=oe(Se);Te.__click=()=>{if(ae()[0]-w(qe)<=(S()[0].minNum??-360)){ae(ae()[0]=S()[0].minNum??-360,!0),l()(ae());return}ae(ae()[0]=He(ae()[0]-w(qe)),!0),l()(ae())};var Ce=de(Te,2);Ce.__click=()=>{if(ae()[0]+w(qe)>=(S()[0].maxNum??360)){ae(ae()[0]=S()[0].maxNum??360,!0),l()(ae());return}ae(ae()[0]=He(ae()[0]+w(qe)),!0),l()(ae())},K(Se),Sn("mouseenter",Te,we=>we.currentTarget.style.backgroundColor="color-mix(in srgb, var(--bg-color), var(--shadow-color) 30%)"),Sn("mouseleave",Te,we=>we.currentTarget.style.backgroundColor="background: color-mix(in srgb, var(--bg-color), var(--shadow-color) 10%)"),Sn("mouseenter",Ce,we=>we.currentTarget.style.backgroundColor="color-mix(in srgb, var(--bg-color), var(--shadow-color) 30%)"),Sn("mouseleave",Ce,we=>we.currentTarget.style.backgroundColor="vabackground: color-mix(in srgb, var(--bg-color), var(--shadow-color) 10%)"),ye(Be,Se)};xt(pt,Be=>{S().length==3&&Be(ft)})}K(ut);var gt=de(ut,2),bt=oe(gt);Er(bt,21,()=>Ie,Ur,(Be,Se,Te)=>{var Ce=Bx();tr(Ce,"id",crypto.randomUUID()),Ce.__click=()=>{St(qe,w(Se),!0)};var we=oe(Ce),be=oe(we);{var ie=ee=>{var Q=Ox(),ue=oe(Q,!0);K(Q),zt(()=>lr(ue,w(Se))),ye(ee,Q)};xt(be,ee=>{w(Se)&&ee(ie)})}K(we),K(Ce),zt(ee=>Gt(Ce,1,ee),[()=>Zr(ir(`m-0 inline-block min-w-0 flex-1 cursor-pointer items-center px-2 py-1 font-semibold shadow-sm transition-all duration-300
            select-none hover:shadow-md
            ${w(Se)===w(qe)&&w(qe)!==null?"z-10 py-1 shadow-[0_0_10px_var(--shadow-color)] hover:shadow-[0_0_15px_var(--shadow-color)]":""}  
            ${Ie.length>0&&Te===0?"rounded-l-2xl":""} ${Te===Ie.length-1?"rounded-r-2xl":""} bg-(--back-color)`))]),ye(Be,Ce)}),K(bt);var Ue=de(bt,2);Er(Ue,21,S,Ur,(Be,Se,Te)=>{var Ce=Nx(),we=oe(Ce),be=oe(we,!0);K(we);var ie=de(we,2);Va(ie),Gt(ie,1,`w-20 rounded-2xl border border-(--border-color) px-4 py-1 text-center transition-all duration-300 outline-none
              hover:shadow-md 
              [&::-webkit-inner-spin-button]:hidden
              [&::-webkit-outer-spin-button]:hidden`),K(Ce),zt(ee=>{lr(be,w(Se).name),gu(ie,ae()[S().length==3?Te:Te+1]),tr(ie,"id",ee)},[()=>`${G()}-${crypto.randomUUID().slice(0,6)}`]),ye(Be,Ce)}),K(Ue),K(gt),K(Ee),zt((Be,Se,Te)=>{tr(Ee,"id",Be),Gt(Ee,1,Se),hi(Oe,`background: ${ae()[3]==1?"color-mix(in srgb, var(--bg-color), var(--shadow-color) 10%)":"var(--bg-color)"}`),tr(bt,"id",Te)},[()=>`${G()}-${crypto.randomUUID().slice(0,6)}`,()=>Zr(ir("bg-blue relative container flex w-full flex-col items-center",B())),()=>`${G()}-${crypto.randomUUID().slice(0,6)}`]),ye(I,Ee),vi()}Xi(["click"]);var jx=Qe('<button class="h-8 w-8 cursor-pointer [&amp;_svg]:h-full [&amp;_svg]:max-h-full [&amp;_svg]:w-full [&amp;_svg]:max-w-full"><!></button>'),Ux=Qe('<div class="relative m-1.5 rounded-xl border-2 border-(--border-color) p-3"><div class="absolute -top-3.5 bg-(--back-color) px-1"> </div> <div class="grid grid-cols-3 place-items-center gap-2"></div></div>'),Gx=Qe('<div class="grid grid-cols-3"></div>'),qx=Qe('<div class="flex items-start gap-2"><h5 class="mt-1"> </h5> <!></div>'),Zx=Qe('<div><div class="relative flex flex-row items-start justify-center"><div class="flex w-1/3 flex-col items-center px-2"><!> <!></div> <div class="flex w-1/3 flex-col px-2"><!> <!> <!></div> <div class="flex w-1/3 flex-col px-2"><div class="mt-6 flex gap-2"><!> <!> <!></div> <!> <!></div></div> <div class="mt-2 flex w-full justify-around gap-2"></div></div>'),Hx=Qe('<button class="h-8 w-8 cursor-pointer [&amp;_svg]:h-full [&amp;_svg]:max-h-full [&amp;_svg]:w-full [&amp;_svg]:max-w-full"><!></button>'),Wx=Qe('<div class="relative m-1.5 rounded-xl border-2 border-(--border-color) p-3"><div class="absolute -top-3.5 bg-(--back-color) px-1"> </div> <div class="grid grid-cols-3 place-items-center gap-2"></div></div>'),Xx=Qe('<div class="grid grid-cols-3"></div>'),Yx=Qe('<div class="flex items-start gap-2"><h5 class="mt-1"> </h5> <!></div>'),Kx=Qe('<div><div class="relative mb-2 flex flex-row items-start justify-center"><div class="flex w-1/3 flex-col items-center px-2"><!> <!></div> <div class="flex w-1/3 flex-col px-2"><!> <!></div> <div class="flex w-1/3 flex-col px-2"><div class="mt-6 flex gap-2"><!> <!> <!></div> <!> <!></div></div> <div class="mt-2 flex w-full justify-around gap-2"></div></div>');function uw(I,_){_i(_,!0);const G=()=>vn(Yl,"$optionsStore",me),B=()=>vn(po,"$t",me),[me,ae]=Mo(),S=Pt(_,"forConstructor",3,!0);let l=Vr(!1);const q=yu("DeviceVariables");let xe=ne(()=>q&&Array.isArray(q)?q:[]);const Ie=ne(()=>G().TEXT_ALIGN_OPTIONS.find(Z=>Z.value.includes(_.component.properties.label?.class?.split(" ").find(Ve=>Ve.startsWith("text-"))))),qe=ne(()=>G().COLOR_OPTIONS.find(Z=>Z.value.includes(_.component.properties.wrapperClass?.split(" ").find(Ve=>Ve.startsWith("bg-")))));var Ne=wr(),Xe=$t(Ne);{var He=Z=>{var Ve=Zx(),ut=oe(Ve),vt=oe(ut),Ke=oe(vt);{let we=ne(()=>({name:B()("constructor.props.variable")})),be=ne(()=>w(xe).find(ie=>ie.value===_.component.properties.id));st(Ke,()=>Nr,(ie,ee)=>{ee(ie,{get label(){return w(we)},get options(){return w(xe)},get value(){return w(be)},onUpdate:Q=>{Tt("id",Q.value,_.component,_.onPropertyChange),_.onPropertyChange({name:Q.name?.split("—")[1].trim(),eventHandler:{Variables:[Q.value]}})}})})}var nt=de(Ke,2);{let we=ne(()=>({name:B()("constructor.props.action")})),be=ne(()=>G().SHORT_ARGUMENT_OPTION.find(ie=>ie.value===_.component.eventHandler.Argument));st(nt,()=>Nr,(ie,ee)=>{ee(ie,{get label(){return w(we)},type:"buttons",get value(){return w(be)},get options(){return G().SHORT_ARGUMENT_OPTION},onUpdate:Q=>{Tt("eventHandler.Argument",Q.value,_.component,_.onPropertyChange),_.onPropertyChange({eventHandler:{Argument:Q.value}})}})})}K(vt);var rt=de(vt,2),Oe=oe(rt);{let we=ne(()=>({name:B()("constructor.props.access")})),be=ne(()=>G().ACCESS_OPTION.find(ie=>ie.value===_.component.access));st(Oe,()=>Nr,(ie,ee)=>{ee(ie,{get label(){return w(we)},type:"buttons",get options(){return G().ACCESS_OPTION},get value(){return w(be)},onUpdate:Q=>_.onPropertyChange({access:Q.value})})})}var Fe=de(Oe,2);{let we=ne(()=>({name:B()("constructor.props.label")}));st(Fe,()=>_r,(be,ie)=>{ie(be,{get label(){return w(we)},get value(){return _.component.properties.label.name},onUpdate:ee=>Tt("label.name",ee,_.component,_.onPropertyChange)})})}var lt=de(Fe,2);{let we=ne(()=>({name:B()("constructor.props.label.class")}));st(lt,()=>_r,(be,ie)=>{ie(be,{get label(){return w(we)},get value(){return _.component.properties.label.class},onUpdate:ee=>Tt("label.class",ee,_.component,_.onPropertyChange)})})}K(rt);var Re=de(rt,2),pt=oe(Re),ft=oe(pt);{let we=ne(()=>({name:B()("constructor.props.buttonIcon")}));st(ft,()=>jr,(be,ie)=>{ie(be,{get content(){return w(we)},onClick:()=>St(l,!0)})})}var gt=de(ft,2);{var bt=we=>{ho(we,{wrapperClass:"w-130",get isOpen(){return w(l)},set isOpen(ie){St(l,ie,!0)},main:ie=>{var ee=Gx();Er(ee,21,()=>uo,Ur,(Q,ue)=>{var De=Ux(),Ge=oe(De),ot=oe(Ge,!0);K(Ge);var it=de(Ge,2);Er(it,21,()=>w(ue)[1],Ur,(It,Rt)=>{var Ft=jx();Ft.__click=()=>{Tt("buttonIcon",w(Rt),_.component,_.onPropertyChange)};var Kt=oe(Ft);Wi(Kt,()=>w(Rt)),K(Ft),ye(It,Ft)}),K(it),K(De),zt(It=>lr(ot,It),[()=>B()(`constructor.props.icon.${w(ue)[0]}`)]),ye(Q,De)}),K(ee),ye(ie,ee)},$$slots:{main:!0}})};xt(gt,we=>{w(l)&&we(bt)})}var Ue=de(gt,2);{var Be=we=>{{let be=ne(()=>({icon:_n}));jr(we,{wrapperClass:"w-8.5 ",componentClass:"p-0.5 bg-red",get content(){return w(be)},onClick:()=>{Tt("buttonIcon","",_.component,_.onPropertyChange)}})}};xt(Ue,we=>{_.component.properties.buttonIcon&&we(Be)})}K(pt);var Se=de(pt,2);{let we=ne(()=>({name:B()("constructor.props.joystick.axes")})),be=ne(()=>_.component.properties.axes.map(ee=>ee.name).join(" ")),ie=ne(()=>({info:B()("constructor.props.joystick.axes.info"),regExp:/^[\p{L}0-9\-_":{}]+ +[\p{L}0-9\-_":{}]+(?: +[\p{L}0-9\-_":{}]+)?$/u}));st(Se,()=>_r,(ee,Q)=>{Q(ee,{get label(){return w(we)},get value(){return w(be)},get help(){return w(ie)},maxlength:100,onUpdate:ue=>{const De=ue;if((De.match(/\s/g)||[]).length>2)return;const ot=De.trim().split(/\s+/);Tt("axes",ot.map((it,It)=>{let Rt=ot.length==2&&_.component.properties.axes.length===3?It+1:It;return{name:it,minNum:_.component.properties.axes[Rt]?_.component.properties.axes[Rt].minNum:-100,maxNum:_.component.properties.axes[Rt]?_.component.properties.axes[Rt].maxNum:100}}),_.component,_.onPropertyChange)}})})}var Te=de(Se,2);{let we=ne(()=>({name:B()("constructor.props.colors")}));st(Te,()=>Nr,(be,ie)=>{ie(be,{wrapperClass:"!h-14",get label(){return w(we)},type:"buttons",get options(){return G().COLOR_OPTIONS},get value(){return w(qe)},onUpdate:ee=>Tt("wrapperClass",ir(_.component.properties.wrapperClass,ee.value),_.component,_.onPropertyChange)})})}K(Re),K(ut);var Ce=de(ut,2);Er(Ce,21,()=>_.component.properties.axes,Ur,(we,be,ie)=>{var ee=qx(),Q=oe(ee),ue=oe(Q,!0);K(Q);var De=de(Q,2);{let Ge=ne(()=>[_.component.properties.axes[ie].minNum,_.component.properties.axes[ie].maxNum]);st(De,()=>Sg,(ot,it)=>{it(ot,{type:"range",number:{minNum:-360,maxNum:360,step:10},get value(){return w(Ge)},onUpdate:It=>{if(Array.isArray(It)){const Rt=_.component.properties.axes;Tt("axes",Rt.map((Ft,Kt)=>Kt===ie?{...Ft,minNum:It[0],maxNum:It[1]}:Ft),_.component,_.onPropertyChange)}}})})}K(ee),zt(()=>lr(ue,w(be).name)),ye(we,ee)}),K(Ce),K(Ve),ye(Z,Ve)},Ee=Z=>{var Ve=Kx(),ut=oe(Ve),vt=oe(ut),Ke=oe(vt);{let Ce=ne(()=>({name:B()("constructor.props.id")}));st(Ke,()=>_r,(we,be)=>{be(we,{get label(){return w(Ce)},get value(){return _.component.properties.id},onUpdate:ie=>Tt("id",ie,_.component,_.onPropertyChange)})})}var nt=de(Ke,2);{let Ce=ne(()=>({name:B()("constructor.props.access")})),we=ne(()=>G().ACCESS_OPTION.find(be=>be.value===_.component.access));st(nt,()=>Nr,(be,ie)=>{ie(be,{get label(){return w(Ce)},type:"buttons",get options(){return G().ACCESS_OPTION},get value(){return w(we)},onUpdate:ee=>_.onPropertyChange({access:ee.value})})})}K(vt);var rt=de(vt,2),Oe=oe(rt);{let Ce=ne(()=>({name:B()("constructor.props.label")}));st(Oe,()=>_r,(we,be)=>{be(we,{get label(){return w(Ce)},get value(){return _.component.properties.label.name},onUpdate:ie=>Tt("label.name",ie,_.component,_.onPropertyChange)})})}var Fe=de(Oe,2);{let Ce=ne(()=>({name:B()("constructor.props.align")}));st(Fe,()=>Nr,(we,be)=>{be(we,{get label(){return w(Ce)},type:"buttons",get value(){return w(Ie)},get options(){return G().TEXT_ALIGN_OPTIONS},onUpdate:ie=>Tt("label.class",ir(_.component.properties.label.class,ie.value),_.component,_.onPropertyChange)})})}K(rt);var lt=de(rt,2),Re=oe(lt),pt=oe(Re);{let Ce=ne(()=>({name:B()("constructor.props.buttonIcon")}));st(pt,()=>jr,(we,be)=>{be(we,{get content(){return w(Ce)},onClick:()=>St(l,!0)})})}var ft=de(pt,2);{var gt=Ce=>{ho(Ce,{wrapperClass:"w-130",get isOpen(){return w(l)},set isOpen(be){St(l,be,!0)},main:be=>{var ie=Xx();Er(ie,21,()=>uo,Ur,(ee,Q)=>{var ue=Wx(),De=oe(ue),Ge=oe(De,!0);K(De);var ot=de(De,2);Er(ot,21,()=>w(Q)[1],Ur,(it,It)=>{var Rt=Hx();Rt.__click=()=>{Tt("buttonIcon",w(It),_.component,_.onPropertyChange)};var Ft=oe(Rt);Wi(Ft,()=>w(It)),K(Rt),ye(it,Rt)}),K(ot),K(ue),zt(it=>lr(Ge,it),[()=>B()(`constructor.props.icon.${w(Q)[0]}`)]),ye(ee,ue)}),K(ie),ye(be,ie)},$$slots:{main:!0}})};xt(ft,Ce=>{w(l)&&Ce(gt)})}var bt=de(ft,2);{var Ue=Ce=>{{let we=ne(()=>({icon:_n}));jr(Ce,{wrapperClass:"w-8.5 ",componentClass:"p-0.5 bg-red",get content(){return w(we)},onClick:()=>{Tt("buttonIcon","",_.component,_.onPropertyChange)}})}};xt(bt,Ce=>{_.component.properties.buttonIcon&&Ce(Ue)})}K(Re);var Be=de(Re,2);{let Ce=ne(()=>({name:B()("constructor.props.joystick.axes")})),we=ne(()=>_.component.properties.axes.map(ie=>ie.name).join(" ")),be=ne(()=>({info:B()("constructor.props.joystick.axes.info"),regExp:/^[\p{L}0-9\-_":{}]+ +[\p{L}0-9\-_":{}]+(?: +[\p{L}0-9\-_":{}]+)?$/u}));st(Be,()=>_r,(ie,ee)=>{ee(ie,{get label(){return w(Ce)},get value(){return w(we)},get help(){return w(be)},maxlength:100,onUpdate:Q=>{const ue=Q;if((ue.match(/\s/g)||[]).length>2)return;const Ge=ue.trim().split(/\s+/);Tt("axes",Ge.map((ot,it)=>{let It=Ge.length==2&&_.component.properties.axes.length===3?it+1:it;return{name:ot,minNum:_.component.properties.axes[It]?_.component.properties.axes[It].minNum:-100,maxNum:_.component.properties.axes[It]?_.component.properties.axes[It].maxNum:100}}),_.component,_.onPropertyChange)}})})}var Se=de(Be,2);{let Ce=ne(()=>({name:B()("constructor.props.colors")}));st(Se,()=>Nr,(we,be)=>{be(we,{wrapperClass:"!h-14",get label(){return w(Ce)},type:"buttons",get options(){return G().COLOR_OPTIONS},get value(){return w(qe)},onUpdate:ie=>Tt("wrapperClass",ir(_.component.properties.wrapperClass,ie.value),_.component,_.onPropertyChange)})})}K(lt),K(ut);var Te=de(ut,2);Er(Te,21,()=>_.component.properties.axes,Ur,(Ce,we,be)=>{var ie=Yx(),ee=oe(ie),Q=oe(ee,!0);K(ee);var ue=de(ee,2);{let De=ne(()=>[_.component.properties.axes[be].minNum,_.component.properties.axes[be].maxNum]);st(ue,()=>Sg,(Ge,ot)=>{ot(Ge,{type:"range",number:{minNum:-360,maxNum:360,step:10},get value(){return w(De)},onUpdate:it=>{if(Array.isArray(it)){const It=_.component.properties.axes;Tt("axes",It.map((Rt,Ft)=>Ft===be?{...Rt,minNum:it[0],maxNum:it[1]}:Rt),_.component,_.onPropertyChange)}}})})}K(ie),zt(()=>lr(Q,w(we).name)),ye(Ce,ie)}),K(Te),K(Ve),ye(Z,Ve)};xt(Xe,Z=>{S()?Z(He):Z(Ee,!1)})}ye(I,Ne),vi(),ae()}Xi(["click"]);function Qx(I){return I&&I.__esModule&&Object.prototype.hasOwnProperty.call(I,"default")?I.default:I}var rd={exports:{}};var Jx=rd.exports,Cg;function $x(){return Cg||(Cg=1,(function(I,_){(function(G,B){I.exports=B()})(Jx,(function(){var G={},B={};function me(S,l,q){if(B[S]=q,S==="index"){var xe="var sharedModule = {}; ("+B.shared+")(sharedModule); ("+B.worker+")(sharedModule);",Ie={};return B.shared(Ie),B.index(G,Ie),typeof window<"u"&&G.setWorkerUrl(window.URL.createObjectURL(new Blob([xe],{type:"text/javascript"}))),G}}me("shared",["exports"],(function(S){function l(i,e,r,o){return new(r||(r=Promise))((function(s,u){function h(y){try{g(o.next(y))}catch(b){u(b)}}function f(y){try{g(o.throw(y))}catch(b){u(b)}}function g(y){var b;y.done?s(y.value):(b=y.value,b instanceof r?b:new r((function(C){C(b)}))).then(h,f)}g((o=o.apply(i,e||[])).next())}))}function q(i,e){this.x=i,this.y=e}function xe(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Ie,qe;typeof SuppressedError=="function"&&SuppressedError,q.prototype={clone(){return new q(this.x,this.y)},add(i){return this.clone()._add(i)},sub(i){return this.clone()._sub(i)},multByPoint(i){return this.clone()._multByPoint(i)},divByPoint(i){return this.clone()._divByPoint(i)},mult(i){return this.clone()._mult(i)},div(i){return this.clone()._div(i)},rotate(i){return this.clone()._rotate(i)},rotateAround(i,e){return this.clone()._rotateAround(i,e)},matMult(i){return this.clone()._matMult(i)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(i){return this.x===i.x&&this.y===i.y},dist(i){return Math.sqrt(this.distSqr(i))},distSqr(i){const e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle(){return Math.atan2(this.y,this.x)},angleTo(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith(i){return this.angleWithSep(i.x,i.y)},angleWithSep(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult(i){const e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add(i){return this.x+=i.x,this.y+=i.y,this},_sub(i){return this.x-=i.x,this.y-=i.y,this},_mult(i){return this.x*=i,this.y*=i,this},_div(i){return this.x/=i,this.y/=i,this},_multByPoint(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint(i){return this.x/=i.x,this.y/=i.y,this},_unit(){return this._div(this.mag()),this},_perp(){const i=this.y;return this.y=this.x,this.x=-i,this},_rotate(i){const e=Math.cos(i),r=Math.sin(i),o=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=o,this},_rotateAround(i,e){const r=Math.cos(i),o=Math.sin(i),s=e.y+o*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-o*(this.y-e.y),this.y=s,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:q},q.convert=function(i){if(i instanceof q)return i;if(Array.isArray(i))return new q(+i[0],+i[1]);if(i.x!==void 0&&i.y!==void 0)return new q(+i.x,+i.y);throw new Error("Expected [x, y] or {x, y} point format")};var Ne=(function(){if(qe)return Ie;function i(e,r,o,s){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(s-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=o,this.p2y=s}return qe=1,Ie=i,i.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,r){if(r===void 0&&(r=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,s=0;s<8;s++){var u=this.sampleCurveX(o)-e;if(Math.abs(u)<r)return o;var h=this.sampleCurveDerivativeX(o);if(Math.abs(h)<1e-6)break;o-=u/h}var f=0,g=1;for(o=e,s=0;s<20&&(u=this.sampleCurveX(o),!(Math.abs(u-e)<r));s++)e>u?f=o:g=o,o=.5*(g-f)+f;return o},solve:function(e,r){return this.sampleCurveY(this.solveCurveX(e,r))}},Ie})(),Xe=xe(Ne);let He,Ee;function Z(){return He==null&&(He=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),He}function Ve(){if(Ee==null&&(Ee=!1,Z())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let o=0;o<25;o++){const s=4*o;e.fillStyle=`rgb(${s},${s+1},${s+2})`,e.fillRect(o%5,Math.floor(o/5),1,1)}const r=e.getImageData(0,0,5,5).data;for(let o=0;o<100;o++)if(o%4!=3&&r[o]!==o){Ee=!0;break}}}return Ee||!1}var ut=1e-6,vt=typeof Float32Array<"u"?Float32Array:Array;function Ke(){var i=new vt(9);return vt!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function nt(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function rt(){var i=new vt(3);return vt!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function Oe(i){var e=i[0],r=i[1],o=i[2];return Math.sqrt(e*e+r*r+o*o)}function Fe(i,e,r){var o=new vt(3);return o[0]=i,o[1]=e,o[2]=r,o}function lt(i,e,r){return i[0]=e[0]+r[0],i[1]=e[1]+r[1],i[2]=e[2]+r[2],i}function Re(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i}function pt(i,e,r){var o=e[0],s=e[1],u=e[2],h=r[0],f=r[1],g=r[2];return i[0]=s*g-u*f,i[1]=u*h-o*g,i[2]=o*f-s*h,i}var ft,gt=Oe;function bt(i,e,r){var o=e[0],s=e[1],u=e[2],h=e[3];return i[0]=r[0]*o+r[4]*s+r[8]*u+r[12]*h,i[1]=r[1]*o+r[5]*s+r[9]*u+r[13]*h,i[2]=r[2]*o+r[6]*s+r[10]*u+r[14]*h,i[3]=r[3]*o+r[7]*s+r[11]*u+r[15]*h,i}function Ue(){var i=new vt(4);return vt!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Be(i,e,r,o){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",u=Math.PI/360;e*=u,o*=u,r*=u;var h=Math.sin(e),f=Math.cos(e),g=Math.sin(r),y=Math.cos(r),b=Math.sin(o),C=Math.cos(o);switch(s){case"xyz":i[0]=h*y*C+f*g*b,i[1]=f*g*C-h*y*b,i[2]=f*y*b+h*g*C,i[3]=f*y*C-h*g*b;break;case"xzy":i[0]=h*y*C-f*g*b,i[1]=f*g*C-h*y*b,i[2]=f*y*b+h*g*C,i[3]=f*y*C+h*g*b;break;case"yxz":i[0]=h*y*C+f*g*b,i[1]=f*g*C-h*y*b,i[2]=f*y*b-h*g*C,i[3]=f*y*C+h*g*b;break;case"yzx":i[0]=h*y*C+f*g*b,i[1]=f*g*C+h*y*b,i[2]=f*y*b-h*g*C,i[3]=f*y*C-h*g*b;break;case"zxy":i[0]=h*y*C-f*g*b,i[1]=f*g*C+h*y*b,i[2]=f*y*b+h*g*C,i[3]=f*y*C-h*g*b;break;case"zyx":i[0]=h*y*C-f*g*b,i[1]=f*g*C+h*y*b,i[2]=f*y*b-h*g*C,i[3]=f*y*C+h*g*b;break;default:throw new Error("Unknown angle order "+s)}return i}function Se(){var i=new vt(2);return vt!=Float32Array&&(i[0]=0,i[1]=0),i}function Te(i,e){var r=new vt(2);return r[0]=i,r[1]=e,r}rt(),ft=new vt(4),vt!=Float32Array&&(ft[0]=0,ft[1]=0,ft[2]=0,ft[3]=0),rt(),Fe(1,0,0),Fe(0,1,0),Ue(),Ue(),Ke(),Se();const Ce=8192;function we(i,e,r){return e*(Ce/(i.tileSize*Math.pow(2,r-i.tileID.overscaledZ)))}function be(i,e){return(i%e+e)%e}function ie(i,e,r){return i*(1-r)+e*r}function ee(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,r=e*i;return 4*(i<.5?r:3*(i-e)+r-.75)}function Q(i,e,r,o){const s=new Xe(i,e,r,o);return u=>s.solve(u)}const ue=Q(.25,.1,.25,1);function De(i,e,r){return Math.min(r,Math.max(e,i))}function Ge(i,e,r){const o=r-e,s=((i-e)%o+o)%o+e;return s===e?r:s}function ot(i,...e){for(const r of e)for(const o in r)i[o]=r[o];return i}let it=1;function It(i,e,r){const o={};for(const s in i)o[s]=e.call(this,i[s],s,i);return o}function Rt(i,e,r){const o={};for(const s in i)e.call(this,i[s],s,i)&&(o[s]=i[s]);return o}function Ft(i){return Array.isArray(i)?i.map(Ft):typeof i=="object"&&i?It(i,Ft):i}const Kt={};function Yt(i){Kt[i]||(typeof console<"u"&&console.warn(i),Kt[i]=!0)}function Tr(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function Qt(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let Mt=null;function Xt(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Sr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Et(i,e,r,o,s){return l(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const u=new VideoFrame(i,{timestamp:0});try{const h=u?.format;if(!h||!h.startsWith("BGR")&&!h.startsWith("RGB"))throw new Error(`Unrecognized format ${h}`);const f=h.startsWith("BGR"),g=new Uint8ClampedArray(o*s*4);if(yield u.copyTo(g,(function(y,b,C,M,E){const z=4*Math.max(-b,0),D=(Math.max(0,C)-C)*M*4+z,F=4*M,j=Math.max(0,b),J=Math.max(0,C);return{rect:{x:j,y:J,width:Math.min(y.width,b+M)-j,height:Math.min(y.height,C+E)-J},layout:[{offset:D,stride:F}]}})(i,e,r,o,s)),f)for(let y=0;y<g.length;y+=4){const b=g[y];g[y]=g[y+2],g[y+2]=b}return g}finally{u.close()}}))}let Ot,ar;function ur(i,e,r,o){return i.addEventListener(e,r,o),{unsubscribe:()=>{i.removeEventListener(e,r,o)}}}function Ar(i){return i*Math.PI/180}function Cr(i){return i/Math.PI*180}const pr={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Rr={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Pr="AbortError";class yr extends Error{constructor(e=Pr){super(e instanceof Error?e.message:e),this.name=Pr,e instanceof Error&&e.stack&&(this.stack=e.stack)}}function ce(i){return i.name===Pr}const R={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function O(i){return R.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const V="global-dispatcher";class se extends Error{constructor(e,r,o,s){super(`AJAXError: ${r} (${e}): ${o}`),this.status=e,this.statusText=r,this.url=o,this.body=s}}const _e=()=>Qt(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Le=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const o=O(i.url);if(o)return o(i,e);if(Qt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:V},e)}if(!(/^file:/.test(r=i.url)||/^file:/.test(_e())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(o,s){return l(this,void 0,void 0,(function*(){const u=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:_e(),signal:s.signal});let h,f;o.type!=="json"||u.headers.has("Accept")||u.headers.set("Accept","application/json");try{h=yield fetch(u)}catch(y){throw ce(y)?y:new se(0,y.message,o.url,new Blob)}if(!h.ok){const y=yield h.blob();throw new se(h.status,h.statusText,o.url,y)}f=o.type==="arrayBuffer"||o.type==="image"?h.arrayBuffer():o.type==="json"?h.json():h.text();const g=yield f;return s.signal.throwIfAborted(),{data:g,cacheControl:h.headers.get("Cache-Control"),expires:h.headers.get("Expires")}}))})(i,e);if(Qt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:V},e)}var r;return(function(o,s){return new Promise(((u,h)=>{var f;const g=new XMLHttpRequest;g.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(g.responseType="arraybuffer");for(const y in o.headers)g.setRequestHeader(y,o.headers[y]);o.type==="json"&&(g.responseType="text",!((f=o.headers)===null||f===void 0)&&f.Accept||g.setRequestHeader("Accept","application/json")),g.withCredentials=o.credentials==="include",g.onerror=()=>{h(new Error(g.statusText))},g.onload=()=>{if(!s.signal.aborted)if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){let y=g.response;if(o.type==="json")try{y=JSON.parse(g.response)}catch(b){return void h(b)}u({data:y,cacheControl:g.getResponseHeader("Cache-Control"),expires:g.getResponseHeader("Expires")})}else{const y=new Blob([g.response],{type:g.getResponseHeader("Content-Type")});h(new se(g.status,g.statusText,o.url,y))}},s.signal.addEventListener("abort",(()=>{g.abort(),h(new yr(s.signal.reason))})),g.send(o.body)}))})(i,e)};function Ae(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),r=window.location;return e.protocol===r.protocol&&e.host===r.host}function Pe(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function ze(i,e,r){if(r&&r[i]){const o=r[i].indexOf(e);o!==-1&&r[i].splice(o,1)}}class dt{constructor(e,r={}){ot(this,r),this.type=e}}class ke extends dt{constructor(e,r={}){super("error",ot({error:e},r))}}class et{on(e,r){return this._listeners=this._listeners||{},Pe(e,r,this._listeners),{unsubscribe:()=>{this.off(e,r)}}}off(e,r){return ze(e,r,this._listeners),ze(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Pe(e,r,this._oneTimeListeners),this):new Promise((o=>this.once(e,o)))}fire(e,r){typeof e=="string"&&(e=new dt(e,r||{}));const o=e.type;if(this.listens(o)){e.target=this;const s=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const f of s)f.call(this,e);const u=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const f of u)ze(o,f,this._oneTimeListeners),f.call(this,e);const h=this._eventedParent;h&&(ot(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),h.fire(e))}else e instanceof ke&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var pe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number",length:2},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"filter"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},filter:{type:"boolean",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"expression_name",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}},interpolation:{type:"array",value:"interpolation_name",minimum:1},interpolation_name:{type:"enum",values:{linear:{syntax:{overloads:[{parameters:[],"output-type":"interpolation"}],parameters:[]}},exponential:{syntax:{overloads:[{parameters:["base"],"output-type":"interpolation"}],parameters:[{name:"base",type:"number literal"}]}},"cubic-bezier":{syntax:{overloads:[{parameters:["x1","y1","x2","y2"],"output-type":"interpolation"}],parameters:[{name:"x1",type:"number literal"},{name:"y1",type:"number literal"},{name:"x2",type:"number literal"},{name:"y2",type:"number literal"}]}}}}};const Lt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function cr(i,e){const r={};for(const o in i)o!=="ref"&&(r[o]=i[o]);return Lt.forEach((o=>{o in e&&(r[o]=e[o])})),r}function Bt(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let r=0;r<i.length;r++)if(!Bt(i[r],e[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const r in i)if(!Bt(i[r],e[r]))return!1;return!0}return i===e}function qt(i,e){i.push(e)}function Ht(i,e,r){qt(r,{command:"addSource",args:[i,e[i]]})}function zr(i,e,r){qt(e,{command:"removeSource",args:[i]}),r[i]=!0}function Ir(i,e,r,o){zr(i,r,o),Ht(i,e,r)}function hr(i,e,r){let o;for(o in i[r])if(Object.prototype.hasOwnProperty.call(i[r],o)&&o!=="data"&&!Bt(i[r][o],e[r][o]))return!1;for(o in e[r])if(Object.prototype.hasOwnProperty.call(e[r],o)&&o!=="data"&&!Bt(i[r][o],e[r][o]))return!1;return!0}function xr(i,e,r,o,s,u){i=i||{},e=e||{};for(const h in i)Object.prototype.hasOwnProperty.call(i,h)&&(Bt(i[h],e[h])||r.push({command:u,args:[o,h,e[h],s]}));for(const h in e)Object.prototype.hasOwnProperty.call(e,h)&&!Object.prototype.hasOwnProperty.call(i,h)&&(Bt(i[h],e[h])||r.push({command:u,args:[o,h,e[h],s]}))}function dr(i){return i.id}function fr(i,e){return i[e.id]=e,i}class Je{constructor(e,r,o,s){this.message=(e?`${e}: `:"")+o,s&&(this.identifier=s),r!=null&&r.__line__&&(this.line=r.__line__)}}function Dr(i,...e){for(const r of e)for(const o in r)i[o]=r[o];return i}class li extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Ji{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[o,s]of r)this.bindings[o]=s}concat(e){return new Ji(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Kr={kind:"null"},wt={kind:"number"},rr={kind:"string"},br={kind:"boolean"},oi={kind:"color"},$i={kind:"projectionDefinition"},zi={kind:"object"},mr={kind:"value"},Ln={kind:"collator"},yn={kind:"formatted"},Eo={kind:"padding"},na={kind:"colorArray"},Ga={kind:"numberArray"},oa={kind:"resolvedImage"},qa={kind:"variableAnchorOffsetCollection"};function an(i,e){return{kind:"array",itemType:i,N:e}}function Jr(i){if(i.kind==="array"){const e=Jr(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const Os=[Kr,wt,rr,br,oi,$i,yn,zi,an(mr),Eo,Ga,na,oa,qa];function aa(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!aa(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of Os)if(!aa(r,e))return null}}return`Expected ${Jr(i)} but found ${Jr(e)} instead.`}function Za(i,e){return e.some((r=>r.kind===i.kind))}function Ao(i,e){return e.some((r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i))}function Rn(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const xu=.96422,ko=.82521,Bs=4/29,wi=6/29,bu=3*wi*wi,wu=wi*wi*wi,Ha=Math.PI/180,Tu=180/Math.PI;function Cu(i){return(i%=360)<0&&(i+=360),i}function Su([i,e,r,o]){let s,u;const h=Kl((.2225045*(i=Ns(i))+.7168786*(e=Ns(e))+.0606169*(r=Ns(r)))/1);i===e&&e===r?s=u=h:(s=Kl((.4360747*i+.3850649*e+.1430804*r)/xu),u=Kl((.0139322*i+.0971045*e+.7141733*r)/ko));const f=116*h-16;return[f<0?0:f,500*(s-h),200*(h-u),o]}function Ns(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Kl(i){return i>wu?Math.pow(i,1/3):i/bu+Bs}function Ql([i,e,r,o]){let s=(i+16)/116,u=isNaN(e)?s:s+e/500,h=isNaN(r)?s:s-r/200;return s=1*$l(s),u=xu*$l(u),h=ko*$l(h),[Jl(3.1338561*u-1.6168667*s-.4906146*h),Jl(-.9787684*u+1.9161415*s+.033454*h),Jl(.0719453*u-.2289914*s+1.4052427*h),o]}function Jl(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function $l(i){return i>wi?i*i*i:bu*(i-Bs)}const ld=Object.hasOwn||function(i,e){return Object.prototype.hasOwnProperty.call(i,e)};function Wa(i,e){return ld(i,e)?i[e]:void 0}function Vs(i){return parseInt(i.padEnd(2,i),16)/255}function Pu(i,e){return sa(e?i/100:i,0,1)}function sa(i,e,r){return Math.min(Math.max(e,i),r)}function ec(i){return!i.some(Number.isNaN)}const Xa={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function fo(i,e,r){return i+r*(e-i)}function la(i,e,r){return i.map(((o,s)=>fo(o,e[s],r)))}class Lr{constructor(e,r,o,s=1,u=!0){this.r=e,this.g=r,this.b=o,this.a=s,u||(this.r*=s,this.g*=s,this.b*=s,s||this.overwriteGetter("rgb",[e,r,o,s]))}static parse(e){if(e instanceof Lr)return e;if(typeof e!="string")return;const r=(function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const s=Wa(Xa,o);if(s){const[h,f,g]=s;return[h/255,f/255,g/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const h=o.length<6?1:2;let f=1;return[Vs(o.slice(f,f+=h)),Vs(o.slice(f,f+=h)),Vs(o.slice(f,f+=h)),Vs(o.slice(f,f+h)||"ff")]}if(o.startsWith("rgb")){const h=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(h){const[f,g,y,b,C,M,E,z,D,F,j,J]=h,U=[b||" ",E||" ",F].join("");if(U==="  "||U==="  /"||U===",,"||U===",,,"){const H=[y,M,D].join(""),re=H==="%%%"?100:H===""?255:0;if(re){const ge=[sa(+g/re,0,1),sa(+C/re,0,1),sa(+z/re,0,1),j?Pu(+j,J):1];if(ec(ge))return ge}}return}}const u=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(u){const[h,f,g,y,b,C,M,E,z]=u,D=[g||" ",b||" ",M].join("");if(D==="  "||D==="  /"||D===",,"||D===",,,"){const F=[+f,sa(+y,0,100),sa(+C,0,100),E?Pu(+E,z):1];if(ec(F))return(function([j,J,U,H]){function re(ge){const je=(ge+j/30)%12,mt=J*Math.min(U,1-U);return U-mt*Math.max(-1,Math.min(je-3,9-je,1))}return j=Cu(j),J/=100,U/=100,[re(0),re(8),re(4),H]})(F)}}})(e);return r?new Lr(...r,!1):void 0}get rgb(){const{r:e,g:r,b:o,a:s}=this,u=s||1/0;return this.overwriteGetter("rgb",[e/u,r/u,o/u,s])}get hcl(){return this.overwriteGetter("hcl",(function(e){const[r,o,s,u]=Su(e),h=Math.sqrt(o*o+s*s);return[Math.round(1e4*h)?Cu(Math.atan2(s,o)*Tu):NaN,h,r,u]})(this.rgb))}get lab(){return this.overwriteGetter("lab",Su(this.rgb))}overwriteGetter(e,r){return Object.defineProperty(this,e,{value:r}),r}toString(){const[e,r,o,s]=this.rgb;return`rgba(${[e,r,o].map((u=>Math.round(255*u))).join(",")},${s})`}static interpolate(e,r,o,s="rgb"){switch(s){case"rgb":{const[u,h,f,g]=la(e.rgb,r.rgb,o);return new Lr(u,h,f,g,!1)}case"hcl":{const[u,h,f,g]=e.hcl,[y,b,C,M]=r.hcl;let E,z;if(isNaN(u)||isNaN(y))isNaN(u)?isNaN(y)?E=NaN:(E=y,f!==1&&f!==0||(z=b)):(E=u,C!==1&&C!==0||(z=h));else{let U=y-u;y>u&&U>180?U-=360:y<u&&u-y>180&&(U+=360),E=u+o*U}const[D,F,j,J]=(function([U,H,re,ge]){return U=isNaN(U)?0:U*Ha,Ql([re,Math.cos(U)*H,Math.sin(U)*H,ge])})([E,z??fo(h,b,o),fo(f,C,o),fo(g,M,o)]);return new Lr(D,F,j,J,!1)}case"lab":{const[u,h,f,g]=Ql(la(e.lab,r.lab,o));return new Lr(u,h,f,g,!1)}}}}Lr.black=new Lr(0,0,0,1),Lr.white=new Lr(1,1,1,1),Lr.transparent=new Lr(0,0,0,0),Lr.red=new Lr(1,0,0,1);class tc{constructor(e,r,o){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const cd=["bottom","center","top"];class rc{constructor(e,r,o,s,u,h){this.text=e,this.image=r,this.scale=o,this.fontStack=s,this.textColor=u,this.verticalAlign=h}}class dn{constructor(e){this.sections=e}static fromString(e){return new dn([new rc(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||e.image&&e.image.name.length!==0))}static factory(e){return e instanceof dn?e:dn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}}class en{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof en)return e;if(typeof e=="number")return new en([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new en(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,r,o){return new en(la(e.values,r.values,o))}}class yi{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof yi)return e;if(typeof e=="number")return new yi([e]);if(Array.isArray(e)){for(const r of e)if(typeof r!="number")return;return new yi(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,r,o){return new yi(la(e.values,r.values,o))}}class gr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof gr)return e;if(typeof e=="string"){const o=Lr.parse(e);return o?new gr([o]):void 0}if(!Array.isArray(e))return;const r=[];for(const o of e){if(typeof o!="string")return;const s=Lr.parse(o);if(!s)return;r.push(s)}return new gr(r)}toString(){return JSON.stringify(this.values)}static interpolate(e,r,o,s="rgb"){const u=[];if(e.values.length!=r.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${r.values.length}), cannot interpolate.`);for(let h=0;h<e.values.length;h++)u.push(Lr.interpolate(e.values[h],r.values[h],o,s));return new gr(u)}}class ei extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const mo=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class sn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof sn)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let r=0;r<e.length;r+=2){const o=e[r],s=e[r+1];if(typeof o!="string"||!mo.has(o)||!Array.isArray(s)||s.length!==2||typeof s[0]!="number"||typeof s[1]!="number")return}return new sn(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,r,o){const s=e.values,u=r.values;if(s.length!==u.length)throw new ei(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${r.toString()}`);const h=[];for(let f=0;f<s.length;f+=2){if(s[f]!==u[f])throw new ei(`Cannot interpolate values containing mismatched anchors. from[${f}]: ${s[f]}, to[${f}]: ${u[f]}`);h.push(s[f]);const[g,y]=s[f+1],[b,C]=u[f+1];h.push([fo(g,b,o),fo(y,C,o)])}return new sn(h)}}class xn{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new xn({name:e,available:!1}):null}}class ln{constructor(e,r,o){this.from=e,this.to=r,this.transition=o}static interpolate(e,r,o){return new ln(e,r,o)}static parse(e){return e instanceof ln?e:Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number"?new ln(e[0],e[1],e[2]):typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number"?new ln(e.from,e.to,e.transition):typeof e=="string"?new ln(e,e,1):void 0}}function ca(i,e,r,o){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[i,e,r,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[i,e,r,o]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function go(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof ln||i instanceof Lr||i instanceof tc||i instanceof dn||i instanceof en||i instanceof yi||i instanceof gr||i instanceof sn||i instanceof xn)return!0;if(Array.isArray(i)){for(const e of i)if(!go(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!go(i[e]))return!1;return!0}return!1}function Ii(i){if(i===null)return Kr;if(typeof i=="string")return rr;if(typeof i=="boolean")return br;if(typeof i=="number")return wt;if(i instanceof Lr)return oi;if(i instanceof ln)return $i;if(i instanceof tc)return Ln;if(i instanceof dn)return yn;if(i instanceof en)return Eo;if(i instanceof yi)return Ga;if(i instanceof gr)return na;if(i instanceof sn)return qa;if(i instanceof xn)return oa;if(Array.isArray(i)){const e=i.length;let r;for(const o of i){const s=Ii(o);if(r){if(r===s)continue;r=mr;break}r=s}return an(r||mr,e)}return zi}function zo(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof Lr||i instanceof ln||i instanceof dn||i instanceof en||i instanceof yi||i instanceof gr||i instanceof sn||i instanceof xn?i.toString():JSON.stringify(i)}class Xn{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!go(e[1]))return r.error("invalid value");const o=e[1];let s=Ii(o);const u=r.expectedType;return s.kind!=="array"||s.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(s=u),new Xn(s,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const js={string:rr,number:wt,boolean:br,object:zi};class pn{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let o,s=1;const u=e[0];if(u==="array"){let f,g;if(e.length>2){const y=e[1];if(typeof y!="string"||!(y in js)||y==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);f=js[y],s++}else f=mr;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);g=e[2],s++}o=an(f,g)}else{if(!js[u])throw new Error(`Types doesn't contain name = ${u}`);o=js[u]}const h=[];for(;s<e.length;s++){const f=r.parse(e[s],s,mr);if(!f)return null;h.push(f)}return new pn(o,h)}evaluate(e){for(let r=0;r<this.args.length;r++){const o=this.args[r].evaluate(e);if(!aa(this.type,Ii(o)))return o;if(r===this.args.length-1)throw new ei(`Expected value to be of type ${Jr(this.type)}, but found ${Jr(Ii(o))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const Do={"to-boolean":br,"to-color":oi,"to-number":wt,"to-string":rr};class eo{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const o=e[0];if(!Do[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&e.length!==2)return r.error("Expected one argument.");const s=Do[o],u=[];for(let h=1;h<e.length;h++){const f=r.parse(e[h],h,mr);if(!f)return null;u.push(f)}return new eo(s,u)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let r,o;for(const s of this.args){if(r=s.evaluate(e),o=null,r instanceof Lr)return r;if(typeof r=="string"){const u=e.parseColor(r);if(u)return u}else if(Array.isArray(r)&&(o=r.length<3||r.length>4?`Invalid rgba value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:ca(r[0],r[1],r[2],r[3]),!o))return new Lr(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new ei(o||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const o of this.args){r=o.evaluate(e);const s=en.parse(r);if(s)return s}throw new ei(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"numberArray":{let r;for(const o of this.args){r=o.evaluate(e);const s=yi.parse(r);if(s)return s}throw new ei(`Could not parse numberArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"colorArray":{let r;for(const o of this.args){r=o.evaluate(e);const s=gr.parse(r);if(s)return s}throw new ei(`Could not parse colorArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const o of this.args){r=o.evaluate(e);const s=sn.parse(r);if(s)return s}throw new ei(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const o of this.args){if(r=o.evaluate(e),r===null)return 0;const s=Number(r);if(!isNaN(s))return s}throw new ei(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return dn.fromString(zo(this.args[0].evaluate(e)));case"resolvedImage":return xn.fromString(zo(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return zo(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const Iu=["Unknown","Point","LineString","Polygon"];class ic{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Iu[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache.get(e);return r||(r=Lr.parse(e),this._parseColorCache.set(e,r)),r}}class Lo{constructor(e,r,o=[],s,u=new Ji,h=[]){this.registry=e,this.path=o,this.key=o.map((f=>`[${f}]`)).join(""),this.scope=u,this.errors=h,this.expectedType=s,this._isConstant=r}parse(e,r,o,s,u={}){return r?this.concat(r,o,s)._parse(e,u):this._parse(e,u)}_parse(e,r){function o(s,u,h){return h==="assert"?new pn(u,[s]):h==="coerce"?new eo(u,[s]):s}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const s=e[0];if(typeof s!="string")return this.error(`Expression name must be a string, but found ${typeof s} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const u=this.registry[s];if(u){let h=u.parse(e,this);if(!h)return null;if(this.expectedType){const f=this.expectedType,g=h.type;if(f.kind!=="string"&&f.kind!=="number"&&f.kind!=="boolean"&&f.kind!=="object"&&f.kind!=="array"||g.kind!=="value"){if(f.kind==="projectionDefinition"&&["string","array"].includes(g.kind)||["color","formatted","resolvedImage"].includes(f.kind)&&["value","string"].includes(g.kind)||["padding","numberArray"].includes(f.kind)&&["value","number","array"].includes(g.kind)||f.kind==="colorArray"&&["value","string","array"].includes(g.kind)||f.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(g.kind))h=o(h,f,r.typeAnnotation||"coerce");else if(this.checkSubtype(f,g))return null}else h=o(h,f,r.typeAnnotation||"assert")}if(!(h instanceof Xn)&&h.type.kind!=="resolvedImage"&&this._isConstant(h)){const f=new ic;try{h=new Xn(h.type,h.evaluate(f))}catch(g){return this.error(g.message),null}}return h}return this.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,o){const s=typeof e=="number"?this.path.concat(e):this.path,u=o?this.scope.concat(o):this.scope;return new Lo(this.registry,this._isConstant,s,r||null,u,this.errors)}error(e,...r){const o=`${this.key}${r.map((s=>`[${s}]`)).join("")}`;this.errors.push(new li(o,e))}checkSubtype(e,r){const o=aa(e,r);return o&&this.error(o),o}}class ti{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let u=1;u<e.length-1;u+=2){const h=e[u];if(typeof h!="string")return r.error(`Expected string, but found ${typeof h} instead.`,u);if(/[^a-zA-Z0-9_]/.test(h))return r.error("Variable names must contain only alphanumeric characters or '_'.",u);const f=r.parse(e[u+1],u+1);if(!f)return null;o.push([h,f])}const s=r.parse(e[e.length-1],e.length-1,r.expectedType,o);return s?new ti(o,s):null}outputDefined(){return this.result.outputDefined()}}class ua{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const o=e[1];return r.scope.has(o)?new ua(o,r.scope.get(o)):r.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Gr{constructor(e,r,o){this.type=e,this.index=r,this.input=o}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,wt),s=r.parse(e[2],2,an(r.expectedType||mr));return o&&s?new Gr(s.type.itemType,o,s):null}evaluate(e){const r=this.index.evaluate(e),o=this.input.evaluate(e);if(r<0)throw new ei(`Array index out of bounds: ${r} < 0.`);if(r>=o.length)throw new ei(`Array index out of bounds: ${r} > ${o.length-1}.`);if(r!==Math.floor(r))throw new ei(`Array index must be an integer, but found ${r} instead.`);return o[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class kr{constructor(e,r){this.type=br,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,mr),s=r.parse(e[2],2,mr);return o&&s?Za(o.type,[br,rr,wt,Kr,mr])?new kr(o,s):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Jr(o.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!o)return!1;if(!Ao(r,["boolean","string","number","null"]))throw new ei(`Expected first argument to be of type boolean, string, number or null, but found ${Jr(Ii(r))} instead.`);if(!Ao(o,["string","array"]))throw new ei(`Expected second argument to be of type array or string, but found ${Jr(Ii(o))} instead.`);return o.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class ha{constructor(e,r,o){this.type=wt,this.needle=e,this.haystack=r,this.fromIndex=o}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,mr),s=r.parse(e[2],2,mr);if(!o||!s)return null;if(!Za(o.type,[br,rr,wt,Kr,mr]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Jr(o.type)} instead`);if(e.length===4){const u=r.parse(e[3],3,wt);return u?new ha(o,s,u):null}return new ha(o,s)}evaluate(e){const r=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!Ao(r,["boolean","string","number","null"]))throw new ei(`Expected first argument to be of type boolean, string, number or null, but found ${Jr(Ii(r))} instead.`);let s;if(this.fromIndex&&(s=this.fromIndex.evaluate(e)),Ao(o,["string"])){const u=o.indexOf(r,s);return u===-1?-1:[...o.slice(0,u)].length}if(Ao(o,["array"]))return o.indexOf(r,s);throw new ei(`Expected second argument to be of type array or string, but found ${Jr(Ii(o))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Hr{constructor(e,r,o,s,u,h){this.inputType=e,this.type=r,this.input=o,this.cases=s,this.outputs=u,this.otherwise=h}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let o,s;r.expectedType&&r.expectedType.kind!=="value"&&(s=r.expectedType);const u={},h=[];for(let y=2;y<e.length-1;y+=2){let b=e[y];const C=e[y+1];Array.isArray(b)||(b=[b]);const M=r.concat(y);if(b.length===0)return M.error("Expected at least one branch label.");for(const z of b){if(typeof z!="number"&&typeof z!="string")return M.error("Branch labels must be numbers or strings.");if(typeof z=="number"&&Math.abs(z)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof z=="number"&&Math.floor(z)!==z)return M.error("Numeric branch labels must be integer values.");if(o){if(M.checkSubtype(o,Ii(z)))return null}else o=Ii(z);if(u[String(z)]!==void 0)return M.error("Branch labels must be unique.");u[String(z)]=h.length}const E=r.parse(C,y,s);if(!E)return null;s=s||E.type,h.push(E)}const f=r.parse(e[1],1,mr);if(!f)return null;const g=r.parse(e[e.length-1],e.length-1,s);return g?f.type.kind!=="value"&&r.concat(1).checkSubtype(o,f.type)?null:new Hr(o,s,f,u,h,g):null}evaluate(e){const r=this.input.evaluate(e);return(Ii(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}}class Ya{constructor(e,r,o){this.type=e,this.branches=r,this.otherwise=o}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let o;r.expectedType&&r.expectedType.kind!=="value"&&(o=r.expectedType);const s=[];for(let h=1;h<e.length-1;h+=2){const f=r.parse(e[h],h,br);if(!f)return null;const g=r.parse(e[h+1],h+1,o);if(!g)return null;s.push([f,g]),o=o||g.type}const u=r.parse(e[e.length-1],e.length-1,o);if(!u)return null;if(!o)throw new Error("Can't infer output type");return new Ya(o,s,u)}evaluate(e){for(const[r,o]of this.branches)if(r.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,o]of this.branches)e(r),e(o);e(this.otherwise)}outputDefined(){return this.branches.every((([e,r])=>r.outputDefined()))&&this.otherwise.outputDefined()}}class In{constructor(e,r,o,s){this.type=e,this.input=r,this.beginIndex=o,this.endIndex=s}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,mr),s=r.parse(e[2],2,wt);if(!o||!s)return null;if(!Za(o.type,[an(mr),rr,mr]))return r.error(`Expected first argument to be of type array or string, but found ${Jr(o.type)} instead`);if(e.length===4){const u=r.parse(e[3],3,wt);return u?new In(o.type,o,s,u):null}return new In(o.type,o,s)}evaluate(e){const r=this.input.evaluate(e),o=this.beginIndex.evaluate(e);let s;if(this.endIndex&&(s=this.endIndex.evaluate(e)),Ao(r,["string"]))return[...r].slice(o,s).join("");if(Ao(r,["array"]))return r.slice(o,s);throw new ei(`Expected first argument to be of type array or string, but found ${Jr(Ii(r))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function da(i,e){const r=i.length-1;let o,s,u=0,h=r,f=0;for(;u<=h;)if(f=Math.floor((u+h)/2),o=i[f],s=i[f+1],o<=e){if(f===r||e<s)return f;u=f+1}else{if(!(o>e))throw new ei("Input is not a number.");h=f-1}return 0}class _o{constructor(e,r,o){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[s,u]of o)this.labels.push(s),this.outputs.push(u)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const o=r.parse(e[1],1,wt);if(!o)return null;const s=[];let u=null;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);for(let h=1;h<e.length;h+=2){const f=h===1?-1/0:e[h],g=e[h+1],y=h,b=h+1;if(typeof f!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',y);if(s.length&&s[s.length-1][0]>=f)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',y);const C=r.parse(g,b,u);if(!C)return null;u=u||C.type,s.push([f,C])}return new _o(u,o,s)}evaluate(e){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(e);const s=this.input.evaluate(e);if(s<=r[0])return o[0].evaluate(e);const u=r.length;return s>=r[u-1]?o[u-1].evaluate(e):o[da(r,s)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function Mu(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Ka,nc,ud=(function(){if(nc)return Ka;function i(e,r,o,s){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(s-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=o,this.p2y=s}return nc=1,Ka=i,i.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,r){if(r===void 0&&(r=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,s=0;s<8;s++){var u=this.sampleCurveX(o)-e;if(Math.abs(u)<r)return o;var h=this.sampleCurveDerivativeX(o);if(Math.abs(h)<1e-6)break;o-=u/h}var f=0,g=1;for(o=e,s=0;s<20&&(u=this.sampleCurveX(o),!(Math.abs(u-e)<r));s++)e>u?f=o:g=o,o=.5*(g-f)+f;return o},solve:function(e,r){return this.sampleCurveY(this.solveCurveX(e,r))}},Ka})(),Eu=Mu(ud);class cn{constructor(e,r,o,s,u){this.type=e,this.operator=r,this.interpolation=o,this.input=s,this.labels=[],this.outputs=[];for(const[h,f]of u)this.labels.push(h),this.outputs.push(f)}static interpolationFactor(e,r,o,s){let u=0;if(e.name==="exponential")u=Yn(r,e.base,o,s);else if(e.name==="linear")u=Yn(r,1,o,s);else if(e.name==="cubic-bezier"){const h=e.controlPoints;u=new Eu(h[0],h[1],h[2],h[3]).solve(Yn(r,1,o,s))}return u}static parse(e,r){let[o,s,u,...h]=e;if(!Array.isArray(s)||s.length===0)return r.error("Expected an interpolation type expression.",1);if(s[0]==="linear")s={name:"linear"};else if(s[0]==="exponential"){const y=s[1];if(typeof y!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);s={name:"exponential",base:y}}else{if(s[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(s[0])}`,1,0);{const y=s.slice(1);if(y.length!==4||y.some((b=>typeof b!="number"||b<0||b>1)))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);s={name:"cubic-bezier",controlPoints:y}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(u=r.parse(u,2,wt),!u)return null;const f=[];let g=null;o!=="interpolate-hcl"&&o!=="interpolate-lab"||r.expectedType==na?r.expectedType&&r.expectedType.kind!=="value"&&(g=r.expectedType):g=oi;for(let y=0;y<h.length;y+=2){const b=h[y],C=h[y+1],M=y+3,E=y+4;if(typeof b!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(f.length&&f[f.length-1][0]>=b)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);const z=r.parse(C,E,g);if(!z)return null;g=g||z.type,f.push([b,z])}return Rn(g,wt)||Rn(g,$i)||Rn(g,oi)||Rn(g,Eo)||Rn(g,Ga)||Rn(g,na)||Rn(g,qa)||Rn(g,an(wt))?new cn(g,o,s,u,f):r.error(`Type ${Jr(g)} is not interpolatable.`)}evaluate(e){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(e);const s=this.input.evaluate(e);if(s<=r[0])return o[0].evaluate(e);const u=r.length;if(s>=r[u-1])return o[u-1].evaluate(e);const h=da(r,s),f=cn.interpolationFactor(this.interpolation,s,r[h],r[h+1]),g=o[h].evaluate(e),y=o[h+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return fo(g,y,f);case"color":return Lr.interpolate(g,y,f);case"padding":return en.interpolate(g,y,f);case"colorArray":return gr.interpolate(g,y,f);case"numberArray":return yi.interpolate(g,y,f);case"variableAnchorOffsetCollection":return sn.interpolate(g,y,f);case"array":return la(g,y,f);case"projectionDefinition":return ln.interpolate(g,y,f)}case"interpolate-hcl":switch(this.type.kind){case"color":return Lr.interpolate(g,y,f,"hcl");case"colorArray":return gr.interpolate(g,y,f,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Lr.interpolate(g,y,f,"lab");case"colorArray":return gr.interpolate(g,y,f,"lab")}}}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function Yn(i,e,r,o){const s=o-r,u=i-r;return s===0?0:e===1?u/s:(Math.pow(e,u)-1)/(Math.pow(e,s)-1)}const di={color:Lr.interpolate,number:fo,padding:en.interpolate,numberArray:yi.interpolate,colorArray:gr.interpolate,variableAnchorOffsetCollection:sn.interpolate,array:la};class Ro{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let o=null;const s=r.expectedType;s&&s.kind!=="value"&&(o=s);const u=[];for(const f of e.slice(1)){const g=r.parse(f,1+u.length,o,void 0,{typeAnnotation:"omit"});if(!g)return null;o=o||g.type,u.push(g)}if(!o)throw new Error("No output type");const h=s&&u.some((f=>aa(s,f.type)));return new Ro(h?mr:o,u)}evaluate(e){let r,o=null,s=0;for(const u of this.args)if(s++,o=u.evaluate(e),o&&o instanceof xn&&!o.available&&(r||(r=o.name),o=null,s===this.args.length&&(o=r)),o!==null)break;return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}function oc(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Qa(i,e,r,o){return o.compare(e,r)===0}function Ti(i,e,r){const o=i!=="=="&&i!=="!=";return class i_{constructor(u,h,f){this.type=br,this.lhs=u,this.rhs=h,this.collator=f,this.hasUntypedArgument=u.type.kind==="value"||h.type.kind==="value"}static parse(u,h){if(u.length!==3&&u.length!==4)return h.error("Expected two or three arguments.");const f=u[0];let g=h.parse(u[1],1,mr);if(!g)return null;if(!oc(f,g.type))return h.concat(1).error(`"${f}" comparisons are not supported for type '${Jr(g.type)}'.`);let y=h.parse(u[2],2,mr);if(!y)return null;if(!oc(f,y.type))return h.concat(2).error(`"${f}" comparisons are not supported for type '${Jr(y.type)}'.`);if(g.type.kind!==y.type.kind&&g.type.kind!=="value"&&y.type.kind!=="value")return h.error(`Cannot compare types '${Jr(g.type)}' and '${Jr(y.type)}'.`);o&&(g.type.kind==="value"&&y.type.kind!=="value"?g=new pn(y.type,[g]):g.type.kind!=="value"&&y.type.kind==="value"&&(y=new pn(g.type,[y])));let b=null;if(u.length===4){if(g.type.kind!=="string"&&y.type.kind!=="string"&&g.type.kind!=="value"&&y.type.kind!=="value")return h.error("Cannot use collator to compare non-string types.");if(b=h.parse(u[3],3,Ln),!b)return null}return new i_(g,y,b)}evaluate(u){const h=this.lhs.evaluate(u),f=this.rhs.evaluate(u);if(o&&this.hasUntypedArgument){const g=Ii(h),y=Ii(f);if(g.kind!==y.kind||g.kind!=="string"&&g.kind!=="number")throw new ei(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${g.kind}, ${y.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const g=Ii(h),y=Ii(f);if(g.kind!=="string"||y.kind!=="string")return e(u,h,f)}return this.collator?r(u,h,f,this.collator.evaluate(u)):e(u,h,f)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}}}const Au=Ti("==",(function(i,e,r){return e===r}),Qa),ac=Ti("!=",(function(i,e,r){return e!==r}),(function(i,e,r,o){return!Qa(0,e,r,o)})),ku=Ti("<",(function(i,e,r){return e<r}),(function(i,e,r,o){return o.compare(e,r)<0})),hd=Ti(">",(function(i,e,r){return e>r}),(function(i,e,r,o){return o.compare(e,r)>0})),pa=Ti("<=",(function(i,e,r){return e<=r}),(function(i,e,r,o){return o.compare(e,r)<=0})),Us=Ti(">=",(function(i,e,r){return e>=r}),(function(i,e,r,o){return o.compare(e,r)>=0}));class fa{constructor(e,r,o){this.type=Ln,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return r.error("Collator options argument must be an object.");const s=r.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,br);if(!s)return null;const u=r.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,br);if(!u)return null;let h=null;return o.locale&&(h=r.parse(o.locale,1,rr),!h)?null:new fa(s,u,h)}evaluate(e){return new tc(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class sc{constructor(e,r,o,s,u){this.type=rr,this.number=e,this.locale=r,this.currency=o,this.minFractionDigits=s,this.maxFractionDigits=u}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const o=r.parse(e[1],1,wt);if(!o)return null;const s=e[2];if(typeof s!="object"||Array.isArray(s))return r.error("NumberFormat options argument must be an object.");let u=null;if(s.locale&&(u=r.parse(s.locale,1,rr),!u))return null;let h=null;if(s.currency&&(h=r.parse(s.currency,1,rr),!h))return null;let f=null;if(s["min-fraction-digits"]&&(f=r.parse(s["min-fraction-digits"],1,wt),!f))return null;let g=null;return s["max-fraction-digits"]&&(g=r.parse(s["max-fraction-digits"],1,wt),!g)?null:new sc(o,u,h,f,g)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Ja{constructor(e){this.type=yn,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return r.error("First argument must be an image or text section.");const s=[];let u=!1;for(let h=1;h<=e.length-1;++h){const f=e[h];if(u&&typeof f=="object"&&!Array.isArray(f)){u=!1;let g=null;if(f["font-scale"]&&(g=r.parse(f["font-scale"],1,wt),!g))return null;let y=null;if(f["text-font"]&&(y=r.parse(f["text-font"],1,an(rr)),!y))return null;let b=null;if(f["text-color"]&&(b=r.parse(f["text-color"],1,oi),!b))return null;let C=null;if(f["vertical-align"]){if(typeof f["vertical-align"]=="string"&&!cd.includes(f["vertical-align"]))return r.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${f["vertical-align"]}' instead.`);if(C=r.parse(f["vertical-align"],1,rr),!C)return null}const M=s[s.length-1];M.scale=g,M.font=y,M.textColor=b,M.verticalAlign=C}else{const g=r.parse(e[h],1,mr);if(!g)return null;const y=g.type.kind;if(y!=="string"&&y!=="value"&&y!=="null"&&y!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,s.push({content:g,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Ja(s)}evaluate(e){return new dn(this.sections.map((r=>{const o=r.content.evaluate(e);return Ii(o)===oa?new rc("",o,null,null,null,r.verticalAlign?r.verticalAlign.evaluate(e):null):new rc(zo(o),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null,r.verticalAlign?r.verticalAlign.evaluate(e):null)})))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor),r.verticalAlign&&e(r.verticalAlign)}outputDefined(){return!1}}class ma{constructor(e){this.type=oa,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const o=r.parse(e[1],1,rr);return o?new ma(o):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),o=xn.fromString(r);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(r)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}}class ga{constructor(e){this.type=wt,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=r.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Jr(o.type)} instead.`):new ga(o):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new ei(`Expected value to be of type string or array, but found ${Jr(Ii(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Ri=8192;function zu(i,e){const r=(180+i[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,s=Math.pow(2,e.z);return[Math.round(r*s*Ri),Math.round(o*s*Ri)]}function _a(i,e){const r=Math.pow(2,e.z);return[(s=(i[0]/Ri+e.x)/r,360*s-180),(o=(i[1]/Ri+e.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,s}function $a(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Fo(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function dd(i,e,r){const o=i[0]-e[0],s=i[1]-e[1],u=i[0]-r[0],h=i[1]-r[1];return o*h-u*s==0&&o*u<=0&&s*h<=0}function Gs(i,e,r,o){return(s=[o[0]-r[0],o[1]-r[1]])[0]*(u=[e[0]-i[0],e[1]-i[1]])[1]-s[1]*u[0]!=0&&!(!lc(i,e,r,o)||!lc(r,o,i,e));var s,u}function pd(i,e,r){for(const o of r)for(let s=0;s<o.length-1;++s)if(Gs(i,e,o[s],o[s+1]))return!0;return!1}function va(i,e,r=!1){let o=!1;for(const f of e)for(let g=0;g<f.length-1;g++){if(dd(i,f[g],f[g+1]))return r;(u=f[g])[1]>(s=i)[1]!=(h=f[g+1])[1]>s[1]&&s[0]<(h[0]-u[0])*(s[1]-u[1])/(h[1]-u[1])+u[0]&&(o=!o)}var s,u,h;return o}function qs(i,e){for(const r of e)if(va(i,r))return!0;return!1}function Du(i,e){for(const r of i)if(!va(r,e))return!1;for(let r=0;r<i.length-1;++r)if(pd(i[r],i[r+1],e))return!1;return!0}function Lu(i,e){for(const r of e)if(Du(i,r))return!0;return!1}function lc(i,e,r,o){const s=o[0]-r[0],u=o[1]-r[1],h=(i[0]-r[0])*u-s*(i[1]-r[1]),f=(e[0]-r[0])*u-s*(e[1]-r[1]);return h>0&&f<0||h<0&&f>0}function cc(i,e,r){const o=[];for(let s=0;s<i.length;s++){const u=[];for(let h=0;h<i[s].length;h++){const f=zu(i[s][h],r);$a(e,f),u.push(f)}o.push(u)}return o}function uc(i,e,r){const o=[];for(let s=0;s<i.length;s++){const u=cc(i[s],e,r);o.push(u)}return o}function Ru(i,e,r,o){if(i[0]<r[0]||i[0]>r[2]){const s=.5*o;let u=i[0]-r[0]>s?-o:r[0]-i[0]>s?o:0;u===0&&(u=i[0]-r[2]>s?-o:r[2]-i[0]>s?o:0),i[0]+=u}$a(e,i)}function Fu(i,e,r,o){const s=Math.pow(2,o.z)*Ri,u=[o.x*Ri,o.y*Ri],h=[];for(const f of i)for(const g of f){const y=[g.x+u[0],g.y+u[1]];Ru(y,e,r,s),h.push(y)}return h}function Ou(i,e,r,o){const s=Math.pow(2,o.z)*Ri,u=[o.x*Ri,o.y*Ri],h=[];for(const g of i){const y=[];for(const b of g){const C=[b.x+u[0],b.y+u[1]];$a(e,C),y.push(C)}h.push(y)}if(e[2]-e[0]<=s/2){(f=e)[0]=f[1]=1/0,f[2]=f[3]=-1/0;for(const g of h)for(const y of g)Ru(y,e,r,s)}var f;return h}class Oo{constructor(e,r){this.type=br,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(go(e[1])){const o=e[1];if(o.type==="FeatureCollection"){const s=[];for(const u of o.features){const{type:h,coordinates:f}=u.geometry;h==="Polygon"&&s.push(f),h==="MultiPolygon"&&s.push(...f)}if(s.length)return new Oo(o,{type:"MultiPolygon",coordinates:s})}else if(o.type==="Feature"){const s=o.geometry.type;if(s==="Polygon"||s==="MultiPolygon")return new Oo(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Oo(o,o)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(r,o){const s=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],h=r.canonicalID();if(o.type==="Polygon"){const f=cc(o.coordinates,u,h),g=Fu(r.geometry(),s,u,h);if(!Fo(s,u))return!1;for(const y of g)if(!va(y,f))return!1}if(o.type==="MultiPolygon"){const f=uc(o.coordinates,u,h),g=Fu(r.geometry(),s,u,h);if(!Fo(s,u))return!1;for(const y of g)if(!qs(y,f))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(r,o){const s=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],h=r.canonicalID();if(o.type==="Polygon"){const f=cc(o.coordinates,u,h),g=Ou(r.geometry(),s,u,h);if(!Fo(s,u))return!1;for(const y of g)if(!Du(y,f))return!1}if(o.type==="MultiPolygon"){const f=uc(o.coordinates,u,h),g=Ou(r.geometry(),s,u,h);if(!Fo(s,u))return!1;for(const y of g)if(!Lu(y,f))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Bu=class{constructor(i=[],e=(r,o)=>r<o?-1:r>o?1:0){if(this.data=i,this.length=this.data.length,this.compare=e,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:e,compare:r}=this,o=e[i];for(;i>0;){const s=i-1>>1,u=e[s];if(r(o,u)>=0)break;e[i]=u,i=s}e[i]=o}_down(i){const{data:e,compare:r}=this,o=this.length>>1,s=e[i];for(;i<o;){let u=1+(i<<1);const h=u+1;if(h<this.length&&r(e[h],e[u])<0&&(u=h),r(e[u],s)>=0)break;e[i]=e[u],i=u}e[i]=s}};function hc(i,e,r=0,o=i.length-1,s=Nu){for(;o>r;){if(o-r>600){const g=o-r+1,y=e-r+1,b=Math.log(g),C=.5*Math.exp(2*b/3),M=.5*Math.sqrt(b*C*(g-C)/g)*(y-g/2<0?-1:1);hc(i,e,Math.max(r,Math.floor(e-y*C/g+M)),Math.min(o,Math.floor(e+(g-y)*C/g+M)),s)}const u=i[e];let h=r,f=o;for(ya(i,r,e),s(i[o],u)>0&&ya(i,r,o);h<f;){for(ya(i,h,f),h++,f--;s(i[h],u)<0;)h++;for(;s(i[f],u)>0;)f--}s(i[r],u)===0?ya(i,r,f):(f++,ya(i,f,o)),f<=e&&(r=f+1),e<=f&&(o=f-1)}}function ya(i,e,r){const o=i[e];i[e]=i[r],i[r]=o}function Nu(i,e){return i<e?-1:i>e?1:0}function Zs(i,e){if(i.length<=1)return[i];const r=[];let o,s;for(const u of i){const h=md(u);h!==0&&(u.area=Math.abs(h),s===void 0&&(s=h<0),s===h<0?(o&&r.push(o),o=[u]):o.push(u))}if(o&&r.push(o),e>1)for(let u=0;u<r.length;u++)r[u].length<=e||(hc(r[u],e,1,r[u].length-1,fd),r[u]=r[u].slice(0,e));return r}function fd(i,e){return e.area-i.area}function md(i){let e=0;for(let r,o,s=0,u=i.length,h=u-1;s<u;h=s++)r=i[s],o=i[h],e+=(o.x-r.x)*(r.y+o.y);return e}const Vu=1/298.257223563,es=Vu*(2-Vu),ju=Math.PI/180;class dc{constructor(e){const r=6378.137*ju*1e3,o=Math.cos(e*ju),s=1/(1-es*(1-o*o)),u=Math.sqrt(s);this.kx=r*u*o,this.ky=r*u*s*(1-es)}distance(e,r){const o=this.wrap(e[0]-r[0])*this.kx,s=(e[1]-r[1])*this.ky;return Math.sqrt(o*o+s*s)}pointOnLine(e,r){let o,s,u,h,f=1/0;for(let g=0;g<e.length-1;g++){let y=e[g][0],b=e[g][1],C=this.wrap(e[g+1][0]-y)*this.kx,M=(e[g+1][1]-b)*this.ky,E=0;C===0&&M===0||(E=(this.wrap(r[0]-y)*this.kx*C+(r[1]-b)*this.ky*M)/(C*C+M*M),E>1?(y=e[g+1][0],b=e[g+1][1]):E>0&&(y+=C/this.kx*E,b+=M/this.ky*E)),C=this.wrap(r[0]-y)*this.kx,M=(r[1]-b)*this.ky;const z=C*C+M*M;z<f&&(f=z,o=y,s=b,u=g,h=E)}return{point:[o,s],index:u,t:Math.max(0,Math.min(1,h))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function Uu(i,e){return e[0]-i[0]}function Hs(i){return i[1]-i[0]+1}function Fn(i,e){return i[1]>=i[0]&&i[1]<e}function Ws(i,e){if(i[0]>i[1])return[null,null];const r=Hs(i);if(e){if(r===2)return[i,null];const s=Math.floor(r/2);return[[i[0],i[0]+s],[i[0]+s,i[1]]]}if(r===1)return[i,null];const o=Math.floor(r/2)-1;return[[i[0],i[0]+o],[i[0]+o+1,i[1]]]}function pc(i,e){if(!Fn(e,i.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let o=e[0];o<=e[1];++o)$a(r,i[o]);return r}function fc(i){const e=[1/0,1/0,-1/0,-1/0];for(const r of i)for(const o of r)$a(e,o);return e}function mc(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function Xs(i,e,r){if(!mc(i)||!mc(e))return NaN;let o=0,s=0;return i[2]<e[0]&&(o=e[0]-i[2]),i[0]>e[2]&&(o=i[0]-e[2]),i[1]>e[3]&&(s=i[1]-e[3]),i[3]<e[1]&&(s=e[1]-i[3]),r.distance([0,0],[o,s])}function Bo(i,e,r){const o=r.pointOnLine(e,i);return r.distance(i,o.point)}function gc(i,e,r,o,s){const u=Math.min(Bo(i,[r,o],s),Bo(e,[r,o],s)),h=Math.min(Bo(r,[i,e],s),Bo(o,[i,e],s));return Math.min(u,h)}function gd(i,e,r,o,s){if(!Fn(e,i.length)||!Fn(o,r.length))return 1/0;let u=1/0;for(let h=e[0];h<e[1];++h){const f=i[h],g=i[h+1];for(let y=o[0];y<o[1];++y){const b=r[y],C=r[y+1];if(Gs(f,g,b,C))return 0;u=Math.min(u,gc(f,g,b,C,s))}}return u}function Gu(i,e,r,o,s){if(!Fn(e,i.length)||!Fn(o,r.length))return NaN;let u=1/0;for(let h=e[0];h<=e[1];++h)for(let f=o[0];f<=o[1];++f)if(u=Math.min(u,s.distance(i[h],r[f])),u===0)return u;return u}function _d(i,e,r){if(va(i,e,!0))return 0;let o=1/0;for(const s of e){const u=s[0],h=s[s.length-1];if(u!==h&&(o=Math.min(o,Bo(i,[h,u],r)),o===0))return o;const f=r.pointOnLine(s,i);if(o=Math.min(o,r.distance(i,f.point)),o===0)return o}return o}function vd(i,e,r,o){if(!Fn(e,i.length))return NaN;for(let u=e[0];u<=e[1];++u)if(va(i[u],r,!0))return 0;let s=1/0;for(let u=e[0];u<e[1];++u){const h=i[u],f=i[u+1];for(const g of r)for(let y=0,b=g.length,C=b-1;y<b;C=y++){const M=g[C],E=g[y];if(Gs(h,f,M,E))return 0;s=Math.min(s,gc(h,f,M,E,o))}}return s}function qu(i,e){for(const r of i)for(const o of r)if(va(o,e,!0))return!0;return!1}function yd(i,e,r,o=1/0){const s=fc(i),u=fc(e);if(o!==1/0&&Xs(s,u,r)>=o)return o;if(Fo(s,u)){if(qu(i,e))return 0}else if(qu(e,i))return 0;let h=1/0;for(const f of i)for(let g=0,y=f.length,b=y-1;g<y;b=g++){const C=f[b],M=f[g];for(const E of e)for(let z=0,D=E.length,F=D-1;z<D;F=z++){const j=E[F],J=E[z];if(Gs(C,M,j,J))return 0;h=Math.min(h,gc(C,M,j,J,r))}}return h}function Xr(i,e,r,o,s,u){if(!u)return;const h=Xs(pc(o,u),s,r);h<e&&i.push([h,u,[0,0]])}function Ys(i,e,r,o,s,u,h){if(!u||!h)return;const f=Xs(pc(o,u),pc(s,h),r);f<e&&i.push([f,u,h])}function Ks(i,e,r,o,s=1/0){let u=Math.min(o.distance(i[0],r[0][0]),s);if(u===0)return u;const h=new Bu([[0,[0,i.length-1],[0,0]]],Uu),f=fc(r);for(;h.length>0;){const g=h.pop();if(g[0]>=u)continue;const y=g[1],b=e?50:100;if(Hs(y)<=b){if(!Fn(y,i.length))return NaN;if(e){const C=vd(i,y,r,o);if(isNaN(C)||C===0)return C;u=Math.min(u,C)}else for(let C=y[0];C<=y[1];++C){const M=_d(i[C],r,o);if(u=Math.min(u,M),u===0)return 0}}else{const C=Ws(y,e);Xr(h,u,o,i,f,C[0]),Xr(h,u,o,i,f,C[1])}}return u}function Qs(i,e,r,o,s,u=1/0){let h=Math.min(u,s.distance(i[0],r[0]));if(h===0)return h;const f=new Bu([[0,[0,i.length-1],[0,r.length-1]]],Uu);for(;f.length>0;){const g=f.pop();if(g[0]>=h)continue;const y=g[1],b=g[2],C=e?50:100,M=o?50:100;if(Hs(y)<=C&&Hs(b)<=M){if(!Fn(y,i.length)&&Fn(b,r.length))return NaN;let E;if(e&&o)E=gd(i,y,r,b,s),h=Math.min(h,E);else if(e&&!o){const z=i.slice(y[0],y[1]+1);for(let D=b[0];D<=b[1];++D)if(E=Bo(r[D],z,s),h=Math.min(h,E),h===0)return h}else if(!e&&o){const z=r.slice(b[0],b[1]+1);for(let D=y[0];D<=y[1];++D)if(E=Bo(i[D],z,s),h=Math.min(h,E),h===0)return h}else E=Gu(i,y,r,b,s),h=Math.min(h,E)}else{const E=Ws(y,e),z=Ws(b,o);Ys(f,h,s,i,r,E[0],z[0]),Ys(f,h,s,i,r,E[0],z[1]),Ys(f,h,s,i,r,E[1],z[0]),Ys(f,h,s,i,r,E[1],z[1])}}return h}function _c(i){return i.type==="MultiPolygon"?i.coordinates.map((e=>({type:"Polygon",coordinates:e}))):i.type==="MultiLineString"?i.coordinates.map((e=>({type:"LineString",coordinates:e}))):i.type==="MultiPoint"?i.coordinates.map((e=>({type:"Point",coordinates:e}))):[i]}class No{constructor(e,r){this.type=wt,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(go(e[1])){const o=e[1];if(o.type==="FeatureCollection")return new No(o,o.features.map((s=>_c(s.geometry))).flat());if(o.type==="Feature")return new No(o,_c(o.geometry));if("type"in o&&"coordinates"in o)return new No(o,_c(o))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(r,o){const s=r.geometry(),u=s.flat().map((g=>_a([g.x,g.y],r.canonical)));if(s.length===0)return NaN;const h=new dc(u[0][1]);let f=1/0;for(const g of o){switch(g.type){case"Point":f=Math.min(f,Qs(u,!1,[g.coordinates],!1,h,f));break;case"LineString":f=Math.min(f,Qs(u,!1,g.coordinates,!0,h,f));break;case"Polygon":f=Math.min(f,Ks(u,!1,g.coordinates,h,f))}if(f===0)return f}return f})(e,this.geometries);if(e.geometryType()==="LineString")return(function(r,o){const s=r.geometry(),u=s.flat().map((g=>_a([g.x,g.y],r.canonical)));if(s.length===0)return NaN;const h=new dc(u[0][1]);let f=1/0;for(const g of o){switch(g.type){case"Point":f=Math.min(f,Qs(u,!0,[g.coordinates],!1,h,f));break;case"LineString":f=Math.min(f,Qs(u,!0,g.coordinates,!0,h,f));break;case"Polygon":f=Math.min(f,Ks(u,!0,g.coordinates,h,f))}if(f===0)return f}return f})(e,this.geometries);if(e.geometryType()==="Polygon")return(function(r,o){const s=r.geometry();if(s.length===0||s[0].length===0)return NaN;const u=Zs(s,0).map((g=>g.map((y=>y.map((b=>_a([b.x,b.y],r.canonical))))))),h=new dc(u[0][0][0][1]);let f=1/0;for(const g of o)for(const y of u){switch(g.type){case"Point":f=Math.min(f,Ks([g.coordinates],!1,y,h,f));break;case"LineString":f=Math.min(f,Ks(g.coordinates,!0,y,h,f));break;case"Polygon":f=Math.min(f,yd(y,g.coordinates,h,f))}if(f===0)return f}return f})(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class ts{constructor(e){this.type=mr,this.key=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=e[1];return o==null?r.error("Global state property must be defined."):typeof o!="string"?r.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new ts(o)}evaluate(e){var r;const o=(r=e.globals)===null||r===void 0?void 0:r.globalState;return o&&Object.keys(o).length!==0?Wa(o,this.key):null}eachChild(){}outputDefined(){return!1}}const xa={"==":Au,"!=":ac,">":hd,"<":ku,">=":Us,"<=":pa,array:pn,at:Gr,boolean:pn,case:Ya,coalesce:Ro,collator:fa,format:Ja,image:ma,in:kr,"index-of":ha,interpolate:cn,"interpolate-hcl":cn,"interpolate-lab":cn,length:ga,let:ti,literal:Xn,match:Hr,number:pn,"number-format":sc,object:pn,slice:In,step:_o,string:pn,"to-boolean":eo,"to-color":eo,"to-number":eo,"to-string":eo,var:ua,within:Oo,distance:No,"global-state":ts};class Mn{constructor(e,r,o,s){this.name=e,this.type=r,this._evaluate=o,this.args=s}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const o=e[0],s=Mn.definitions[o];if(!s)return r.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const u=Array.isArray(s)?s[0]:s.type,h=Array.isArray(s)?[[s[1],s[2]]]:s.overloads,f=h.filter((([y])=>!Array.isArray(y)||y.length===e.length-1));let g=null;for(const[y,b]of f){g=new Lo(r.registry,Js,r.path,null,r.scope);const C=[];let M=!1;for(let E=1;E<e.length;E++){const z=e[E],D=Array.isArray(y)?y[E-1]:y.type,F=g.parse(z,1+C.length,D);if(!F){M=!0;break}C.push(F)}if(!M)if(Array.isArray(y)&&y.length!==C.length)g.error(`Expected ${y.length} arguments, but found ${C.length} instead.`);else{for(let E=0;E<C.length;E++){const z=Array.isArray(y)?y[E]:y.type,D=C[E];g.concat(E+1).checkSubtype(z,D.type)}if(g.errors.length===0)return new Mn(o,u,b,C)}}if(f.length===1)r.errors.push(...g.errors);else{const y=(f.length?f:h).map((([C])=>{return M=C,Array.isArray(M)?`(${M.map(Jr).join(", ")})`:`(${Jr(M.type)}...)`;var M})).join(" | "),b=[];for(let C=1;C<e.length;C++){const M=r.parse(e[C],1+b.length);if(!M)return null;b.push(Jr(M.type))}r.error(`Expected arguments of type ${y}, but found (${b.join(", ")}) instead.`)}return null}static register(e,r){Mn.definitions=r;for(const o in r)e[o]=Mn}}function Zu(i,[e,r,o,s]){e=e.evaluate(i),r=r.evaluate(i),o=o.evaluate(i);const u=s?s.evaluate(i):1,h=ca(e,r,o,u);if(h)throw new ei(h);return new Lr(e/255,r/255,o/255,u,!1)}function Hu(i,e){return i in e}function vc(i,e){const r=e[i];return r===void 0?null:r}function Vo(i){return{type:i}}function Js(i){if(i instanceof ua)return Js(i.boundExpression);if(i instanceof Mn&&i.name==="error"||i instanceof fa||i instanceof Oo||i instanceof No||i instanceof ts)return!1;const e=i instanceof eo||i instanceof pn;let r=!0;return i.eachChild((o=>{r=e?r&&Js(o):r&&o instanceof Xn})),!!r&&$s(i)&&el(i,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function $s(i){if(i instanceof Mn&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Oo||i instanceof No)return!1;let e=!0;return i.eachChild((r=>{e&&!$s(r)&&(e=!1)})),e}function rs(i){if(i instanceof Mn&&i.name==="feature-state")return!1;let e=!0;return i.eachChild((r=>{e&&!rs(r)&&(e=!1)})),e}function el(i,e){if(i instanceof Mn&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild((o=>{r&&!el(o,e)&&(r=!1)})),r}function Wu(i){return{result:"success",value:i}}function ba(i){return{result:"error",value:i}}function wa(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Xu(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function yc(i){return!!i.expression&&i.expression.interpolated}function Fr(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function tl(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)&&Ii(i)===zi}function xd(i){return i}function Yu(i,e){const r=i.stops&&typeof i.stops[0][0]=="object",o=r||!(r||i.property!==void 0),s=i.type||(yc(e)?"exponential":"interval"),u=(function(b){switch(b.type){case"color":return Lr.parse;case"padding":return en.parse;case"numberArray":return yi.parse;case"colorArray":return gr.parse;default:return null}})(e);if(u&&((i=Dr({},i)).stops&&(i.stops=i.stops.map((b=>[b[0],u(b[1])]))),i.default=u(i.default?i.default:e.default)),i.colorSpace&&(h=i.colorSpace)!=="rgb"&&h!=="hcl"&&h!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var h;const f=(function(b){switch(b){case"exponential":return Ku;case"interval":return wd;case"categorical":return bd;case"identity":return Td;default:throw new Error(`Unknown function type "${b}"`)}})(s);let g,y;if(s==="categorical"){g=Object.create(null);for(const b of i.stops)g[b[0]]=b[1];y=typeof i.stops[0][0]}if(r){const b={},C=[];for(let z=0;z<i.stops.length;z++){const D=i.stops[z],F=D[0].zoom;b[F]===void 0&&(b[F]={zoom:F,type:i.type,property:i.property,default:i.default,stops:[]},C.push(F)),b[F].stops.push([D[0].value,D[1]])}const M=[];for(const z of C)M.push([b[z].zoom,Yu(b[z],e)]);const E={name:"linear"};return{kind:"composite",interpolationType:E,interpolationFactor:cn.interpolationFactor.bind(void 0,E),zoomStops:M.map((z=>z[0])),evaluate:({zoom:z},D)=>Ku({stops:M,base:i.base},e,z).evaluate(z,D)}}if(o){const b=s==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:b,interpolationFactor:cn.interpolationFactor.bind(void 0,b),zoomStops:i.stops.map((C=>C[0])),evaluate:({zoom:C})=>f(i,e,C,g,y)}}return{kind:"source",evaluate(b,C){const M=C&&C.properties?C.properties[i.property]:void 0;return M===void 0?is(i.default,e.default):f(i,e,M,g,y)}}}function is(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function bd(i,e,r,o,s){return is(typeof r===s?o[r]:void 0,i.default,e.default)}function wd(i,e,r){if(Fr(r)!=="number")return is(i.default,e.default);const o=i.stops.length;if(o===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[o-1][0])return i.stops[o-1][1];const s=da(i.stops.map((u=>u[0])),r);return i.stops[s][1]}function Ku(i,e,r){const o=i.base!==void 0?i.base:1;if(Fr(r)!=="number")return is(i.default,e.default);const s=i.stops.length;if(s===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[s-1][0])return i.stops[s-1][1];const u=da(i.stops.map((b=>b[0])),r),h=(function(b,C,M,E){const z=E-M,D=b-M;return z===0?0:C===1?D/z:(Math.pow(C,D)-1)/(Math.pow(C,z)-1)})(r,o,i.stops[u][0],i.stops[u+1][0]),f=i.stops[u][1],g=i.stops[u+1][1],y=di[e.type]||xd;return typeof f.evaluate=="function"?{evaluate(...b){const C=f.evaluate.apply(void 0,b),M=g.evaluate.apply(void 0,b);if(C!==void 0&&M!==void 0)return y(C,M,h,i.colorSpace)}}:y(f,g,h,i.colorSpace)}function Td(i,e,r){switch(e.type){case"color":r=Lr.parse(r);break;case"formatted":r=dn.fromString(r.toString());break;case"resolvedImage":r=xn.fromString(r.toString());break;case"padding":r=en.parse(r);break;case"colorArray":r=gr.parse(r);break;case"numberArray":r=yi.parse(r);break;default:Fr(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return is(r,i.default,e.default)}Mn.register(xa,{error:[{kind:"error"},[rr],(i,[e])=>{throw new ei(e.evaluate(i))}],typeof:[rr,[mr],(i,[e])=>Jr(Ii(e.evaluate(i)))],"to-rgba":[an(wt,4),[oi],(i,[e])=>{const[r,o,s,u]=e.evaluate(i).rgb;return[255*r,255*o,255*s,u]}],rgb:[oi,[wt,wt,wt],Zu],rgba:[oi,[wt,wt,wt,wt],Zu],has:{type:br,overloads:[[[rr],(i,[e])=>Hu(e.evaluate(i),i.properties())],[[rr,zi],(i,[e,r])=>Hu(e.evaluate(i),r.evaluate(i))]]},get:{type:mr,overloads:[[[rr],(i,[e])=>vc(e.evaluate(i),i.properties())],[[rr,zi],(i,[e,r])=>vc(e.evaluate(i),r.evaluate(i))]]},"feature-state":[mr,[rr],(i,[e])=>vc(e.evaluate(i),i.featureState||{})],properties:[zi,[],i=>i.properties()],"geometry-type":[rr,[],i=>i.geometryType()],id:[mr,[],i=>i.id()],zoom:[wt,[],i=>i.globals.zoom],"heatmap-density":[wt,[],i=>i.globals.heatmapDensity||0],elevation:[wt,[],i=>i.globals.elevation||0],"line-progress":[wt,[],i=>i.globals.lineProgress||0],accumulated:[mr,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[wt,Vo(wt),(i,e)=>{let r=0;for(const o of e)r+=o.evaluate(i);return r}],"*":[wt,Vo(wt),(i,e)=>{let r=1;for(const o of e)r*=o.evaluate(i);return r}],"-":{type:wt,overloads:[[[wt,wt],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[wt],(i,[e])=>-e.evaluate(i)]]},"/":[wt,[wt,wt],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[wt,[wt,wt],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[wt,[],()=>Math.LN2],pi:[wt,[],()=>Math.PI],e:[wt,[],()=>Math.E],"^":[wt,[wt,wt],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[wt,[wt],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[wt,[wt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[wt,[wt],(i,[e])=>Math.log(e.evaluate(i))],log2:[wt,[wt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[wt,[wt],(i,[e])=>Math.sin(e.evaluate(i))],cos:[wt,[wt],(i,[e])=>Math.cos(e.evaluate(i))],tan:[wt,[wt],(i,[e])=>Math.tan(e.evaluate(i))],asin:[wt,[wt],(i,[e])=>Math.asin(e.evaluate(i))],acos:[wt,[wt],(i,[e])=>Math.acos(e.evaluate(i))],atan:[wt,[wt],(i,[e])=>Math.atan(e.evaluate(i))],min:[wt,Vo(wt),(i,e)=>Math.min(...e.map((r=>r.evaluate(i))))],max:[wt,Vo(wt),(i,e)=>Math.max(...e.map((r=>r.evaluate(i))))],abs:[wt,[wt],(i,[e])=>Math.abs(e.evaluate(i))],round:[wt,[wt],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[wt,[wt],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[wt,[wt],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[br,[rr,mr],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[br,[mr],(i,[e])=>i.id()===e.value],"filter-type-==":[br,[rr],(i,[e])=>i.geometryType()===e.value],"filter-<":[br,[rr,mr],(i,[e,r])=>{const o=i.properties()[e.value],s=r.value;return typeof o==typeof s&&o<s}],"filter-id-<":[br,[mr],(i,[e])=>{const r=i.id(),o=e.value;return typeof r==typeof o&&r<o}],"filter->":[br,[rr,mr],(i,[e,r])=>{const o=i.properties()[e.value],s=r.value;return typeof o==typeof s&&o>s}],"filter-id->":[br,[mr],(i,[e])=>{const r=i.id(),o=e.value;return typeof r==typeof o&&r>o}],"filter-<=":[br,[rr,mr],(i,[e,r])=>{const o=i.properties()[e.value],s=r.value;return typeof o==typeof s&&o<=s}],"filter-id-<=":[br,[mr],(i,[e])=>{const r=i.id(),o=e.value;return typeof r==typeof o&&r<=o}],"filter->=":[br,[rr,mr],(i,[e,r])=>{const o=i.properties()[e.value],s=r.value;return typeof o==typeof s&&o>=s}],"filter-id->=":[br,[mr],(i,[e])=>{const r=i.id(),o=e.value;return typeof r==typeof o&&r>=o}],"filter-has":[br,[mr],(i,[e])=>e.value in i.properties()],"filter-has-id":[br,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[br,[an(rr)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[br,[an(mr)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[br,[rr,an(mr)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[br,[rr,an(mr)],(i,[e,r])=>(function(o,s,u,h){for(;u<=h;){const f=u+h>>1;if(s[f]===o)return!0;s[f]>o?h=f-1:u=f+1}return!1})(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:br,overloads:[[[br,br],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[Vo(br),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:br,overloads:[[[br,br],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[Vo(br),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[br,[br],(i,[e])=>!e.evaluate(i)],"is-supported-script":[br,[rr],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[rr,[rr],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[rr,[rr],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[rr,Vo(mr),(i,e)=>e.map((r=>zo(r.evaluate(i)))).join("")],"resolved-locale":[rr,[Ln],(i,[e])=>e.evaluate(i).resolvedLocale()]});class xc{constructor(e,r,o){this.expression=e,this._warningHistory={},this._evaluator=new ic,this._defaultValue=r?(function(s){if(s.type==="color"&&tl(s.default))return new Lr(0,0,0,0);switch(s.type){case"color":return Lr.parse(s.default)||null;case"padding":return en.parse(s.default)||null;case"numberArray":return yi.parse(s.default)||null;case"colorArray":return gr.parse(s.default)||null;case"variableAnchorOffsetCollection":return sn.parse(s.default)||null;case"projectionDefinition":return ln.parse(s.default)||null;default:return s.default===void 0?null:s.default}})(r):null,this._enumValues=r&&r.type==="enum"?r.values:null,this._globalState=o}evaluateWithoutErrorHandling(e,r,o,s,u,h){return this._globalState&&(e=jo(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=o,this._evaluator.canonical=s,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=h,this.expression.evaluate(this._evaluator)}evaluate(e,r,o,s,u,h){this._globalState&&(e=jo(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=o||null,this._evaluator.canonical=s,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=h||null;try{const f=this.expression.evaluate(this._evaluator);if(f==null||typeof f=="number"&&f!=f)return this._defaultValue;if(this._enumValues&&!(f in this._enumValues))throw new ei(`Expected value to be one of ${Object.keys(this._enumValues).map((g=>JSON.stringify(g))).join(", ")}, but found ${JSON.stringify(f)} instead.`);return f}catch(f){return this._warningHistory[f.message]||(this._warningHistory[f.message]=!0,typeof console<"u"&&console.warn(f.message)),this._defaultValue}}}function Ta(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in xa}function ns(i,e,r){const o=new Lo(xa,Js,[],e?(function(u){const h={color:oi,string:rr,number:wt,enum:rr,boolean:br,formatted:yn,padding:Eo,numberArray:Ga,colorArray:na,projectionDefinition:$i,resolvedImage:oa,variableAnchorOffsetCollection:qa};return u.type==="array"?an(h[u.value]||mr,u.length):h[u.type]})(e):void 0),s=o.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?Wu(new xc(s,e,r)):ba(o.errors)}class rl{constructor(e,r,o){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!rs(r.expression),this.globalStateRefs=vo(r.expression),this._globalState=o}evaluateWithoutErrorHandling(e,r,o,s,u,h){return this._globalState&&(e=jo(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,r,o,s,u,h)}evaluate(e,r,o,s,u,h){return this._globalState&&(e=jo(e,this._globalState)),this._styleExpression.evaluate(e,r,o,s,u,h)}}class bc{constructor(e,r,o,s,u){this.kind=e,this.zoomStops=o,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!rs(r.expression),this.globalStateRefs=vo(r.expression),this.interpolationType=s,this._globalState=u}evaluateWithoutErrorHandling(e,r,o,s,u,h){return this._globalState&&(e=jo(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,r,o,s,u,h)}evaluate(e,r,o,s,u,h){return this._globalState&&(e=jo(e,this._globalState)),this._styleExpression.evaluate(e,r,o,s,u,h)}interpolationFactor(e,r,o){return this.interpolationType?cn.interpolationFactor(this.interpolationType,e,r,o):0}}function wc(i,e,r){const o=ns(i,e,r);if(o.result==="error")return o;const s=o.value.expression,u=$s(s);if(!u&&!wa(e))return ba([new li("","data expressions not supported")]);const h=el(s,["zoom"]);if(!h&&!Xu(e))return ba([new li("","zoom expressions not supported")]);const f=nl(s);return f||h?f instanceof li?ba([f]):f instanceof cn&&!yc(e)?ba([new li("",'"interpolate" expressions cannot be used with this property')]):Wu(f?new bc(u?"camera":"composite",o.value,f.labels,f instanceof cn?f.interpolation:void 0,r):new rl(u?"constant":"source",o.value,r)):ba([new li("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class il{constructor(e,r){this._parameters=e,this._specification=r,Dr(this,Yu(this._parameters,this._specification))}static deserialize(e){return new il(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function nl(i){let e=null;if(i instanceof ti)e=nl(i.result);else if(i instanceof Ro){for(const r of i.args)if(e=nl(r),e)break}else(i instanceof _o||i instanceof cn)&&i.input instanceof Mn&&i.input.name==="zoom"&&(e=i);return e instanceof li||i.eachChild((r=>{const o=nl(r);o instanceof li?e=o:!e&&o?e=new li("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new li("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}function vo(i,e=new Set){return i instanceof ts&&e.add(i.key),i.eachChild((r=>{vo(r,e)})),e}function jo(i,e){const{zoom:r,heatmapDensity:o,elevation:s,lineProgress:u,isSupportedScript:h,accumulated:f}=i??{};return{zoom:r,heatmapDensity:o,elevation:s,lineProgress:u,isSupportedScript:h,accumulated:f,globalState:e}}function Tc(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!Tc(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const Cd={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function os(i,e){if(i==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Tc(i)||(i=as(i));const r=ns(i,Cd,e);if(r.result==="error")throw new Error(r.value.map((o=>`${o.key}: ${o.message}`)).join(", "));return{filter:(o,s,u)=>r.value.evaluate(o,s,{},u),needGeometry:Qu(i),getGlobalStateRefs:()=>vo(r.value.expression)}}function Sd(i,e){return i<e?-1:i>e?1:0}function Qu(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let e=1;e<i.length;e++)if(Qu(i[e]))return!0;return!1}function as(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?ol(i[1],i[2],"=="):e==="!="?ss(ol(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?ol(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(as))):e==="all"?["all"].concat(i.slice(1).map(as)):e==="none"?["all"].concat(i.slice(1).map(as).map(ss)):e==="in"?Ju(i[1],i.slice(2)):e==="!in"?ss(Ju(i[1],i.slice(2))):e==="has"?$u(i[1]):e!=="!has"||ss($u(i[1]));var r}function ol(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function Ju(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((r=>typeof r!=typeof e[0]))?["filter-in-large",i,["literal",e.sort(Sd)]]:["filter-in-small",i,["literal",e]]}}function $u(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function ss(i){return["!",i]}function al(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let s="[";for(const u of i)s+=`${al(u)},`;return`${s}]`}const r=Object.keys(i).sort();let o="{";for(let s=0;s<r.length;s++)o+=`${JSON.stringify(r[s])}:${al(i[r[s]])},`;return`${o}}`}function eh(i){let e="";for(const r of Lt)e+=`/${al(i[r])}`;return e}function th(i){const e=i.value;return e?[new Je(i.key,e,"constants have been deprecated as of v8")]:[]}function Mi(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Uo(i){if(Array.isArray(i))return i.map(Uo);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=Uo(i[r]);return e}return Mi(i)}function bn(i){const e=i.key,r=i.value,o=i.valueSpec||{},s=i.objectElementValidators||{},u=i.style,h=i.styleSpec,f=i.validateSpec;let g=[];const y=Fr(r);if(y!=="object")return[new Je(e,r,`object expected, ${y} found`)];for(const b in r){const C=b.split(".")[0],M=Wa(o,C)||o["*"];let E;if(Wa(s,C))E=s[C];else if(Wa(o,C)){if(r[b]===void 0)continue;E=f}else if(s["*"])E=s["*"];else{if(!o["*"]){g.push(new Je(e,r[b],`unknown property "${b}"`));continue}E=f}g=g.concat(E({key:(e&&`${e}.`)+b,value:r[b],valueSpec:M,style:u,styleSpec:h,object:r,objectKey:b,validateSpec:f},r))}for(const b in o)s[b]||o[b].required&&o[b].default===void 0&&r[b]===void 0&&g.push(new Je(e,r,`missing required property "${b}"`));return g}function sl(i){const e=i.value,r=i.valueSpec,o=i.style,s=i.styleSpec,u=i.key,h=i.arrayElementValidator||i.validateSpec;if(Fr(e)!=="array")return[new Je(u,e,`array expected, ${Fr(e)} found`)];if(r.length&&e.length!==r.length)return[new Je(u,e,`array length ${r.length} expected, length ${e.length} found`)];let f={type:r.value,values:r.values};s.$version<7&&(f.function=r.function),Fr(r.value)==="object"&&(f=r.value);let g=[];for(let y=0;y<e.length;y++)g=g.concat(h({array:e,arrayIndex:y,value:e[y],valueSpec:f,validateSpec:i.validateSpec,style:o,styleSpec:s,key:`${u}[${y}]`}));return g}function ls(i){const e=i.key,r=i.value,o=i.valueSpec;let s=Fr(r);return s==="number"&&r!=r&&(s="NaN"),s!=="number"?[new Je(e,r,`number expected, ${s} found`)]:"minimum"in o&&r<o.minimum?[new Je(e,r,`${r} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&r>o.maximum?[new Je(e,r,`${r} is greater than the maximum value ${o.maximum}`)]:[]}function ll(i){const e=i.valueSpec,r=Mi(i.value.type);let o,s,u,h={};const f=r!=="categorical"&&i.value.property===void 0,g=!f,y=Fr(i.value.stops)==="array"&&Fr(i.value.stops[0])==="array"&&Fr(i.value.stops[0][0])==="object",b=bn({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(E){if(r==="identity")return[new Je(E.key,E.value,'identity function may not have a "stops" property')];let z=[];const D=E.value;return z=z.concat(sl({key:E.key,value:D,valueSpec:E.valueSpec,validateSpec:E.validateSpec,style:E.style,styleSpec:E.styleSpec,arrayElementValidator:C})),Fr(D)==="array"&&D.length===0&&z.push(new Je(E.key,D,"array must have at least one stop")),z},default:function(E){return E.validateSpec({key:E.key,value:E.value,valueSpec:e,validateSpec:E.validateSpec,style:E.style,styleSpec:E.styleSpec})}}});return r==="identity"&&f&&b.push(new Je(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||b.push(new Je(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!yc(i.valueSpec)&&b.push(new Je(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(g&&!wa(i.valueSpec)?b.push(new Je(i.key,i.value,"property functions not supported")):f&&!Xu(i.valueSpec)&&b.push(new Je(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!y||i.value.property!==void 0||b.push(new Je(i.key,i.value,'"property" property is required')),b;function C(E){let z=[];const D=E.value,F=E.key;if(Fr(D)!=="array")return[new Je(F,D,`array expected, ${Fr(D)} found`)];if(D.length!==2)return[new Je(F,D,`array length 2 expected, length ${D.length} found`)];if(y){if(Fr(D[0])!=="object")return[new Je(F,D,`object expected, ${Fr(D[0])} found`)];if(D[0].zoom===void 0)return[new Je(F,D,"object stop key must have zoom")];if(D[0].value===void 0)return[new Je(F,D,"object stop key must have value")];if(u&&u>Mi(D[0].zoom))return[new Je(F,D[0].zoom,"stop zoom values must appear in ascending order")];Mi(D[0].zoom)!==u&&(u=Mi(D[0].zoom),s=void 0,h={}),z=z.concat(bn({key:`${F}[0]`,value:D[0],valueSpec:{zoom:{}},validateSpec:E.validateSpec,style:E.style,styleSpec:E.styleSpec,objectElementValidators:{zoom:ls,value:M}}))}else z=z.concat(M({key:`${F}[0]`,value:D[0],validateSpec:E.validateSpec,style:E.style,styleSpec:E.styleSpec},D));return Ta(Uo(D[1]))?z.concat([new Je(`${F}[1]`,D[1],"expressions are not allowed in function stops.")]):z.concat(E.validateSpec({key:`${F}[1]`,value:D[1],valueSpec:e,validateSpec:E.validateSpec,style:E.style,styleSpec:E.styleSpec}))}function M(E,z){const D=Fr(E.value),F=Mi(E.value),j=E.value!==null?E.value:z;if(o){if(D!==o)return[new Je(E.key,j,`${D} stop domain type must match previous stop domain type ${o}`)]}else o=D;if(D!=="number"&&D!=="string"&&D!=="boolean")return[new Je(E.key,j,"stop domain value must be a number, string, or boolean")];if(D!=="number"&&r!=="categorical"){let J=`number expected, ${D} found`;return wa(e)&&r===void 0&&(J+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Je(E.key,j,J)]}return r!=="categorical"||D!=="number"||isFinite(F)&&Math.floor(F)===F?r!=="categorical"&&D==="number"&&s!==void 0&&F<s?[new Je(E.key,j,"stop domain values must appear in ascending order")]:(s=F,r==="categorical"&&F in h?[new Je(E.key,j,"stop domain values must be unique")]:(h[F]=!0,[])):[new Je(E.key,j,`integer expected, found ${F}`)]}}function yo(i){const e=(i.expressionContext==="property"?wc:ns)(Uo(i.value),i.valueSpec);if(e.result==="error")return e.value.map((o=>new Je(`${i.key}${o.key}`,i.value,o.message)));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new Je(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!rs(r))return[new Je(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!rs(r))return[new Je(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!el(r,["zoom","feature-state"]))return[new Je(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!$s(r))return[new Je(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function cs(i){const e=i.key,r=i.value,o=Fr(r);return o!=="string"?[new Je(e,r,`color expected, ${o} found`)]:Lr.parse(String(r))?[]:[new Je(e,r,`color expected, "${r}" found`)]}function Go(i){const e=i.key,r=i.value,o=i.valueSpec,s=[];return Array.isArray(o.values)?o.values.indexOf(Mi(r))===-1&&s.push(new Je(e,r,`expected one of [${o.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(o.values).indexOf(Mi(r))===-1&&s.push(new Je(e,r,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(r)} found`)),s}function Ca(i){return Tc(Uo(i.value))?yo(Dr({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):rh(i)}function rh(i){const e=i.value,r=i.key;if(Fr(e)!=="array")return[new Je(r,e,`array expected, ${Fr(e)} found`)];const o=i.styleSpec;let s,u=[];if(e.length<1)return[new Je(r,e,"filter array must have at least 1 element")];switch(u=u.concat(Go({key:`${r}[0]`,value:e[0],valueSpec:o.filter_operator,style:i.style,styleSpec:i.styleSpec})),Mi(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Mi(e[1])==="$type"&&u.push(new Je(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&u.push(new Je(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(s=Fr(e[1]),s!=="string"&&u.push(new Je(`${r}[1]`,e[1],`string expected, ${s} found`)));for(let h=2;h<e.length;h++)s=Fr(e[h]),Mi(e[1])==="$type"?u=u.concat(Go({key:`${r}[${h}]`,value:e[h],valueSpec:o.geometry_type,style:i.style,styleSpec:i.styleSpec})):s!=="string"&&s!=="number"&&s!=="boolean"&&u.push(new Je(`${r}[${h}]`,e[h],`string, number, or boolean expected, ${s} found`));break;case"any":case"all":case"none":for(let h=1;h<e.length;h++)u=u.concat(rh({key:`${r}[${h}]`,value:e[h],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":s=Fr(e[1]),e.length!==2?u.push(new Je(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):s!=="string"&&u.push(new Je(`${r}[1]`,e[1],`string expected, ${s} found`))}return u}function ih(i,e){const r=i.key,o=i.validateSpec,s=i.style,u=i.styleSpec,h=i.value,f=i.objectKey,g=u[`${e}_${i.layerType}`];if(!g)return[];const y=f.match(/^(.*)-transition$/);if(e==="paint"&&y&&g[y[1]]&&g[y[1]].transition)return o({key:r,value:h,valueSpec:u.transition,style:s,styleSpec:u});const b=i.valueSpec||g[f];if(!b)return[new Je(r,h,`unknown property "${f}"`)];let C;if(Fr(h)==="string"&&wa(b)&&!b.tokens&&(C=/^{([^}]+)}$/.exec(h)))return[new Je(r,h,`"${f}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(C[1])} }\`.`)];const M=[];return i.layerType==="symbol"&&f==="text-font"&&tl(Uo(h))&&Mi(h.type)==="identity"&&M.push(new Je(r,h,'"text-font" does not support identity functions')),M.concat(o({key:i.key,value:h,valueSpec:b,style:s,styleSpec:u,expressionContext:"property",propertyType:e,propertyKey:f}))}function nh(i){return ih(i,"paint")}function oh(i){return ih(i,"layout")}function ah(i){let e=[];const r=i.value,o=i.key,s=i.style,u=i.styleSpec;if(Fr(r)!=="object")return[new Je(o,r,`object expected, ${Fr(r)} found`)];r.type||r.ref||e.push(new Je(o,r,'either "type" or "ref" is required'));let h=Mi(r.type);const f=Mi(r.ref);if(r.id){const g=Mi(r.id);for(let y=0;y<i.arrayIndex;y++){const b=s.layers[y];Mi(b.id)===g&&e.push(new Je(o,r.id,`duplicate layer id "${r.id}", previously used at line ${b.id.__line__}`))}}if("ref"in r){let g;["type","source","source-layer","filter","layout"].forEach((y=>{y in r&&e.push(new Je(o,r[y],`"${y}" is prohibited for ref layers`))})),s.layers.forEach((y=>{Mi(y.id)===f&&(g=y)})),g?g.ref?e.push(new Je(o,r.ref,"ref cannot reference another ref layer")):h=Mi(g.type):e.push(new Je(o,r.ref,`ref layer "${f}" not found`))}else if(h!=="background")if(r.source){const g=s.sources&&s.sources[r.source],y=g&&Mi(g.type);g?y==="vector"&&h==="raster"?e.push(new Je(o,r.source,`layer "${r.id}" requires a raster source`)):y!=="raster-dem"&&h==="hillshade"||y!=="raster-dem"&&h==="color-relief"?e.push(new Je(o,r.source,`layer "${r.id}" requires a raster-dem source`)):y==="raster"&&h!=="raster"?e.push(new Je(o,r.source,`layer "${r.id}" requires a vector source`)):y!=="vector"||r["source-layer"]?y==="raster-dem"&&h!=="hillshade"&&h!=="color-relief"?e.push(new Je(o,r.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):h!=="line"||!r.paint||!r.paint["line-gradient"]||y==="geojson"&&g.lineMetrics||e.push(new Je(o,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Je(o,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Je(o,r.source,`source "${r.source}" not found`))}else e.push(new Je(o,r,'missing required property "source"'));return e=e.concat(bn({key:o,value:r,valueSpec:u.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${o}.type`,value:r.type,valueSpec:u.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:Ca,layout:g=>bn({layer:r,key:g.key,value:g.value,style:g.style,styleSpec:g.styleSpec,validateSpec:g.validateSpec,objectElementValidators:{"*":y=>oh(Dr({layerType:h},y))}}),paint:g=>bn({layer:r,key:g.key,value:g.value,style:g.style,styleSpec:g.styleSpec,validateSpec:g.validateSpec,objectElementValidators:{"*":y=>nh(Dr({layerType:h},y))}})}})),e}function xo(i){const e=i.value,r=i.key,o=Fr(e);return o!=="string"?[new Je(r,e,`string expected, ${o} found`)]:[]}const Cc={promoteId:function({key:i,value:e}){if(Fr(e)==="string")return xo({key:i,value:e});{const r=[];for(const o in e)r.push(...xo({key:`${i}.${o}`,value:e[o]}));return r}}};function Sc(i){const e=i.value,r=i.key,o=i.styleSpec,s=i.style,u=i.validateSpec;if(!e.type)return[new Je(r,e,'"type" is required')];const h=Mi(e.type);let f;switch(h){case"vector":case"raster":return f=bn({key:r,value:e,valueSpec:o[`source_${h.replace("-","_")}`],style:i.style,styleSpec:o,objectElementValidators:Cc,validateSpec:u}),f;case"raster-dem":return f=(function(g){var y;const b=(y=g.sourceName)!==null&&y!==void 0?y:"",C=g.value,M=g.styleSpec,E=M.source_raster_dem,z=g.style;let D=[];const F=Fr(C);if(C===void 0)return D;if(F!=="object")return D.push(new Je("source_raster_dem",C,`object expected, ${F} found`)),D;const j=Mi(C.encoding)==="custom",J=["redFactor","greenFactor","blueFactor","baseShift"],U=g.value.encoding?`"${g.value.encoding}"`:"Default";for(const H in C)!j&&J.includes(H)?D.push(new Je(H,C[H],`In "${b}": "${H}" is only valid when "encoding" is set to "custom". ${U} encoding found`)):E[H]?D=D.concat(g.validateSpec({key:H,value:C[H],valueSpec:E[H],validateSpec:g.validateSpec,style:z,styleSpec:M})):D.push(new Je(H,C[H],`unknown property "${H}"`));return D})({sourceName:r,value:e,style:i.style,styleSpec:o,validateSpec:u}),f;case"geojson":if(f=bn({key:r,value:e,valueSpec:o.source_geojson,style:s,styleSpec:o,validateSpec:u,objectElementValidators:Cc}),e.cluster)for(const g in e.clusterProperties){const[y,b]=e.clusterProperties[g],C=typeof y=="string"?[y,["accumulated"],["get",g]]:y;f.push(...yo({key:`${r}.${g}.map`,value:b,expressionContext:"cluster-map"})),f.push(...yo({key:`${r}.${g}.reduce`,value:C,expressionContext:"cluster-reduce"}))}return f;case"video":return bn({key:r,value:e,valueSpec:o.source_video,style:s,validateSpec:u,styleSpec:o});case"image":return bn({key:r,value:e,valueSpec:o.source_image,style:s,validateSpec:u,styleSpec:o});case"canvas":return[new Je(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Go({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function us(i){const e=i.value,r=i.styleSpec,o=r.light,s=i.style;let u=[];const h=Fr(e);if(e===void 0)return u;if(h!=="object")return u=u.concat([new Je("light",e,`object expected, ${h} found`)]),u;for(const f in e){const g=f.match(/^(.*)-transition$/);u=u.concat(g&&o[g[1]]&&o[g[1]].transition?i.validateSpec({key:f,value:e[f],valueSpec:r.transition,validateSpec:i.validateSpec,style:s,styleSpec:r}):o[f]?i.validateSpec({key:f,value:e[f],valueSpec:o[f],validateSpec:i.validateSpec,style:s,styleSpec:r}):[new Je(f,e[f],`unknown property "${f}"`)])}return u}function sh(i){const e=i.value,r=i.styleSpec,o=r.sky,s=i.style,u=Fr(e);if(e===void 0)return[];if(u!=="object")return[new Je("sky",e,`object expected, ${u} found`)];let h=[];for(const f in e)h=h.concat(o[f]?i.validateSpec({key:f,value:e[f],valueSpec:o[f],style:s,styleSpec:r}):[new Je(f,e[f],`unknown property "${f}"`)]);return h}function Pc(i){const e=i.value,r=i.styleSpec,o=r.terrain,s=i.style;let u=[];const h=Fr(e);if(e===void 0)return u;if(h!=="object")return u=u.concat([new Je("terrain",e,`object expected, ${h} found`)]),u;for(const f in e)u=u.concat(o[f]?i.validateSpec({key:f,value:e[f],valueSpec:o[f],validateSpec:i.validateSpec,style:s,styleSpec:r}):[new Je(f,e[f],`unknown property "${f}"`)]);return u}function Ic(i){let e=[];const r=i.value,o=i.key;if(Array.isArray(r)){const s=[],u=[];for(const h in r)r[h].id&&s.includes(r[h].id)&&e.push(new Je(o,r,`all the sprites' ids must be unique, but ${r[h].id} is duplicated`)),s.push(r[h].id),r[h].url&&u.includes(r[h].url)&&e.push(new Je(o,r,`all the sprites' URLs must be unique, but ${r[h].url} is duplicated`)),u.push(r[h].url),e=e.concat(bn({key:`${o}[${h}]`,value:r[h],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return xo({key:o,value:r})}function lh(i){return!!i&&i.constructor===Object}function Mc(i){return lh(i.value)?[]:[new Je(i.key,i.value,`object expected, ${Fr(i.value)} found`)]}const Ec={"*":()=>[],array:sl,boolean:function(i){const e=i.value,r=i.key,o=Fr(e);return o!=="boolean"?[new Je(r,e,`boolean expected, ${o} found`)]:[]},number:ls,color:cs,constants:th,enum:Go,filter:Ca,function:ll,layer:ah,object:bn,source:Sc,light:us,sky:sh,terrain:Pc,projection:function(i){const e=i.value,r=i.styleSpec,o=r.projection,s=i.style,u=Fr(e);if(e===void 0)return[];if(u!=="object")return[new Je("projection",e,`object expected, ${u} found`)];let h=[];for(const f in e)h=h.concat(o[f]?i.validateSpec({key:f,value:e[f],valueSpec:o[f],style:s,styleSpec:r}):[new Je(f,e[f],`unknown property "${f}"`)]);return h},projectionDefinition:function(i){const e=i.key;let r=i.value;r=r instanceof String?r.valueOf():r;const o=Fr(r);return o!=="array"||(function(s){return Array.isArray(s)&&s.length===3&&typeof s[0]=="string"&&typeof s[1]=="string"&&typeof s[2]=="number"})(r)||(function(s){return!!["interpolate","step","literal"].includes(s[0])})(r)?["array","string"].includes(o)?[]:[new Je(e,r,`projection expected, invalid type "${o}" found`)]:[new Je(e,r,`projection expected, invalid array ${JSON.stringify(r)} found`)]},string:xo,formatted:function(i){return xo(i).length===0?[]:yo(i)},resolvedImage:function(i){return xo(i).length===0?[]:yo(i)},padding:function(i){const e=i.key,r=i.value;if(Fr(r)==="array"){if(r.length<1||r.length>4)return[new Je(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const o={type:"number"};let s=[];for(let u=0;u<r.length;u++)s=s.concat(i.validateSpec({key:`${e}[${u}]`,value:r[u],validateSpec:i.validateSpec,valueSpec:o}));return s}return ls({key:e,value:r,valueSpec:{}})},numberArray:function(i){const e=i.key,r=i.value;if(Fr(r)==="array"){const o={type:"number"};if(r.length<1)return[new Je(e,r,"array length at least 1 expected, length 0 found")];let s=[];for(let u=0;u<r.length;u++)s=s.concat(i.validateSpec({key:`${e}[${u}]`,value:r[u],validateSpec:i.validateSpec,valueSpec:o}));return s}return ls({key:e,value:r,valueSpec:{}})},colorArray:function(i){const e=i.key,r=i.value;if(Fr(r)==="array"){if(r.length<1)return[new Je(e,r,"array length at least 1 expected, length 0 found")];let o=[];for(let s=0;s<r.length;s++)o=o.concat(cs({key:`${e}[${s}]`,value:r[s]}));return o}return cs({key:e,value:r})},variableAnchorOffsetCollection:function(i){const e=i.key,r=i.value,o=Fr(r),s=i.styleSpec;if(o!=="array"||r.length<1||r.length%2!=0)return[new Je(e,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let u=[];for(let h=0;h<r.length;h+=2)u=u.concat(Go({key:`${e}[${h}]`,value:r[h],valueSpec:s.layout_symbol["text-anchor"]})),u=u.concat(sl({key:`${e}[${h+1}]`,value:r[h+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:s}));return u},sprite:Ic,state:Mc,fontFaces:function(i){const e=i.key,r=i.value,o=i.validateSpec,s=i.styleSpec,u=i.style;if(!lh(r))return[new Je(e,r,`object expected, ${Fr(r)} found`)];const h=[];for(const f in r){const g=r[f],y=Fr(g);if(y==="string")h.push(...xo({key:`${e}.${f}`,value:g}));else if(y==="array"){const b={url:{type:"string",required:!0},"unicode-range":{type:"array",value:"string"}};for(const[C,M]of g.entries())h.push(...bn({key:`${e}.${f}[${C}]`,value:M,valueSpec:b,styleSpec:s,style:u,validateSpec:o}))}else h.push(new Je(`${e}.${f}`,g,`string or array expected, ${y} found`))}return h}};function bo(i){const e=i.value,r=i.valueSpec,o=i.styleSpec;return i.validateSpec=bo,r.expression&&tl(Mi(e))?ll(i):r.expression&&Ta(Uo(e))?yo(i):r.type&&Ec[r.type]?Ec[r.type](i):bn(Dr({},i,{valueSpec:r.type?o[r.type]:r}))}function ch(i){const e=i.value,r=i.key,o=xo(i);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new Je(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new Je(r,e,'"glyphs" url must include a "{range}" token'))),o}function En(i,e=pe){let r=[];return r=r.concat(bo({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:bo,objectElementValidators:{glyphs:ch,"*":()=>[]}})),i.constants&&(r=r.concat(th({key:"constants",value:i.constants}))),uh(r)}function On(i){return function(e){return i(Object.assign({},e,{validateSpec:bo}))}}function uh(i){return[].concat(i).sort(((e,r)=>e.line-r.line))}function Bn(i){return function(...e){return uh(i.apply(this,e))}}En.source=Bn(On(Sc)),En.sprite=Bn(On(Ic)),En.glyphs=Bn(On(ch)),En.light=Bn(On(us)),En.sky=Bn(On(sh)),En.terrain=Bn(On(Pc)),En.state=Bn(On(Mc)),En.layer=Bn(On(ah)),En.filter=Bn(On(Ca)),En.paintProperty=Bn(On(nh)),En.layoutProperty=Bn(On(oh));const Pd={type:"enum","property-type":"data-constant",expression:{interpolated:!1,parameters:["global-state"]},values:{visible:{},none:{}},transition:!1,default:"visible"};class hs{constructor(e,r){this._globalState=r,this.setValue(e)}evaluate(){var e;return(e=this._literalValue)!==null&&e!==void 0?e:this._compiledValue.evaluate({})}setValue(e){if(e==null||e==="visible"||e==="none")return this._literalValue=e==="none"?"none":"visible",this._compiledValue=void 0,void(this._globalStateRefs=new Set);const r=ns(e,Pd,this._globalState);if(r.result==="error")throw this._literalValue="visible",this._compiledValue=void 0,new Error(r.value.map((o=>`${o.key}: ${o.message}`)).join(", "));this._literalValue=void 0,this._compiledValue=r.value,this._globalStateRefs=vo(r.value.expression)}getGlobalStateRefs(){return this._globalStateRefs}}const ds=pe,Vi=En,ps=Vi.light,hh=Vi.sky,Id=Vi.paintProperty,Md=Vi.layoutProperty;function Sa(i,e){let r=!1;if(e&&e.length)for(const o of e)i.fire(new ke(new Error(o.message))),r=!0;return r}class Pa{constructor(e,r,o){const s=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const h=new Int32Array(this.arrayBuffer);e=h[0],this.d=(r=h[1])+2*(o=h[2]);for(let g=0;g<this.d*this.d;g++){const y=h[3+g],b=h[3+g+1];s.push(y===b?null:h.subarray(y,b))}const f=h[3+s.length+1];this.keys=h.subarray(h[3+s.length],f),this.bboxes=h.subarray(f),this.insert=this._insertReadonly}else{this.d=r+2*o;for(let h=0;h<this.d*this.d;h++)s.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=o,this.scale=r/e,this.uid=0;const u=o/r*e;this.min=-u,this.max=e+u}insert(e,r,o,s,u){this._forEachCell(r,o,s,u,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(o),this.bboxes.push(s),this.bboxes.push(u)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,o,s,u,h){this.cells[u].push(h)}query(e,r,o,s,u){const h=this.min,f=this.max;if(e<=h&&r<=h&&f<=o&&f<=s&&!u)return Array.prototype.slice.call(this.keys);{const g=[];return this._forEachCell(e,r,o,s,this._queryCell,g,{},u),g}}_queryCell(e,r,o,s,u,h,f,g){const y=this.cells[u];if(y!==null){const b=this.keys,C=this.bboxes;for(let M=0;M<y.length;M++){const E=y[M];if(f[E]===void 0){const z=4*E;(g?g(C[z+0],C[z+1],C[z+2],C[z+3]):e<=C[z+2]&&r<=C[z+3]&&o>=C[z+0]&&s>=C[z+1])?(f[E]=!0,h.push(b[E])):f[E]=!1}}}}_forEachCell(e,r,o,s,u,h,f,g){const y=this._convertToCellCoord(e),b=this._convertToCellCoord(r),C=this._convertToCellCoord(o),M=this._convertToCellCoord(s);for(let E=y;E<=C;E++)for(let z=b;z<=M;z++){const D=this.d*z+E;if((!g||g(this._convertFromCellCoord(E),this._convertFromCellCoord(z),this._convertFromCellCoord(E+1),this._convertFromCellCoord(z+1)))&&u.call(this,e,r,o,s,D,h,f,g))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let o=0;for(let h=0;h<this.cells.length;h++)o+=this.cells[h].length;const s=new Int32Array(r+o+this.keys.length+this.bboxes.length);s[0]=this.extent,s[1]=this.n,s[2]=this.padding;let u=r;for(let h=0;h<e.length;h++){const f=e[h];s[3+h]=u,s.set(f,u),u+=f.length}return s[3+e.length]=u,s.set(this.keys,u),u+=this.keys.length,s[3+e.length+1]=u,s.set(this.bboxes,u),u+=this.bboxes.length,s.buffer}static serialize(e,r){const o=e.toArrayBuffer();return r&&r.push(o),{buffer:o}}static deserialize(e){return new Pa(e.buffer)}}const Nn={};function Zt(i,e,r={}){if(Nn[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),Nn[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}Zt("Object",Object),Zt("Set",Set),Zt("TransferableGridIndex",Pa),Zt("Color",Lr),Zt("Error",Error),Zt("AJAXError",se),Zt("ResolvedImage",xn),Zt("StylePropertyFunction",il),Zt("StyleExpression",xc,{omit:["_evaluator"]}),Zt("ZoomDependentExpression",bc),Zt("ZoomConstantExpression",rl),Zt("CompoundExpression",Mn,{omit:["_evaluate"]});for(const i in xa)xa[i]._classRegistryKey||Zt(`Expression_${i}`,xa[i]);function cl(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Ac(i){return i.$name||i.constructor._classRegistryKey}function Ia(i){return!(function(e){if(e===null||typeof e!="object")return!1;const r=Ac(e);return!(!r||r==="Object")})(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||cl(i)||Xt(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function fs(i,e){if(Ia(i))return(cl(i)||Xt(i))&&e&&e.push(i),ArrayBuffer.isView(i)&&e&&e.push(i.buffer),i instanceof ImageData&&e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const u=[];for(const h of i)u.push(fs(h,e));return u}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const r=Ac(i);if(!r)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!Nn[r])throw new Error(`${r} is not registered.`);const{klass:o}=Nn[r],s=o.serialize?o.serialize(i,e):{};if(o.serialize){if(e&&s===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const u in i){if(!i.hasOwnProperty(u)||Nn[r].omit.indexOf(u)>=0)continue;const h=i[u];s[u]=Nn[r].shallow.indexOf(u)>=0?h:fs(h,e)}i instanceof Error&&(s.message=i.message)}if(s.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(s.$name=r),s}function ms(i){if(Ia(i))return i;if(Array.isArray(i))return i.map(ms);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const e=Ac(i)||"Object";if(!Nn[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=Nn[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const o=Object.create(r.prototype);for(const s of Object.keys(i)){if(s==="$name")continue;const u=i[s];o[s]=Nn[e].shallow.indexOf(s)>=0?u:ms(u)}return o}class kc{constructor(){this.first=!0}update(e,r){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}function gs(i){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))}function zc(i){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))}function dh(i){return/\s/u.test(String.fromCodePoint(i))}function Ma(i){for(const e of i)if(zc(e.codePointAt(0)))return!0;return!1}function Ed(i){for(const e of i)if(!ph(e.codePointAt(0)))return!1;return!0}function ul(i){const e=i.map((r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}})).filter((r=>r));return new RegExp(e.join("|"),"u")}const hl=ul(["Arab","Dupl","Mong","Ougr","Syrc"]);function ph(i){return!hl.test(String.fromCodePoint(i))}function Dc(i){return!(zc(i)||(e=i,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(e))));var e}const fh=ul(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Lc(i){return fh.test(String.fromCodePoint(i))}function Rc(i,e){return!(!e&&Lc(i)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(i)))}function mh(i){for(const e of i)if(Lc(e.codePointAt(0)))return!0;return!1}const wo=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){if(wo.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(i,e){return l(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(i.pluginStatus!=="loading")return this.setState(i),i;const r=i.pluginURL,o=new Promise((u=>{this.loadScriptResolve=u}));e(r);const s=new Promise((u=>setTimeout((()=>u()),this.TIMEOUT)));if(yield Promise.race([o,s]),this.isParsed()){const u={pluginStatus:"loaded",pluginURL:r};return this.setState(u),u}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${r}`)}))}};class $r{constructor(e,r){this.isSupportedScript=Ad,this.zoom=e,r?(this.now=r.now||0,this.fadeDuration=r.fadeDuration||0,this.zoomHistory=r.zoomHistory||new kc,this.transition=r.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new kc,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*r}}}function Ad(i){return(function(e,r){for(const o of e)if(!Rc(o.codePointAt(0),r))return!1;return!0})(i,wo.getRTLTextPluginStatus()==="loaded")}const _s="-transition";class dl{constructor(e,r,o){this.property=e,this.value=r,this.expression=(function(s,u,h){if(tl(s))return new il(s,u);if(Ta(s)){const f=wc(s,u,h);if(f.result==="error")throw new Error(f.value.map((g=>`${g.key}: ${g.message}`)).join(", "));return f.value}{let f=s;return u.type==="color"&&typeof s=="string"?f=Lr.parse(s):u.type!=="padding"||typeof s!="number"&&!Array.isArray(s)?u.type!=="numberArray"||typeof s!="number"&&!Array.isArray(s)?u.type!=="colorArray"||typeof s!="string"&&!Array.isArray(s)?u.type==="variableAnchorOffsetCollection"&&Array.isArray(s)?f=sn.parse(s):u.type==="projectionDefinition"&&typeof s=="string"&&(f=ln.parse(s)):f=gr.parse(s):f=yi.parse(s):f=en.parse(s),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>f}}})(r===void 0?e.specification.default:r,e.specification,o)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(e,r,o){return this.property.possiblyEvaluate(this,e,r,o)}}class pl{constructor(e,r){this.property=e,this.value=new dl(e,void 0,r)}transitioned(e,r){return new gh(this.property,this.value,r,ot({},e.transition,this.transition),e.now)}untransitioned(){return new gh(this.property,this.value,null,{},0)}}class Fc{constructor(e,r){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._globalState=r}getValue(e){return Ft(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new pl(this._values[e].property,this._globalState)),this._values[e].value=new dl(this._values[e].property,r===null?void 0:Ft(r),this._globalState)}getTransition(e){return Ft(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new pl(this._values[e].property,this._globalState)),this._values[e].transition=Ft(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(e[r]=o);const s=this.getTransition(r);s!==void 0&&(e[`${r}${_s}`]=s)}return e}transitioned(e,r){const o=new _h(this._properties);for(const s of Object.keys(this._values))o._values[s]=this._values[s].transitioned(e,r._values[s]);return o}untransitioned(){const e=new _h(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class gh{constructor(e,r,o,s,u){this.property=e,this.value=r,this.begin=u+s.delay||0,this.end=this.begin+s.duration||0,e.specification.transition&&(s.delay||s.duration)&&(this.prior=o)}possiblyEvaluate(e,r,o){const s=e.now||0,u=this.value.possiblyEvaluate(e,r,o),h=this.prior;if(h){if(s>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(s<this.begin)return h.possiblyEvaluate(e,r,o);{const f=(s-this.begin)/(this.end-this.begin);return this.property.interpolate(h.possiblyEvaluate(e,r,o),u,ee(f))}}return u}}class _h{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,o){const s=new vs(this._properties);for(const u of Object.keys(this._values))s._values[u]=this._values[u].possiblyEvaluate(e,r,o);return s}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class vh{constructor(e,r){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._globalState=r}hasValue(e){return this._values[e].value!==void 0}getValue(e){return Ft(this._values[e].value)}setValue(e,r){this._values[e]=new dl(this._values[e].property,r===null?void 0:Ft(r),this._globalState)}serialize(){const e={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(e[r]=o)}return e}possiblyEvaluate(e,r,o){const s=new vs(this._properties);for(const u of Object.keys(this._values))s._values[u]=this._values[u].possiblyEvaluate(e,r,o);return s}}class Vn{constructor(e,r,o){this.property=e,this.value=r,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,o,s){return this.property.evaluate(this.value,this.parameters,e,r,o,s)}}class vs{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Jt{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,o){const s=di[this.specification.type];return s?s(e,r,o):e}}class sr{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,o,s){return new Vn(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},o,s)}:e.expression,r)}interpolate(e,r,o){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new Vn(this,{kind:"constant",value:void 0},e.parameters);const s=di[this.specification.type];if(s){const u=s(e.value.value,r.value.value,o);return new Vn(this,{kind:"constant",value:u},e.parameters)}return e}evaluate(e,r,o,s,u,h){return e.kind==="constant"?e.value:e.evaluate(r,o,s,u,h)}}class ys extends sr{possiblyEvaluate(e,r,o,s){if(e.value===void 0)return new Vn(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const u=e.expression.evaluate(r,null,{},o,s),h=e.property.specification.type==="resolvedImage"&&typeof u!="string"?u.name:u,f=this._calculate(h,h,h,r);return new Vn(this,{kind:"constant",value:f},r)}if(e.expression.kind==="camera"){const u=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new Vn(this,{kind:"constant",value:u},r)}return new Vn(this,e.expression,r)}evaluate(e,r,o,s,u,h){if(e.kind==="source"){const f=e.evaluate(r,o,s,u,h);return this._calculate(f,f,f,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},o,s),e.evaluate({zoom:Math.floor(r.zoom)},o,s),e.evaluate({zoom:Math.floor(r.zoom)+1},o,s),r):e.value}_calculate(e,r,o,s){return s.zoom>s.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:o,to:r}}interpolate(e){return e}}class fl{constructor(e){this.specification=e}possiblyEvaluate(e,r,o,s){if(e.value!==void 0){if(e.expression.kind==="constant"){const u=e.expression.evaluate(r,null,{},o,s);return this._calculate(u,u,u,r)}return this._calculate(e.expression.evaluate(new $r(Math.floor(r.zoom-1),r)),e.expression.evaluate(new $r(Math.floor(r.zoom),r)),e.expression.evaluate(new $r(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,o,s){return s.zoom>s.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:o,to:r}}interpolate(e){return e}}class ml{constructor(e){this.specification=e}possiblyEvaluate(e,r,o,s){return!!e.expression.evaluate(r,null,{},o,s)}interpolate(){return!1}}class un{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const o=e[r];o.specification.overridable&&this.overridableProperties.push(r);const s=this.defaultPropertyValues[r]=new dl(o,void 0,void 0),u=this.defaultTransitionablePropertyValues[r]=new pl(o,void 0);this.defaultTransitioningPropertyValues[r]=u.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=s.possiblyEvaluate({})}}}Zt("DataDrivenProperty",sr),Zt("DataConstantProperty",Jt),Zt("CrossFadedDataDrivenProperty",ys),Zt("CrossFadedProperty",fl),Zt("ColorRampProperty",ml);class An extends et{constructor(e,r,o){if(super(),this.id=e.id,this.type=e.type,this._globalState=o,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},this._visibilityExpression=(function(s,u){return new hs(s,u)})(this.visibility,o),e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter,this._featureFilter=os(e.filter,o)),r.layout&&(this._unevaluatedLayout=new vh(r.layout,o)),r.paint)){this._transitionablePaint=new Fc(r.paint,o);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new vs(r.paint)}}setFilter(e){this.filter=e,this._featureFilter=os(e,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}getLayoutAffectingGlobalStateRefs(){const e=new Set;for(const r of this._visibilityExpression.getGlobalStateRefs())e.add(r);if(this._unevaluatedLayout)for(const r in this._unevaluatedLayout._values){const o=this._unevaluatedLayout._values[r];for(const s of o.getGlobalStateRefs())e.add(s)}for(const r of this._featureFilter.getGlobalStateRefs())e.add(r);return e}getPaintAffectingGlobalStateRefs(){var e;const r=new globalThis.Map;if(this._transitionablePaint)for(const o in this._transitionablePaint._values){const s=this._transitionablePaint._values[o].value;for(const u of s.getGlobalStateRefs()){const h=(e=r.get(u))!==null&&e!==void 0?e:[];h.push({name:o,value:s.value}),r.set(u,h)}}return r}getVisibilityAffectingGlobalStateRefs(){return this._visibilityExpression.getGlobalStateRefs()}setLayoutProperty(e,r,o={}){if(r==null||!this._validate(Md,`layers.${this.id}.layout.${e}`,e,r,o))return e==="visibility"?(this.visibility=r,this._visibilityExpression.setValue(r),void this.recalculateVisibility()):void this._unevaluatedLayout.setValue(e,r)}getPaintProperty(e){return e.endsWith(_s)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,o={}){if(r!=null&&this._validate(Id,`layers.${this.id}.paint.${e}`,e,r,o))return!1;if(e.endsWith(_s))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const s=this._transitionablePaint._values[e],u=s.property.specification["property-type"]==="cross-faded-data-driven",h=s.value.isDataDriven(),f=s.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const g=this._transitionablePaint._values[e].value;return g.isDataDriven()||h||u||this._handleOverridablePaintPropertyUpdate(e,f,g)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,o){return!1}isHidden(e=this.minzoom,r=!1){return!!(this.minzoom&&e<(r?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&e>=this.maxzoom)||this._evaluatedVisibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculateVisibility(){this._evaluatedVisibility=this._visibilityExpression.evaluate()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Rt(e,((r,o)=>!(r===void 0||o==="layout"&&!Object.keys(r).length||o==="paint"&&!Object.keys(r).length)))}_validate(e,r,o,s,u={}){return(!u||u.validate!==!1)&&Sa(this,e.call(Vi,{key:r,layerType:this.type,objectKey:o,value:s,styleSpec:pe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof Vn&&wa(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}let Oc;var yh={get paint(){return Oc=Oc||new un({"raster-opacity":new Jt(pe.paint_raster["raster-opacity"]),"raster-hue-rotate":new Jt(pe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Jt(pe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Jt(pe.paint_raster["raster-brightness-max"]),"raster-saturation":new Jt(pe.paint_raster["raster-saturation"]),"raster-contrast":new Jt(pe.paint_raster["raster-contrast"]),"raster-resampling":new Jt(pe.paint_raster["raster-resampling"]),"raster-fade-duration":new Jt(pe.paint_raster["raster-fade-duration"])})}};class kd extends An{constructor(e,r){super(e,yh,r)}}const zd={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class xs{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class xi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Ei(i,e=1){let r=0,o=0;return{members:i.map((s=>{const u=zd[s.type].BYTES_PER_ELEMENT,h=r=qo(r,Math.max(e,u)),f=s.components||1;return o=Math.max(o,u),r+=u*f,{name:s.name,type:s.type,components:f,offset:h}})),size:qo(r,Math.max(o,e)),alignment:e}}function qo(i,e){return Math.ceil(i/e)*e}class bs extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,r)}emplace(e,r,o){const s=2*e;return this.int16[s+0]=r,this.int16[s+1]=o,e}}bs.prototype.bytesPerElement=4,Zt("StructArrayLayout2i4",bs);class gl extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,r,o)}emplace(e,r,o,s){const u=3*e;return this.int16[u+0]=r,this.int16[u+1]=o,this.int16[u+2]=s,e}}gl.prototype.bytesPerElement=6,Zt("StructArrayLayout3i6",gl);class Bc extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,o,s)}emplace(e,r,o,s,u){const h=4*e;return this.int16[h+0]=r,this.int16[h+1]=o,this.int16[h+2]=s,this.int16[h+3]=u,e}}Bc.prototype.bytesPerElement=8,Zt("StructArrayLayout4i8",Bc);class _l extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,s,u,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,o,s,u,h)}emplace(e,r,o,s,u,h,f){const g=6*e;return this.int16[g+0]=r,this.int16[g+1]=o,this.int16[g+2]=s,this.int16[g+3]=u,this.int16[g+4]=h,this.int16[g+5]=f,e}}_l.prototype.bytesPerElement=12,Zt("StructArrayLayout2i4i12",_l);class Nc extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,s,u,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,o,s,u,h)}emplace(e,r,o,s,u,h,f){const g=4*e,y=8*e;return this.int16[g+0]=r,this.int16[g+1]=o,this.uint8[y+4]=s,this.uint8[y+5]=u,this.uint8[y+6]=h,this.uint8[y+7]=f,e}}Nc.prototype.bytesPerElement=8,Zt("StructArrayLayout2i4ub8",Nc);class ws extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,r)}emplace(e,r,o){const s=2*e;return this.float32[s+0]=r,this.float32[s+1]=o,e}}ws.prototype.bytesPerElement=8,Zt("StructArrayLayout2f8",ws);class to extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,s,u,h,f,g,y,b){const C=this.length;return this.resize(C+1),this.emplace(C,e,r,o,s,u,h,f,g,y,b)}emplace(e,r,o,s,u,h,f,g,y,b,C){const M=10*e;return this.uint16[M+0]=r,this.uint16[M+1]=o,this.uint16[M+2]=s,this.uint16[M+3]=u,this.uint16[M+4]=h,this.uint16[M+5]=f,this.uint16[M+6]=g,this.uint16[M+7]=y,this.uint16[M+8]=b,this.uint16[M+9]=C,e}}to.prototype.bytesPerElement=20,Zt("StructArrayLayout10ui20",to);class vl extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,s,u,h,f,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,o,s,u,h,f,g)}emplace(e,r,o,s,u,h,f,g,y){const b=8*e;return this.uint16[b+0]=r,this.uint16[b+1]=o,this.uint16[b+2]=s,this.uint16[b+3]=u,this.uint16[b+4]=h,this.uint16[b+5]=f,this.uint16[b+6]=g,this.uint16[b+7]=y,e}}vl.prototype.bytesPerElement=16,Zt("StructArrayLayout8ui16",vl);class Ts extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,s,u,h,f,g,y,b,C,M){const E=this.length;return this.resize(E+1),this.emplace(E,e,r,o,s,u,h,f,g,y,b,C,M)}emplace(e,r,o,s,u,h,f,g,y,b,C,M,E){const z=12*e;return this.int16[z+0]=r,this.int16[z+1]=o,this.int16[z+2]=s,this.int16[z+3]=u,this.uint16[z+4]=h,this.uint16[z+5]=f,this.uint16[z+6]=g,this.uint16[z+7]=y,this.int16[z+8]=b,this.int16[z+9]=C,this.int16[z+10]=M,this.int16[z+11]=E,e}}Ts.prototype.bytesPerElement=24,Zt("StructArrayLayout4i4ui4i24",Ts);class yl extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,r,o)}emplace(e,r,o,s){const u=3*e;return this.float32[u+0]=r,this.float32[u+1]=o,this.float32[u+2]=s,e}}yl.prototype.bytesPerElement=12,Zt("StructArrayLayout3f12",yl);class Cs extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}Cs.prototype.bytesPerElement=4,Zt("StructArrayLayout1ul4",Cs);class Vc extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,s,u,h,f,g,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,o,s,u,h,f,g,y)}emplace(e,r,o,s,u,h,f,g,y,b){const C=10*e,M=5*e;return this.int16[C+0]=r,this.int16[C+1]=o,this.int16[C+2]=s,this.int16[C+3]=u,this.int16[C+4]=h,this.int16[C+5]=f,this.uint32[M+3]=g,this.uint16[C+8]=y,this.uint16[C+9]=b,e}}Vc.prototype.bytesPerElement=20,Zt("StructArrayLayout6i1ul2ui20",Vc);class Ea extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,s,u,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,o,s,u,h)}emplace(e,r,o,s,u,h,f){const g=6*e;return this.int16[g+0]=r,this.int16[g+1]=o,this.int16[g+2]=s,this.int16[g+3]=u,this.int16[g+4]=h,this.int16[g+5]=f,e}}Ea.prototype.bytesPerElement=12,Zt("StructArrayLayout2i2i2i12",Ea);class Zo extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,s,u){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,o,s,u)}emplace(e,r,o,s,u,h){const f=4*e,g=8*e;return this.float32[f+0]=r,this.float32[f+1]=o,this.float32[f+2]=s,this.int16[g+6]=u,this.int16[g+7]=h,e}}Zo.prototype.bytesPerElement=16,Zt("StructArrayLayout2f1f2i16",Zo);class jc extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,s,u,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,o,s,u,h)}emplace(e,r,o,s,u,h,f){const g=16*e,y=4*e,b=8*e;return this.uint8[g+0]=r,this.uint8[g+1]=o,this.float32[y+1]=s,this.float32[y+2]=u,this.int16[b+6]=h,this.int16[b+7]=f,e}}jc.prototype.bytesPerElement=16,Zt("StructArrayLayout2ub2f2i16",jc);class Ss extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,r,o)}emplace(e,r,o,s){const u=3*e;return this.uint16[u+0]=r,this.uint16[u+1]=o,this.uint16[u+2]=s,e}}Ss.prototype.bytesPerElement=6,Zt("StructArrayLayout3ui6",Ss);class Ho extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,s,u,h,f,g,y,b,C,M,E,z,D,F,j){const J=this.length;return this.resize(J+1),this.emplace(J,e,r,o,s,u,h,f,g,y,b,C,M,E,z,D,F,j)}emplace(e,r,o,s,u,h,f,g,y,b,C,M,E,z,D,F,j,J){const U=24*e,H=12*e,re=48*e;return this.int16[U+0]=r,this.int16[U+1]=o,this.uint16[U+2]=s,this.uint16[U+3]=u,this.uint32[H+2]=h,this.uint32[H+3]=f,this.uint32[H+4]=g,this.uint16[U+10]=y,this.uint16[U+11]=b,this.uint16[U+12]=C,this.float32[H+7]=M,this.float32[H+8]=E,this.uint8[re+36]=z,this.uint8[re+37]=D,this.uint8[re+38]=F,this.uint32[H+10]=j,this.int16[U+22]=J,e}}Ho.prototype.bytesPerElement=48,Zt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Ho);class Uc extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,s,u,h,f,g,y,b,C,M,E,z,D,F,j,J,U,H,re,ge,je,mt,ht,_t,Dt,Ct){const ct=this.length;return this.resize(ct+1),this.emplace(ct,e,r,o,s,u,h,f,g,y,b,C,M,E,z,D,F,j,J,U,H,re,ge,je,mt,ht,_t,Dt,Ct)}emplace(e,r,o,s,u,h,f,g,y,b,C,M,E,z,D,F,j,J,U,H,re,ge,je,mt,ht,_t,Dt,Ct,ct){const tt=32*e,Ut=16*e;return this.int16[tt+0]=r,this.int16[tt+1]=o,this.int16[tt+2]=s,this.int16[tt+3]=u,this.int16[tt+4]=h,this.int16[tt+5]=f,this.int16[tt+6]=g,this.int16[tt+7]=y,this.uint16[tt+8]=b,this.uint16[tt+9]=C,this.uint16[tt+10]=M,this.uint16[tt+11]=E,this.uint16[tt+12]=z,this.uint16[tt+13]=D,this.uint16[tt+14]=F,this.uint16[tt+15]=j,this.uint16[tt+16]=J,this.uint16[tt+17]=U,this.uint16[tt+18]=H,this.uint16[tt+19]=re,this.uint16[tt+20]=ge,this.uint16[tt+21]=je,this.uint16[tt+22]=mt,this.uint32[Ut+12]=ht,this.float32[Ut+13]=_t,this.float32[Ut+14]=Dt,this.uint16[tt+30]=Ct,this.uint16[tt+31]=ct,e}}Uc.prototype.bytesPerElement=64,Zt("StructArrayLayout8i15ui1ul2f2ui64",Uc);class xl extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}xl.prototype.bytesPerElement=4,Zt("StructArrayLayout1f4",xl);class bl extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,r,o)}emplace(e,r,o,s){const u=3*e;return this.uint16[6*e+0]=r,this.float32[u+1]=o,this.float32[u+2]=s,e}}bl.prototype.bytesPerElement=12,Zt("StructArrayLayout1ui2f12",bl);class Gc extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,r,o)}emplace(e,r,o,s){const u=4*e;return this.uint32[2*e+0]=r,this.uint16[u+2]=o,this.uint16[u+3]=s,e}}Gc.prototype.bytesPerElement=8,Zt("StructArrayLayout1ul2ui8",Gc);class d extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,r)}emplace(e,r,o){const s=2*e;return this.uint16[s+0]=r,this.uint16[s+1]=o,e}}d.prototype.bytesPerElement=4,Zt("StructArrayLayout2ui4",d);class t extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}t.prototype.bytesPerElement=2,Zt("StructArrayLayout1ui2",t);class n extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,o,s)}emplace(e,r,o,s,u){const h=4*e;return this.float32[h+0]=r,this.float32[h+1]=o,this.float32[h+2]=s,this.float32[h+3]=u,e}}n.prototype.bytesPerElement=16,Zt("StructArrayLayout4f16",n);class a extends xs{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new q(this.anchorPointX,this.anchorPointY)}}a.prototype.size=20;class c extends Vc{get(e){return new a(this,e)}}Zt("CollisionBoxArray",c);class p extends xs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}p.prototype.size=48;class m extends Ho{get(e){return new p(this,e)}}Zt("PlacedSymbolArray",m);class v extends xs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}v.prototype.size=64;class x extends Uc{get(e){return new v(this,e)}}Zt("SymbolInstanceArray",x);class T extends xl{getoffsetX(e){return this.float32[1*e+0]}}Zt("GlyphOffsetArray",T);class P extends gl{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Zt("SymbolLineVertexArray",P);class k extends xs{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}k.prototype.size=12;class A extends bl{get(e){return new k(this,e)}}Zt("TextAnchorOffsetArray",A);class L extends xs{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}L.prototype.size=8;class N extends Gc{get(e){return new L(this,e)}}Zt("FeatureIndexArray",N);class W extends bs{}class Y extends bs{}class X extends bs{}class te extends _l{}class fe extends Nc{}class $ extends ws{}class he extends to{}class ve extends vl{}class le extends Ts{}class Me extends yl{}class $e extends Cs{}class Ze extends Ea{}class We extends jc{}class Ye extends Ss{}class At extends d{}const kt=Ei([{name:"a_pos",components:2,type:"Int16"}],4),{members:yt}=kt;class Nt{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,r,o,s){const u=this.segments[this.segments.length-1];return e>Nt.MAX_VERTEX_ARRAY_LENGTH&&Yt(`Max vertices per segment is ${Nt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Nt.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!u||u.vertexLength+e>Nt.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==s?this.createNewSegment(r,o,s):u}createNewSegment(e,r,o){const s={vertexOffset:e.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0,vaos:{}};return o!==void 0&&(s.sortKey=o),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(s),s}getOrCreateLatestSegment(e,r,o){return this.prepareSegment(0,e,r,o)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,o,s){return new Nt([{vertexOffset:e,primitiveOffset:r,vertexLength:o,primitiveLength:s,vaos:{},sortKey:0}])}}function Mr(i,e){return 256*(i=De(Math.floor(i),0,255))+De(Math.floor(e),0,255)}Nt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Zt("SegmentVector",Nt);const Qr=Ei([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),ci=Ei([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var ri,pi,ii,Ci={exports:{}},fi={exports:{}},ji={exports:{}},Di=(function(){if(ii)return Ci.exports;ii=1;var i=(ri||(ri=1,fi.exports=function(r,o){var s,u,h,f,g,y,b,C;for(u=r.length-(s=3&r.length),h=o,g=3432918353,y=461845907,C=0;C<u;)b=255&r.charCodeAt(C)|(255&r.charCodeAt(++C))<<8|(255&r.charCodeAt(++C))<<16|(255&r.charCodeAt(++C))<<24,++C,h=27492+(65535&(f=5*(65535&(h=(h^=b=(65535&(b=(b=(65535&b)*g+(((b>>>16)*g&65535)<<16)&4294967295)<<15|b>>>17))*y+(((b>>>16)*y&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(b=0,s){case 3:b^=(255&r.charCodeAt(C+2))<<16;case 2:b^=(255&r.charCodeAt(C+1))<<8;case 1:h^=b=(65535&(b=(b=(65535&(b^=255&r.charCodeAt(C)))*g+(((b>>>16)*g&65535)<<16)&4294967295)<<15|b>>>17))*y+(((b>>>16)*y&65535)<<16)&4294967295}return h^=r.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0}),fi.exports),e=(pi||(pi=1,ji.exports=function(r,o){for(var s,u=r.length,h=o^u,f=0;u>=4;)s=1540483477*(65535&(s=255&r.charCodeAt(f)|(255&r.charCodeAt(++f))<<8|(255&r.charCodeAt(++f))<<16|(255&r.charCodeAt(++f))<<24))+((1540483477*(s>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),u-=4,++f;switch(u){case 3:h^=(255&r.charCodeAt(f+2))<<16;case 2:h^=(255&r.charCodeAt(f+1))<<8;case 1:h=1540483477*(65535&(h^=255&r.charCodeAt(f)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0}),ji.exports);return Ci.exports=i,Ci.exports.murmur3=i,Ci.exports.murmur2=e,Ci.exports})(),Ai=xe(Di);class Yi{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,o,s){this.ids.push(To(e)),this.positions.push(r,o,s)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=To(e);let o=0,s=this.ids.length-1;for(;o<s;){const h=o+s>>1;this.ids[h]>=r?s=h:o=h+1}const u=[];for(;this.ids[o]===r;)u.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return u}static serialize(e,r){const o=new Float64Array(e.ids),s=new Uint32Array(e.positions);return ro(o,s,0,o.length-1),r&&r.push(o.buffer,s.buffer),{ids:o,positions:s}}static deserialize(e){const r=new Yi;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function To(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Ai(String(i))}function ro(i,e,r,o){for(;r<o;){const s=i[r+o>>1];let u=r-1,h=o+1;for(;;){do u++;while(i[u]<s);do h--;while(i[h]>s);if(u>=h)break;Kn(i,u,h),Kn(e,3*u,3*h),Kn(e,3*u+1,3*h+1),Kn(e,3*u+2,3*h+2)}h-r<o-h?(ro(i,e,r,h),r=h+1):(ro(i,e,h+1,o),o=h)}}function Kn(i,e,r){const o=i[e];i[e]=i[r],i[r]=o}Zt("FeaturePositionMap",Yi);class fn{constructor(e,r){this.gl=e.gl,this.location=r}}class Wo extends fn{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Ps extends fn{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Xo extends fn{constructor(e,r){super(e,r),this.current=Lr.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const kn=new Float32Array(16);function Qn(i){return[Mr(255*i.r,255*i.g),Mr(255*i.b,255*i.a)]}class jn{constructor(e,r,o){this.value=e,this.uniformNames=r.map((s=>`u_${s}`)),this.type=o}setUniform(e,r,o){e.set(o.constantOr(this.value))}getBinding(e,r,o){return this.type==="color"?new Xo(e,r):new Wo(e,r)}}class Un{constructor(e,r){this.uniformNames=r.map((o=>`u_${o}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setConstantDashPositions(e,r){this.dashTo=[0,e.y,e.height,e.width],this.dashFrom=[0,r.y,r.height,r.width]}setUniform(e,r,o,s){let u=null;s==="u_pattern_to"?u=this.patternTo:s==="u_pattern_from"?u=this.patternFrom:s==="u_dasharray_to"?u=this.dashTo:s==="u_dasharray_from"?u=this.dashFrom:s==="u_pixel_ratio_to"?u=this.pixelRatioTo:s==="u_pixel_ratio_from"&&(u=this.pixelRatioFrom),u!==null&&e.set(u)}getBinding(e,r,o){return o.substr(0,9)==="u_pattern"||o.substr(0,12)==="u_dasharray_"?new Ps(e,r):new Wo(e,r)}}class ai{constructor(e,r,o,s){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=r.map((u=>({name:`a_${u}`,type:"Float32",components:o==="color"?2:1,offset:0}))),this.paintVertexArray=new s}populatePaintArray(e,r,o){const s=this.paintVertexArray.length,u=this.expression.evaluate(new $r(0,o),r,{},o.canonical,[],o.formattedSection);this.paintVertexArray.resize(e),this._setPaintValue(s,e,u)}updatePaintArray(e,r,o,s,u){const h=this.expression.evaluate(new $r(0,u),o,s);this._setPaintValue(e,r,h)}_setPaintValue(e,r,o){if(this.type==="color"){const s=Qn(o);for(let u=e;u<r;u++)this.paintVertexArray.emplace(u,s[0],s[1])}else{for(let s=e;s<r;s++)this.paintVertexArray.emplace(s,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ni{constructor(e,r,o,s,u,h){this.expression=e,this.uniformNames=r.map((f=>`u_${f}_t`)),this.type=o,this.useIntegerZoom=s,this.zoom=u,this.maxValue=0,this.paintVertexAttributes=r.map((f=>({name:`a_${f}`,type:"Float32",components:o==="color"?4:2,offset:0}))),this.paintVertexArray=new h}populatePaintArray(e,r,o){const s=this.expression.evaluate(new $r(this.zoom,o),r,{},o.canonical,[],o.formattedSection),u=this.expression.evaluate(new $r(this.zoom+1,o),r,{},o.canonical,[],o.formattedSection),h=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(h,e,s,u)}updatePaintArray(e,r,o,s,u){const h=this.expression.evaluate(new $r(this.zoom,u),o,s),f=this.expression.evaluate(new $r(this.zoom+1,u),o,s);this._setPaintValue(e,r,h,f)}_setPaintValue(e,r,o,s){if(this.type==="color"){const u=Qn(o),h=Qn(s);for(let f=e;f<r;f++)this.paintVertexArray.emplace(f,u[0],u[1],h[0],h[1])}else{for(let u=e;u<r;u++)this.paintVertexArray.emplace(u,o,s);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const o=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,s=De(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(s)}getBinding(e,r,o){return new Wo(e,r)}}class Bi{constructor(e,r,o,s,u,h){this.expression=e,this.type=r,this.useIntegerZoom=o,this.zoom=s,this.layerId=h,this.zoomInPaintVertexArray=new u,this.zoomOutPaintVertexArray=new u}populatePaintArray(e,r,o){const s=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(s,e,this.getPositionIds(r),o)}updatePaintArray(e,r,o,s,u){this._setPaintValues(e,r,this.getPositionIds(o),u)}_setPaintValues(e,r,o,s){const u=this.getPositions(s);if(!u||!o)return;const h=u[o.min],f=u[o.mid],g=u[o.max];if(h&&f&&g)for(let y=e;y<r;y++)this.emplace(this.zoomInPaintVertexArray,y,f,h),this.emplace(this.zoomOutPaintVertexArray,y,f,g)}upload(e){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const r=this.getVertexAttributes();this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,r,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,r,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ni extends Bi{getPositions(e){return e.imagePositions}getPositionIds(e){return e.patterns&&e.patterns[this.layerId]}getVertexAttributes(){return Qr.members}emplace(e,r,o,s){e.emplace(r,o.tlbr[0],o.tlbr[1],o.tlbr[2],o.tlbr[3],s.tlbr[0],s.tlbr[1],s.tlbr[2],s.tlbr[3],o.pixelRatio,s.pixelRatio)}}class xh extends Bi{getPositions(e){return e.dashPositions}getPositionIds(e){return e.dashes&&e.dashes[this.layerId]}getVertexAttributes(){return ci.members}emplace(e,r,o,s){e.emplace(r,0,o.y,o.height,o.width,0,s.y,s.height,s.width)}}class bh{constructor(e,r,o){this.binders={},this._buffers=[];const s=[];for(const u in e.paint._values){if(!o(u))continue;const h=e.paint.get(u);if(!(h instanceof Vn&&wa(h.property.specification)))continue;const f=Dd(u,e.type),g=h.value,y=h.property.specification.type,b=h.property.useIntegerZoom,C=h.property.specification["property-type"],M=C==="cross-faded"||C==="cross-faded-data-driven";if(g.kind==="constant")this.binders[u]=M?new Un(g.value,f):new jn(g.value,f,y),s.push(`/u_${u}`);else if(g.kind==="source"||M){const E=wh(u,y,"source");this.binders[u]=M?u==="line-dasharray"?new xh(g,y,b,r,E,e.id):new Ni(g,y,b,r,E,e.id):new ai(g,f,y,E),s.push(`/a_${u}`)}else{const E=wh(u,y,"composite");this.binders[u]=new ni(g,f,y,b,r,E),s.push(`/z_${u}`)}}this.cacheKey=s.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof ai||r instanceof ni?r.maxValue:0}populatePaintArrays(e,r,o){for(const s in this.binders){const u=this.binders[s];(u instanceof ai||u instanceof ni||u instanceof Bi)&&u.populatePaintArray(e,r,o)}}setConstantPatternPositions(e,r){for(const o in this.binders){const s=this.binders[o];s instanceof Un&&s.setConstantPatternPositions(e,r)}}setConstantDashPositions(e,r){for(const o in this.binders){const s=this.binders[o];s instanceof Un&&s.setConstantDashPositions(e,r)}}updatePaintArrays(e,r,o,s,u){let h=!1;for(const f in e){const g=r.getPositions(f);for(const y of g){const b=o.feature(y.index);for(const C in this.binders){const M=this.binders[C];if((M instanceof ai||M instanceof ni||M instanceof Bi)&&M.expression.isStateDependent===!0){const E=s.paint.get(C);M.expression=E.value,M.updatePaintArray(y.start,y.end,b,e[f],u),h=!0}}}}return h}defines(){const e=[];for(const r in this.binders){const o=this.binders[r];(o instanceof jn||o instanceof Un)&&e.push(...o.uniformNames.map((s=>`#define HAS_UNIFORM_${s}`)))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof ai||o instanceof ni)for(let s=0;s<o.paintVertexAttributes.length;s++)e.push(o.paintVertexAttributes[s].name);else if(o instanceof Bi){const s=o.getVertexAttributes();for(const u of s)e.push(u.name)}}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof jn||o instanceof Un||o instanceof ni)for(const s of o.uniformNames)e.push(s)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const o=[];for(const s in this.binders){const u=this.binders[s];if(u instanceof jn||u instanceof Un||u instanceof ni){for(const h of u.uniformNames)if(r[h]){const f=u.getBinding(e,r[h],h);o.push({name:h,property:s,binding:f})}}}return o}setUniforms(e,r,o,s){for(const{name:u,property:h,binding:f}of r)this.binders[h].setUniform(f,s,o.get(h),u)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const o=this.binders[r];if(e&&o instanceof Bi){const s=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;s&&this._buffers.push(s)}else(o instanceof ai||o instanceof ni)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const r in this.binders){const o=this.binders[r];(o instanceof ai||o instanceof ni||o instanceof Bi)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof ai||r instanceof ni||r instanceof Bi)&&r.destroy()}}}class Yo{constructor(e,r,o=()=>!0){this.programConfigurations={};for(const s of e)this.programConfigurations[s.id]=new bh(s,r,o);this.needsUpload=!1,this._featureMap=new Yi,this._bufferOffset=0}populatePaintArrays(e,r,o,s){for(const u in this.programConfigurations)this.programConfigurations[u].populatePaintArrays(e,r,s);r.id!==void 0&&this._featureMap.add(r.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,o,s){for(const u of o)this.needsUpload=this.programConfigurations[u.id].updatePaintArrays(e,this._featureMap,r,u,s)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Dd(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function wh(i,e,r){const o={color:{source:ws,composite:n},number:{source:xl,composite:ws}},s=(function(u){return{"line-pattern":{source:he,composite:he},"fill-pattern":{source:he,composite:he},"fill-extrusion-pattern":{source:he,composite:he},"line-dasharray":{source:ve,composite:ve}}[u]})(i);return s&&s[r]||o[e][r]}Zt("ConstantBinder",jn),Zt("CrossFadedConstantBinder",Un),Zt("SourceExpressionBinder",ai),Zt("CrossFadedPatternBinder",Ni),Zt("CrossFadedDasharrayBinder",xh),Zt("CompositeExpressionBinder",ni),Zt("ProgramConfiguration",bh,{omit:["_buffers"]}),Zt("ProgramConfigurationSet",Yo);const qc=Math.pow(2,14)-1,Co=-qc-1;function So(i){const e=Ce/i.extent,r=i.loadGeometry();for(let o=0;o<r.length;o++){const s=r[o];for(let u=0;u<s.length;u++){const h=s[u],f=Math.round(h.x*e),g=Math.round(h.y*e);h.x=De(f,Co,qc),h.y=De(g,Co,qc),(f<h.x||f>h.x+1||g<h.y||g>h.y+1)&&Yt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Po(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?So(i):[]}}const Zc=-32768;function Hc(i,e,r,o,s){i.emplaceBack(Zc+8*e+o,Zc+8*r+s)}class wl{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new Y,this.indexArray=new Ye,this.segments=new Nt,this.programConfigurations=new Yo(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(e,r,o){const s=this.layers[0],u=[];let h=null,f=!1,g=s.type==="heatmap";if(s.type==="circle"){const b=s;h=b.layout.get("circle-sort-key"),f=!h.isConstant(),g=g||b.paint.get("circle-pitch-alignment")==="map"}const y=g?r.subdivisionGranularity.circle:1;for(const{feature:b,id:C,index:M,sourceLayerIndex:E}of e){const z=this.layers[0]._featureFilter.needGeometry,D=Po(b,z);if(!this.layers[0]._featureFilter.filter(new $r(this.zoom),D,o))continue;const F=f?h.evaluate(D,{},o):void 0,j={id:C,properties:b.properties,type:b.type,sourceLayerIndex:E,index:M,geometry:z?D.geometry:So(b),patterns:{},sortKey:F};u.push(j)}f&&u.sort(((b,C)=>b.sortKey-C.sortKey));for(const b of u){const{geometry:C,index:M,sourceLayerIndex:E}=b,z=e[M].feature;this.addFeature(b,C,M,o,y),r.featureIndex.insert(z,C,M,E,this.index)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,yt),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,o,s,u=1){let h;switch(u){case 1:h=[0,7];break;case 3:h=[0,2,5,7];break;case 5:h=[0,1,3,4,6,7];break;case 7:h=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${u}; valid values are 1, 3, 5, 7.`)}const f=h.length;for(const g of r)for(const y of g){const b=y.x,C=y.y;if(b<0||b>=Ce||C<0||C>=Ce)continue;const M=this.segments.prepareSegment(f*f,this.layoutVertexArray,this.indexArray,e.sortKey),E=M.vertexLength;for(let z=0;z<f;z++)for(let D=0;D<f;D++)Hc(this.layoutVertexArray,b,C,h[D],h[z]);for(let z=0;z<f-1;z++)for(let D=0;D<f-1;D++){const F=E+z*f+D,j=E+(z+1)*f+D;this.indexArray.emplaceBack(F,j+1,F+1),this.indexArray.emplaceBack(F,j,j+1)}M.vertexLength+=f*f,M.primitiveLength+=(f-1)*(f-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:{},canonical:s})}}function Tl(i,e){for(let r=0;r<i.length;r++)if(Cl(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Cl(i,e[r]))return!0;return!!Ld(i,e)}function Th(i,e,r){return!!Cl(i,e)||!!Rd(e,i,r)}function Kp(i,e){if(i.length===1)return Jp(e,i[0]);for(let r=0;r<e.length;r++){const o=e[r];for(let s=0;s<o.length;s++)if(Cl(i,o[s]))return!0}for(let r=0;r<i.length;r++)if(Jp(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Ld(i,e[r]))return!0;return!1}function a_(i,e,r){if(i.length>1){if(Ld(i,e))return!0;for(let o=0;o<e.length;o++)if(Rd(e[o],i,r))return!0}for(let o=0;o<i.length;o++)if(Rd(i[o],e,r))return!0;return!1}function Ld(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const o=i[r],s=i[r+1];for(let u=0;u<e.length-1;u++)if(s_(o,s,e[u],e[u+1]))return!0}return!1}function s_(i,e,r,o){return Tr(i,r,o)!==Tr(e,r,o)&&Tr(i,e,r)!==Tr(i,e,o)}function Rd(i,e,r){const o=r*r;if(e.length===1)return i.distSqr(e[0])<o;for(let s=1;s<e.length;s++)if(Qp(i,e[s-1],e[s])<o)return!0;return!1}function Qp(i,e,r){const o=e.distSqr(r);if(o===0)return i.distSqr(e);const s=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/o;return i.distSqr(s<0?e:s>1?r:r.sub(e)._mult(s)._add(e))}function Jp(i,e){let r,o,s,u=!1;for(let h=0;h<i.length;h++){r=i[h];for(let f=0,g=r.length-1;f<r.length;g=f++)o=r[f],s=r[g],o.y>e.y!=s.y>e.y&&e.x<(s.x-o.x)*(e.y-o.y)/(s.y-o.y)+o.x&&(u=!u)}return u}function Cl(i,e){let r=!1;for(let o=0,s=i.length-1;o<i.length;s=o++){const u=i[o],h=i[s];u.y>e.y!=h.y>e.y&&e.x<(h.x-u.x)*(e.y-u.y)/(h.y-u.y)+u.x&&(r=!r)}return r}function l_(i,e,r){const o=r[0],s=r[2];if(i.x<o.x&&e.x<o.x||i.x>s.x&&e.x>s.x||i.y<o.y&&e.y<o.y||i.y>s.y&&e.y>s.y)return!1;const u=Tr(i,e,r[0]);return u!==Tr(i,e,r[1])||u!==Tr(i,e,r[2])||u!==Tr(i,e,r[3])}function Sl(i,e,r){const o=e.paint.get(i).value;return o.kind==="constant"?o.value:r.programConfigurations.get(e.id).getMaxValue(i)}function Ch(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Sh(i,e,r,o,s){if(!e[0]&&!e[1])return i;const u=q.convert(e)._mult(s);r==="viewport"&&u._rotate(-o);const h=[];for(let f=0;f<i.length;f++)h.push(i[f].sub(u));return h}function c_(i){const e=[];for(let r=0;r<i.length;r++){const o=i[r],s=e.at(-1);(r===0||s&&!o.equals(s))&&e.push(o)}return e}function u_({queryGeometry:i,size:e},r){return Th(i,r,e)}function h_({queryGeometry:i,size:e,transform:r,unwrappedTileID:o,getElevation:s},u){return Th(i,u,e*(r.projectTileCoordinates(u.x,u.y,o,s).signedDistanceFromCamera/r.cameraToCenterDistance))}function d_({queryGeometry:i,size:e,transform:r,unwrappedTileID:o,getElevation:s},u){const h=r.projectTileCoordinates(u.x,u.y,o,s).signedDistanceFromCamera,f=e*(r.cameraToCenterDistance/h);return Th(i,Fd(u,r,o,s),f)}function p_({queryGeometry:i,size:e,transform:r,unwrappedTileID:o,getElevation:s},u){return Th(i,Fd(u,r,o,s),e)}function $p({queryGeometry:i,size:e,transform:r,unwrappedTileID:o,getElevation:s,pitchAlignment:u="map",pitchScale:h="map"},f){const g=u==="map"?h==="map"?u_:h_:h==="map"?d_:p_,y={queryGeometry:i,size:e,transform:r,unwrappedTileID:o,getElevation:s};for(const b of f)for(const C of b)if(g(y,C))return!0;return!1}function Fd(i,e,r,o){const s=e.projectTileCoordinates(i.x,i.y,r,o).point;return new q((.5*s.x+.5)*e.width,(.5*-s.y+.5)*e.height)}let ef,tf;Zt("CircleBucket",wl,{omit:["layers"]});var f_={get paint(){return tf=tf||new un({"circle-radius":new sr(pe.paint_circle["circle-radius"]),"circle-color":new sr(pe.paint_circle["circle-color"]),"circle-blur":new sr(pe.paint_circle["circle-blur"]),"circle-opacity":new sr(pe.paint_circle["circle-opacity"]),"circle-translate":new Jt(pe.paint_circle["circle-translate"]),"circle-translate-anchor":new Jt(pe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Jt(pe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Jt(pe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new sr(pe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new sr(pe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new sr(pe.paint_circle["circle-stroke-opacity"])})},get layout(){return ef=ef||new un({"circle-sort-key":new sr(pe.layout_circle["circle-sort-key"])})}};class m_ extends An{constructor(e,r){super(e,f_,r)}createBucket(e){return new wl(e)}queryRadius(e){const r=e;return Sl("circle-radius",this,r)+Sl("circle-stroke-width",this,r)+Ch(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:o,geometry:s,transform:u,pixelsToTileUnits:h,unwrappedTileID:f,getElevation:g}){const y=Sh(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-u.bearingInRadians,h),b=this.paint.get("circle-radius").evaluate(r,o)+this.paint.get("circle-stroke-width").evaluate(r,o),C=this.paint.get("circle-pitch-scale"),M=this.paint.get("circle-pitch-alignment");let E,z;return M==="map"?(E=y,z=b*h):(E=(function(D,F,j,J){return D.map((U=>Fd(U,F,j,J)))})(y,u,f,g),z=b),$p({queryGeometry:E,size:z,transform:u,unwrappedTileID:f,getElevation:g,pitchAlignment:M,pitchScale:C},s)}}class rf extends wl{}let nf;Zt("HeatmapBucket",rf,{omit:["layers"]});var g_={get paint(){return nf=nf||new un({"heatmap-radius":new sr(pe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new sr(pe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Jt(pe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ml(pe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Jt(pe.paint_heatmap["heatmap-opacity"])})}};function Od(i,{width:e,height:r},o,s){if(s){if(s instanceof Uint8ClampedArray)s=new Uint8Array(s.buffer);else if(s.length!==e*r*o)throw new RangeError(`mismatched image size. expected: ${s.length} but got: ${e*r*o}`)}else s=new Uint8Array(e*r*o);return i.width=e,i.height=r,i.data=s,i}function of(i,{width:e,height:r},o){if(e===i.width&&r===i.height)return;const s=Od({},{width:e,height:r},o);Bd(i,s,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},o),i.width=e,i.height=r,i.data=s.data}function Bd(i,e,r,o,s,u){if(s.width===0||s.height===0)return e;if(s.width>i.width||s.height>i.height||r.x>i.width-s.width||r.y>i.height-s.height)throw new RangeError("out of range source coordinates for image copy");if(s.width>e.width||s.height>e.height||o.x>e.width-s.width||o.y>e.height-s.height)throw new RangeError("out of range destination coordinates for image copy");const h=i.data,f=e.data;if(h===f)throw new Error("srcData equals dstData, so image is already copied");for(let g=0;g<s.height;g++){const y=((r.y+g)*i.width+r.x)*u,b=((o.y+g)*e.width+o.x)*u;for(let C=0;C<s.width*u;C++)f[b+C]=h[y+C]}return e}class Wc{constructor(e,r){Od(this,e,1,r)}resize(e){of(this,e,1)}clone(){return new Wc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,o,s,u){Bd(e,r,o,s,u,1)}}class wn{constructor(e,r){Od(this,e,4,r)}resize(e){of(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new wn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,o,s,u){Bd(e,r,o,s,u,4)}setPixel(e,r,o){const s=4*(e*this.width+r);this.data[s+0]=Math.round(255*o.r/o.a),this.data[s+1]=Math.round(255*o.g/o.a),this.data[s+2]=Math.round(255*o.b/o.a),this.data[s+3]=Math.round(255*o.a)}}function af(i){const e={},r=i.resolution||256,o=i.clips?i.clips.length:1,s=i.image||new wn({width:r,height:o});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const u=(h,f,g)=>{e[i.evaluationKey]=g;const y=i.expression.evaluate(e);s.setPixel(h/4/r,f/4,y)};if(i.clips)for(let h=0,f=0;h<o;++h,f+=4*r)for(let g=0,y=0;g<r;g++,y+=4){const b=g/(r-1),{start:C,end:M}=i.clips[h];u(f,y,C*(1-b)+M*b)}else for(let h=0,f=0;h<r;h++,f+=4)u(0,f,h/(r-1));return s}Zt("AlphaImage",Wc),Zt("RGBAImage",wn);const Nd="big-fb";class __ extends An{createBucket(e){return new rf(e)}constructor(e,r){super(e,g_,r),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=af({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Nd)&&this.heatmapFbos.delete(Nd)}queryRadius(e){return Sl("heatmap-radius",this,e)}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:o,geometry:s,transform:u,pixelsToTileUnits:h,unwrappedTileID:f,getElevation:g}){return $p({queryGeometry:e,size:this.paint.get("heatmap-radius").evaluate(r,o)*h,transform:u,unwrappedTileID:f,getElevation:g},s)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&!this.isHidden()}}let sf;var v_={get paint(){return sf=sf||new un({"hillshade-illumination-direction":new Jt(pe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Jt(pe.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Jt(pe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Jt(pe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Jt(pe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Jt(pe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Jt(pe.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Jt(pe.paint_hillshade["hillshade-method"])})}};class y_ extends An{constructor(e,r){super(e,v_,r),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,r=this.paint.get("hillshade-illumination-altitude").values,o=this.paint.get("hillshade-highlight-color").values,s=this.paint.get("hillshade-shadow-color").values;const u=Math.max(e.length,r.length,o.length,s.length);e=e.concat(Array(u-e.length).fill(e.at(-1))),r=r.concat(Array(u-r.length).fill(r.at(-1))),o=o.concat(Array(u-o.length).fill(o.at(-1))),s=s.concat(Array(u-s.length).fill(s.at(-1)));const h=r.map(Ar);return{directionRadians:e.map(Ar),altitudeRadians:h,shadowColor:s,highlightColor:o}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&!this.isHidden()}}let lf;var x_={get paint(){return lf=lf||new un({"color-relief-opacity":new Jt(pe["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new ml(pe["paint_color-relief"]["color-relief-color"])})}};class Vd{constructor(e,r,o,s){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(r,s)}update(e,r,o){const{width:s,height:u}=e,h=!(this.size&&this.size[0]===s&&this.size[1]===u||o),{context:f}=this,{gl:g}=f;if(this.useMipmap=!!(r&&r.useMipmap),g.bindTexture(g.TEXTURE_2D,this.texture),f.pixelStoreUnpackFlipY.set(!1),f.pixelStoreUnpack.set(1),f.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA&&(!r||r.premultiply!==!1)),h)this.size=[s,u],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Xt(e)?g.texImage2D(g.TEXTURE_2D,0,this.format,this.format,g.UNSIGNED_BYTE,e):g.texImage2D(g.TEXTURE_2D,0,this.format,s,u,0,this.format,g.UNSIGNED_BYTE,e.data);else{const{x:y,y:b}=o||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Xt(e)?g.texSubImage2D(g.TEXTURE_2D,0,y,b,g.RGBA,g.UNSIGNED_BYTE,e):g.texSubImage2D(g.TEXTURE_2D,0,y,b,s,u,g.RGBA,g.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&g.generateMipmap(g.TEXTURE_2D),f.pixelStoreUnpackFlipY.setDefault(),f.pixelStoreUnpack.setDefault(),f.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,r,o){const{context:s}=this,{gl:u}=s;u.bindTexture(u.TEXTURE_2D,this.texture),o!==u.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=u.LINEAR),e!==this.filter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,o||e),this.filter=e),r!==this.wrap&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,r),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class cf{constructor(e,r,o,s=1,u=1,h=1,f=0){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void Yt(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const g=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=s,this.greenFactor=u,this.blueFactor=h,this.baseShift=f;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let y=0;y<g;y++)this.data[this._idx(-1,y)]=this.data[this._idx(0,y)],this.data[this._idx(g,y)]=this.data[this._idx(g-1,y)],this.data[this._idx(y,-1)]=this.data[this._idx(y,0)],this.data[this._idx(y,g)]=this.data[this._idx(y,g-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(g,-1)]=this.data[this._idx(g-1,0)],this.data[this._idx(-1,g)]=this.data[this._idx(0,g-1)],this.data[this._idx(g,g)]=this.data[this._idx(g-1,g-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let y=0;y<g;y++)for(let b=0;b<g;b++){const C=this.get(y,b);C>this.max&&(this.max=C),C<this.min&&(this.min=C)}}get(e,r){const o=new Uint8Array(this.data.buffer),s=4*this._idx(e,r);return this.unpack(o[s],o[s+1],o[s+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError(`Out of range source coordinates for DEM data. x: ${e}, y: ${r}, dim: ${this.dim}`);return(r+1)*this.stride+(e+1)}unpack(e,r,o){return e*this.redFactor+r*this.greenFactor+o*this.blueFactor-this.baseShift}pack(e){return uf(e,this.getUnpackVector())}getPixels(){return new wn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let s=r*this.dim,u=r*this.dim+this.dim,h=o*this.dim,f=o*this.dim+this.dim;switch(r){case-1:s=u-1;break;case 1:u=s+1}switch(o){case-1:h=f-1;break;case 1:f=h+1}const g=-r*this.dim,y=-o*this.dim;for(let b=h;b<f;b++)for(let C=s;C<u;C++)this.data[this._idx(C,b)]=e.data[this._idx(C+g,b+y)]}}function uf(i,e){const r=e[0],o=e[1],s=e[2],u=e[3],h=Math.min(r,o,s),f=Math.round((i+u)/h);return{r:Math.floor(f*h/r)%256,g:Math.floor(f*h/o)%256,b:Math.floor(f*h/s)%256}}Zt("DEMData",cf);class b_ extends An{constructor(e,r){super(e,x_,r)}_createColorRamp(e){const r={elevationStops:[],colorStops:[]},o=this._transitionablePaint._values["color-relief-color"].value.expression;if(o instanceof rl&&o._styleExpression.expression instanceof cn){this.colorRampExpression=o;const h=o._styleExpression.expression;r.elevationStops=h.labels,r.colorStops=[];for(const f of r.elevationStops)r.colorStops.push(h.evaluate({globals:{elevation:f}}))}if(r.elevationStops.length<1&&(r.elevationStops=[0],r.colorStops=[Lr.transparent]),r.elevationStops.length<2&&(r.elevationStops.push(r.elevationStops[0]+1),r.colorStops.push(r.colorStops[0])),r.elevationStops.length<=e)return r;const s={elevationStops:[],colorStops:[]},u=(r.elevationStops.length-1)/(e-1);for(let h=0;h<r.elevationStops.length-.5;h+=u)s.elevationStops.push(r.elevationStops[Math.round(h)]),s.colorStops.push(r.colorStops[Math.round(h)]);return Yt(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${e}, provided: ${r.elevationStops.length}`),s}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(e,r,o){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const s=this._createColorRamp(r),u=new wn({width:s.colorStops.length,height:1}),h=new wn({width:s.colorStops.length,height:1});for(let f=0;f<s.elevationStops.length;f++){const g=uf(s.elevationStops[f],o);h.setPixel(0,f,new Lr(g.r/255,g.g/255,g.b/255,1)),u.setPixel(0,f,s.colorStops[f])}return this.colorRampTextures={elevationTexture:new Vd(e,h,e.gl.RGBA),colorTexture:new Vd(e,u,e.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return!this.isHidden()&&!!this.colorRampTextures}}const w_=Ei([{name:"a_pos",components:2,type:"Int16"}],4),{members:T_}=w_;function Ph(i,e,r){const o=r.patternDependencies;let s=!1;for(const u of e){const h=u.paint.get(`${i}-pattern`);h.isConstant()||(s=!0);const f=h.constantOr(null);f&&(s=!0,o[f.to]=!0,o[f.from]=!0)}return s}function jd(i,e,r,o,s){const{zoom:u}=o,h=s.patternDependencies;for(const f of e){const g=f.paint.get(`${i}-pattern`).value;if(g.kind!=="constant"){let y=g.evaluate({zoom:u-1},r,{},s.availableImages),b=g.evaluate({zoom:u},r,{},s.availableImages),C=g.evaluate({zoom:u+1},r,{},s.availableImages);y=y&&y.name?y.name:y,b=b&&b.name?b.name:b,C=C&&C.name?C.name:C,h[y]=!0,h[b]=!0,h[C]=!0,r.patterns[f.id]={min:y,mid:b,max:C}}}return r}function hf(i,e,r,o,s){let u;if(s===(function(h,f,g,y){let b=0;for(let C=f,M=g-y;C<g;C+=y)b+=(h[M]-h[C])*(h[C+1]+h[M+1]),M=C;return b})(i,e,r,o)>0)for(let h=e;h<r;h+=o)u=mf(h/o|0,i[h],i[h+1],u);else for(let h=r-o;h>=e;h-=o)u=mf(h/o|0,i[h],i[h+1],u);return u&&Pl(u,u.next)&&(Qc(u),u=u.next),u}function Is(i,e){if(!i)return i;e||(e=i);let r,o=i;do if(r=!1,o.steiner||!Pl(o,o.next)&&Li(o.prev,o,o.next)!==0)o=o.next;else{if(Qc(o),o=e=o.prev,o===o.next)break;r=!0}while(r||o!==e);return e}function Xc(i,e,r,o,s,u,h){if(!i)return;!h&&u&&(function(g,y,b,C){let M=g;do M.z===0&&(M.z=Ud(M.x,M.y,y,b,C)),M.prevZ=M.prev,M.nextZ=M.next,M=M.next;while(M!==g);M.prevZ.nextZ=null,M.prevZ=null,(function(E){let z,D=1;do{let F,j=E;E=null;let J=null;for(z=0;j;){z++;let U=j,H=0;for(let ge=0;ge<D&&(H++,U=U.nextZ,U);ge++);let re=D;for(;H>0||re>0&&U;)H!==0&&(re===0||!U||j.z<=U.z)?(F=j,j=j.nextZ,H--):(F=U,U=U.nextZ,re--),J?J.nextZ=F:E=F,F.prevZ=J,J=F;j=U}J.nextZ=null,D*=2}while(z>1)})(M)})(i,o,s,u);let f=i;for(;i.prev!==i.next;){const g=i.prev,y=i.next;if(u?S_(i,o,s,u):C_(i))e.push(g.i,i.i,y.i),Qc(i),i=y.next,f=y.next;else if((i=y)===f){h?h===1?Xc(i=P_(Is(i),e),e,r,o,s,u,2):h===2&&I_(i,e,r,o,s,u):Xc(Is(i),e,r,o,s,u,1);break}}}function C_(i){const e=i.prev,r=i,o=i.next;if(Li(e,r,o)>=0)return!1;const s=e.x,u=r.x,h=o.x,f=e.y,g=r.y,y=o.y,b=Math.min(s,u,h),C=Math.min(f,g,y),M=Math.max(s,u,h),E=Math.max(f,g,y);let z=o.next;for(;z!==e;){if(z.x>=b&&z.x<=M&&z.y>=C&&z.y<=E&&Yc(s,f,u,g,h,y,z.x,z.y)&&Li(z.prev,z,z.next)>=0)return!1;z=z.next}return!0}function S_(i,e,r,o){const s=i.prev,u=i,h=i.next;if(Li(s,u,h)>=0)return!1;const f=s.x,g=u.x,y=h.x,b=s.y,C=u.y,M=h.y,E=Math.min(f,g,y),z=Math.min(b,C,M),D=Math.max(f,g,y),F=Math.max(b,C,M),j=Ud(E,z,e,r,o),J=Ud(D,F,e,r,o);let U=i.prevZ,H=i.nextZ;for(;U&&U.z>=j&&H&&H.z<=J;){if(U.x>=E&&U.x<=D&&U.y>=z&&U.y<=F&&U!==s&&U!==h&&Yc(f,b,g,C,y,M,U.x,U.y)&&Li(U.prev,U,U.next)>=0||(U=U.prevZ,H.x>=E&&H.x<=D&&H.y>=z&&H.y<=F&&H!==s&&H!==h&&Yc(f,b,g,C,y,M,H.x,H.y)&&Li(H.prev,H,H.next)>=0))return!1;H=H.nextZ}for(;U&&U.z>=j;){if(U.x>=E&&U.x<=D&&U.y>=z&&U.y<=F&&U!==s&&U!==h&&Yc(f,b,g,C,y,M,U.x,U.y)&&Li(U.prev,U,U.next)>=0)return!1;U=U.prevZ}for(;H&&H.z<=J;){if(H.x>=E&&H.x<=D&&H.y>=z&&H.y<=F&&H!==s&&H!==h&&Yc(f,b,g,C,y,M,H.x,H.y)&&Li(H.prev,H,H.next)>=0)return!1;H=H.nextZ}return!0}function P_(i,e){let r=i;do{const o=r.prev,s=r.next.next;!Pl(o,s)&&pf(o,r,r.next,s)&&Kc(o,s)&&Kc(s,o)&&(e.push(o.i,r.i,s.i),Qc(r),Qc(r.next),r=i=s),r=r.next}while(r!==i);return Is(r)}function I_(i,e,r,o,s,u){let h=i;do{let f=h.next.next;for(;f!==h.prev;){if(h.i!==f.i&&z_(h,f)){let g=ff(h,f);return h=Is(h,h.next),g=Is(g,g.next),Xc(h,e,r,o,s,u,0),void Xc(g,e,r,o,s,u,0)}f=f.next}h=h.next}while(h!==i)}function M_(i,e){let r=i.x-e.x;return r===0&&(r=i.y-e.y,r===0)&&(r=(i.next.y-i.y)/(i.next.x-i.x)-(e.next.y-e.y)/(e.next.x-e.x)),r}function E_(i,e){const r=(function(s,u){let h=u;const f=s.x,g=s.y;let y,b=-1/0;if(Pl(s,h))return h;do{if(Pl(s,h.next))return h.next;if(g<=h.y&&g>=h.next.y&&h.next.y!==h.y){const D=h.x+(g-h.y)*(h.next.x-h.x)/(h.next.y-h.y);if(D<=f&&D>b&&(b=D,y=h.x<h.next.x?h:h.next,D===f))return y}h=h.next}while(h!==u);if(!y)return null;const C=y,M=y.x,E=y.y;let z=1/0;h=y;do{if(f>=h.x&&h.x>=M&&f!==h.x&&df(g<E?f:b,g,M,E,g<E?b:f,g,h.x,h.y)){const D=Math.abs(g-h.y)/(f-h.x);Kc(h,s)&&(D<z||D===z&&(h.x>y.x||h.x===y.x&&A_(y,h)))&&(y=h,z=D)}h=h.next}while(h!==C);return y})(i,e);if(!r)return e;const o=ff(r,i);return Is(o,o.next),Is(r,r.next)}function A_(i,e){return Li(i.prev,i,e.prev)<0&&Li(e.next,i,i.next)<0}function Ud(i,e,r,o,s){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*s|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*s|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function k_(i){let e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function df(i,e,r,o,s,u,h,f){return(s-h)*(e-f)>=(i-h)*(u-f)&&(i-h)*(o-f)>=(r-h)*(e-f)&&(r-h)*(u-f)>=(s-h)*(o-f)}function Yc(i,e,r,o,s,u,h,f){return!(i===h&&e===f)&&df(i,e,r,o,s,u,h,f)}function z_(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!(function(r,o){let s=r;do{if(s.i!==r.i&&s.next.i!==r.i&&s.i!==o.i&&s.next.i!==o.i&&pf(s,s.next,r,o))return!0;s=s.next}while(s!==r);return!1})(i,e)&&(Kc(i,e)&&Kc(e,i)&&(function(r,o){let s=r,u=!1;const h=(r.x+o.x)/2,f=(r.y+o.y)/2;do s.y>f!=s.next.y>f&&s.next.y!==s.y&&h<(s.next.x-s.x)*(f-s.y)/(s.next.y-s.y)+s.x&&(u=!u),s=s.next;while(s!==r);return u})(i,e)&&(Li(i.prev,i,e.prev)||Li(i,e.prev,e))||Pl(i,e)&&Li(i.prev,i,i.next)>0&&Li(e.prev,e,e.next)>0)}function Li(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function Pl(i,e){return i.x===e.x&&i.y===e.y}function pf(i,e,r,o){const s=Mh(Li(i,e,r)),u=Mh(Li(i,e,o)),h=Mh(Li(r,o,i)),f=Mh(Li(r,o,e));return s!==u&&h!==f||!(s!==0||!Ih(i,r,e))||!(u!==0||!Ih(i,o,e))||!(h!==0||!Ih(r,i,o))||!(f!==0||!Ih(r,e,o))}function Ih(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function Mh(i){return i>0?1:i<0?-1:0}function Kc(i,e){return Li(i.prev,i,i.next)<0?Li(i,e,i.next)>=0&&Li(i,i.prev,e)>=0:Li(i,e,i.prev)<0||Li(i,i.next,e)<0}function ff(i,e){const r=Gd(i.i,i.x,i.y),o=Gd(e.i,e.x,e.y),s=i.next,u=e.prev;return i.next=e,e.prev=i,r.next=s,s.prev=r,o.next=r,r.prev=o,u.next=o,o.prev=u,o}function mf(i,e,r,o){const s=Gd(i,e,r);return o?(s.next=o.next,s.prev=o,o.next.prev=s,o.next=s):(s.prev=s,s.next=s),s}function Qc(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Gd(i,e,r){return{i,x:e,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Il{constructor(e,r){if(r>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=r}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class Eh{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}Eh.noSubdivision=new Eh({fill:new Il(0,0),line:new Il(0,0),tile:new Il(0,0),stencil:new Il(0,0),circle:1}),Zt("SubdivisionGranularityExpression",Il),Zt("SubdivisionGranularitySetting",Eh);const Ml=-32768,Jc=32767;class D_{constructor(e,r){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=Ce/e,this._canonical=r}_getKey(e,r){return(e+=32768)<<16|r+32768}_vertexToIndex(e,r){if(e<-32768||r<-32768||e>32767||r>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const o=0|Math.round(e),s=0|Math.round(r),u=this._getKey(o,s);if(this._vertexDictionary.has(u))return this._vertexDictionary.get(u);const h=this._vertexBuffer.length/2;return this._vertexDictionary.set(u,h),this._vertexBuffer.push(o,s),h}_subdivideTrianglesScanline(e){if(this._granularity<2)return(function(s,u){const h=[];for(let f=0;f<u.length;f+=3){const g=u[f],y=u[f+1],b=u[f+2],C=s[2*g],M=s[2*g+1];(s[2*y]-C)*(s[2*b+1]-M)-(s[2*y+1]-M)*(s[2*b]-C)>0?(h.push(g),h.push(b),h.push(y)):(h.push(g),h.push(y),h.push(b))}return h})(this._vertexBuffer,e);const r=[],o=e.length;for(let s=0;s<o;s+=3){const u=[e[s+0],e[s+1],e[s+2]],h=[this._vertexBuffer[2*e[s+0]+0],this._vertexBuffer[2*e[s+0]+1],this._vertexBuffer[2*e[s+1]+0],this._vertexBuffer[2*e[s+1]+1],this._vertexBuffer[2*e[s+2]+0],this._vertexBuffer[2*e[s+2]+1]];let f=1/0,g=1/0,y=-1/0,b=-1/0;for(let D=0;D<3;D++){const F=h[2*D],j=h[2*D+1];f=Math.min(f,F),y=Math.max(y,F),g=Math.min(g,j),b=Math.max(b,j)}if(f===y||g===b)continue;const C=Math.floor(f/this._granularityCellSize),M=Math.ceil(y/this._granularityCellSize),E=Math.floor(g/this._granularityCellSize),z=Math.ceil(b/this._granularityCellSize);if(C!==M||E!==z)for(let D=E;D<z;D++){const F=this._scanlineGenerateVertexRingForCellRow(D,h,u);L_(this._vertexBuffer,F,r)}else r.push(...u)}return r}_scanlineGenerateVertexRingForCellRow(e,r,o){const s=e*this._granularityCellSize,u=s+this._granularityCellSize,h=[];for(let f=0;f<3;f++){const g=r[2*f],y=r[2*f+1],b=r[2*(f+1)%6],C=r[(2*(f+1)+1)%6],M=r[2*(f+2)%6],E=r[(2*(f+2)+1)%6],z=b-g,D=C-y,F=z===0,j=D===0,J=(s-y)/D,U=(u-y)/D,H=Math.min(J,U),re=Math.max(J,U);if(!j&&(H>=1||re<=0)||j&&(y<s||y>u)){C>=s&&C<=u&&h.push(o[(f+1)%3]);continue}!j&&H>0&&h.push(this._vertexToIndex(g+z*H,y+D*H));const ge=g+z*Math.max(H,0),je=g+z*Math.min(re,1);F||this._generateIntraEdgeVertices(h,g,y,b,C,ge,je),!j&&re<1&&h.push(this._vertexToIndex(g+z*re,y+D*re)),(j||C>=s&&C<=u)&&h.push(o[(f+1)%3]),!j&&(C<=s||C>=u)&&this._generateInterEdgeVertices(h,g,y,b,C,M,E,je,s,u)}return h}_generateIntraEdgeVertices(e,r,o,s,u,h,f){const g=s-r,y=u-o,b=y===0,C=b?Math.min(r,s):Math.min(h,f),M=b?Math.max(r,s):Math.max(h,f),E=Math.floor(C/this._granularityCellSize)+1,z=Math.ceil(M/this._granularityCellSize)-1;if(b?r<s:h<f)for(let D=E;D<=z;D++){const F=D*this._granularityCellSize;e.push(this._vertexToIndex(F,o+y*(F-r)/g))}else for(let D=z;D>=E;D--){const F=D*this._granularityCellSize;e.push(this._vertexToIndex(F,o+y*(F-r)/g))}}_generateInterEdgeVertices(e,r,o,s,u,h,f,g,y,b){const C=u-o,M=h-s,E=f-u,z=(y-u)/E,D=(b-u)/E,F=Math.min(z,D),j=Math.max(z,D),J=s+M*F;let U=Math.floor(Math.min(J,g)/this._granularityCellSize)+1,H=Math.ceil(Math.max(J,g)/this._granularityCellSize)-1,re=g<J;const ge=E===0;if(ge&&(f===y||f===b))return;if(ge||F>=1||j<=0){const mt=o-f,ht=h+(r-h)*Math.min((y-f)/mt,(b-f)/mt);U=Math.floor(Math.min(ht,g)/this._granularityCellSize)+1,H=Math.ceil(Math.max(ht,g)/this._granularityCellSize)-1,re=g<ht}const je=C>0?b:y;if(re)for(let mt=U;mt<=H;mt++)e.push(this._vertexToIndex(mt*this._granularityCellSize,je));else for(let mt=H;mt>=U;mt--)e.push(this._vertexToIndex(mt*this._granularityCellSize,je))}_generateOutline(e){const r=[];for(const o of e){const s=Ms(o,this._granularity,!0),u=this._pointArrayToIndices(s),h=[];for(let f=1;f<u.length;f++)h.push(u[f-1]),h.push(u[f]);r.push(h)}return r}_handlePoles(e){let r=!1,o=!1;this._canonical&&(this._canonical.y===0&&(r=!0),this._canonical.y===(1<<this._canonical.z)-1&&(o=!0)),(r||o)&&this._fillPoles(e,r,o)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let r=0;r<e.length;r+=2){const o=e[r+1];o===Ml&&(e[r+1]=-32767),o===Jc&&(e[r+1]=32766)}}_generatePoleQuad(e,r,o,s,u,h){s>u!=(h===Ml)?(e.push(r),e.push(o),e.push(this._vertexToIndex(s,h)),e.push(o),e.push(this._vertexToIndex(u,h)),e.push(this._vertexToIndex(s,h))):(e.push(o),e.push(r),e.push(this._vertexToIndex(s,h)),e.push(this._vertexToIndex(u,h)),e.push(o),e.push(this._vertexToIndex(s,h)))}_fillPoles(e,r,o){const s=this._vertexBuffer,u=Ce,h=e.length;for(let f=2;f<h;f+=3){const g=e[f-2],y=e[f-1],b=e[f],C=s[2*g],M=s[2*g+1],E=s[2*y],z=s[2*y+1],D=s[2*b],F=s[2*b+1];r&&(M===0&&z===0&&this._generatePoleQuad(e,g,y,C,E,Ml),z===0&&F===0&&this._generatePoleQuad(e,y,b,E,D,Ml),F===0&&M===0&&this._generatePoleQuad(e,b,g,D,C,Ml)),o&&(M===u&&z===u&&this._generatePoleQuad(e,g,y,C,E,Jc),z===u&&F===u&&this._generatePoleQuad(e,y,b,E,D,Jc),F===u&&M===u&&this._generatePoleQuad(e,b,g,D,C,Jc))}}_initializeVertices(e){for(let r=0;r<e.length;r+=2)this._vertexToIndex(e[r],e[r+1])}subdividePolygonInternal(e,r){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:o,holeIndices:s}=(function(f){const g=[],y=[];for(const b of f)if(b.length!==0){b!==f[0]&&g.push(y.length/2);for(let C=0;C<b.length;C++)y.push(b[C].x),y.push(b[C].y)}return{flattened:y,holeIndices:g}})(e);let u;this._initializeVertices(o);try{const f=(function(y,b,C=2){const M=b&&b.length,E=M?b[0]*C:y.length;let z=hf(y,0,E,C,!0);const D=[];if(!z||z.next===z.prev)return D;let F,j,J;if(M&&(z=(function(U,H,re,ge){const je=[];for(let mt=0,ht=H.length;mt<ht;mt++){const _t=hf(U,H[mt]*ge,mt<ht-1?H[mt+1]*ge:U.length,ge,!1);_t===_t.next&&(_t.steiner=!0),je.push(k_(_t))}je.sort(M_);for(let mt=0;mt<je.length;mt++)re=E_(je[mt],re);return re})(y,b,z,C)),y.length>80*C){F=y[0],j=y[1];let U=F,H=j;for(let re=C;re<E;re+=C){const ge=y[re],je=y[re+1];ge<F&&(F=ge),je<j&&(j=je),ge>U&&(U=ge),je>H&&(H=je)}J=Math.max(U-F,H-j),J=J!==0?32767/J:0}return Xc(z,D,C,F,j,J,0),D})(o,s),g=this._convertIndices(o,f);u=this._subdivideTrianglesScanline(g)}catch(f){console.error(f)}let h=[];return r&&(h=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(u),{verticesFlattened:this._vertexBuffer,indicesTriangles:u,indicesLineList:h}}_convertIndices(e,r){const o=[];for(let s=0;s<r.length;s++)o.push(this._vertexToIndex(e[2*r[s]],e[2*r[s]+1]));return o}_pointArrayToIndices(e){const r=[];for(let o=0;o<e.length;o++){const s=e[o];r.push(this._vertexToIndex(s.x,s.y))}return r}}function gf(i,e,r,o=!0){return new D_(r,e).subdividePolygonInternal(i,o)}function Ms(i,e,r=!1){if(!i||i.length<1)return[];if(i.length<2)return[];const o=i[0],s=i[i.length-1],u=r&&(o.x!==s.x||o.y!==s.y);if(e<2)return u?[...i,i[0]]:[...i];const h=Math.floor(Ce/e),f=[];f.push(new q(i[0].x,i[0].y));const g=i.length,y=u?g:g-1;for(let b=0;b<y;b++){const C=i[b],M=b<g-1?i[b+1]:i[0],E=C.x,z=C.y,D=M.x,F=M.y,j=E!==D,J=z!==F;if(!j&&!J)continue;const U=D-E,H=F-z,re=Math.abs(U),ge=Math.abs(H);let je=E,mt=z;for(;;){const _t=U>0?(Math.floor(je/h)+1)*h:(Math.ceil(je/h)-1)*h,Dt=H>0?(Math.floor(mt/h)+1)*h:(Math.ceil(mt/h)-1)*h,Ct=Math.abs(je-_t),ct=Math.abs(mt-Dt),tt=Math.abs(je-D),Ut=Math.abs(mt-F),Vt=j?Ct/re:Number.POSITIVE_INFINITY,Wt=J?ct/ge:Number.POSITIVE_INFINITY;if((tt<=Ct||!j)&&(Ut<=ct||!J))break;if(Vt<Wt&&j||!J){je=_t,mt+=H*Vt;const jt=new q(je,Math.round(mt));f[f.length-1].x===jt.x&&f[f.length-1].y===jt.y||f.push(jt)}else{je+=U*Wt,mt=Dt;const jt=new q(Math.round(je),mt);f[f.length-1].x===jt.x&&f[f.length-1].y===jt.y||f.push(jt)}}const ht=new q(D,F);f[f.length-1].x===ht.x&&f[f.length-1].y===ht.y||f.push(ht)}return f}function L_(i,e,r){if(e.length===0)throw new Error("Subdivision vertex ring is empty.");let o=0,s=i[2*e[0]];for(let g=1;g<e.length;g++){const y=i[2*e[g]];y<s&&(s=y,o=g)}const u=e.length;let h=o,f=(h+1)%u;for(;;){const g=h-1>=0?h-1:u-1,y=(f+1)%u,b=i[2*e[g]],C=i[2*e[y]],M=i[2*e[h]],E=i[2*e[h]+1],z=i[2*e[f]+1];let D=!1;if(b<C)D=!0;else if(b>C)D=!1;else{const F=z-E,j=-(i[2*e[f]]-M),J=E<z?1:-1;((b-M)*F+(i[2*e[g]+1]-E)*j)*J>((C-M)*F+(i[2*e[y]+1]-E)*j)*J&&(D=!0)}if(D){const F=e[g],j=e[h],J=e[f];F!==j&&F!==J&&j!==J&&r.push(J,j,F),h--,h<0&&(h=u-1)}else{const F=e[y],j=e[h],J=e[f];F!==j&&F!==J&&j!==J&&r.push(J,j,F),f++,f>=u&&(f=0)}if(g===y)break}}function _f(i,e,r,o,s,u,h,f,g){const y=s.length/2,b=h&&f&&g;if(y<Nt.MAX_VERTEX_ARRAY_LENGTH){const C=e.prepareSegment(y,r,o),M=C.vertexLength;for(let D=0;D<u.length;D+=3)o.emplaceBack(M+u[D],M+u[D+1],M+u[D+2]);let E,z;C.vertexLength+=y,C.primitiveLength+=u.length/3,b&&(z=h.prepareSegment(y,r,f),E=z.vertexLength,z.vertexLength+=y);for(let D=0;D<s.length;D+=2)i(s[D],s[D+1]);if(b)for(let D=0;D<g.length;D++){const F=g[D];for(let j=1;j<F.length;j+=2)f.emplaceBack(E+F[j-1],E+F[j]);z.primitiveLength+=F.length/2}}else(function(C,M,E,z,D,F){const j=[];for(let ge=0;ge<z.length/2;ge++)j.push(-1);const J={count:0};let U=0,H=C.getOrCreateLatestSegment(M,E),re=H.vertexLength;for(let ge=2;ge<D.length;ge+=3){const je=D[ge-2],mt=D[ge-1],ht=D[ge];let _t=j[je]<U,Dt=j[mt]<U,Ct=j[ht]<U;H.vertexLength+((_t?1:0)+(Dt?1:0)+(Ct?1:0))>Nt.MAX_VERTEX_ARRAY_LENGTH&&(H=C.createNewSegment(M,E),U=J.count,_t=!0,Dt=!0,Ct=!0,re=0);const ct=$c(j,z,F,J,je,_t,H),tt=$c(j,z,F,J,mt,Dt,H),Ut=$c(j,z,F,J,ht,Ct,H);E.emplaceBack(re+ct-U,re+tt-U,re+Ut-U),H.primitiveLength++}})(e,r,o,s,u,i),b&&(function(C,M,E,z,D,F){const j=[];for(let ge=0;ge<z.length/2;ge++)j.push(-1);const J={count:0};let U=0,H=C.getOrCreateLatestSegment(M,E),re=H.vertexLength;for(let ge=0;ge<D.length;ge++){const je=D[ge];for(let mt=1;mt<D[ge].length;mt+=2){const ht=je[mt-1],_t=je[mt];let Dt=j[ht]<U,Ct=j[_t]<U;H.vertexLength+((Dt?1:0)+(Ct?1:0))>Nt.MAX_VERTEX_ARRAY_LENGTH&&(H=C.createNewSegment(M,E),U=J.count,Dt=!0,Ct=!0,re=0);const ct=$c(j,z,F,J,ht,Dt,H),tt=$c(j,z,F,J,_t,Ct,H);E.emplaceBack(re+ct-U,re+tt-U),H.primitiveLength++}}})(h,r,f,s,g,i),e.forceNewSegmentOnNextPrepare(),h?.forceNewSegmentOnNextPrepare()}function $c(i,e,r,o,s,u,h){if(u){const f=o.count;return r(e[2*s],e[2*s+1]),i[s]=o.count,o.count++,h.vertexLength++,f}return i[s]}class qd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new X,this.indexArray=new Ye,this.indexArray2=new At,this.programConfigurations=new Yo(e.layers,e.zoom),this.segments=new Nt,this.segments2=new Nt,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(e,r,o){this.hasDependencies=Ph("fill",this.layers,r);const s=this.layers[0].layout.get("fill-sort-key"),u=!s.isConstant(),h=[];for(const{feature:f,id:g,index:y,sourceLayerIndex:b}of e){const C=this.layers[0]._featureFilter.needGeometry,M=Po(f,C);if(!this.layers[0]._featureFilter.filter(new $r(this.zoom),M,o))continue;const E=u?s.evaluate(M,{},o,r.availableImages):void 0,z={id:g,properties:f.properties,type:f.type,sourceLayerIndex:b,index:y,geometry:C?M.geometry:So(f),patterns:{},sortKey:E};h.push(z)}u&&h.sort(((f,g)=>f.sortKey-g.sortKey));for(const f of h){const{geometry:g,index:y,sourceLayerIndex:b}=f;if(this.hasDependencies){const C=jd("fill",this.layers,f,{zoom:this.zoom},r);this.patternFeatures.push(C)}else this.addFeature(f,g,y,o,{},r.subdivisionGranularity);r.featureIndex.insert(e[y].feature,g,y,b,this.index)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,{imagePositions:o})}addFeatures(e,r,o){for(const s of this.patternFeatures)this.addFeature(s,s.geometry,s.index,r,o,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,T_),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,o,s,u,h){for(const f of Zs(r,500)){const g=gf(f,s,h.fill.getGranularityForZoomLevel(s.z)),y=this.layoutVertexArray;_f(((b,C)=>{y.emplaceBack(b,C)}),this.segments,this.layoutVertexArray,this.indexArray,g.verticesFlattened,g.indicesTriangles,this.segments2,this.indexArray2,g.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:u,canonical:s})}}let vf,yf;Zt("FillBucket",qd,{omit:["layers","patternFeatures"]});var R_={get paint(){return yf=yf||new un({"fill-antialias":new Jt(pe.paint_fill["fill-antialias"]),"fill-opacity":new sr(pe.paint_fill["fill-opacity"]),"fill-color":new sr(pe.paint_fill["fill-color"]),"fill-outline-color":new sr(pe.paint_fill["fill-outline-color"]),"fill-translate":new Jt(pe.paint_fill["fill-translate"]),"fill-translate-anchor":new Jt(pe.paint_fill["fill-translate-anchor"]),"fill-pattern":new ys(pe.paint_fill["fill-pattern"])})},get layout(){return vf=vf||new un({"fill-sort-key":new sr(pe.layout_fill["fill-sort-key"])})}};class F_ extends An{constructor(e,r){super(e,R_,r)}recalculate(e,r){super.recalculate(e,r);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new qd(e)}queryRadius(){return Ch(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:r,transform:o,pixelsToTileUnits:s}){return Kp(Sh(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-o.bearingInRadians,s),r)}isTileClipped(){return!0}}const O_=Ei([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),B_=Ei([{name:"a_centroid",components:2,type:"Int16"}],4),{members:N_}=O_;class eu{constructor(e,r,o,s,u){this.properties={},this.extent=o,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=s,this._values=u,e.readFields(V_,this,r)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const r=e.readVarint()+e.pos,o=[];let s,u=1,h=0,f=0,g=0;for(;e.pos<r;){if(h<=0){const y=e.readVarint();u=7&y,h=y>>3}if(h--,u===1||u===2)f+=e.readSVarint(),g+=e.readSVarint(),u===1&&(s&&o.push(s),s=[]),s&&s.push(new q(f,g));else{if(u!==7)throw new Error(`unknown command ${u}`);s&&s.push(s[0].clone())}}return s&&o.push(s),o}bbox(){const e=this._pbf;e.pos=this._geometry;const r=e.readVarint()+e.pos;let o=1,s=0,u=0,h=0,f=1/0,g=-1/0,y=1/0,b=-1/0;for(;e.pos<r;){if(s<=0){const C=e.readVarint();o=7&C,s=C>>3}if(s--,o===1||o===2)u+=e.readSVarint(),h+=e.readSVarint(),u<f&&(f=u),u>g&&(g=u),h<y&&(y=h),h>b&&(b=h);else if(o!==7)throw new Error(`unknown command ${o}`)}return[f,y,g,b]}toGeoJSON(e,r,o){const s=this.extent*Math.pow(2,o),u=this.extent*e,h=this.extent*r,f=this.loadGeometry();function g(M){return[360*(M.x+u)/s-180,360/Math.PI*Math.atan(Math.exp((1-2*(M.y+h)/s)*Math.PI))-90]}function y(M){return M.map(g)}let b;if(this.type===1){const M=[];for(const z of f)M.push(z[0]);const E=y(M);b=M.length===1?{type:"Point",coordinates:E[0]}:{type:"MultiPoint",coordinates:E}}else if(this.type===2){const M=f.map(y);b=M.length===1?{type:"LineString",coordinates:M[0]}:{type:"MultiLineString",coordinates:M}}else{if(this.type!==3)throw new Error("unknown feature type");{const M=xf(f),E=[];for(const z of M)E.push(z.map(y));b=E.length===1?{type:"Polygon",coordinates:E[0]}:{type:"MultiPolygon",coordinates:E}}}const C={type:"Feature",geometry:b,properties:this.properties};return this.id!=null&&(C.id=this.id),C}}function V_(i,e,r){i===1?e.id=r.readVarint():i===2?(function(o,s){const u=o.readVarint()+o.pos;for(;o.pos<u;){const h=s._keys[o.readVarint()],f=s._values[o.readVarint()];s.properties[h]=f}})(r,e):i===3?e.type=r.readVarint():i===4&&(e._geometry=r.pos)}function xf(i){const e=i.length;if(e<=1)return[i];const r=[];let o,s;for(let u=0;u<e;u++){const h=j_(i[u]);h!==0&&(s===void 0&&(s=h<0),s===h<0?(o&&r.push(o),o=[i[u]]):o&&o.push(i[u]))}return o&&r.push(o),r}function j_(i){let e=0;for(let r,o,s=0,u=i.length,h=u-1;s<u;h=s++)r=i[s],o=i[h],e+=(o.x-r.x)*(r.y+o.y);return e}eu.types=["Unknown","Point","LineString","Polygon"];class U_{constructor(e,r){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(G_,this,r),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const r=this._pbf.readVarint()+this._pbf.pos;return new eu(this._pbf,r,this.extent,this._keys,this._values)}}function G_(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push((function(o){let s=null;const u=o.readVarint()+o.pos;for(;o.pos<u;){const h=o.readVarint()>>3;s=h===1?o.readString():h===2?o.readFloat():h===3?o.readDouble():h===4?o.readVarint64():h===5?o.readVarint():h===6?o.readSVarint():h===7?o.readBoolean():null}if(s==null)throw new Error("unknown feature value");return s})(r))}class bf{constructor(e,r){this.layers=e.readFields(q_,{},r)}}function q_(i,e,r){if(i===3){const o=new U_(r,r.readVarint()+r.pos);o.length&&(e[o.name]=o)}}const Zd=Math.pow(2,13);function tu(i,e,r,o,s,u,h,f){i.emplaceBack(e,r,2*Math.floor(o*Zd)+h,s*Zd*2,u*Zd*2,Math.round(f))}class Hd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new te,this.centroidVertexArray=new W,this.indexArray=new Ye,this.programConfigurations=new Yo(e.layers,e.zoom),this.segments=new Nt,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(e,r,o){this.features=[],this.hasDependencies=Ph("fill-extrusion",this.layers,r);for(const{feature:s,id:u,index:h,sourceLayerIndex:f}of e){const g=this.layers[0]._featureFilter.needGeometry,y=Po(s,g);if(!this.layers[0]._featureFilter.filter(new $r(this.zoom),y,o))continue;const b={id:u,sourceLayerIndex:f,index:h,geometry:g?y.geometry:So(s),properties:s.properties,type:s.type,patterns:{}};this.hasDependencies?this.features.push(jd("fill-extrusion",this.layers,b,{zoom:this.zoom},r)):this.addFeature(b,b.geometry,h,o,{},r.subdivisionGranularity),r.featureIndex.insert(s,b.geometry,h,f,this.index,!0)}}addFeatures(e,r,o){for(const s of this.features){const{geometry:u}=s;this.addFeature(s,u,s.index,r,o,e.subdivisionGranularity)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,N_),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,B_.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,o,s,u,h){for(const f of Zs(r,500)){const g={x:0,y:0,sampleCount:0},y=this.layoutVertexArray.length;this.processPolygon(g,s,e,f,h);const b=this.layoutVertexArray.length-y,C=Math.floor(g.x/g.sampleCount),M=Math.floor(g.y/g.sampleCount);for(let E=0;E<b;E++)this.centroidVertexArray.emplaceBack(C,M)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:u,canonical:s})}processPolygon(e,r,o,s,u){if(s.length<1||wf(s[0]))return;for(const C of s)C.length!==0&&Z_(e,C);const h={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},f=u.fill.getGranularityForZoomLevel(r.z),g=eu.types[o.type]==="Polygon";for(const C of s){if(C.length===0||wf(C))continue;const M=Ms(C,f,g);this._generateSideFaces(M,h)}if(!g)return;const y=gf(s,r,f,!1),b=this.layoutVertexArray;_f(((C,M)=>{tu(b,C,M,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,y.verticesFlattened,y.indicesTriangles)}_generateSideFaces(e,r){let o=0;for(let s=1;s<e.length;s++){const u=e[s],h=e[s-1];if(H_(u,h))continue;r.segment.vertexLength+4>Nt.MAX_VERTEX_ARRAY_LENGTH&&(r.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const f=u.sub(h)._perp()._unit(),g=h.dist(u);o+g>32768&&(o=0),tu(this.layoutVertexArray,u.x,u.y,f.x,f.y,0,0,o),tu(this.layoutVertexArray,u.x,u.y,f.x,f.y,0,1,o),o+=g,tu(this.layoutVertexArray,h.x,h.y,f.x,f.y,0,0,o),tu(this.layoutVertexArray,h.x,h.y,f.x,f.y,0,1,o);const y=r.segment.vertexLength;this.indexArray.emplaceBack(y,y+2,y+1),this.indexArray.emplaceBack(y+1,y+2,y+3),r.segment.vertexLength+=4,r.segment.primitiveLength+=2}}}function Z_(i,e){for(let r=0;r<e.length;r++){const o=e[r];r===e.length-1&&e[0].x===o.x&&e[0].y===o.y||(i.x+=o.x,i.y+=o.y,i.sampleCount++)}}function H_(i,e){return i.x===e.x&&(i.x<0||i.x>Ce)||i.y===e.y&&(i.y<0||i.y>Ce)}function wf(i){return i.every((e=>e.x<0))||i.every((e=>e.x>Ce))||i.every((e=>e.y<0))||i.every((e=>e.y>Ce))}let Tf;Zt("FillExtrusionBucket",Hd,{omit:["layers","features"]});var W_={get paint(){return Tf=Tf||new un({"fill-extrusion-opacity":new Jt(pe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new sr(pe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Jt(pe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Jt(pe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ys(pe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new sr(pe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new sr(pe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Jt(pe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class X_ extends An{constructor(e,r){super(e,W_,r)}createBucket(e){return new Hd(e)}queryRadius(){return Ch(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:o,geometry:s,transform:u,pixelsToTileUnits:h,pixelPosMatrix:f}){const g=Sh(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-u.bearingInRadians,h),y=this.paint.get("fill-extrusion-height").evaluate(r,o),b=this.paint.get("fill-extrusion-base").evaluate(r,o),C=(function(E,z){const D=[];for(const F of E){const j=[F.x,F.y,0,1];bt(j,j,z),D.push(new q(j[0]/j[3],j[1]/j[3]))}return D})(g,f),M=(function(E,z,D,F){const j=[],J=[],U=F[8]*z,H=F[9]*z,re=F[10]*z,ge=F[11]*z,je=F[8]*D,mt=F[9]*D,ht=F[10]*D,_t=F[11]*D;for(const Dt of E){const Ct=[],ct=[];for(const tt of Dt){const Ut=tt.x,Vt=tt.y,Wt=F[0]*Ut+F[4]*Vt+F[12],jt=F[1]*Ut+F[5]*Vt+F[13],er=F[2]*Ut+F[6]*Vt+F[14],Wr=F[3]*Ut+F[7]*Vt+F[15],Or=er+re,mi=Wr+ge,nn=Wt+je,Fi=jt+mt,gi=er+ht,ui=Wr+_t,Yr=new q((Wt+U)/mi,(jt+H)/mi);Yr.z=Or/mi,Ct.push(Yr);const Si=new q(nn/ui,Fi/ui);Si.z=gi/ui,ct.push(Si)}j.push(Ct),J.push(ct)}return[j,J]})(s,b,y,f);return(function(E,z,D){let F=1/0;Kp(D,z)&&(F=Cf(D,z[0]));for(let j=0;j<z.length;j++){const J=z[j],U=E[j];for(let H=0;H<J.length-1;H++){const re=J[H],ge=[re,J[H+1],U[H+1],U[H],re];Tl(D,ge)&&(F=Math.min(F,Cf(D,ge)))}}return F!==1/0&&F})(M[0],M[1],C)}}function ru(i,e){return i.x*e.x+i.y*e.y}function Cf(i,e){if(i.length===1){let r=0;const o=e[r++];let s;for(;!s||o.equals(s);)if(s=e[r++],!s)return 1/0;for(;r<e.length;r++){const u=e[r],h=i[0],f=s.sub(o),g=u.sub(o),y=h.sub(o),b=ru(f,f),C=ru(f,g),M=ru(g,g),E=ru(y,f),z=ru(y,g),D=b*M-C*C,F=(M*E-C*z)/D,j=(b*z-C*E)/D,J=o.z*(1-F-j)+s.z*F+u.z*j;if(isFinite(J))return J}return 1/0}{let r=1/0;for(const o of e)r=Math.min(r,o.z);return r}}const Y_=Ei([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:K_}=Y_,Q_=Ei([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:J_}=Q_,$_=Math.cos(Math.PI/180*37.5),Sf=Math.pow(2,14)/.5;class Wd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((r=>{this.gradients[r.id]={}})),this.layoutVertexArray=new fe,this.layoutVertexArray2=new $,this.indexArray=new Ye,this.programConfigurations=new Yo(e.layers,e.zoom),this.segments=new Nt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(e,r,o){this.hasDependencies=Ph("line",this.layers,r)||this.hasLineDasharray(this.layers);const s=this.layers[0].layout.get("line-sort-key"),u=!s.isConstant(),h=[];for(const{feature:f,id:g,index:y,sourceLayerIndex:b}of e){const C=this.layers[0]._featureFilter.needGeometry,M=Po(f,C);if(!this.layers[0]._featureFilter.filter(new $r(this.zoom),M,o))continue;const E=u?s.evaluate(M,{},o):void 0,z={id:g,properties:f.properties,type:f.type,sourceLayerIndex:b,index:y,geometry:C?M.geometry:So(f),patterns:{},dashes:{},sortKey:E};h.push(z)}u&&h.sort(((f,g)=>f.sortKey-g.sortKey));for(const f of h){const{geometry:g,index:y,sourceLayerIndex:b}=f;this.hasDependencies?(Ph("line",this.layers,r)?jd("line",this.layers,f,{zoom:this.zoom},r):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,f,this.zoom,r),this.patternFeatures.push(f)):this.addFeature(f,g,y,o,{},{},r.subdivisionGranularity),r.featureIndex.insert(e[y].feature,g,y,b,this.index)}}update(e,r,o,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,{imagePositions:o,dashPositions:s})}addFeatures(e,r,o,s){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,r,o,s,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,J_)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,K_),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,o,s,u,h,f){const g=this.layers[0].layout,y=g.get("line-join").evaluate(e,{}),b=g.get("line-cap"),C=g.get("line-miter-limit"),M=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const E of r)this.addLine(E,e,y,b,C,M,s,f);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:u,dashPositions:h,canonical:s})}addLine(e,r,o,s,u,h,f,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=Ms(e,f?g.line.getGranularityForZoomLevel(f.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let U=0;U<e.length-1;U++)this.totalDistance+=e[U].dist(e[U+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y=eu.types[r.type]==="Polygon";let b=e.length;for(;b>=2&&e[b-1].equals(e[b-2]);)b--;let C=0;for(;C<b-1&&e[C].equals(e[C+1]);)C++;if(b<(y?3:2))return;o==="bevel"&&(u=1.05);const M=this.overscaling<=16?122880/(512*this.overscaling):0,E=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let z,D,F,j,J;this.e1=this.e2=-1,y&&(z=e[b-2],J=e[C].sub(z)._unit()._perp());for(let U=C;U<b;U++){if(F=U===b-1?y?e[C+1]:void 0:e[U+1],F&&e[U].equals(F))continue;J&&(j=J),z&&(D=z),z=e[U],J=F?F.sub(z)._unit()._perp():j,j=j||J;let H=j.add(J);H.x===0&&H.y===0||H._unit();const re=j.x*J.x+j.y*J.y,ge=H.x*J.x+H.y*J.y,je=ge!==0?1/ge:1/0,mt=2*Math.sqrt(2-2*ge),ht=ge<$_&&D&&F,_t=j.x*J.y-j.y*J.x>0;if(ht&&U>C){const ct=z.dist(D);if(ct>2*M){const tt=z.sub(z.sub(D)._mult(M/ct)._round());this.updateDistance(D,tt),this.addCurrentVertex(tt,j,0,0,E),D=tt}}const Dt=D&&F;let Ct=Dt?o:y?"butt":s;if(Dt&&Ct==="round"&&(je<h?Ct="miter":je<=2&&(Ct="fakeround")),Ct==="miter"&&je>u&&(Ct="bevel"),Ct==="bevel"&&(je>2&&(Ct="flipbevel"),je<u&&(Ct="miter")),D&&this.updateDistance(D,z),Ct==="miter")H._mult(je),this.addCurrentVertex(z,H,0,0,E);else if(Ct==="flipbevel"){if(je>100)H=J.mult(-1);else{const ct=je*j.add(J).mag()/j.sub(J).mag();H._perp()._mult(ct*(_t?-1:1))}this.addCurrentVertex(z,H,0,0,E),this.addCurrentVertex(z,H.mult(-1),0,0,E)}else if(Ct==="bevel"||Ct==="fakeround"){const ct=-Math.sqrt(je*je-1),tt=_t?ct:0,Ut=_t?0:ct;if(D&&this.addCurrentVertex(z,j,tt,Ut,E),Ct==="fakeround"){const Vt=Math.round(180*mt/Math.PI/20);for(let Wt=1;Wt<Vt;Wt++){let jt=Wt/Vt;if(jt!==.5){const Wr=jt-.5;jt+=jt*Wr*(jt-1)*((1.0904+re*(re*(3.55645-1.43519*re)-3.2452))*Wr*Wr+(.848013+re*(.215638*re-1.06021)))}const er=J.sub(j)._mult(jt)._add(j)._unit()._mult(_t?-1:1);this.addHalfVertex(z,er.x,er.y,!1,_t,0,E)}}F&&this.addCurrentVertex(z,J,-tt,-Ut,E)}else if(Ct==="butt")this.addCurrentVertex(z,H,0,0,E);else if(Ct==="square"){const ct=D?1:-1;this.addCurrentVertex(z,H,ct,ct,E)}else Ct==="round"&&(D&&(this.addCurrentVertex(z,j,0,0,E),this.addCurrentVertex(z,j,1,1,E,!0)),F&&(this.addCurrentVertex(z,J,-1,-1,E,!0),this.addCurrentVertex(z,J,0,0,E)));if(ht&&U<b-1){const ct=z.dist(F);if(ct>2*M){const tt=z.add(F.sub(z)._mult(M/ct)._round());this.updateDistance(z,tt),this.addCurrentVertex(tt,J,0,0,E),z=tt}}}}addCurrentVertex(e,r,o,s,u,h=!1){const f=r.y*s-r.x,g=-r.y-r.x*s;this.addHalfVertex(e,r.x+r.y*o,r.y-r.x*o,h,!1,o,u),this.addHalfVertex(e,f,g,h,!0,-s,u),this.distance>Sf/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,r,o,s,u,h))}addHalfVertex({x:e,y:r},o,s,u,h,f,g){const y=.5*(this.lineClips?this.scaledDistance*(Sf-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(u?1:0),(r<<1)+(h?1:0),Math.round(63*o)+128,Math.round(63*s)+128,1+(f===0?0:f<0?-1:1)|(63&y)<<2,y>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const b=g.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,b,this.e2),g.primitiveLength++),h?this.e2=b:this.e1=b}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}hasLineDasharray(e){for(const r of e){const o=r.paint.get("line-dasharray");if(o&&!o.isConstant())return!0}return!1}addLineDashDependencies(e,r,o,s){for(const u of e){const h=u.paint.get("line-dasharray");if(!h||h.value.kind==="constant")continue;const f=u.layout.get("line-cap")==="round",g={dasharray:h.value.evaluate({zoom:o-1},r,{}),round:f},y={dasharray:h.value.evaluate({zoom:o},r,{}),round:f},b={dasharray:h.value.evaluate({zoom:o+1},r,{}),round:f},C=`${g.dasharray.join(",")},${g.round}`,M=`${y.dasharray.join(",")},${y.round}`,E=`${b.dasharray.join(",")},${b.round}`;s.dashDependencies[C]=g,s.dashDependencies[M]=y,s.dashDependencies[E]=b,r.dashes[u.id]={min:C,mid:M,max:E}}}}let Pf,If;Zt("LineBucket",Wd,{omit:["layers","patternFeatures"]});var Mf={get paint(){return If=If||new un({"line-opacity":new sr(pe.paint_line["line-opacity"]),"line-color":new sr(pe.paint_line["line-color"]),"line-translate":new Jt(pe.paint_line["line-translate"]),"line-translate-anchor":new Jt(pe.paint_line["line-translate-anchor"]),"line-width":new sr(pe.paint_line["line-width"]),"line-gap-width":new sr(pe.paint_line["line-gap-width"]),"line-offset":new sr(pe.paint_line["line-offset"]),"line-blur":new sr(pe.paint_line["line-blur"]),"line-dasharray":new ys(pe.paint_line["line-dasharray"]),"line-pattern":new ys(pe.paint_line["line-pattern"]),"line-gradient":new ml(pe.paint_line["line-gradient"])})},get layout(){return Pf=Pf||new un({"line-cap":new Jt(pe.layout_line["line-cap"]),"line-join":new sr(pe.layout_line["line-join"]),"line-miter-limit":new Jt(pe.layout_line["line-miter-limit"]),"line-round-limit":new Jt(pe.layout_line["line-round-limit"]),"line-sort-key":new sr(pe.layout_line["line-sort-key"])})}};class e0 extends sr{possiblyEvaluate(e,r){return r=new $r(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,o,s){return r=ot({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,o,s)}}let Ah;class t0 extends An{constructor(e,r){super(e,Mf,r),this.gradientVersion=0,Ah||(Ah=new e0(Mf.paint.properties["line-width"].specification),Ah.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!(function(o){return o._styleExpression!==void 0})(r)&&r._styleExpression.expression instanceof _o,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,r){super.recalculate(e,r),this.paint._values["line-floorwidth"]=Ah.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Wd(e)}queryRadius(e){const r=e,o=Ef(Sl("line-width",this,r),Sl("line-gap-width",this,r)),s=Sl("line-offset",this,r);return o/2+Math.abs(s)+Ch(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:o,geometry:s,transform:u,pixelsToTileUnits:h}){const f=Sh(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-u.bearingInRadians,h),g=h/2*Ef(this.paint.get("line-width").evaluate(r,o),this.paint.get("line-gap-width").evaluate(r,o)),y=this.paint.get("line-offset").evaluate(r,o);return y&&(s=(function(b,C){const M=[];for(let E=0;E<b.length;E++){const z=c_(b[E]),D=[];for(let F=0;F<z.length;F++){const j=z[F],J=z[F-1],U=z[F+1],H=F===0?new q(0,0):j.sub(J)._unit()._perp(),re=F===z.length-1?new q(0,0):U.sub(j)._unit()._perp(),ge=H._add(re)._unit(),je=ge.x*re.x+ge.y*re.y;je!==0&&ge._mult(1/je),D.push(ge._mult(C)._add(j))}M.push(D)}return M})(s,y*h)),(function(b,C,M){for(let E=0;E<C.length;E++){const z=C[E];if(b.length>=3){for(let D=0;D<z.length;D++)if(Cl(b,z[D]))return!0}if(a_(b,z,M))return!0}return!1})(f,s,g)}isTileClipped(){return!0}}function Ef(i,e){return e>0?e+2*i:i}const r0=Ei([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),i0=Ei([{name:"a_projected_pos",components:3,type:"Float32"}],4);Ei([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const n0=Ei([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Ei([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Af=Ei([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),o0=Ei([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function a0(i,e,r){return i.sections.forEach((o=>{o.text=(function(s,u,h){const f=u.layout.get("text-transform").evaluate(h,{});return f==="uppercase"?s=s.toLocaleUpperCase():f==="lowercase"&&(s=s.toLocaleLowerCase()),wo.applyArabicShaping&&(s=wo.applyArabicShaping(s)),s})(o.text,e,r)})),i}Ei([{name:"triangle",components:3,type:"Uint16"}]),Ei([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ei([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Ei([{type:"Float32",name:"offsetX"}]),Ei([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Ei([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var Ui=24;const iu={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","⋯":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"},s0={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},l0={40:!0};function kf(i,e,r,o,s,u){if("fontStack"in e){const h=r[e.fontStack],f=h&&h[i];return f?f.metrics.advance*e.scale+s:0}{const h=o[e.imageName];return h?h.displaySize[0]*e.scale*Ui/u+s:0}}function zf(i,e,r,o){const s=Math.pow(i-e,2);return o?i<e?s/2:2*s:s+Math.abs(r)*r}function c0(i,e,r){let o=0;return i===10&&(o-=1e4),r&&(o+=150),i!==40&&i!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function Df(i,e,r,o,s,u){let h=null,f=zf(e,r,s,u);for(const g of o){const y=zf(e-g.x,r,s,u)+g.badness;y<=f&&(h=g,f=y)}return{index:i,x:e,priorBreak:h,badness:f}}function Lf(i){return i?Lf(i.priorBreak).concat(i.index):[]}class El{constructor(e="",r=[],o=[]){this.text=e,this.sections=r,this.sectionIndex=o,this.imageSectionID=null}static fromFeature(e,r){const o=new El;for(let s=0;s<e.sections.length;s++){const u=e.sections[s];u.image?o.addImageSection(u):o.addTextSection(u,r)}return o}length(){return[...this.text].length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}verticalizePunctuation(){this.text=(function(e){let r="",o={premature:!0,value:void 0};const s=e[Symbol.iterator]();let u=s.next();const h=e[Symbol.iterator]();h.next();let f=h.next();for(;!u.done;)r+=!f.done&&Dc(f.value.codePointAt(0))&&!iu[f.value]||!o.premature&&Dc(o.value.codePointAt(0))&&!iu[o.value]||!iu[u.value]?u.value:iu[u.value],o={value:u.value,premature:!1},u=s.next(),f=h.next();return r})(this.text)}hasZeroWidthSpaces(){return this.text.includes("​")}trim(){const e=this.text.match(/^\s*/),r=e?e[0].length:0,o=this.text.match(/\S\s*$/),s=o?o[0].length-1:0;this.text=this.text.substring(r,this.text.length-s),this.sectionIndex=this.sectionIndex.slice(r,this.sectionIndex.length-s)}substring(e,r){const o=[...this.text].slice(e,r).join(""),s=this.sectionIndex.slice(e,r);return new El(o,this.sections,s)}toCodeUnitIndex(e){return[...this.text].slice(0,e).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,r)=>Math.max(e,this.sections[r].scale)),0)}getMaxImageSize(e){let r=0,o=0;for(let s=0;s<this.length();s++){const u=this.getSection(s);if("imageName"in u){const h=e[u.imageName];if(!h)continue;const f=h.displaySize;r=Math.max(r,f[0]),o=Math.max(o,f[1])}}return{maxImageWidth:r,maxImageHeight:o}}addTextSection(e,r){this.text+=e.text,this.sections.push({scale:e.scale||1,verticalAlign:e.verticalAlign||"bottom",fontStack:e.fontStack||r});const o=this.sections.length-1;this.sectionIndex.push(...[...e.text].map((()=>o)))}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void Yt("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push({scale:1,verticalAlign:e.verticalAlign||"bottom",imageName:r}),this.sectionIndex.push(this.sections.length-1)):Yt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(e,r,o,s,u){const h=[],f=this.determineAverageLineWidth(e,r,o,s,u),g=this.hasZeroWidthSpaces();let y=0,b=0;const C=this.text[Symbol.iterator]();let M=C.next();const E=this.text[Symbol.iterator]();E.next();let z=E.next();const D=this.text[Symbol.iterator]();D.next(),D.next();let F=D.next();for(;!M.done;){const j=this.getSection(b),J=M.value.codePointAt(0);if(dh(J)||(y+=kf(J,j,o,s,e,u)),!z.done){const U=gs(J),H=z.value.codePointAt(0);(s0[J]||U||"imageName"in j||!F.done&&l0[H])&&h.push(Df(b+1,y,f,h,c0(J,H,U&&g),!1))}b++,M=C.next(),z=E.next(),F=D.next()}return Lf(Df(this.length(),y,f,h,0,!0))}determineAverageLineWidth(e,r,o,s,u){let h=0,f=0;for(const g of this.text){const y=this.getSection(f);h+=kf(g.codePointAt(0),y,o,s,e,u),f++}return h/Math.max(1,Math.ceil(h/r))}}const Xd=4294967296,Rf=1/Xd,Ff=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class kh{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,r,o=this.length){for(;this.pos<o;){const s=this.readVarint(),u=s>>3,h=this.pos;this.type=7&s,e(u,r,this),this.pos===h&&this.skip(s)}return r}readMessage(e,r){return this.readFields(e,r,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Xd;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Xd;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const r=this.buf;let o,s;return s=r[this.pos++],o=127&s,s<128?o:(s=r[this.pos++],o|=(127&s)<<7,s<128?o:(s=r[this.pos++],o|=(127&s)<<14,s<128?o:(s=r[this.pos++],o|=(127&s)<<21,s<128?o:(s=r[this.pos],o|=(15&s)<<28,(function(u,h,f){const g=f.buf;let y,b;if(b=g[f.pos++],y=(112&b)>>4,b<128||(b=g[f.pos++],y|=(127&b)<<3,b<128)||(b=g[f.pos++],y|=(127&b)<<10,b<128)||(b=g[f.pos++],y|=(127&b)<<17,b<128)||(b=g[f.pos++],y|=(127&b)<<24,b<128)||(b=g[f.pos++],y|=(1&b)<<31,b<128))return Al(u,y,h);throw new Error("Expected varint not more than 10 bytes")})(o,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){const e=this.readVarint()+this.pos,r=this.pos;return this.pos=e,e-r>=12&&Ff?Ff.decode(this.buf.subarray(r,e)):(function(o,s,u){let h="",f=s;for(;f<u;){const g=o[f];let y,b,C,M=null,E=g>239?4:g>223?3:g>191?2:1;if(f+E>u)break;E===1?g<128&&(M=g):E===2?(y=o[f+1],(192&y)==128&&(M=(31&g)<<6|63&y,M<=127&&(M=null))):E===3?(y=o[f+1],b=o[f+2],(192&y)==128&&(192&b)==128&&(M=(15&g)<<12|(63&y)<<6|63&b,(M<=2047||M>=55296&&M<=57343)&&(M=null))):E===4&&(y=o[f+1],b=o[f+2],C=o[f+3],(192&y)==128&&(192&b)==128&&(192&C)==128&&(M=(15&g)<<18|(63&y)<<12|(63&b)<<6|63&C,(M<=65535||M>=1114112)&&(M=null))),M===null?(M=65533,E=1):M>65535&&(M-=65536,h+=String.fromCharCode(M>>>10&1023|55296),M=56320|1023&M),h+=String.fromCharCode(M),f+=E}return h})(this.buf,r,e)}readBytes(){const e=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,e);return this.pos=e,r}readPackedVarint(e=[],r){const o=this.readPackedEnd();for(;this.pos<o;)e.push(this.readVarint(r));return e}readPackedSVarint(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(e){const r=7&e;if(r===0)for(;this.buf[this.pos++]>127;);else if(r===2)this.pos=this.readVarint()+this.pos;else if(r===5)this.pos+=4;else{if(r!==1)throw new Error(`Unimplemented type: ${r}`);this.pos+=8}}writeTag(e,r){this.writeVarint(e<<3|r)}realloc(e){let r=this.length||16;for(;r<this.pos+e;)r*=2;if(r!==this.length){const o=new Uint8Array(r);o.set(this.buf),this.buf=o,this.dataView=new DataView(o.buffer),this.length=r}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Rf),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Rf),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?(function(r,o){let s,u;if(r>=0?(s=r%4294967296|0,u=r/4294967296|0):(s=~(-r%4294967296),u=~(-r/4294967296),4294967295^s?s=s+1|0:(s=0,u=u+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),(function(h,f,g){g.buf[g.pos++]=127&h|128,h>>>=7,g.buf[g.pos++]=127&h|128,h>>>=7,g.buf[g.pos++]=127&h|128,h>>>=7,g.buf[g.pos++]=127&h|128,g.buf[g.pos]=127&(h>>>=7)})(s,0,o),(function(h,f){const g=(7&h)<<4;f.buf[f.pos++]|=g|((h>>>=3)?128:0),h&&(f.buf[f.pos++]=127&h|((h>>>=7)?128:0),h&&(f.buf[f.pos++]=127&h|((h>>>=7)?128:0),h&&(f.buf[f.pos++]=127&h|((h>>>=7)?128:0),h&&(f.buf[f.pos++]=127&h|((h>>>=7)?128:0),h&&(f.buf[f.pos++]=127&h)))))})(u,o)})(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const r=this.pos;this.pos=(function(s,u,h){for(let f,g,y=0;y<u.length;y++){if(f=u.charCodeAt(y),f>55295&&f<57344){if(!g){f>56319||y+1===u.length?(s[h++]=239,s[h++]=191,s[h++]=189):g=f;continue}if(f<56320){s[h++]=239,s[h++]=191,s[h++]=189,g=f;continue}f=g-55296<<10|f-56320|65536,g=null}else g&&(s[h++]=239,s[h++]=191,s[h++]=189,g=null);f<128?s[h++]=f:(f<2048?s[h++]=f>>6|192:(f<65536?s[h++]=f>>12|224:(s[h++]=f>>18|240,s[h++]=f>>12&63|128),s[h++]=f>>6&63|128),s[h++]=63&f|128)}return h})(this.buf,e,this.pos);const o=this.pos-r;o>=128&&Of(r,o,this),this.pos=r-1,this.writeVarint(o),this.pos+=o}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const r=e.length;this.writeVarint(r),this.realloc(r);for(let o=0;o<r;o++)this.buf[this.pos++]=e[o]}writeRawMessage(e,r){this.pos++;const o=this.pos;e(r,this);const s=this.pos-o;s>=128&&Of(o,s,this),this.pos=o-1,this.writeVarint(s),this.pos+=s}writeMessage(e,r,o){this.writeTag(e,2),this.writeRawMessage(r,o)}writePackedVarint(e,r){r.length&&this.writeMessage(e,u0,r)}writePackedSVarint(e,r){r.length&&this.writeMessage(e,h0,r)}writePackedBoolean(e,r){r.length&&this.writeMessage(e,f0,r)}writePackedFloat(e,r){r.length&&this.writeMessage(e,d0,r)}writePackedDouble(e,r){r.length&&this.writeMessage(e,p0,r)}writePackedFixed32(e,r){r.length&&this.writeMessage(e,m0,r)}writePackedSFixed32(e,r){r.length&&this.writeMessage(e,g0,r)}writePackedFixed64(e,r){r.length&&this.writeMessage(e,_0,r)}writePackedSFixed64(e,r){r.length&&this.writeMessage(e,v0,r)}writeBytesField(e,r){this.writeTag(e,2),this.writeBytes(r)}writeFixed32Field(e,r){this.writeTag(e,5),this.writeFixed32(r)}writeSFixed32Field(e,r){this.writeTag(e,5),this.writeSFixed32(r)}writeFixed64Field(e,r){this.writeTag(e,1),this.writeFixed64(r)}writeSFixed64Field(e,r){this.writeTag(e,1),this.writeSFixed64(r)}writeVarintField(e,r){this.writeTag(e,0),this.writeVarint(r)}writeSVarintField(e,r){this.writeTag(e,0),this.writeSVarint(r)}writeStringField(e,r){this.writeTag(e,2),this.writeString(r)}writeFloatField(e,r){this.writeTag(e,5),this.writeFloat(r)}writeDoubleField(e,r){this.writeTag(e,1),this.writeDouble(r)}writeBooleanField(e,r){this.writeVarintField(e,+r)}}function Al(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Of(i,e,r){const o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(o);for(let s=r.pos-1;s>=i;s--)r.buf[s+o]=r.buf[s]}function u0(i,e){for(let r=0;r<i.length;r++)e.writeVarint(i[r])}function h0(i,e){for(let r=0;r<i.length;r++)e.writeSVarint(i[r])}function d0(i,e){for(let r=0;r<i.length;r++)e.writeFloat(i[r])}function p0(i,e){for(let r=0;r<i.length;r++)e.writeDouble(i[r])}function f0(i,e){for(let r=0;r<i.length;r++)e.writeBoolean(i[r])}function m0(i,e){for(let r=0;r<i.length;r++)e.writeFixed32(i[r])}function g0(i,e){for(let r=0;r<i.length;r++)e.writeSFixed32(i[r])}function _0(i,e){for(let r=0;r<i.length;r++)e.writeFixed64(i[r])}function v0(i,e){for(let r=0;r<i.length;r++)e.writeSFixed64(i[r])}function y0(i,e,r){i===1&&r.readMessage(x0,e)}function x0(i,e,r){if(i===3){const{id:o,bitmap:s,width:u,height:h,left:f,top:g,advance:y}=r.readMessage(b0,{});e.push({id:o,bitmap:new Wc({width:u+6,height:h+6},s),metrics:{width:u,height:h,left:f,top:g,advance:y}})}}function b0(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}function Bf(i){let e=0,r=0;for(const h of i)e+=h.w*h.h,r=Math.max(r,h.w);i.sort(((h,f)=>f.h-h.h));const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let s=0,u=0;for(const h of i)for(let f=o.length-1;f>=0;f--){const g=o[f];if(!(h.w>g.w||h.h>g.h)){if(h.x=g.x,h.y=g.y,u=Math.max(u,h.y+h.h),s=Math.max(s,h.x+h.w),h.w===g.w&&h.h===g.h){const y=o.pop();y&&f<o.length&&(o[f]=y)}else h.h===g.h?(g.x+=h.w,g.w-=h.w):h.w===g.w?(g.y+=h.h,g.h-=h.h):(o.push({x:g.x+h.w,y:g.y,w:g.w-h.w,h:h.h}),g.y+=h.h,g.h-=h.h);break}}return{w:s,h:u,fill:e/(s*u)||0}}class Yd{constructor(e,{pixelRatio:r,version:o,stretchX:s,stretchY:u,content:h,textFitWidth:f,textFitHeight:g}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=s,this.stretchY=u,this.content=h,this.version=o,this.textFitWidth=f,this.textFitHeight=g}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Nf{constructor(e,r){const o={},s={};this.haveRenderCallbacks=[];const u=[];this.addImages(e,o,u),this.addImages(r,s,u);const{w:h,h:f}=Bf(u),g=new wn({width:h||1,height:f||1});for(const y in e){const b=e[y],C=o[y].paddedRect;wn.copy(b.data,g,{x:0,y:0},{x:C.x+1,y:C.y+1},b.data)}for(const y in r){const b=r[y],C=s[y].paddedRect,M=C.x+1,E=C.y+1,z=b.data.width,D=b.data.height;wn.copy(b.data,g,{x:0,y:0},{x:M,y:E},b.data),wn.copy(b.data,g,{x:0,y:D-1},{x:M,y:E-1},{width:z,height:1}),wn.copy(b.data,g,{x:0,y:0},{x:M,y:E+D},{width:z,height:1}),wn.copy(b.data,g,{x:z-1,y:0},{x:M-1,y:E},{width:1,height:D}),wn.copy(b.data,g,{x:0,y:0},{x:M+z,y:E},{width:1,height:D})}this.image=g,this.iconPositions=o,this.patternPositions=s}addImages(e,r,o){for(const s in e){const u=e[s],h={x:0,y:0,w:u.data.width+2,h:u.data.height+2};o.push(h),r[s]=new Yd(h,u),u.hasRenderCallback&&this.haveRenderCallbacks.push(s)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),r),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),r)}patchUpdatedImage(e,r,o){if(!e||!r||e.version===r.version)return;e.version=r.version;const[s,u]=e.tl;o.update(r.data,void 0,{x:s,y:u})}}var Aa;function zh(i,e,r,o,s,u,h,f,g,y,b,C,M,E,z){const D=El.fromFeature(i,s);let F;C===S.az.vertical&&D.verticalizePunctuation();let j=D.determineLineBreaks(y,u,e,o,E);const{processBidirectionalText:J,processStyledBidirectionalText:U}=wo;if(J&&D.sections.length===1){F=[],j=j.map((je=>D.toCodeUnitIndex(je)));const ge=J(D.toString(),j);for(const je of ge){const mt=[...je].map((()=>0));F.push(new El(je,D.sections,mt))}}else if(U){F=[],j=j.map((ht=>D.toCodeUnitIndex(ht)));let ge=0;const je=[];for(const ht of D.text)je.push(...Array(ht.length).fill(D.sectionIndex[ge])),ge++;const mt=U(D.text,je,j);for(const ht of mt){const _t=[];let Dt="";for(const Ct of ht[0])_t.push(ht[1][Dt.length]),Dt+=Ct;F.push(new El(ht[0],D.sections,_t))}}else F=(function(ge,je){const mt=[];let ht=0;for(const _t of je)mt.push(ge.substring(ht,_t)),ht=_t;return ht<ge.length()&&mt.push(ge.substring(ht,ge.length())),mt})(D,j);const H=[],re={positionedLines:H,text:D.toString(),top:b[1],bottom:b[1],left:b[0],right:b[0],writingMode:C,iconsInText:!1,verticalizable:!1};return(function(ge,je,mt,ht,_t,Dt,Ct,ct,tt,Ut,Vt,Wt){let jt=0,er=0,Wr=0,Or=0;const mi=ct==="right"?1:ct==="left"?0:.5,nn=Ui/Wt;let Fi=0;for(const Yr of _t){Yr.trim();const Si=Yr.getMaxScale(),ki={positionedGlyphs:[],lineOffset:0};ge.positionedLines[Fi]=ki;const si=ki.positionedGlyphs;let Tn=0;if(!Yr.length()){er+=Dt,++Fi;continue}const on=w0(ht,Yr,nn);let Cn=0;for(const Zi of Yr.text){const bi=Yr.getSection(Cn),Oi=Zi.codePointAt(0),Pi=T0(tt,Vt,Oi),Hi={glyph:Oi,imageName:null,x:jt,y:er+-17,vertical:Pi,scale:1,fontStack:"",sectionIndex:Yr.getSectionIndex(Cn),metrics:null,rect:null};let Jo;if("fontStack"in bi){if(Jo=C0(bi,Oi,Pi,on,je,mt),!Jo)continue;Hi.fontStack=bi.fontStack}else{if(ge.iconsInText=!0,bi.scale*=nn,Jo=S0(bi,Pi,Si,on,ht),!Jo)continue;Tn=Math.max(Tn,Jo.imageOffset),Hi.imageName=bi.imageName}const{rect:oo,metrics:uu,baselineOffset:Ra}=Jo;Hi.y+=Ra,Hi.scale=bi.scale,Hi.metrics=uu,Hi.rect=oo,si.push(Hi),Pi?(ge.verticalizable=!0,jt+=("imageName"in bi?uu.advance:Ui)*bi.scale+Ut):jt+=uu.advance*bi.scale+Ut,Cn++}si.length!==0&&(Wr=Math.max(jt-Ut,Wr),P0(si,0,si.length-1,mi)),jt=0,ki.lineOffset=Math.max(Tn,(Si-1)*Ui);const Jn=Dt*Si+Tn;er+=Jn,Or=Math.max(Jn,Or),++Fi}const{horizontalAlign:gi,verticalAlign:ui}=Kd(Ct);(function(Yr,Si,ki,si,Tn,on,Cn,Jn,Zi){const bi=(Si-ki)*Tn;let Oi=0;Oi=on!==Cn?-Jn*si- -17:-si*Zi*Cn+.5*Cn;for(const Pi of Yr)for(const Hi of Pi.positionedGlyphs)Hi.x+=bi,Hi.y+=Oi})(ge.positionedLines,mi,gi,ui,Wr,Or,Dt,er,_t.length),ge.top+=-ui*er,ge.bottom=ge.top+er,ge.left+=-gi*Wr,ge.right=ge.left+Wr})(re,e,r,o,F,h,f,g,C,y,M,z),!(function(ge){for(const je of ge)if(je.positionedGlyphs.length!==0)return!1;return!0})(H)&&re}function Kd(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function w0(i,e,r){const o=e.getMaxScale()*Ui,{maxImageWidth:s,maxImageHeight:u}=e.getMaxImageSize(i),h=Math.max(o,u*r);return{verticalLineContentWidth:Math.max(o,s*r),horizontalLineContentHeight:h}}function Vf(i){switch(i){case"top":return 0;case"center":return .5;default:return 1}}function T0(i,e,r){return!(i===S.az.horizontal||!e&&!zc(r)||e&&(dh(r)||(o=r,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(o)))));var o}function C0(i,e,r,o,s,u){const h=u[i.fontStack],f=(function(y,b,C,M){if(y&&y.rect)return y;const E=b[C.fontStack],z=E&&E[M];return z?{rect:null,metrics:z.metrics}:null})(h&&h[e],s,i,e);if(f===null)return null;let g;if(r)g=o.verticalLineContentWidth-i.scale*Ui;else{const y=Vf(i.verticalAlign);g=(o.horizontalLineContentHeight-i.scale*Ui)*y}return{rect:f.rect,metrics:f.metrics,baselineOffset:g}}function S0(i,e,r,o,s){const u=s[i.imageName];if(!u)return null;const h=u.paddedRect,f=u.displaySize,g={width:f[0],height:f[1],left:1,top:-3,advance:e?f[1]:f[0]};let y;if(e)y=o.verticalLineContentWidth-f[1]*i.scale;else{const b=Vf(i.verticalAlign);y=(o.horizontalLineContentHeight-f[1]*i.scale)*b}return{rect:h,metrics:g,baselineOffset:y,imageOffset:(e?f[0]:f[1])*i.scale-Ui*r}}function P0(i,e,r,o){if(o===0)return;const s=i[r],u=(i[r].x+s.metrics.advance*s.scale)*o;for(let h=e;h<=r;h++)i[h].x-=u}function I0(i,e,r){const{horizontalAlign:o,verticalAlign:s}=Kd(r),u=e[0]-i.displaySize[0]*o,h=e[1]-i.displaySize[1]*s;return{image:i,top:h,bottom:h+i.displaySize[1],left:u,right:u+i.displaySize[0]}}function jf(i){var e,r;let o=i.left,s=i.top,u=i.right-o,h=i.bottom-s;const f=(e=i.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",g=(r=i.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",y=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(g==="proportional"){if(f==="stretchOnly"&&u/h<y||f==="proportional"){const b=Math.ceil(h*y);o*=b/u,u=b}}else if(f==="proportional"&&g==="stretchOnly"&&y!==0&&u/h>y){const b=Math.ceil(u/y);s*=b/h,h=b}return{x1:o,y1:s,x2:o+u,y2:s+h}}function Uf(i,e,r,o,s,u){const h=i.image;let f;if(h.content){const F=h.content,j=h.pixelRatio||1;f=[F[0]/j,F[1]/j,h.displaySize[0]-F[2]/j,h.displaySize[1]-F[3]/j]}const g=e.left*u,y=e.right*u;let b,C,M,E;r==="width"||r==="both"?(E=s[0]+g-o[3],C=s[0]+y+o[1]):(E=s[0]+(g+y-h.displaySize[0])/2,C=E+h.displaySize[0]);const z=e.top*u,D=e.bottom*u;return r==="height"||r==="both"?(b=s[1]+z-o[0],M=s[1]+D+o[2]):(b=s[1]+(z+D-h.displaySize[1])/2,M=b+h.displaySize[1]),{image:h,top:b,right:C,bottom:M,left:E,collisionPadding:f}}Zt("ImagePosition",Yd),Zt("ImageAtlas",Nf),S.az=void 0,(Aa=S.az||(S.az={}))[Aa.none=0]="none",Aa[Aa.horizontal=1]="horizontal",Aa[Aa.vertical=2]="vertical",Aa[Aa.horizontalOnly=3]="horizontalOnly";const Ko=128,ka=32640;function Gf(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new $r(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:s}=r;let u=0;for(;u<o.length&&o[u]<=i;)u++;u=Math.max(0,u-1);let h=u;for(;h<o.length&&o[h]<i+1;)h++;h=Math.min(o.length-1,h);const f=o[u],g=o[h];return r.kind==="composite"?{kind:"composite",minZoom:f,maxZoom:g,interpolationType:s}:{kind:"camera",minZoom:f,maxZoom:g,minSize:r.evaluate(new $r(f)),maxSize:r.evaluate(new $r(g)),interpolationType:s}}}function Qd(i,e,r){let o="never";const s=i.get(e);return s?o=s:i.get(r)&&(o="always"),o}const M0=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Dh(i,e,r,o,s,u,h,f,g,y,b,C,M){const E=f?Math.min(ka,Math.round(f[0])):0,z=f?Math.min(ka,Math.round(f[1])):0;i.emplaceBack(e,r,Math.round(32*o),Math.round(32*s),u,h,(E<<1)+(g?1:0),z,16*y,16*b,256*C,256*M)}function Jd(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function E0(i){for(const e of i.sections)if(mh(e.text))return!0;return!1}class $d{constructor(e){this.layoutVertexArray=new le,this.indexArray=new Ye,this.programConfigurations=e,this.segments=new Nt,this.dynamicLayoutVertexArray=new Me,this.opacityVertexArray=new $e,this.hasVisibleVertices=!1,this.placedSymbolArray=new m}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,o,s){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,r0.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,i0.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,M0,!0),this.opacityVertexBuffer.itemSize=1),(o||s)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Zt("SymbolBuffers",$d);class ep{constructor(e,r,o){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new o,this.segments=new Nt,this.collisionVertexArray=new We}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,n0.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Zt("CollisionBuffers",ep);class kl{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((h=>h.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Gf(this.zoom,r["text-size"]),this.iconSizeData=Gf(this.zoom,r["icon-size"]);const o=this.layers[0].layout,s=o.get("symbol-sort-key"),u=o.get("symbol-z-order");this.canOverlap=Qd(o,"text-overlap","text-allow-overlap")!=="never"||Qd(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&!s.isConstant(),this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map((h=>S.az[h]))),this.stateDependentLayerIds=this.layers.filter((h=>h.isStateDependent())).map((h=>h.id)),this.sourceID=e.sourceID}createArrays(){this.text=new $d(new Yo(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new $d(new Yo(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new T,this.lineVertexArray=new P,this.symbolInstances=new x,this.textAnchorOffsets=new A}calculateGlyphDependencies(e,r,o,s,u){for(const h of e)if(r[h.codePointAt(0)]=!0,(o||s)&&u){const f=iu[h];f&&(r[f.codePointAt(0)]=!0)}}populate(e,r,o){const s=this.layers[0],u=s.layout,h=u.get("text-font"),f=u.get("text-field"),g=u.get("icon-image"),y=(f.value.kind!=="constant"||f.value.value instanceof dn&&!f.value.value.isEmpty()||f.value.value.toString().length>0)&&(h.value.kind!=="constant"||h.value.value.length>0),b=g.value.kind!=="constant"||!!g.value.value||Object.keys(g.parameters).length>0,C=u.get("symbol-sort-key");if(this.features=[],!y&&!b)return;const M=r.iconDependencies,E=r.glyphDependencies,z=r.availableImages,D=new $r(this.zoom);for(const{feature:F,id:j,index:J,sourceLayerIndex:U}of e){const H=s._featureFilter.needGeometry,re=Po(F,H);if(!s._featureFilter.filter(D,re,o))continue;let ge,je;if(H||(re.geometry=So(F)),y){const ht=s.getValueAndResolveTokens("text-field",re,o,z),_t=dn.factory(ht),Dt=this.hasRTLText=this.hasRTLText||E0(_t);(!Dt||wo.getRTLTextPluginStatus()==="unavailable"||Dt&&wo.isParsed())&&(ge=a0(_t,s,re))}if(b){const ht=s.getValueAndResolveTokens("icon-image",re,o,z);je=ht instanceof xn?ht:xn.fromString(ht)}if(!ge&&!je)continue;const mt=this.sortFeaturesByKey?C.evaluate(re,{},o):void 0;if(this.features.push({id:j,text:ge,icon:je,index:J,sourceLayerIndex:U,geometry:re.geometry,properties:F.properties,type:eu.types[F.type],sortKey:mt}),je&&(M[je.name]=!0),ge){const ht=h.evaluate(re,{},o).join(","),_t=u.get("text-rotation-alignment")!=="viewport"&&u.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(S.az.vertical)>=0;for(const Dt of ge.sections)if(Dt.image)M[Dt.image.name]=!0;else{const Ct=Ma(ge.toString()),ct=Dt.fontStack||ht,tt=E[ct]=E[ct]||{};this.calculateGlyphDependencies(Dt.text,tt,_t,this.allowVerticalPlacement,Ct)}}}u.get("symbol-placement")==="line"&&(this.features=(function(F){const j={},J={},U=[];let H=0;function re(ht){U.push(F[ht]),H++}function ge(ht,_t,Dt){const Ct=J[ht];return delete J[ht],J[_t]=Ct,U[Ct].geometry[0].pop(),U[Ct].geometry[0]=U[Ct].geometry[0].concat(Dt[0]),Ct}function je(ht,_t,Dt){const Ct=j[_t];return delete j[_t],j[ht]=Ct,U[Ct].geometry[0].shift(),U[Ct].geometry[0]=Dt[0].concat(U[Ct].geometry[0]),Ct}function mt(ht,_t,Dt){const Ct=Dt?_t[0][_t[0].length-1]:_t[0][0];return`${ht}:${Ct.x}:${Ct.y}`}for(let ht=0;ht<F.length;ht++){const _t=F[ht],Dt=_t.geometry,Ct=_t.text?_t.text.toString():null;if(!Ct){re(ht);continue}const ct=mt(Ct,Dt),tt=mt(Ct,Dt,!0);if(ct in J&&tt in j&&J[ct]!==j[tt]){const Ut=je(ct,tt,Dt),Vt=ge(ct,tt,U[Ut].geometry);delete j[ct],delete J[tt],J[mt(Ct,U[Vt].geometry,!0)]=Vt,U[Ut].geometry=null}else ct in J?ge(ct,tt,Dt):tt in j?je(ct,tt,Dt):(re(ht),j[ct]=H-1,J[tt]=H-1)}return U.filter((ht=>ht.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((F,j)=>F.sortKey-j.sortKey))}update(e,r,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,{imagePositions:o}),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,{imagePositions:o}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const o=this.lineVertexArray.length;if(e.segment!==void 0){let s=e.dist(r[e.segment+1]),u=e.dist(r[e.segment]);const h={};for(let f=e.segment+1;f<r.length;f++)h[f]={x:r[f].x,y:r[f].y,tileUnitDistanceFromAnchor:s},f<r.length-1&&(s+=r[f+1].dist(r[f]));for(let f=e.segment||0;f>=0;f--)h[f]={x:r[f].x,y:r[f].y,tileUnitDistanceFromAnchor:u},f>0&&(u+=r[f-1].dist(r[f]));for(let f=0;f<r.length;f++){const g=h[f];this.lineVertexArray.emplaceBack(g.x,g.y,g.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,r,o,s,u,h,f,g,y,b,C,M){const E=e.indexArray,z=e.layoutVertexArray,D=e.segments.prepareSegment(4*r.length,z,E,this.canOverlap?h.sortKey:void 0),F=this.glyphOffsetArray.length,j=D.vertexLength,J=this.allowVerticalPlacement&&f===S.az.vertical?Math.PI/2:0,U=h.text&&h.text.sections;for(let H=0;H<r.length;H++){const{tl:re,tr:ge,bl:je,br:mt,tex:ht,pixelOffsetTL:_t,pixelOffsetBR:Dt,minFontScaleX:Ct,minFontScaleY:ct,glyphOffset:tt,isSDF:Ut,sectionIndex:Vt}=r[H],Wt=D.vertexLength,jt=tt[1];Dh(z,g.x,g.y,re.x,jt+re.y,ht.x,ht.y,o,Ut,_t.x,_t.y,Ct,ct),Dh(z,g.x,g.y,ge.x,jt+ge.y,ht.x+ht.w,ht.y,o,Ut,Dt.x,_t.y,Ct,ct),Dh(z,g.x,g.y,je.x,jt+je.y,ht.x,ht.y+ht.h,o,Ut,_t.x,Dt.y,Ct,ct),Dh(z,g.x,g.y,mt.x,jt+mt.y,ht.x+ht.w,ht.y+ht.h,o,Ut,Dt.x,Dt.y,Ct,ct),Jd(e.dynamicLayoutVertexArray,g,J),E.emplaceBack(Wt,Wt+2,Wt+1),E.emplaceBack(Wt+1,Wt+2,Wt+3),D.vertexLength+=4,D.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(tt[0]),H!==r.length-1&&Vt===r[H+1].sectionIndex||e.programConfigurations.populatePaintArrays(z.length,h,h.index,{imagePositions:{},canonical:M,formattedSection:U&&U[Vt]})}e.placedSymbolArray.emplaceBack(g.x,g.y,F,this.glyphOffsetArray.length-F,j,y,b,g.segment,o?o[0]:0,o?o[1]:0,s[0],s[1],f,0,!1,0,C)}_addCollisionDebugVertex(e,r,o,s,u,h){return r.emplaceBack(0,0),e.emplaceBack(o.x,o.y,s,u,Math.round(h.x),Math.round(h.y))}addCollisionDebugVertices(e,r,o,s,u,h,f){const g=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),y=g.vertexLength,b=u.layoutVertexArray,C=u.collisionVertexArray,M=f.anchorX,E=f.anchorY;this._addCollisionDebugVertex(b,C,h,M,E,new q(e,r)),this._addCollisionDebugVertex(b,C,h,M,E,new q(o,r)),this._addCollisionDebugVertex(b,C,h,M,E,new q(o,s)),this._addCollisionDebugVertex(b,C,h,M,E,new q(e,s)),g.vertexLength+=4;const z=u.indexArray;z.emplaceBack(y,y+1),z.emplaceBack(y+1,y+2),z.emplaceBack(y+2,y+3),z.emplaceBack(y+3,y),g.primitiveLength+=4}addDebugCollisionBoxes(e,r,o,s){for(let u=e;u<r;u++){const h=this.collisionBoxArray.get(u);this.addCollisionDebugVertices(h.x1,h.y1,h.x2,h.y2,s?this.textCollisionBox:this.iconCollisionBox,h.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ep(Ze,Af.members,At),this.iconCollisionBox=new ep(Ze,Af.members,At);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,o,s,u,h,f,g,y){const b={};for(let C=r;C<o;C++){const M=e.get(C);b.textBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,anchorPointX:M.anchorPointX,anchorPointY:M.anchorPointY},b.textFeatureIndex=M.featureIndex;break}for(let C=s;C<u;C++){const M=e.get(C);b.verticalTextBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,anchorPointX:M.anchorPointX,anchorPointY:M.anchorPointY},b.verticalTextFeatureIndex=M.featureIndex;break}for(let C=h;C<f;C++){const M=e.get(C);b.iconBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,anchorPointX:M.anchorPointX,anchorPointY:M.anchorPointY},b.iconFeatureIndex=M.featureIndex;break}for(let C=g;C<y;C++){const M=e.get(C);b.verticalIconBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,anchorPointX:M.anchorPointX,anchorPointY:M.anchorPointY},b.verticalIconFeatureIndex=M.featureIndex;break}return b}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const o=e.placedSymbolArray.get(r),s=o.vertexStartIndex+4*o.numGlyphs;for(let u=o.vertexStartIndex;u<s;u+=4)e.indexArray.emplaceBack(u,u+2,u+1),e.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),o=Math.cos(e),s=[],u=[],h=[];for(let f=0;f<this.symbolInstances.length;++f){h.push(f);const g=this.symbolInstances.get(f);s.push(0|Math.round(r*g.anchorX+o*g.anchorY)),u.push(g.featureIndex)}return h.sort(((f,g)=>s[f]-s[g]||u[g]-u[f])),h}addToSortKeyRanges(e,r){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===r?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const o=this.symbolInstances.get(r);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach(((s,u,h)=>{s>=0&&h.indexOf(s)===u&&this.addIndicesForPlacedSymbol(this.text,s)})),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let qf,Zf;Zt("SymbolBucket",kl,{omit:["layers","collisionBoxArray","features","compareText"]}),kl.MAX_GLYPHS=65535,kl.addDynamicAttributes=Jd;var tp={get paint(){return Zf=Zf||new un({"icon-opacity":new sr(pe.paint_symbol["icon-opacity"]),"icon-color":new sr(pe.paint_symbol["icon-color"]),"icon-halo-color":new sr(pe.paint_symbol["icon-halo-color"]),"icon-halo-width":new sr(pe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new sr(pe.paint_symbol["icon-halo-blur"]),"icon-translate":new Jt(pe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Jt(pe.paint_symbol["icon-translate-anchor"]),"text-opacity":new sr(pe.paint_symbol["text-opacity"]),"text-color":new sr(pe.paint_symbol["text-color"],{runtimeType:oi,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new sr(pe.paint_symbol["text-halo-color"]),"text-halo-width":new sr(pe.paint_symbol["text-halo-width"]),"text-halo-blur":new sr(pe.paint_symbol["text-halo-blur"]),"text-translate":new Jt(pe.paint_symbol["text-translate"]),"text-translate-anchor":new Jt(pe.paint_symbol["text-translate-anchor"])})},get layout(){return qf=qf||new un({"symbol-placement":new Jt(pe.layout_symbol["symbol-placement"]),"symbol-spacing":new Jt(pe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Jt(pe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new sr(pe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Jt(pe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Jt(pe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Jt(pe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Jt(pe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Jt(pe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Jt(pe.layout_symbol["icon-rotation-alignment"]),"icon-size":new sr(pe.layout_symbol["icon-size"]),"icon-text-fit":new Jt(pe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Jt(pe.layout_symbol["icon-text-fit-padding"]),"icon-image":new sr(pe.layout_symbol["icon-image"]),"icon-rotate":new sr(pe.layout_symbol["icon-rotate"]),"icon-padding":new sr(pe.layout_symbol["icon-padding"]),"icon-keep-upright":new Jt(pe.layout_symbol["icon-keep-upright"]),"icon-offset":new sr(pe.layout_symbol["icon-offset"]),"icon-anchor":new sr(pe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Jt(pe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Jt(pe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Jt(pe.layout_symbol["text-rotation-alignment"]),"text-field":new sr(pe.layout_symbol["text-field"]),"text-font":new sr(pe.layout_symbol["text-font"]),"text-size":new sr(pe.layout_symbol["text-size"]),"text-max-width":new sr(pe.layout_symbol["text-max-width"]),"text-line-height":new Jt(pe.layout_symbol["text-line-height"]),"text-letter-spacing":new sr(pe.layout_symbol["text-letter-spacing"]),"text-justify":new sr(pe.layout_symbol["text-justify"]),"text-radial-offset":new sr(pe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Jt(pe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new sr(pe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new sr(pe.layout_symbol["text-anchor"]),"text-max-angle":new Jt(pe.layout_symbol["text-max-angle"]),"text-writing-mode":new Jt(pe.layout_symbol["text-writing-mode"]),"text-rotate":new sr(pe.layout_symbol["text-rotate"]),"text-padding":new Jt(pe.layout_symbol["text-padding"]),"text-keep-upright":new Jt(pe.layout_symbol["text-keep-upright"]),"text-transform":new sr(pe.layout_symbol["text-transform"]),"text-offset":new sr(pe.layout_symbol["text-offset"]),"text-allow-overlap":new Jt(pe.layout_symbol["text-allow-overlap"]),"text-overlap":new Jt(pe.layout_symbol["text-overlap"]),"text-ignore-placement":new Jt(pe.layout_symbol["text-ignore-placement"]),"text-optional":new Jt(pe.layout_symbol["text-optional"])})}};class Hf{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Kr,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Zt("FormatSectionOverride",Hf,{omit:["defaultValue"]});class Lh extends An{constructor(e,r){super(e,tp,r)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const s=[];for(const u of o)s.indexOf(u)<0&&s.push(u);this.layout._values["text-writing-mode"]=s}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,o,s){const u=this.layout.get(e).evaluate(r,{},o,s),h=this._unevaluatedLayout._values[e];return h.isDataDriven()||Ta(h.value)||!u?u:(function(f,g){return g.replace(/{([^{}]+)}/g,((y,b)=>f&&b in f?String(f[b]):""))})(r.properties,u)}createBucket(e){return new kl(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of tp.paint.overridableProperties){if(!Lh.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),o=new Hf(r),s=new xc(o,r.property.specification);let u=null;u=r.value.kind==="constant"||r.value.kind==="source"?new rl("source",s):new bc("composite",s,r.value.zoomStops),this.paint._values[e]=new Vn(r.property,u,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,o){return!(!this.layout||r.isDataDriven()||o.isDataDriven())&&Lh.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const o=e.get("text-field"),s=tp.paint.properties[r];let u=!1;const h=f=>{for(const g of f)if(s.overrides&&s.overrides.hasOverride(g))return void(u=!0)};if(o.value.kind==="constant"&&o.value.value instanceof dn)h(o.value.value.sections);else if(o.value.kind==="source"||o.value.kind==="composite"){const f=y=>{u||(y instanceof Xn&&Ii(y.value)===yn?h(y.value.sections):y instanceof Ja?h(y.sections):y.eachChild(f))},g=o.value;g._styleExpression&&f(g._styleExpression.expression)}return u}}let Wf;var A0={get paint(){return Wf=Wf||new un({"background-color":new Jt(pe.paint_background["background-color"]),"background-pattern":new fl(pe.paint_background["background-pattern"]),"background-opacity":new Jt(pe.paint_background["background-opacity"])})}};class k0 extends An{constructor(e,r){super(e,A0,r)}}class z0 extends An{constructor(e,r){super(e,{},r),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class D0{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const L0={once:!0},rp=63710088e-1;class za{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new za(Ge(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,o=this.lat*r,s=e.lat*r,u=Math.sin(o)*Math.sin(s)+Math.cos(o)*Math.cos(s)*Math.cos((e.lng-this.lng)*r);return rp*Math.acos(Math.min(u,1))}static convert(e){if(e instanceof za)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new za(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new za(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Xf=2*Math.PI*rp;function Yf(i){return Xf*Math.cos(i*Math.PI/180)}function Kf(i){return(180+i)/360}function Qf(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Jf(i,e){return i/Yf(e)}function $f(i){return 360*i-180}function Rh(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function em(i,e){return i*Yf(Rh(e))}class nu{constructor(e,r,o=0){this.x=+e,this.y=+r,this.z=+o}static fromLngLat(e,r=0){const o=za.convert(e);return new nu(Kf(o.lng),Qf(o.lat),Jf(r,o.lat))}toLngLat(){return new za($f(this.x),Rh(this.y))}toAltitude(){return em(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Xf*(e=Rh(this.y),1/Math.cos(e*Math.PI/180));var e}}function tm(i,e,r){var o=2*Math.PI*6378137/256/Math.pow(2,r);return[i*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class ip{constructor(e,r,o){if(!(function(s,u,h){return!(s<0||s>25||h<0||h>=Math.pow(2,s)||u<0||u>=Math.pow(2,s))})(e,r,o))throw new Error(`x=${r}, y=${o}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=o,this.key=zl(0,e,e,r,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,o){const s=(h=this.y,f=this.z,g=tm(256*(u=this.x),256*(h=Math.pow(2,f)-h-1),f),y=tm(256*(u+1),256*(h+1),f),g[0]+","+g[1]+","+y[0]+","+y[1]);var u,h,f,g,y;const b=(function(C,M,E){let z,D="";for(let F=C;F>0;F--)z=1<<F-1,D+=(M&z?1:0)+(E&z?2:0);return D})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,b).replace(/{bbox-epsg-3857}/g,s)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new q((e.x*r-this.x)*Ce,(e.y*r-this.y)*Ce)}toString(){return`${this.z}/${this.x}/${this.y}`}}class rm{constructor(e,r){this.wrap=e,this.canonical=r,this.key=zl(e,r.z,r.z,r.x,r.y)}}class Gn{constructor(e,r,o,s,u){if(this.terrainRttPosMatrix32f=null,e<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${o}`);this.overscaledZ=e,this.wrap=r,this.canonical=new ip(o,+s,+u),this.key=zl(r,e,o,s,u)}clone(){return new Gn(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new Gn(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Gn(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-e;return e>this.canonical.z?zl(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):zl(this.wrap*+r,e,e,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(e){if(e.wrap!==this.wrap||this.overscaledZ-e.overscaledZ<=0)return!1;if(e.overscaledZ===0)return this.overscaledZ>0;const r=this.canonical.z-e.canonical.z;return!(r<0)&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new Gn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,o=2*this.canonical.x,s=2*this.canonical.y;return[new Gn(r,this.wrap,r,o,s),new Gn(r,this.wrap,r,o+1,s),new Gn(r,this.wrap,r,o,s+1),new Gn(r,this.wrap,r,o+1,s+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Gn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Gn(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new rm(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new nu(e.x-this.wrap,e.y))}}function zl(i,e,r,o,s){(i*=2)<0&&(i=-1*i-1);const u=1<<r;return(u*u*i+u*s+o).toString(36)+r.toString(36)+e.toString(36)}function np(i,e){return e?i.properties[e]:i.id}function R0(i,e){const r={id:i.id};if(e.removeAllProperties&&(delete i.removeProperties,delete i.addOrUpdateProperties,delete e.removeProperties),e.removeProperties)for(const o of e.removeProperties){const s=i.addOrUpdateProperties.findIndex((u=>u.key===o));s>-1&&i.addOrUpdateProperties.splice(s,1)}return(i.removeAllProperties||e.removeAllProperties)&&(r.removeAllProperties=!0),(i.removeProperties||e.removeProperties)&&(r.removeProperties=[...i.removeProperties||[],...e.removeProperties||[]]),(i.addOrUpdateProperties||e.addOrUpdateProperties)&&(r.addOrUpdateProperties=[...i.addOrUpdateProperties||[],...e.addOrUpdateProperties||[]]),(i.newGeometry||e.newGeometry)&&(r.newGeometry=e.newGeometry||i.newGeometry),r}function im(i){var e,r;if(!i)return{};const o={};return o.removeAll=i.removeAll,o.remove=new Set(i.remove||[]),o.add=new Map((e=i.add)===null||e===void 0?void 0:e.map((s=>[s.id,s]))),o.update=new Map((r=i.update)===null||r===void 0?void 0:r.map((s=>[s.id,s]))),o}Zt("CanonicalTileID",ip),Zt("OverscaledTileID",Gn,{omit:["terrainRttPosMatrix32f"]});class Es{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(e){return this.minX=Math.min(this.minX,e.x),this.minY=Math.min(this.minY,e.y),this.maxX=Math.max(this.maxX,e.x),this.maxY=Math.max(this.maxY,e.y),this}expandBy(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(e){return this.expandBy(-e)}map(e){const r=new Es;return r.extend(e(new q(this.minX,this.minY))),r.extend(e(new q(this.maxX,this.minY))),r.extend(e(new q(this.minX,this.maxY))),r.extend(e(new q(this.maxX,this.maxY))),r}static fromPoints(e){const r=new Es;for(const o of e)r.extend(o);return r}contains(e){return e.x>=this.minX&&e.x<=this.maxX&&e.y>=this.minY&&e.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(e){return!this.empty()&&!e.empty()&&e.minX>=this.minX&&e.maxX<=this.maxX&&e.minY>=this.minY&&e.maxY<=this.maxY}intersects(e){return!this.empty()&&!e.empty()&&e.minX<=this.maxX&&e.maxX>=this.minX&&e.minY<=this.maxY&&e.maxY>=this.minY}}class nm{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const o=e[r];this._stringToNumber[o]=r,this._numberToString[r]=o}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class om{constructor(e,r,o,s,u){this.type="Feature",this._vectorTileFeature=e,this._x=o,this._y=s,this._z=r,this.properties=e.properties,this.id=u}projectPoint(e,r,o,s){return[360*(e.x+r)/s-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+o)/s)*Math.PI))-90]}projectLine(e,r,o,s){return e.map((u=>this.projectPoint(u,r,o,s)))}get geometry(){if(this._geometry)return this._geometry;const e=this._vectorTileFeature,r=e.extent*Math.pow(2,this._z),o=e.extent*this._x,s=e.extent*this._y,u=e.loadGeometry();switch(e.type){case 1:{const h=[];for(const g of u)h.push(g[0]);const f=this.projectLine(h,o,s,r);this._geometry=h.length===1?{type:"Point",coordinates:f[0]}:{type:"MultiPoint",coordinates:f};break}case 2:{const h=u.map((f=>this.projectLine(f,o,s,r)));this._geometry=h.length===1?{type:"LineString",coordinates:h[0]}:{type:"MultiLineString",coordinates:h};break}case 3:{const h=xf(u),f=[];for(const g of h)f.push(g.map((y=>this.projectLine(y,o,s,r))));this._geometry=f.length===1?{type:"Polygon",coordinates:f[0]}:{type:"MultiPolygon",coordinates:f};break}default:throw new Error(`unknown feature type: ${e.type}`)}return this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&r!=="_x"&&r!=="_y"&&r!=="_z"&&(e[r]=this[r]);return e}}class Dl{_name;dataBuffer;nullabilityBuffer;_size;constructor(e,r,o){this._name=e,this.dataBuffer=r,typeof o=="number"?this._size=o:(this.nullabilityBuffer=o,this._size=o.size())}getValue(e){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(e)?null:this.getValueFromBuffer(e)}has(e){return this.nullabilityBuffer&&this.nullabilityBuffer.get(e)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class Fh extends Dl{}class op extends Fh{getValueFromBuffer(e){return this.dataBuffer[e]}}class ap extends Fh{getValueFromBuffer(e){return this.dataBuffer[e]}}class am extends Dl{delta;constructor(e,r,o,s){super(e,r,s),this.delta=o}}class sp extends am{constructor(e,r,o,s){super(e,Int32Array.of(r),o,s)}getValueFromBuffer(e){return this.dataBuffer[0]+e*this.delta}}class lp extends Dl{constructor(e,r,o){super(e,Int32Array.of(r),o)}getValueFromBuffer(e){return this.dataBuffer[0]}}class F0{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(e,r,o,s,u=4096){this._name=e,this._geometryVector=r,this._idVector=o,this._propertyVectors=s,this._extent=u}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(e){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((r=>[r.name,r])))),this.propertyVectorsMap.get(e)}*[Symbol.iterator](){const e=this.geometryVector[Symbol.iterator]();let r=0;for(;r<this.numFeatures;){let o;this.idVector&&(o=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(r)):this.idVector.getValue(r));const s=e?.next().value,u={};for(const h of this.propertyVectors){if(!h)continue;const f=h.name,g=h.getValue(r);g!==null&&(u[f]=g)}r++,yield{id:o,geometry:s,properties:u}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const e=[],r=this.geometryVector.getGeometries();for(let o=0;o<this.numFeatures;o++){let s;this.idVector&&(s=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(o)):this.idVector.getValue(o));const u={coordinates:r[o],type:this.geometryVector.geometryType(o)},h={};for(const f of this.propertyVectors){if(!f)continue;const g=f.name,y=f.getValue(o);y!==null&&(h[g]=y)}e.push({id:s,geometry:u,properties:h})}return e}containsMaxSaveIntegerValues(e){return e instanceof op||e instanceof lp&&e instanceof sp||e instanceof ap}}class O0{value;constructor(e){this.value=e}get(){return this.value}set(e){this.value=e}increment(){return this.value++}add(e){this.value+=e}}var Br,Qo,tn,io,As,zn,Gi,qi,sm,qn;function Ki(i,e,r){const o=new Int32Array(r);let s=0,u=e.get();for(let h=0;h<o.length;h++){let f=i[u++],g=127&f;f<128||(f=i[u++],g|=(127&f)<<7,f<128||(f=i[u++],g|=(127&f)<<14,f<128||(f=i[u++],g|=(127&f)<<21,f<128||(f=i[u++],g|=(15&f)<<28)))),o[s++]=g}return e.set(u),o}function Oh(i,e,r){const o=new BigInt64Array(r);for(let s=0;s<o.length;s++)o[s]=N0(i,e);return o}function B0(i,e){let r,o;return o=i[e.get()],e.increment(),r=127&o,o<128?r:(o=i[e.get()],e.increment(),r|=(127&o)<<7,o<128?r:(o=i[e.get()],e.increment(),r|=(127&o)<<14,o<128?r:(o=i[e.get()],e.increment(),r|=(127&o)<<21,o<128?r:(o=i[e.get()],r|=(15&o)<<28,(function(s,u,h){let f,g;if(g=u[h.get()],h.increment(),f=(112&g)>>4,g<128||(g=u[h.get()],h.increment(),f|=(127&g)<<3,g<128)||(g=u[h.get()],h.increment(),f|=(127&g)<<10,g<128)||(g=u[h.get()],h.increment(),f|=(127&g)<<17,g<128)||(g=u[h.get()],h.increment(),f|=(127&g)<<24,g<128)||(g=u[h.get()],h.increment(),f|=(1&g)<<31,g<128))return 4294967296*f+(s>>>0);throw new Error("Expected varint not more than 10 bytes")})(r,i,e)))))}function lm(i,e,r,o){throw new Error("FastPFor is not implemented yet.")}function ks(i){return i>>>1^-(1&i)}function Ll(i){return i>>1n^-(1n&i)}function N0(i,e){let r=0n,o=0,s=e.get();for(;s<i.length;){const u=i[s++];if(r|=BigInt(127&u)<<BigInt(o),!(128&u))break;if(o+=7,o>=64)throw new Error("Varint too long")}return e.set(s),r}function cm(i,e,r){const o=new Int32Array(r);let s=0;for(let u=0;u<e;u++){const h=i[u];o.fill(i[u+e],s,s+h),s+=h}return o}function um(i,e,r){const o=new BigInt64Array(r);let s=0;for(let u=0;u<e;u++){const h=Number(i[u]);o.fill(i[u+e],s,s+h),s+=h}return o}function hm(i,e,r){const o=new Float64Array(r);let s=0;for(let u=0;u<e;u++){const h=i[u];o.fill(i[u+e],s,s+h),s+=h}return o}function cp(i){const e=i.length/4*4;let r=1;if(e>=4)for(let o=i[0];r<e-4;r+=4)o=i[r]+=o,o=i[r+1]+=o,o=i[r+2]+=o,o=i[r+3]+=o;for(;r!=i.length;)i[r]+=i[r-1],++r}function dm(i){i[0]=i[0]>>>1^-(1&i[0]),i[1]=i[1]>>>1^-(1&i[1]);const e=i.length/4*4;let r=2;if(e>=4)for(;r<e-4;r+=4){const o=i[r],s=i[r+1],u=i[r+2],h=i[r+3];i[r]=(o>>>1^-(1&o))+i[r-2],i[r+1]=(s>>>1^-(1&s))+i[r-1],i[r+2]=(u>>>1^-(1&u))+i[r],i[r+3]=(h>>>1^-(1&h))+i[r+1]}for(;r!=i.length;r+=2)i[r]=(i[r]>>>1^-(1&i[r]))+i[r-2],i[r+1]=(i[r+1]>>>1^-(1&i[r+1]))+i[r-1]}(function(i){i.NONE="NONE",i.DELTA="DELTA",i.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",i.RLE="RLE",i.MORTON="MORTON",i.PDE="PDE"})(Br||(Br={})),(function(i){i.NONE="NONE",i.FAST_PFOR="FAST_PFOR",i.VARINT="VARINT",i.ALP="ALP"})(Qo||(Qo={})),(function(i){i.PRESENT="PRESENT",i.DATA="DATA",i.OFFSET="OFFSET",i.LENGTH="LENGTH"})(tn||(tn={}));class up{_dictionaryType;_offsetType;_lengthType;constructor(e,r,o){this._dictionaryType=e,this._offsetType=r,this._lengthType=o}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function mn(i,e){const r=(function(o,s){const u=o[s.get()],h=Object.values(tn)[u>>4];let f=null;switch(h){case tn.DATA:f=new up(Object.values(io)[15&u]);break;case tn.OFFSET:f=new up(null,Object.values(As)[15&u]);break;case tn.LENGTH:f=new up(null,null,Object.values(zn)[15&u])}s.increment();const g=o[s.get()],y=Object.values(Br)[g>>5],b=Object.values(Br)[g>>2&7],C=Object.values(Qo)[3&g];s.increment();const M=Ki(o,s,2),E=M[0];return{physicalStreamType:h,logicalStreamType:f,logicalLevelTechnique1:y,logicalLevelTechnique2:b,physicalLevelTechnique:C,numValues:E,byteLength:M[1],decompressedCount:E}})(i,e);return r.logicalLevelTechnique1===Br.MORTON?(function(o,s,u){const h=Ki(s,u,2);return{physicalStreamType:o.physicalStreamType,logicalStreamType:o.logicalStreamType,logicalLevelTechnique1:o.logicalLevelTechnique1,logicalLevelTechnique2:o.logicalLevelTechnique2,physicalLevelTechnique:o.physicalLevelTechnique,numValues:o.numValues,byteLength:o.byteLength,decompressedCount:o.decompressedCount,numBits:h[0],coordinateShift:h[1]}})(r,i,e):Br.RLE!==r.logicalLevelTechnique1&&Br.RLE!==r.logicalLevelTechnique2||Qo.NONE===r.physicalLevelTechnique?r:(function(o,s,u){const h=Ki(s,u,2);return{physicalStreamType:o.physicalStreamType,logicalStreamType:o.logicalStreamType,logicalLevelTechnique1:o.logicalLevelTechnique1,logicalLevelTechnique2:o.logicalLevelTechnique2,physicalLevelTechnique:o.physicalLevelTechnique,numValues:o.numValues,byteLength:o.byteLength,decompressedCount:h[1],runs:h[0],numRleValues:h[1]}})(r,i,e)}(function(i){i.NONE="NONE",i.SINGLE="SINGLE",i.SHARED="SHARED",i.VERTEX="VERTEX",i.MORTON="MORTON",i.FSST="FSST"})(io||(io={})),(function(i){i.VERTEX="VERTEX",i.INDEX="INDEX",i.STRING="STRING",i.KEY="KEY"})(As||(As={})),(function(i){i.VAR_BINARY="VAR_BINARY",i.GEOMETRIES="GEOMETRIES",i.PARTS="PARTS",i.RINGS="RINGS",i.TRIANGLES="TRIANGLES",i.SYMBOL="SYMBOL",i.DICTIONARY="DICTIONARY"})(zn||(zn={})),(function(i){i[i.FLAT=0]="FLAT",i[i.CONST=1]="CONST",i[i.SEQUENCE=2]="SEQUENCE",i[i.DICTIONARY=3]="DICTIONARY",i[i.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(Gi||(Gi={}));class no{values;_size;constructor(e,r){this.values=e,this._size=r}get(e){const r=Math.floor(e/8);return(this.values[r]>>e%8&1)==1}set(e,r){const o=Math.floor(e/8);this.values[o]=this.values[o]|(r?1:0)<<e%8}getInt(e){const r=Math.floor(e/8);return this.values[r]>>e%8&1}size(){return this._size}getBuffer(){return this.values}}function gn(i,e,r,o,s){return(function(u,h,f){switch(h.logicalLevelTechnique1){case Br.DELTA:return h.logicalLevelTechnique2===Br.RLE?(function(g,y,b){const C=new Int32Array(b);let M=0,E=0;for(let z=0;z<y;z++){const D=g[z],F=ks(g[z+y]);for(let j=0;j<D;j++)E+=F,C[M++]=E}return C})(u,h.runs,h.numRleValues):((function(g){g[0]=g[0]>>>1^-(1&g[0]);const y=g.length/4*4;let b=1;if(y>=4)for(;b<y-4;b+=4){const C=g[b],M=g[b+1],E=g[b+2],z=g[b+3];g[b]=(C>>>1^-(1&C))+g[b-1],g[b+1]=(M>>>1^-(1&M))+g[b],g[b+2]=(E>>>1^-(1&E))+g[b+1],g[b+3]=(z>>>1^-(1&z))+g[b+2]}for(;b!=g.length;++b)g[b]=(g[b]>>>1^-(1&g[b]))+g[b-1]})(u),u);case Br.RLE:return(function(g,y,b){return b?(function(C,M,E){const z=new Int32Array(E);let D=0;for(let F=0;F<M;F++){const j=C[F];let J=C[F+M];J=J>>>1^-(1&J),z.fill(J,D,D+j),D+=j}return z})(g,y.runs,y.numRleValues):cm(g,y.runs,y.numRleValues)})(u,h,f);case Br.MORTON:return cp(u),u;case Br.COMPONENTWISE_DELTA:return dm(u),u;case Br.NONE:return f&&(function(g){for(let y=0;y<g.length;y++){const b=g[y];g[y]=b>>>1^-(1&b)}})(u),u;default:throw new Error(`The specified Logical level technique is not supported: ${h.logicalLevelTechnique1}`)}})(Bh(i,e,r),r,o)}function Da(i,e,r){return(function(o,s){if(s.logicalLevelTechnique1===Br.DELTA&&s.logicalLevelTechnique2===Br.NONE)return(function(h){const f=new Int32Array(h.length+1);f[0]=0,f[1]=ks(h[0]);let g=f[1],y=2;for(;y!=f.length;++y){const b=h[y-1];g+=b>>>1^-(1&b),f[y]=f[y-1]+g}return f})(o);if(s.logicalLevelTechnique1===Br.RLE&&s.logicalLevelTechnique2===Br.NONE)return(function(h,f,g){const y=new Int32Array(g+1);y[0]=0;let b=1,C=y[0];for(let M=0;M<f;M++){const E=h[M],z=h[M+f];for(let D=b;D<b+E;D++)y[D]=z+C,C=y[D];b+=E}return y})(o,s.runs,s.numRleValues);if(s.logicalLevelTechnique1===Br.NONE&&s.logicalLevelTechnique2===Br.NONE){(function(h){let f=0;for(let g=0;g<h.length;g++)h[g]+=f,f=h[g]})(o);const u=new Int32Array(s.numValues+1);return u[0]=0,u.set(o,1),u}if(s.logicalLevelTechnique1===Br.DELTA&&s.logicalLevelTechnique2===Br.RLE){const u=(function(h,f,g){const y=new Int32Array(g+1);y[0]=0;let b=1,C=y[0];for(let M=0;M<f;M++){const E=h[M];let z=h[M+f];z=z>>>1^-(1&z);for(let D=b;D<b+E;D++)y[D]=z+C,C=y[D];b+=E}return y})(o,s.runs,s.numRleValues);return cp(u),u}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")})(Bh(i,e,r),r)}function Bh(i,e,r){const o=r.physicalLevelTechnique;if(o===Qo.FAST_PFOR)return lm();if(o===Qo.VARINT)return Ki(i,e,r.numValues);if(o===Qo.NONE){const s=e.get();e.add(r.byteLength);const u=i.subarray(s,e.get());return new Int32Array(u)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function hp(i,e,r,o){const s=Bh(i,e,r);if(s.length===1){const u=s[0];return o?ks(u):u}return o?(function(u){return ks(u[1])})(s):(function(u){return u[1]})(s)}function pm(i,e,r){return(function(o){if(o.length==2){const s=ks(o[1]);return[s,s]}return[ks(o[2]),ks(o[3])]})(Bh(i,e,r))}function fm(i,e,r){return(function(o){if(o.length==2){const s=Ll(o[1]);return[s,s]}return[Ll(o[2]),Ll(o[3])]})(Oh(i,e,r.numValues))}function mm(i,e,r,o){return(function(s,u,h){switch(u.logicalLevelTechnique1){case Br.DELTA:return u.logicalLevelTechnique2===Br.RLE?(function(f,g,y){const b=new BigInt64Array(y);let C=0,M=0n;for(let E=0;E<g;E++){const z=Number(f[E]),D=Ll(f[E+g]);for(let F=0;F<z;F++)M+=D,b[C++]=M}return b})(s,u.runs,u.numRleValues):((function(f){f[0]=f[0]>>1n^-(1n&f[0]);const g=f.length/4*4;let y=1;if(g>=4)for(;y<g-4;y+=4){const b=f[y],C=f[y+1],M=f[y+2],E=f[y+3];f[y]=(b>>1n^-(1n&b))+f[y-1],f[y+1]=(C>>1n^-(1n&C))+f[y],f[y+2]=(M>>1n^-(1n&M))+f[y+1],f[y+3]=(E>>1n^-(1n&E))+f[y+2]}for(;y!=f.length;++y)f[y]=(f[y]>>1n^-(1n&f[y]))+f[y-1]})(s),s);case Br.RLE:return(function(f,g,y){return y?(function(b,C,M){const E=new BigInt64Array(M);let z=0;for(let D=0;D<C;D++){const F=Number(b[D]);let j=b[D+C];j=j>>1n^-(1n&j),E.fill(j,z,z+F),z+=F}return E})(f,g.runs,g.numRleValues):um(f,g.runs,g.numRleValues)})(s,u,h);case Br.NONE:return h&&(function(f){for(let g=0;g<f.length;g++){const y=f[g];f[g]=y>>1n^-(1n&y)}})(s),s;default:throw new Error(`The specified Logical level technique is not supported: ${u.logicalLevelTechnique1}`)}})(Oh(i,e,r.numValues),r,o)}function gm(i,e,r,o){const s=Oh(i,e,r.numValues);if(s.length===1){const u=s[0];return o?Ll(u):u}return o?(function(u){return Ll(u[1])})(s):(function(u){return u[1]})(s)}function dp(i,e,r,o,s){return(function(u,h,f,g){switch(h.logicalLevelTechnique1){case Br.DELTA:return h.logicalLevelTechnique2===Br.RLE&&(u=cm(u,h.runs,h.numRleValues)),(function(y,b){const C=new Int32Array(y.size());let M=0;y.get(0)?(C[0]=y.get(0)?b[0]>>>1^-(1&b[0]):0,M=1):C[0]=0;let E=1;for(;E!=C.length;++E)C[E]=y.get(E)?C[E-1]+(b[M]>>>1^-(1&b[M++])):C[E-1];return C})(g,u);case Br.RLE:return(function(y,b,C,M){const E=b;return C?(function(z,D,F){const j=new Int32Array(z.size());let J=0;for(let U=0;U<F;U++){const H=D[U];let re=D[U+F];re=re>>>1^-(1&re);for(let ge=J;ge<J+H;ge++)z.get(ge)?j[ge]=re:(j[ge]=0,J++);J+=H}return j})(M,y,E.runs):(function(z,D,F){const j=new Int32Array(z.size());let J=0;for(let U=0;U<F;U++){const H=D[U],re=D[U+F];for(let ge=J;ge<J+H;ge++)z.get(ge)?j[ge]=re:(j[ge]=0,J++);J+=H}return j})(M,y,E.runs)})(u,h,f,g);case Br.MORTON:return cp(u),u;case Br.COMPONENTWISE_DELTA:return dm(u),u;case Br.NONE:return u=f?(function(y,b){const C=new Int32Array(y.size());let M=0,E=0;for(;E!=C.length;++E)if(y.get(E)){const z=b[M++];C[E]=z>>>1^-(1&z)}else C[E]=0;return C})(g,u):(function(y,b){const C=new Int32Array(y.size());let M=0,E=0;for(;E!=C.length;++E)C[E]=y.get(E)?b[M++]:0;return C})(g,u),u;default:throw new Error("The specified Logical level technique is not supported")}})(r.physicalLevelTechnique===Qo.FAST_PFOR?lm():Ki(i,e,r.numValues),r,o,s)}function Nh(i,e,r,o){const s=i.logicalLevelTechnique1;if(s===Br.RLE)return i.runs===1?Gi.CONST:Gi.FLAT;const u=e instanceof no?e.size():e;if(s===Br.DELTA&&i.logicalLevelTechnique2===Br.RLE){const h=i.runs,f=2;if(i.numRleValues!==u)return Gi.FLAT;if(h===1)return Gi.SEQUENCE;if(h===2){const g=o.get();let y;if(i.physicalLevelTechnique===Qo.VARINT)y=Ki(r,o,4);else{const b=o.get();y=new Int32Array(r.buffer,r.byteOffset+b,4)}if(o.set(g),y[2]===f&&y[3]===f)return Gi.SEQUENCE}}return i.numValues===1?Gi.CONST:Gi.FLAT}class _m extends Fh{getValueFromBuffer(e){return this.dataBuffer[e]}}class vm extends am{constructor(e,r,o,s){super(e,BigInt64Array.of(r),o,s)}getValueFromBuffer(e){return this.dataBuffer[0]+BigInt(e)*this.delta}}class Rl{_geometryOffsets;_partOffsets;_ringOffsets;constructor(e,r,o){this._geometryOffsets=e,this._partOffsets=r,this._ringOffsets=o}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function pp(i,e,r){return{x:ym(i,e)-r,y:ym(i>>1,e)-r}}function ym(i,e){let r=0;for(let o=0;o<e;o++)r|=(i&1<<2*o)>>o;return r}(function(i){i[i.POINT=0]="POINT",i[i.LINESTRING=1]="LINESTRING",i[i.POLYGON=2]="POLYGON",i[i.MULTIPOINT=3]="MULTIPOINT",i[i.MULTILINESTRING=4]="MULTILINESTRING",i[i.MULTIPOLYGON=5]="MULTIPOLYGON"})(qi||(qi={})),(function(i){i[i.POINT=0]="POINT",i[i.LINESTRING=1]="LINESTRING",i[i.POLYGON=2]="POLYGON"})(sm||(sm={})),(function(i){i[i.MORTON=0]="MORTON",i[i.VEC_2=1]="VEC_2",i[i.VEC_3=2]="VEC_3"})(qn||(qn={}));class V0{createPoint(e){return[[e]]}createMultiPoint(e){return e.map((r=>[r]))}createLineString(e){return[e]}createMultiLineString(e){return e}createPolygon(e,r){return[e].concat(r)}createMultiPolygon(e){return e.flat()}}function xm(i){const e=new Array(i.numGeometries);let r=1,o=1,s=1,u=0;const h=new V0;let f=0,g=0;const y=i.mortonSettings,b=i.topologyVector,C=b.geometryOffsets,M=b.partOffsets,E=b.ringOffsets,z=i.vertexOffsets,D=i.containsPolygonGeometry(),F=i.vertexBuffer;for(let j=0;j<i.numGeometries;j++){const J=i.geometryType(j);if(J===qi.POINT){if(z&&z.length!==0)if(i.vertexBufferType===qn.VEC_2){const U=2*z[g++],H=new q(F[U],F[U+1]);e[u++]=h.createPoint(H)}else{const U=pp(F[z[g++]],y.numBits,y.coordinateShift),H=new q(U.x,U.y);e[u++]=h.createPoint(H)}else{const U=new q(F[f++],F[f++]);e[u++]=h.createPoint(U)}C&&s++,M&&r++,E&&o++}else if(J===qi.MULTIPOINT){const U=C[s]-C[s-1];s++;const H=new Array(U);if(z&&z.length!==0){for(let re=0;re<U;re++){const ge=2*z[g++];H[re]=new q(F[ge],F[ge+1])}e[u++]=h.createMultiPoint(H)}else{for(let re=0;re<U;re++){const ge=F[f++],je=F[f++];H[re]=new q(ge,je)}e[u++]=h.createMultiPoint(H)}}else if(J===qi.LINESTRING){let U,H=0;D?(H=E[o]-E[o-1],o++):H=M[r]-M[r-1],r++,z&&z.length!==0?(U=i.vertexBufferType===qn.VEC_2?mp(F,z,g,H,!1):gp(F,z,g,H,!1,y),g+=H):(U=fp(F,f,H,!1),f+=2*H),e[u++]=h.createLineString(U),C&&s++}else if(J===qi.POLYGON){const U=M[r]-M[r-1];r++;const H=new Array(U-1);let re=E[o]-E[o-1];if(o++,z&&z.length!==0){const ge=i.vertexBufferType===qn.VEC_2?jh(F,z,g,re):Uh(F,z,g,re,0,y);g+=re;for(let je=0;je<H.length;je++)re=E[o]-E[o-1],o++,H[je]=i.vertexBufferType===qn.VEC_2?jh(F,z,g,re):Uh(F,z,g,re,0,y),g+=re;e[u++]=h.createPolygon(ge,H)}else{const ge=Vh(F,f,re);f+=2*re;for(let je=0;je<H.length;je++)re=E[o]-E[o-1],o++,H[je]=Vh(F,f,re),f+=2*re;e[u++]=h.createPolygon(ge,H)}C&&s++}else if(J===qi.MULTILINESTRING){const U=C[s]-C[s-1];s++;const H=new Array(U);if(z&&z.length!==0){for(let re=0;re<U;re++){let ge=0;D?(ge=E[o]-E[o-1],o++):ge=M[r]-M[r-1],r++;const je=i.vertexBufferType===qn.VEC_2?mp(F,z,g,ge,!1):gp(F,z,g,ge,!1,y);H[re]=je,g+=ge}e[u++]=h.createMultiLineString(H)}else{for(let re=0;re<U;re++){let ge=0;D?(ge=E[o]-E[o-1],o++):ge=M[r]-M[r-1],r++,H[re]=fp(F,f,ge,!1),f+=2*ge}e[u++]=h.createMultiLineString(H)}}else{if(J!==qi.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const U=C[s]-C[s-1];s++;const H=new Array(U);let re=0;if(z&&z.length!==0){for(let ge=0;ge<U;ge++){const je=M[r]-M[r-1];r++;const mt=new Array(je-1);re=E[o]-E[o-1],o++;const ht=i.vertexBufferType===qn.VEC_2?jh(F,z,g,re):Uh(F,z,g,re,0,y);g+=re;for(let _t=0;_t<mt.length;_t++)re=E[o]-E[o-1],o++,mt[_t]=i.vertexBufferType===qn.VEC_2?jh(F,z,g,re):Uh(F,z,g,re,0,y),g+=re;H[ge]=h.createPolygon(ht,mt)}e[u++]=h.createMultiPolygon(H)}else{for(let ge=0;ge<U;ge++){const je=M[r]-M[r-1];r++;const mt=new Array(je-1);re=E[o]-E[o-1],o++;const ht=Vh(F,f,re);f+=2*re;for(let _t=0;_t<mt.length;_t++){const Dt=E[o]-E[o-1];o++,mt[_t]=Vh(F,f,Dt),f+=2*Dt}H[ge]=h.createPolygon(ht,mt)}e[u++]=h.createMultiPolygon(H)}}}}return e}function Vh(i,e,r){return fp(i,e,r,!0)}function jh(i,e,r,o){return mp(i,e,r,o,!0)}function Uh(i,e,r,o,s,u){return gp(i,e,r,o,!0,u)}function fp(i,e,r,o){const s=new Array(o?r+1:r);for(let u=0;u<2*r;u+=2)s[u/2]=new q(i[e+u],i[e+u+1]);return o&&(s[s.length-1]=s[0]),s}function mp(i,e,r,o,s){const u=new Array(s?o+1:o);for(let h=0;h<2*o;h+=2){const f=2*e[r+h/2];u[h/2]=new q(i[f],i[f+1])}return s&&(u[u.length-1]=u[0]),u}function gp(i,e,r,o,s,u){const h=new Array(s?o+1:o);for(let f=0;f<o;f++){const g=pp(i[e[r+f]],u.numBits,u.coordinateShift);h[f]=new q(g.x,g.y)}return s&&(h[h.length-1]=h[0]),h}class bm{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(e,r,o,s,u){this._vertexBufferType=e,this._topologyVector=r,this._vertexOffsets=o,this._vertexBuffer=s,this._mortonSettings=u}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const e=xm(this);let r=0;for(;r<this.numGeometries;)yield{coordinates:e[r],type:this.geometryType(r)},r++}getSimpleEncodedVertex(e){const r=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[r],this.vertexBuffer[r+1]]}getVertex(e){if(this.vertexOffsets&&this.mortonSettings){const o=pp(this.vertexBuffer[this.vertexOffsets[e]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[o.x,o.y]}const r=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[r],this.vertexBuffer[r+1]]}getGeometries(){return xm(this)}get mortonSettings(){return this._mortonSettings}}class wm extends bm{_numGeometries;_geometryType;constructor(e,r,o,s,u,h,f){super(o,s,u,h,f),this._numGeometries=e,this._geometryType=r}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===qi.POLYGON||this._geometryType===qi.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class Tm extends bm{_geometryTypes;constructor(e,r,o,s,u,h){super(e,o,s,u,h),this._geometryTypes=r}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let e=0;e<this.numGeometries;e++)if(this.geometryType(e)===qi.POLYGON||this.geometryType(e)===qi.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class Cm{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(e,r,o,s){this._triangleOffsets=e,this._indexBuffer=r,this._vertexBuffer=o,this._topologyVector=s}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const e=new Array(this.numGeometries),r=this._topologyVector,o=r.partOffsets,s=r.ringOffsets,u=r.geometryOffsets;let h=0,f=1,g=1,y=1;for(let b=0;b<this.numGeometries;b++)switch(this.geometryType(b)){case qi.POLYGON:{const C=o[f]-o[f-1];f++;const M=[];for(let E=0;E<C;E++){const z=s[g]-s[g-1];g++;const D=[];for(let F=0;F<z;F++){const j=this._vertexBuffer[h++],J=this._vertexBuffer[h++];D.push(new q(j,J))}D.length>0&&D.push(D[0]),M.push(D)}e[b]=M,u&&y++}break;case qi.MULTIPOLYGON:{const C=u[y]-u[y-1];y++;const M=[];for(let E=0;E<C;E++){const z=o[f]-o[f-1];f++;for(let D=0;D<z;D++){const F=s[g]-s[g-1];g++;const j=[];for(let J=0;J<F;J++){const U=this._vertexBuffer[h++],H=this._vertexBuffer[h++];j.push(new q(U,H))}j.length>0&&j.push(j[0]),M.push(j)}}e[b]=M}}return e}[Symbol.iterator](){return null}}function Sm(i,e,r,o,s,u){return new j0(i,e,r,o,s,u)}class j0 extends Cm{_numGeometries;_geometryType;constructor(e,r,o,s,u,h){super(o,s,u,h),this._numGeometries=e,this._geometryType=r}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function Pm(i,e,r,o,s){return new U0(i,e,r,o,s)}class U0 extends Cm{_geometryTypes;constructor(e,r,o,s,u){super(r,o,s,u),this._geometryTypes=e}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function G0(i,e,r,o,s){const u=mn(i,r);let h=null,f=null,g=null,y=null,b=null,C=null,M=null,E=null;if(Nh(u,o,i,r)===Gi.CONST){const D=hp(i,r,u,!1);for(let F=0;F<e-1;F++){const j=mn(i,r);switch(j.physicalStreamType){case tn.LENGTH:switch(j.logicalStreamType.lengthType){case zn.GEOMETRIES:h=Da(i,r,j);break;case zn.PARTS:f=Da(i,r,j);break;case zn.RINGS:g=Da(i,r,j);break;case zn.TRIANGLES:M=Da(i,r,j)}break;case tn.OFFSET:switch(j.logicalStreamType.offsetType){case As.VERTEX:y=gn(i,r,j,!1);break;case As.INDEX:E=gn(i,r,j,!1)}break;case tn.DATA:io.VERTEX===j.logicalStreamType.dictionaryType?b=gn(i,r,j,!0):(C={numBits:j.numBits,coordinateShift:j.coordinateShift},b=gn(i,r,j,!1))}}return E!==null?h!=null||f!=null?Sm(o,D,M,E,b,new Rl(h,f,g)):Sm(o,D,M,E,b):C===null?(function(F,j,J,U,H){return new wm(F,j,qn.VEC_2,J,U,H)})(o,D,new Rl(h,f,g),y,b):(function(F,j,J,U,H,re){return new wm(F,j,qn.MORTON,J,U,H,re)})(o,D,new Rl(h,f,g),y,b,C)}const z=gn(i,r,u,!1);for(let D=0;D<e-1;D++){const F=mn(i,r);switch(F.physicalStreamType){case tn.LENGTH:switch(F.logicalStreamType.lengthType){case zn.GEOMETRIES:h=gn(i,r,F,!1);break;case zn.PARTS:f=gn(i,r,F,!1);break;case zn.RINGS:g=gn(i,r,F,!1);break;case zn.TRIANGLES:M=Da(i,r,F)}break;case tn.OFFSET:switch(F.logicalStreamType.offsetType){case As.VERTEX:y=gn(i,r,F,!1);break;case As.INDEX:E=gn(i,r,F,!1)}break;case tn.DATA:io.VERTEX===F.logicalStreamType.dictionaryType?b=gn(i,r,F,!0):(C={numBits:F.numBits,coordinateShift:F.coordinateShift},b=gn(i,r,F,!1))}}return E!==null&&f===null?Pm(z,M,E,b):(h!==null?(h=_p(z,h,2),f!==null&&g!==null?(f=Im(z,h,f,!1),g=(function(D,F,j,J){const U=new Int32Array(j[j.length-1]+1);let H=0;U[0]=H;let re=1,ge=1,je=0;for(let mt=0;mt<D.length;mt++){const ht=D[mt],_t=F[mt+1]-F[mt];if(ht!==0&&ht!==3)for(let Dt=0;Dt<_t;Dt++){const Ct=j[re]-j[re-1];re++;for(let ct=0;ct<Ct;ct++)H=U[ge++]=H+J[je++]}else for(let Dt=0;Dt<_t;Dt++)U[ge++]=++H,re++}return U})(z,h,f,g)):f!==null&&(f=(function(D,F,j){const J=new Int32Array(F[F.length-1]+1);let U=0;J[0]=U;let H=1,re=0;for(let ge=0;ge<D.length;ge++){const je=D[ge],mt=F[ge+1]-F[ge];if(je===4||je===1)for(let ht=0;ht<mt;ht++)U=J[H++]=U+j[re++];else for(let ht=0;ht<mt;ht++)J[H++]=++U}return J})(z,h,f))):f!==null&&g!==null?(f=_p(z,f,1),g=Im(z,f,g,!0)):f!==null&&(f=_p(z,f,0)),E!==null?Pm(z,M,E,b,new Rl(h,f,g)):C===null?(function(D,F,j,J){return new Tm(qn.VEC_2,D,F,j,J)})(z,new Rl(h,f,g),y,b):(function(D,F,j,J,U){return new Tm(qn.MORTON,D,F,j,J,U)})(z,new Rl(h,f,g),y,b,C))}function _p(i,e,r){const o=new Int32Array(i.length+1);let s=0;o[0]=s;let u=0;for(let h=0;h<i.length;h++)s=o[h+1]=s+(i[h]>r?e[u++]:1);return o}function Im(i,e,r,o){const s=new Int32Array(e[e.length-1]+1);let u=0;s[0]=u;let h=1,f=0;for(let g=0;g<i.length;g++){const y=i[g],b=e[g+1]-e[g];if(y===5||y===2||o&&(y===4||y===1))for(let C=0;C<b;C++)u=s[h++]=u+r[f++];else for(let C=0;C<b;C++)s[h++]=++u}return s}class q0 extends Dl{dataVector;constructor(e,r,o){super(e,r.getBuffer(),o),this.dataVector=r}getValueFromBuffer(e){return this.dataVector.get(e)}}class Z0 extends Fh{getValueFromBuffer(e){return this.dataBuffer[e]}}class Mm extends Dl{constructor(e,r,o){super(e,BigInt64Array.of(r),o)}getValueFromBuffer(e){return this.dataBuffer[0]}}function ou(i,e,r){return Em(i,Math.ceil(e/8),r)}function Em(i,e,r){const o=new Uint8Array(e);let s=0;for(;s<e;){const u=i[r.increment()];if(u<=127){const h=u+3,f=i[r.increment()],g=s+h;o.fill(f,s,g),s=g}else{const h=256-u;for(let f=0;f<h;f++)o[s++]=i[r.increment()]}}return o}const H0=new TextDecoder;function vp(i,e,r){return r-e>=12?H0.decode(i.subarray(e,r)):(function(o,s,u){let h="",f=s;for(;f<u;){const g=o[f];let y,b,C,M=null,E=g>239?4:g>223?3:g>191?2:1;if(f+E>u)break;E===1?g<128&&(M=g):E===2?(y=o[f+1],(192&y)==128&&(M=(31&g)<<6|63&y,M<=127&&(M=null))):E===3?(y=o[f+1],b=o[f+2],(192&y)==128&&(192&b)==128&&(M=(15&g)<<12|(63&y)<<6|63&b,(M<=2047||M>=55296&&M<=57343)&&(M=null))):E===4&&(y=o[f+1],b=o[f+2],C=o[f+3],(192&y)==128&&(192&b)==128&&(192&C)==128&&(M=(15&g)<<18|(63&y)<<12|(63&b)<<6|63&C,(M<=65535||M>=1114112)&&(M=null))),M===null?(M=65533,E=1):M>65535&&(M-=65536,h+=String.fromCharCode(M>>>10&1023|55296),M=56320|1023&M),h+=String.fromCharCode(M),f+=E}return h})(i,e,r)}class yp extends Dl{offsetBuffer;constructor(e,r,o,s){super(e,o,s),this.offsetBuffer=r}}class Am extends yp{textEncoder;constructor(e,r,o,s){super(e,r,o,s??r.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(e){return vp(this.dataBuffer,this.offsetBuffer[e],this.offsetBuffer[e+1])}}class Fl extends yp{indexBuffer;textEncoder;constructor(e,r,o,s,u){super(e,o,s,u??r.length),this.indexBuffer=r,this.indexBuffer=r,this.textEncoder=new TextEncoder}getValueFromBuffer(e){const r=this.indexBuffer[e];return vp(this.dataBuffer,this.offsetBuffer[r],this.offsetBuffer[r+1])}}class km extends yp{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(e,r,o,s,u,h,f){super(e,o,s,f),this.indexBuffer=r,this.symbolOffsetBuffer=u,this.symbolTableBuffer=h,this.textEncoder=new TextEncoder}getValueFromBuffer(e){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(o,s,u){const h=[],f=new Array(s.length).fill(0);for(let g=1;g<s.length;g++)f[g]=f[g-1]+s[g-1];for(let g=0;g<u.length;g++)if(u[g]===255)h.push(u[++g]);else{const y=s[u[g]],b=f[u[g]];for(let C=0;C<y;C++)h.push(o[b+C])}return new Uint8Array(h)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const r=this.indexBuffer[e];return vp(this.decodedDictionary,this.offsetBuffer[r],this.offsetBuffer[r+1])}offsetToLengthBuffer(e){const r=new Uint32Array(e.length-1);let o=e[0];for(let s=1;s<e.length;s++){const u=e[s];r[s-1]=u-o,o=u}return r}}function W0(i,e,r,o,s,u){return r.type==="scalarType"?(function(h,f,g,y,b,C){let M=null,E=0;if(h===0)return null;if(C.nullable){const D=mn(f,g);E=D.numValues;const F=g.get(),j=ou(f,E,g);g.set(F+D.byteLength),M=new no(j,D.numValues)}const z=M??y;switch(b.physicalType){case 4:case 3:return(function(D,F,j,J,U){const H=mn(D,F),re=Nh(H,U,D,F),ge=J.physicalType===3;if(re===Gi.FLAT){const je=au(U)?dp(D,F,H,ge,U):gn(D,F,H,ge);return new op(j.name,je,U)}if(re===Gi.SEQUENCE){const je=pm(D,F,H);return new sp(j.name,je[0],je[1],H.numRleValues)}{const je=hp(D,F,H,ge);return new lp(j.name,je,U)}})(f,g,C,b,z);case 9:return(function(D,F,j,J,U){let H=null,re=null,ge=null,je=null,mt=null,ht=null,_t=null,Dt=null;for(let Ct=0;Ct<J;Ct++){const ct=mn(F,j);if(ct.byteLength!==0)switch(ct.physicalStreamType){case tn.PRESENT:{const tt=ou(F,ct.numValues,j);ht=new no(tt,ct.numValues);break}case tn.OFFSET:re=U!=null||ht!=null?dp(F,j,ct,!1,U??ht):gn(F,j,ct,!1);break;case tn.LENGTH:{const tt=Da(F,j,ct);zn.DICTIONARY===ct.logicalStreamType.lengthType?H=tt:zn.SYMBOL===ct.logicalStreamType.lengthType?je=tt:_t=tt;break}case tn.DATA:{const tt=F.subarray(j.get(),j.get()+ct.byteLength);j.add(ct.byteLength);const Ut=ct.logicalStreamType.dictionaryType;io.FSST===Ut?mt=tt:io.SINGLE===Ut||io.SHARED===Ut?ge=tt:io.NONE===Ut&&(Dt=tt);break}}}return(function(Ct,ct,tt,Ut,Vt,Wt,jt){return ct?new km(Ct,tt,Ut,Vt,Wt,ct,jt):null})(D,mt,re,H,ge,je,U??ht)??(function(Ct,ct,tt,Ut,Vt){return ct?Vt?new Fl(Ct,tt,Ut,ct,Vt):new Fl(Ct,tt,Ut,ct):null})(D,ge,re,H,U??ht)??(function(Ct,ct,tt,Ut,Vt){if(!ct||!tt)return null;if(Ut)return Vt?new Fl(Ct,Ut,ct,tt,Vt):new Fl(Ct,Ut,ct,tt);if(Vt&&Vt.size()!==ct.length-1){const Wt=new Int32Array(Vt.size());let jt=0;for(let er=0;er<Vt.size();er++)Wt[er]=Vt.get(er)?jt++:0;return new Fl(Ct,Wt,ct,tt,Vt)}return Vt?new Am(Ct,ct,tt,Vt):new Am(Ct,ct,tt)})(D,_t,Dt,re,U??ht)})(C.name,f,g,C.nullable?h-1:h,M);case 0:return(function(D,F,j,J,U){const H=mn(D,F),re=H.numValues,ge=F.get(),je=au(U)?(function(ht,_t,Dt,Ct){const ct=Em(ht,Math.ceil(_t/8),Dt),tt=new no(ct,_t),Ut=Ct.size(),Vt=new no(new Uint8Array(Ut),Ut);let Wt=0;for(let jt=0;jt<Ct.size();jt++){const er=!!Ct.get(jt)&&tt.get(Wt++);Vt.set(jt,er)}return Vt.getBuffer()})(D,re,F,U):ou(D,re,F);F.set(ge+H.byteLength);const mt=new no(je,re);return new q0(j.name,mt,U)})(f,g,C,0,z);case 6:case 5:return(function(D,F,j,J,U){const H=mn(D,F),re=Nh(H,J,D,F),ge=U.physicalType===5;if(re===Gi.FLAT){const je=au(J)?(function(mt,ht,_t,Dt,Ct){return(function(ct,tt,Ut,Vt){switch(tt.logicalLevelTechnique1){case Br.DELTA:return tt.logicalLevelTechnique2===Br.RLE&&(ct=um(ct,tt.runs,tt.numRleValues)),(function(Wt,jt){const er=new BigInt64Array(Wt.size());let Wr=0;Wt.get(0)?(er[0]=Wt.get(0)?jt[0]>>1n^-(1n&jt[0]):0n,Wr=1):er[0]=0n;let Or=1;for(;Or!=er.length;++Or)er[Or]=Wt.get(Or)?er[Or-1]+(jt[Wr]>>1n^-(1n&jt[Wr++])):er[Or-1];return er})(Vt,ct);case Br.RLE:return(function(Wt,jt,er,Wr){const Or=jt;return er?(function(mi,nn,Fi){const gi=new BigInt64Array(mi.size());let ui=0;for(let Yr=0;Yr<Fi;Yr++){const Si=Number(nn[Yr]);let ki=nn[Yr+Fi];ki=ki>>1n^-(1n&ki);for(let si=ui;si<ui+Si;si++)mi.get(si)?gi[si]=ki:(gi[si]=0n,ui++);ui+=Si}return gi})(Wr,Wt,Or.runs):(function(mi,nn,Fi){const gi=new BigInt64Array(mi.size());let ui=0;for(let Yr=0;Yr<Fi;Yr++){const Si=Number(nn[Yr]),ki=nn[Yr+Fi];for(let si=ui;si<ui+Si;si++)mi.get(si)?gi[si]=ki:(gi[si]=0n,ui++);ui+=Si}return gi})(Wr,Wt,Or.runs)})(ct,tt,Ut,Vt);case Br.NONE:return ct=Ut?(function(Wt,jt){const er=new BigInt64Array(Wt.size());let Wr=0,Or=0;for(;Or!=er.length;++Or)if(Wt.get(Or)){const mi=jt[Wr++];er[Or]=mi>>1n^-(1n&mi)}else er[Or]=0n;return er})(Vt,ct):(function(Wt,jt){const er=new BigInt64Array(Wt.size());let Wr=0,Or=0;for(;Or!=er.length;++Or)er[Or]=Wt.get(Or)?jt[Wr++]:0n;return er})(Vt,ct),ct;default:throw new Error("The specified Logical level technique is not supported")}})(Oh(mt,ht,_t.numValues),_t,Dt,Ct)})(D,F,H,ge,J):mm(D,F,H,ge);return new _m(j.name,je,J)}if(re===Gi.SEQUENCE){const je=fm(D,F,H);return new vm(j.name,je[0],je[1],H.numRleValues)}{const je=gm(D,F,H,ge);return new Mm(j.name,je,J)}})(f,g,C,z,b);case 7:return(function(D,F,j,J){const U=mn(D,F),H=au(J)?(function(re,ge,je,mt){const ht=ge.get(),_t=ht+mt*Float32Array.BYTES_PER_ELEMENT,Dt=new Uint8Array(re.subarray(ht,_t)).buffer,Ct=new Float32Array(Dt);ge.set(_t);const ct=je.size(),tt=new Float32Array(ct);let Ut=0;for(let Vt=0;Vt<ct;Vt++)tt[Vt]=je.get(Vt)?Ct[Ut++]:0;return tt})(D,F,J,U.numValues):(function(re,ge,je){const mt=ge.get(),ht=mt+je*Float32Array.BYTES_PER_ELEMENT,_t=new Uint8Array(re.subarray(mt,ht)).buffer,Dt=new Float32Array(_t);return ge.set(ht),Dt})(D,F,U.numValues);return new Z0(j.name,H,J)})(f,g,C,z);case 8:return(function(D,F,j,J){const U=mn(D,F),H=au(J)?(function(re,ge,je,mt){const ht=ge.get(),_t=ht+mt*Float64Array.BYTES_PER_ELEMENT,Dt=new Uint8Array(re.subarray(ht,_t)).buffer,Ct=new Float64Array(Dt);ge.set(_t);const ct=je.size(),tt=new Float64Array(ct);let Ut=0;for(let Vt=0;Vt<ct;Vt++)tt[Vt]=je.get(Vt)?Ct[Ut++]:0;return tt})(D,F,J,U.numValues):(function(re,ge,je){const mt=ge.get(),ht=mt+je*Float64Array.BYTES_PER_ELEMENT,_t=new Uint8Array(re.subarray(mt,ht)).buffer,Dt=new Float64Array(_t);return ge.set(ht),Dt})(D,F,U.numValues);return new ap(j.name,H,J)})(f,g,C,z);default:throw new Error(`The specified data type for the field is currently not supported: ${b}`)}})(o,i,e,s,r.scalarType,r):o!=1?null:(function(h,f,g,y){let b=null,C=null,M=null,E=null,z=!1;for(;!z;){const J=mn(h,f);switch(J.physicalStreamType){case tn.LENGTH:zn.DICTIONARY===J.logicalStreamType.lengthType?b=Da(h,f,J):M=Da(h,f,J);break;case tn.DATA:io.SINGLE===J.logicalStreamType.dictionaryType||io.SHARED===J.logicalStreamType.dictionaryType?(C=h.subarray(f.get(),f.get()+J.byteLength),z=!0):E=h.subarray(f.get(),f.get()+J.byteLength),f.add(J.byteLength)}}const D=g.complexType.children,F=[];let j=0;for(const J of D){const U=Ki(h,f,1)[0];if(U==0)continue;const H=`${g.name}${J.name==="default"?"":":"+J.name}`;if(U!==2||J.type!=="scalarField"||J.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const re=mn(h,f),ge=ou(h,re.numValues,f),je=mn(h,f),mt=je.decompressedCount!==y?dp(h,f,je,!1,new no(ge,re.numValues)):gn(h,f,je,!1);F[j++]=E?new km(H,mt,b,C,M,E,new no(ge,re.numValues)):new Fl(H,mt,b,C,new no(ge,re.numValues))}return F})(i,e,r,s)}function au(i){return i instanceof no}function X0(i){if(i.name==="id")return!1;if(i.type==="scalarType"){const e=i.scalarType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(e.type==="logicalType")return!1}else if(i.type==="complexType"){const e=i.complexType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",i),!1}const Y0=new TextDecoder;function zm(i,e){const r=Ki(i,e,1)[0];if(r===0)return"";const o=e.get(),s=i.subarray(o,o+r);return e.add(r),Y0.decode(s)}function Dm(i,e){const r=Ki(i,e,1)[0]>>>0,o=!!(4&r),s=!!(2&r),u=Ki(i,e,1)[0]>>>0,h={};if(1&r&&(h.nullable=!0),s){const f={};if(o?(f.type="logicalType",f.logicalType=u):(f.type="physicalType",f.physicalType=u),8&r){const g=Ki(i,e,1)[0]>>>0;f.children=new Array(g);for(let y=0;y<g;y++)f.children[y]=Dm(i,e)}h.type="complexField",h.complexField=f}else{const f={};o?(f.type="logicalType",f.logicalType=u):(f.type="physicalType",f.physicalType=u),h.type="scalarField",h.scalarField=f}return h}function K0(i,e){const r=Ki(i,e,1)[0]>>>0,o=(function(s){switch(s){case 0:case 1:case 2:case 3:{const u={};u.nullable=!!(1&s),u.columnScope=0;const h={};return h.physicalType=s>1?6:4,h.type="physicalType",u.scalarType=h,u.type="scalarType",u}case 4:{const u={nullable:!1,columnScope:0},h={type:"physicalType",physicalType:0};return u.type="complexType",u.complexType=h,u}case 30:{const u={nullable:!1,columnScope:0},h={type:"physicalType",physicalType:1};return u.type="complexType",u.complexType=h,u}default:return(function(u){let h=null;switch(u){case 10:case 11:h=0;break;case 12:case 13:h=1;break;case 14:case 15:h=2;break;case 16:case 17:h=3;break;case 18:case 19:h=4;break;case 20:case 21:h=5;break;case 22:case 23:h=6;break;case 24:case 25:h=7;break;case 26:case 27:h=8;break;case 28:case 29:h=9;break;default:return null}const f={};f.nullable=!!(1&u),f.columnScope=0;const g={type:"physicalType"};return g.physicalType=h,f.type="scalarType",f.scalarType=g,f})(s)}})(r);if(!o)throw new Error(`Unsupported column type code: ${r}`);if((function(s){return s>=10})(r)?o.name=zm(i,e):r>=0&&r<=3?o.name="id":r===4&&(o.name="geometry"),(function(s){return s===30})(r)){const s=Ki(i,e,1)[0]>>>0,u=o.complexType;u.children=new Array(s);for(let h=0;h<s;h++)u.children[h]=Dm(i,e)}return o}function Q0(i,e){const r={featureTables:[]},o={};o.name=zm(i,e);const s=Ki(i,e,1)[0]>>>0,u=Ki(i,e,1)[0]>>>0;o.columns=new Array(u);for(let h=0;h<u;h++)o.columns[h]=K0(i,e);return r.featureTables.push(o),[r,s]}function J0(i,e,r,o,s,u,h=!1){const f=e.scalarType.physicalType,g=Nh(s,u,i,r);if(f===4)switch(g){case Gi.FLAT:{const y=gn(i,r,s,!1);return new op(o,y,u)}case Gi.SEQUENCE:{const y=pm(i,r,s);return new sp(o,y[0],y[1],s.numRleValues)}case Gi.CONST:{const y=hp(i,r,s,!1);return new lp(o,y,u)}}else switch(g){case Gi.FLAT:{if(h){const b=(function(C,M,E,z){const D=(function(F,j,J){const U=new Float64Array(j);for(let H=0;H<j;H++)U[H]=B0(F,J);return U})(C,E.numValues,M);return(function(F,j,J){switch(j.logicalLevelTechnique1){case Br.DELTA:return j.logicalLevelTechnique2===Br.RLE&&(F=hm(F,j.runs,j.numRleValues)),(function(U){U[0]=U[0]%2==1?(U[0]+1)/-2:U[0]/2;const H=U.length/4*4;let re=1;if(H>=4)for(;re<H-4;re+=4){const ge=U[re],je=U[re+1],mt=U[re+2],ht=U[re+3];U[re]=(ge%2==1?(ge+1)/-2:ge/2)+U[re-1],U[re+1]=(je%2==1?(je+1)/-2:je/2)+U[re],U[re+2]=(mt%2==1?(mt+1)/-2:mt/2)+U[re+1],U[re+3]=(ht%2==1?(ht+1)/-2:ht/2)+U[re+2]}for(;re!=U.length;++re)U[re]=(U[re]%2==1?(U[re]+1)/-2:U[re]/2)+U[re-1]})(F),F;case Br.RLE:return(function(U,H,re){return hm(U,H.runs,H.numRleValues)})(F,j);case Br.NONE:return F;default:throw new Error(`The specified Logical level technique is not supported: ${j.logicalLevelTechnique1}`)}})(D,E)})(i,r,s);return new ap(o,b,u)}const y=mm(i,r,s,!1);return new _m(o,y,u)}case Gi.SEQUENCE:{const y=fm(i,r,s);return new vm(o,y[0],y[1],s.numRleValues)}case Gi.CONST:{const y=gm(i,r,s,!1);return new Mm(o,y,u)}}throw new Error("Vector type not supported for id column.")}class $0{constructor(e,r){var o;switch(this._featureData=e,this.properties=this._featureData.properties||{},(o=this._featureData.geometry)===null||o===void 0?void 0:o.type){case qi.POINT:case qi.MULTIPOINT:this.type=1;break;case qi.LINESTRING:case qi.MULTILINESTRING:this.type=2;break;case qi.POLYGON:case qi.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=r,this.id=Number(this._featureData.id)}loadGeometry(){const e=[];for(const r of this._featureData.geometry.coordinates){const o=[];for(const s of r)o.push(new q(s.x,s.y));e.push(o)}return e}}class ev{constructor(e){this.features=[],this.featureTable=e,this.name=e.name,this.extent=e.extent,this.version=2,this.features=e.getFeatures(),this.length=this.features.length}feature(e){return new $0(this.features[e],this.extent)}}class Lm{constructor(e){this.layers={};const r=(function(o,s,u=!0){const h=new O0(0),f=[];for(;h.get()<o.length;){const g=Ki(o,h,1)[0]>>>0,y=h.get()+g;if(y>o.length)throw new Error(`Block overruns tile: ${y} > ${o.length}`);if(Ki(o,h,1)[0]>>>0!=1){h.set(y);continue}const b=Q0(o,h),C=b[1],M=b[0].featureTables[0];let E=null,z=null;const D=[];let F=0;for(const J of M.columns){const U=J.name;if(U==="id"){let H=null;if(J.nullable){const ge=mn(o,h),je=h.get(),mt=ou(o,ge.numValues,h);h.set(je+ge.byteLength),H=new no(mt,ge.numValues)}const re=mn(o,h);F=re.decompressedCount,E=J0(o,J,h,U,re,H??F,u)}else if(U==="geometry"){const H=Ki(o,h,1)[0];if(F===0){const re=h.get();F=mn(o,h).decompressedCount,h.set(re)}z=G0(o,H,h,F)}else{const H=X0(J)?Ki(o,h,1)[0]:1;if(H===0&&J.type==="scalarType")continue;const re=W0(o,h,J,H,F);if(re)if(Array.isArray(re))for(const ge of re)D.push(ge);else D.push(re)}}const j=new F0(M.name,z,E,D,C);f.push(j),h.set(y)}return f})(new Uint8Array(e));this.layers=r.reduce(((o,s)=>Object.assign(Object.assign({},o),{[s.name]:new ev(s)})),{})}}class tv{constructor(e,r){this.feature=e,this.type=e.type,this.properties=e.tags?e.tags:{},this.extent=r,"id"in e&&(typeof e.id=="string"?this.id=parseInt(e.id,10):typeof e.id!="number"||isNaN(e.id)||(this.id=e.id))}loadGeometry(){const e=[],r=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const o of r){const s=[];for(const u of o)s.push(new q(u[0],u[1]));e.push(s)}return e}}const su="_geojsonTileLayer";function rv(i,e){e.writeVarintField(15,i.version||1),e.writeStringField(1,i.name||""),e.writeVarintField(5,i.extent||4096);const r={keys:[],values:[],keycache:{},valuecache:{}};for(let u=0;u<i.length;u++)r.feature=i.feature(u),e.writeMessage(2,iv,r);const o=r.keys;for(const u of o)e.writeStringField(3,u);const s=r.values;for(const u of s)e.writeMessage(4,av,u)}function iv(i,e){if(!i.feature)return;const r=i.feature;r.id!==void 0&&e.writeVarintField(1,r.id),e.writeMessage(2,nv,i),e.writeVarintField(3,r.type),e.writeMessage(4,ov,r)}function nv(i,e){for(const r in i.feature?.properties){let o=i.feature.properties[r],s=i.keycache[r];if(o==null)continue;s===void 0&&(i.keys.push(r),s=i.keys.length-1,i.keycache[r]=s),e.writeVarint(s),typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"&&(o=JSON.stringify(o));const u=typeof o+":"+o;let h=i.valuecache[u];h===void 0&&(i.values.push(o),h=i.values.length-1,i.valuecache[u]=h),e.writeVarint(h)}}function xp(i,e){return(e<<3)+(7&i)}function Rm(i){return i<<1^i>>31}function ov(i,e){const r=i.loadGeometry(),o=i.type;let s=0,u=0;for(const h of r){let f=1;o===1&&(f=h.length),e.writeVarint(xp(1,f));const g=o===3?h.length-1:h.length;for(let y=0;y<g;y++){y===1&&o!==1&&e.writeVarint(xp(2,g-1));const b=h[y].x-s,C=h[y].y-u;e.writeVarint(Rm(b)),e.writeVarint(Rm(C)),s+=b,u+=C}i.type===3&&e.writeVarint(xp(7,1))}}function av(i,e){const r=typeof i;r==="string"?e.writeStringField(1,i):r==="boolean"?e.writeBooleanField(7,i):r==="number"&&(i%1!=0?e.writeDoubleField(3,i):i<0?e.writeSVarintField(6,i):e.writeVarintField(5,i))}class Fm{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Pa(Ce,16,0),this.grid3D=new Pa(Ce,16,0),this.featureIndexArray=new N,this.promoteId=r}insert(e,r,o,s,u,h){const f=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,s,u);const g=h?this.grid3D:this.grid;for(let y=0;y<r.length;y++){const b=r[y],C=[1/0,1/0,-1/0,-1/0];for(let M=0;M<b.length;M++){const E=b[M];C[0]=Math.min(C[0],E.x),C[1]=Math.min(C[1],E.y),C[2]=Math.max(C[2],E.x),C[3]=Math.max(C[3],E.y)}C[0]<Ce&&C[1]<Ce&&C[2]>=0&&C[3]>=0&&g.insert(f,C[0],C[1],C[2],C[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new bf(new kh(this.rawTileData)).layers:new Lm(this.rawTileData).layers,this.sourceLayerCoder=new nm(this.vtLayers?Object.keys(this.vtLayers).sort():[su])),this.vtLayers}query(e,r,o,s){this.loadVTLayers();const u=e.params,h=Ce/e.tileSize/e.scale,f=os(u.filter,u.globalState),g=e.queryGeometry,y=e.queryPadding*h,b=Es.fromPoints(g),C=this.grid.query(b.minX-y,b.minY-y,b.maxX+y,b.maxY+y),M=Es.fromPoints(e.cameraQueryGeometry).expandBy(y),E=this.grid3D.query(M.minX,M.minY,M.maxX,M.maxY,((F,j,J,U)=>(function(H,re,ge,je,mt){for(const _t of H)if(re<=_t.x&&ge<=_t.y&&je>=_t.x&&mt>=_t.y)return!0;const ht=[new q(re,ge),new q(re,mt),new q(je,mt),new q(je,ge)];if(H.length>2){for(const _t of ht)if(Cl(H,_t))return!0}for(let _t=0;_t<H.length-1;_t++)if(l_(H[_t],H[_t+1],ht))return!0;return!1})(e.cameraQueryGeometry,F-y,j-y,J+y,U+y)));for(const F of E)C.push(F);C.sort(sv);const z={};let D;for(let F=0;F<C.length;F++){const j=C[F];if(j===D)continue;D=j;const J=this.featureIndexArray.get(j);let U=null;this.loadMatchingFeature(z,J.bucketIndex,J.sourceLayerIndex,J.featureIndex,f,u.layers,u.availableImages,r,o,s,((H,re,ge)=>(U||(U=So(H)),re.queryIntersectsFeature({queryGeometry:g,feature:H,featureState:ge,geometry:U,zoom:this.z,transform:e.transform,pixelsToTileUnits:h,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation}))))}return z}loadMatchingFeature(e,r,o,s,u,h,f,g,y,b,C){const M=this.bucketLayerIDs[r];if(h&&!M.some((F=>h.has(F))))return;const E=this.sourceLayerCoder.decode(o),z=this.vtLayers[E].feature(s);if(u.needGeometry){const F=Po(z,!0);if(!u.filter(new $r(this.tileID.overscaledZ),F,this.tileID.canonical))return}else if(!u.filter(new $r(this.tileID.overscaledZ),z))return;const D=this.getId(z,E);for(let F=0;F<M.length;F++){const j=M[F];if(h&&!h.has(j))continue;const J=g[j];if(!J)continue;let U={};D&&b&&(U=b.getState(J.sourceLayer||su,D));const H=ot({},y[j]);H.paint=Om(H.paint,J.paint,z,U,f),H.layout=Om(H.layout,J.layout,z,U,f);const re=!C||C(z,J,U);if(!re)continue;const ge=new om(z,this.z,this.x,this.y,D);ge.layer=H;let je=e[j];je===void 0&&(je=e[j]=[]),je.push({featureIndex:s,feature:ge,intersectionZ:re})}}lookupSymbolFeatures(e,r,o,s,u,h,f,g){const y={};this.loadVTLayers();const b=os(u.filterSpec,u.globalState);for(const C of e)this.loadMatchingFeature(y,o,s,C,b,h,f,g,r);return y}hasLayer(e){for(const r of this.bucketLayerIDs)for(const o of r)if(e===o)return!0;return!1}getId(e,r){var o;let s=e.id;return this.promoteId&&(s=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof s=="boolean"&&(s=Number(s)),s===void 0&&(!((o=e.properties)===null||o===void 0)&&o.cluster)&&this.promoteId&&(s=Number(e.properties.cluster_id))),s}}function Om(i,e,r,o,s){return It(i,((u,h)=>{const f=e instanceof vs?e.get(h):null;return f&&f.evaluate?f.evaluate(r,o,s):f}))}function sv(i,e){return e-i}function Bm(i,e,r,o,s){const u=[];for(let h=0;h<i.length;h++){const f=i[h];let g;for(let y=0;y<f.length-1;y++){let b=f[y],C=f[y+1];b.x<e&&C.x<e||(b.x<e?b=new q(e,b.y+(e-b.x)/(C.x-b.x)*(C.y-b.y))._round():C.x<e&&(C=new q(e,b.y+(e-b.x)/(C.x-b.x)*(C.y-b.y))._round()),b.y<r&&C.y<r||(b.y<r?b=new q(b.x+(r-b.y)/(C.y-b.y)*(C.x-b.x),r)._round():C.y<r&&(C=new q(b.x+(r-b.y)/(C.y-b.y)*(C.x-b.x),r)._round()),b.x>=o&&C.x>=o||(b.x>=o?b=new q(o,b.y+(o-b.x)/(C.x-b.x)*(C.y-b.y))._round():C.x>=o&&(C=new q(o,b.y+(o-b.x)/(C.x-b.x)*(C.y-b.y))._round()),b.y>=s&&C.y>=s||(b.y>=s?b=new q(b.x+(s-b.y)/(C.y-b.y)*(C.x-b.x),s)._round():C.y>=s&&(C=new q(b.x+(s-b.y)/(C.y-b.y)*(C.x-b.x),s)._round()),g&&b.equals(g[g.length-1])||(g=[b],u.push(g)),g.push(C)))))}}return u}function Nm(i,e,r,o,s){switch(e){case 1:return(function(u,h,f,g){const y=[];for(const b of u)for(const C of b){const M=g===0?C.x:C.y;M>=h&&M<=f&&y.push([C])}return y})(i,r,o,s);case 2:return Vm(i,r,o,s,!1);case 3:return Vm(i,r,o,s,!0)}return[]}function lv(i,e,r,o,s){const u=o===0?cv:uv;let h=[];const f=[];for(let b=0;b<i.length-1;b++){const C=i[b],M=i[b+1],E=o===0?C.x:C.y,z=o===0?M.x:M.y;let D=!1;E<e?z>e&&h.push(u(C,M,e)):E>r?z<r&&h.push(u(C,M,r)):h.push(C),z<e&&E>=e&&(h.push(u(C,M,e)),D=!0),z>r&&E<=r&&(h.push(u(C,M,r)),D=!0),!s&&D&&(f.push(h),h=[])}const g=i.length-1,y=o===0?i[g].x:i[g].y;return y>=e&&y<=r&&h.push(i[g]),s&&h.length>0&&!h[0].equals(h[h.length-1])&&h.push(new q(h[0].x,h[0].y)),h.length>0&&f.push(h),f}function Vm(i,e,r,o,s){const u=[];for(const h of i){const f=lv(h,e,r,o,s);f.length>0&&u.push(...f)}return u}function cv(i,e,r){return new q(r,i.y+(r-i.x)/(e.x-i.x)*(e.y-i.y))}function uv(i,e,r){return new q(i.x+(r-i.y)/(e.y-i.y)*(e.x-i.x),r)}Zt("FeatureIndex",Fm,{omit:["rawTileData","sourceLayerCoder"]});class La extends q{constructor(e,r,o,s){super(e,r),this.angle=o,s!==void 0&&(this.segment=s)}clone(){return new La(this.x,this.y,this.angle,this.segment)}}function jm(i,e,r,o,s){if(e.segment===void 0||r===0)return!0;let u=e,h=e.segment+1,f=0;for(;f>-r/2;){if(h--,h<0)return!1;f-=i[h].dist(u),u=i[h]}f+=i[h].dist(i[h+1]),h++;const g=[];let y=0;for(;f<r/2;){const b=i[h],C=i[h+1];if(!C)return!1;let M=i[h-1].angleTo(b)-b.angleTo(C);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),g.push({distance:f,angleDelta:M}),y+=M;f-g[0].distance>o;)y-=g.shift().angleDelta;if(y>s)return!1;h++,f+=b.dist(C)}return!0}function Um(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function Gm(i,e,r){return i?.6*e*r:0}function qm(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function hv(i,e,r,o,s,u){const h=Gm(r,s,u),f=qm(r,o)*u;let g=0;const y=Um(i)/2;for(let b=0;b<i.length-1;b++){const C=i[b],M=i[b+1],E=C.dist(M);if(g+E>y){const z=(y-g)/E,D=di.number(C.x,M.x,z),F=di.number(C.y,M.y,z),j=new La(D,F,M.angleTo(C),b);return j._round(),!h||jm(i,j,f,h,e)?j:void 0}g+=E}}function dv(i,e,r,o,s,u,h,f,g){const y=Gm(o,u,h),b=qm(o,s),C=b*h,M=i[0].x===0||i[0].x===g||i[0].y===0||i[0].y===g;return e-C<e/4&&(e=C+e/4),Zm(i,M?e/2*f%e:(b/2+2*u)*h*f%e,e,y,r,C,M,!1,g)}function Zm(i,e,r,o,s,u,h,f,g){const y=u/2,b=Um(i);let C=0,M=e-r,E=[];for(let z=0;z<i.length-1;z++){const D=i[z],F=i[z+1],j=D.dist(F),J=F.angleTo(D);for(;M+r<C+j;){M+=r;const U=(M-C)/j,H=di.number(D.x,F.x,U),re=di.number(D.y,F.y,U);if(H>=0&&H<g&&re>=0&&re<g&&M-y>=0&&M+y<=b){const ge=new La(H,re,J,z);ge._round(),o&&!jm(i,ge,u,o,s)||E.push(ge)}}C+=j}return f||E.length||h||(E=Zm(i,C/2,r,o,s,u,h,!0,g)),E}function Hm(i,e,r,o){const s=[],u=i.image,h=u.pixelRatio,f=u.paddedRect.w-2,g=u.paddedRect.h-2;let y={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const b=u.stretchX||[[0,f]],C=u.stretchY||[[0,g]],M=(tt,Ut)=>tt+Ut[1]-Ut[0],E=b.reduce(M,0),z=C.reduce(M,0),D=f-E,F=g-z;let j=0,J=E,U=0,H=z,re=0,ge=D,je=0,mt=F;if(u.content&&o){const tt=u.content,Ut=tt[2]-tt[0],Vt=tt[3]-tt[1];(u.textFitWidth||u.textFitHeight)&&(y=jf(i)),j=Gh(b,0,tt[0]),U=Gh(C,0,tt[1]),J=Gh(b,tt[0],tt[2]),H=Gh(C,tt[1],tt[3]),re=tt[0]-j,je=tt[1]-U,ge=Ut-J,mt=Vt-H}const ht=y.x1,_t=y.y1,Dt=y.x2-ht,Ct=y.y2-_t,ct=(tt,Ut,Vt,Wt)=>{const jt=qh(tt.stretch-j,J,Dt,ht),er=Zh(tt.fixed-re,ge,tt.stretch,E),Wr=qh(Ut.stretch-U,H,Ct,_t),Or=Zh(Ut.fixed-je,mt,Ut.stretch,z),mi=qh(Vt.stretch-j,J,Dt,ht),nn=Zh(Vt.fixed-re,ge,Vt.stretch,E),Fi=qh(Wt.stretch-U,H,Ct,_t),gi=Zh(Wt.fixed-je,mt,Wt.stretch,z),ui=new q(jt,Wr),Yr=new q(mi,Wr),Si=new q(mi,Fi),ki=new q(jt,Fi),si=new q(er/h,Or/h),Tn=new q(nn/h,gi/h),on=e*Math.PI/180;if(on){const Zi=Math.sin(on),bi=Math.cos(on),Oi=[bi,-Zi,Zi,bi];ui._matMult(Oi),Yr._matMult(Oi),ki._matMult(Oi),Si._matMult(Oi)}const Cn=tt.stretch+tt.fixed,Jn=Ut.stretch+Ut.fixed;return{tl:ui,tr:Yr,bl:ki,br:Si,tex:{x:u.paddedRect.x+1+Cn,y:u.paddedRect.y+1+Jn,w:Vt.stretch+Vt.fixed-Cn,h:Wt.stretch+Wt.fixed-Jn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:si,pixelOffsetBR:Tn,minFontScaleX:ge/h/Dt,minFontScaleY:mt/h/Ct,isSDF:r}};if(o&&(u.stretchX||u.stretchY)){const tt=Wm(b,D,E),Ut=Wm(C,F,z);for(let Vt=0;Vt<tt.length-1;Vt++){const Wt=tt[Vt],jt=tt[Vt+1];for(let er=0;er<Ut.length-1;er++)s.push(ct(Wt,Ut[er],jt,Ut[er+1]))}}else s.push(ct({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:f+1},{fixed:0,stretch:g+1}));return s}function Gh(i,e,r){let o=0;for(const s of i)o+=Math.max(e,Math.min(r,s[1]))-Math.max(e,Math.min(r,s[0]));return o}function Wm(i,e,r){const o=[{fixed:-1,stretch:0}];for(const[s,u]of i){const h=o[o.length-1];o.push({fixed:s-h.stretch,stretch:h.stretch}),o.push({fixed:s-h.stretch,stretch:h.stretch+(u-s)})}return o.push({fixed:e+1,stretch:r}),o}function qh(i,e,r,o){return i/e*r+o}function Zh(i,e,r,o){return i-e*r/o}Zt("Anchor",La);class Hh{constructor(e,r,o,s,u,h,f,g,y,b){var C;if(this.boxStartIndex=e.length,y){let M=h.top,E=h.bottom;const z=h.collisionPadding;z&&(M-=z[1],E+=z[3]);let D=E-M;D>0&&(D=Math.max(10,D),this.circleDiameter=D)}else{const M=!((C=h.image)===null||C===void 0)&&C.content&&(h.image.textFitWidth||h.image.textFitHeight)?jf(h):{x1:h.left,y1:h.top,x2:h.right,y2:h.bottom};M.y1=M.y1*f-g[0],M.y2=M.y2*f+g[2],M.x1=M.x1*f-g[3],M.x2=M.x2*f+g[1];const E=h.collisionPadding;if(E&&(M.x1-=E[0]*f,M.y1-=E[1]*f,M.x2+=E[2]*f,M.y2+=E[3]*f),b){const z=new q(M.x1,M.y1),D=new q(M.x2,M.y1),F=new q(M.x1,M.y2),j=new q(M.x2,M.y2),J=b*Math.PI/180;z._rotate(J),D._rotate(J),F._rotate(J),j._rotate(J),M.x1=Math.min(z.x,D.x,F.x,j.x),M.x2=Math.max(z.x,D.x,F.x,j.x),M.y1=Math.min(z.y,D.y,F.y,j.y),M.y2=Math.max(z.y,D.y,F.y,j.y)}e.emplaceBack(r.x,r.y,M.x1,M.y1,M.x2,M.y2,o,s,u)}this.boxEndIndex=e.length}}class pv{constructor(e=[],r=(o,s)=>o<s?-1:o>s?1:0){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:o}=this,s=r[e];for(;e>0;){const u=e-1>>1,h=r[u];if(o(s,h)>=0)break;r[e]=h,e=u}r[e]=s}_down(e){const{data:r,compare:o}=this,s=this.length>>1,u=r[e];for(;e<s;){let h=1+(e<<1);const f=h+1;if(f<this.length&&o(r[f],r[h])<0&&(h=f),o(r[h],u)>=0)break;r[e]=r[h],e=h}r[e]=u}}function fv(i,e=1,r=!1){const o=Es.fromPoints(i[0]),s=Math.min(o.width(),o.height());let u=s/2;const h=new pv([],mv),{minX:f,minY:g,maxX:y,maxY:b}=o;if(s===0)return new q(f,g);for(let E=f;E<y;E+=s)for(let z=g;z<b;z+=s)h.push(new Ol(E+u,z+u,u,i));let C=(function(E){let z=0,D=0,F=0;const j=E[0];for(let J=0,U=j.length,H=U-1;J<U;H=J++){const re=j[J],ge=j[H],je=re.x*ge.y-ge.x*re.y;D+=(re.x+ge.x)*je,F+=(re.y+ge.y)*je,z+=3*je}return new Ol(D/z,F/z,0,E)})(i),M=h.length;for(;h.length;){const E=h.pop();(E.d>C.d||!C.d)&&(C=E,r&&console.log("found best %d after %d probes",Math.round(1e4*E.d)/1e4,M)),E.max-C.d<=e||(u=E.h/2,h.push(new Ol(E.p.x-u,E.p.y-u,u,i)),h.push(new Ol(E.p.x+u,E.p.y-u,u,i)),h.push(new Ol(E.p.x-u,E.p.y+u,u,i)),h.push(new Ol(E.p.x+u,E.p.y+u,u,i)),M+=4)}return r&&(console.log(`num probes: ${M}`),console.log(`best distance: ${C.d}`)),C.p}function mv(i,e){return e.max-i.max}function Ol(i,e,r,o){this.p=new q(i,e),this.h=r,this.d=(function(s,u){let h=!1,f=1/0;for(let g=0;g<u.length;g++){const y=u[g];for(let b=0,C=y.length,M=C-1;b<C;M=b++){const E=y[b],z=y[M];E.y>s.y!=z.y>s.y&&s.x<(z.x-E.x)*(s.y-E.y)/(z.y-E.y)+E.x&&(h=!h),f=Math.min(f,Qp(s,E,z))}}return(h?1:-1)*Math.sqrt(f)})(this.p,o),this.max=this.d+this.h*Math.SQRT2}var rn;S.aP=void 0,(rn=S.aP||(S.aP={}))[rn.center=1]="center",rn[rn.left=2]="left",rn[rn.right=3]="right",rn[rn.top=4]="top",rn[rn.bottom=5]="bottom",rn[rn["top-left"]=6]="top-left",rn[rn["top-right"]=7]="top-right",rn[rn["bottom-left"]=8]="bottom-left",rn[rn["bottom-right"]=9]="bottom-right";const bp=Number.POSITIVE_INFINITY;function Xm(i,e){return e[1]!==bp?(function(r,o,s){let u=0,h=0;switch(o=Math.abs(o),s=Math.abs(s),r){case"top-right":case"top-left":case"top":h=s-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-s}switch(r){case"top-right":case"bottom-right":case"right":u=-o;break;case"top-left":case"bottom-left":case"left":u=o}return[u,h]})(i,e[0],e[1]):(function(r,o){let s=0,u=0;o<0&&(o=0);const h=o/Math.SQRT2;switch(r){case"top-right":case"top-left":u=h-7;break;case"bottom-right":case"bottom-left":u=7-h;break;case"bottom":u=7-o;break;case"top":u=o-7}switch(r){case"top-right":case"bottom-right":s=-h;break;case"top-left":case"bottom-left":s=h;break;case"left":s=o;break;case"right":s=-o}return[s,u]})(i,e[0])}function Ym(i,e,r){var o;const s=i.layout,u=(o=s.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(e,{},r);if(u){const f=u.values,g=[];for(let y=0;y<f.length;y+=2){const b=g[y]=f[y],C=f[y+1].map((M=>M*Ui));b.startsWith("top")?C[1]-=7:b.startsWith("bottom")&&(C[1]+=7),g[y+1]=C}return new sn(g)}const h=s.get("text-variable-anchor");if(h){let f;f=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[s.get("text-radial-offset").evaluate(e,{},r)*Ui,bp]:s.get("text-offset").evaluate(e,{},r).map((y=>y*Ui));const g=[];for(const y of h)g.push(y,Xm(y,f));return new sn(g)}return null}function wp(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function gv(i,e,r,o,s,u,h,f,g,y,b,C){let M=u.textMaxSize.evaluate(e,{});M===void 0&&(M=h);const E=i.layers[0].layout,z=E.get("icon-offset").evaluate(e,{},b),D=Qm(r.horizontal),F=h/24,j=i.tilePixelRatio*F,J=i.tilePixelRatio*M/24,U=i.tilePixelRatio*f,H=i.tilePixelRatio*E.get("symbol-spacing"),re=E.get("text-padding")*i.tilePixelRatio,ge=(function(Vt,Wt,jt,er=1){const Wr=Vt.get("icon-padding").evaluate(Wt,{},jt),Or=Wr&&Wr.values;return[Or[0]*er,Or[1]*er,Or[2]*er,Or[3]*er]})(E,e,b,i.tilePixelRatio),je=E.get("text-max-angle")/180*Math.PI,mt=E.get("text-rotation-alignment")!=="viewport"&&E.get("symbol-placement")!=="point",ht=E.get("icon-rotation-alignment")==="map"&&E.get("symbol-placement")!=="point",_t=E.get("symbol-placement"),Dt=H/2,Ct=E.get("icon-text-fit");let ct;o&&Ct!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(ct=Uf(o,r.vertical,Ct,E.get("icon-text-fit-padding"),z,F)),D&&(o=Uf(o,D,Ct,E.get("icon-text-fit-padding"),z,F)));const tt=b?C.line.getGranularityForZoomLevel(b.z):1,Ut=(Vt,Wt)=>{Wt.x<0||Wt.x>=Ce||Wt.y<0||Wt.y>=Ce||(function(jt,er,Wr,Or,mi,nn,Fi,gi,ui,Yr,Si,ki,si,Tn,on,Cn,Jn,Zi,bi,Oi,Pi,Hi,Jo,oo,uu){const Ra=jt.addToLineVertexArray(er,Wr);let zs,Bl,Nl,Vl,tg=0,rg=0,ig=0,ng=0,Ap=-1,kp=-1;const $o={};let og=Ai("");if(jt.allowVerticalPlacement&&Or.vertical){const hn=gi.layout.get("text-rotate").evaluate(Pi,{},oo)+90;Nl=new Hh(ui,er,Yr,Si,ki,Or.vertical,si,Tn,on,hn),Fi&&(Vl=new Hh(ui,er,Yr,Si,ki,Fi,Jn,Zi,on,hn))}if(mi){const hn=gi.layout.get("icon-rotate").evaluate(Pi,{}),Zn=gi.layout.get("icon-text-fit")!=="none",Ds=Hm(mi,hn,Jo,Zn),so=Fi?Hm(Fi,hn,Jo,Zn):void 0;Bl=new Hh(ui,er,Yr,Si,ki,mi,Jn,Zi,!1,hn),tg=4*Ds.length;const Ls=jt.iconSizeData;let Io=null;Ls.kind==="source"?(Io=[Ko*gi.layout.get("icon-size").evaluate(Pi,{})],Io[0]>ka&&Yt(`${jt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Ls.kind==="composite"&&(Io=[Ko*Hi.compositeIconSizes[0].evaluate(Pi,{},oo),Ko*Hi.compositeIconSizes[1].evaluate(Pi,{},oo)],(Io[0]>ka||Io[1]>ka)&&Yt(`${jt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),jt.addSymbols(jt.icon,Ds,Io,Oi,bi,Pi,S.az.none,er,Ra.lineStartIndex,Ra.lineLength,-1,oo),Ap=jt.icon.placedSymbolArray.length-1,so&&(rg=4*so.length,jt.addSymbols(jt.icon,so,Io,Oi,bi,Pi,S.az.vertical,er,Ra.lineStartIndex,Ra.lineLength,-1,oo),kp=jt.icon.placedSymbolArray.length-1)}const ag=Object.keys(Or.horizontal);for(const hn of ag){const Zn=Or.horizontal[hn];if(!zs){og=Ai(Zn.text);const so=gi.layout.get("text-rotate").evaluate(Pi,{},oo);zs=new Hh(ui,er,Yr,Si,ki,Zn,si,Tn,on,so)}const Ds=Zn.positionedLines.length===1;if(ig+=Km(jt,er,Zn,nn,gi,on,Pi,Cn,Ra,Or.vertical?S.az.horizontal:S.az.horizontalOnly,Ds?ag:[hn],$o,Ap,Hi,oo),Ds)break}Or.vertical&&(ng+=Km(jt,er,Or.vertical,nn,gi,on,Pi,Cn,Ra,S.az.vertical,["vertical"],$o,kp,Hi,oo));const yv=zs?zs.boxStartIndex:jt.collisionBoxArray.length,xv=zs?zs.boxEndIndex:jt.collisionBoxArray.length,bv=Nl?Nl.boxStartIndex:jt.collisionBoxArray.length,wv=Nl?Nl.boxEndIndex:jt.collisionBoxArray.length,Tv=Bl?Bl.boxStartIndex:jt.collisionBoxArray.length,Cv=Bl?Bl.boxEndIndex:jt.collisionBoxArray.length,Sv=Vl?Vl.boxStartIndex:jt.collisionBoxArray.length,Pv=Vl?Vl.boxEndIndex:jt.collisionBoxArray.length;let ao=-1;const Xh=(hn,Zn)=>hn&&hn.circleDiameter?Math.max(hn.circleDiameter,Zn):Zn;ao=Xh(zs,ao),ao=Xh(Nl,ao),ao=Xh(Bl,ao),ao=Xh(Vl,ao);const sg=ao>-1?1:0;sg&&(ao*=uu/Ui),jt.glyphOffsetArray.length>=kl.MAX_GLYPHS&&Yt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Pi.sortKey!==void 0&&jt.addToSortKeyRanges(jt.symbolInstances.length,Pi.sortKey);const Iv=Ym(gi,Pi,oo),[Mv,Ev]=(function(hn,Zn){const Ds=hn.length,so=Zn?.values;if(so?.length>0)for(let Ls=0;Ls<so.length;Ls+=2){const Io=so[Ls+1];hn.emplaceBack(S.aP[so[Ls]],Io[0],Io[1])}return[Ds,hn.length]})(jt.textAnchorOffsets,Iv);jt.symbolInstances.emplaceBack(er.x,er.y,$o.right>=0?$o.right:-1,$o.center>=0?$o.center:-1,$o.left>=0?$o.left:-1,$o.vertical||-1,Ap,kp,og,yv,xv,bv,wv,Tv,Cv,Sv,Pv,Yr,ig,ng,tg,rg,sg,0,si,ao,Mv,Ev)})(i,Wt,Vt,r,o,s,ct,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,j,[re,re,re,re],mt,g,U,ge,ht,z,e,u,y,b,h)};if(_t==="line")for(const Vt of Bm(e.geometry,0,0,Ce,Ce)){const Wt=Ms(Vt,tt),jt=dv(Wt,H,je,r.vertical||D,o,24,J,i.overscaling,Ce);for(const er of jt)D&&_v(i,D.text,Dt,er)||Ut(Wt,er)}else if(_t==="line-center"){for(const Vt of e.geometry)if(Vt.length>1){const Wt=Ms(Vt,tt),jt=hv(Wt,je,r.vertical||D,o,24,J);jt&&Ut(Wt,jt)}}else if(e.type==="Polygon")for(const Vt of Zs(e.geometry,0)){const Wt=fv(Vt,16);Ut(Ms(Vt[0],tt,!0),new La(Wt.x,Wt.y,0))}else if(e.type==="LineString")for(const Vt of e.geometry){const Wt=Ms(Vt,tt);Ut(Wt,new La(Wt[0].x,Wt[0].y,0))}else if(e.type==="Point")for(const Vt of e.geometry)for(const Wt of Vt)Ut([Wt],new La(Wt.x,Wt.y,0))}function Km(i,e,r,o,s,u,h,f,g,y,b,C,M,E,z){const D=(function(J,U,H,re,ge,je,mt,ht){const _t=re.layout.get("text-rotate").evaluate(je,{})*Math.PI/180,Dt=[];for(const Ct of U.positionedLines)for(const ct of Ct.positionedGlyphs){if(!ct.rect)continue;const tt=ct.rect||{};let Ut=4,Vt=!0,Wt=1,jt=0;const er=(ge||ht)&&ct.vertical,Wr=ct.metrics.advance*ct.scale/2;if(ht&&U.verticalizable&&(jt=Ct.lineOffset/2-(ct.imageName?-(Ui-ct.metrics.width*ct.scale)/2:(ct.scale-1)*Ui)),ct.imageName){const Zi=mt[ct.imageName];Vt=Zi.sdf,Wt=Zi.pixelRatio,Ut=1/Wt}const Or=ge?[ct.x+Wr,ct.y]:[0,0];let mi=ge?[0,0]:[ct.x+Wr+H[0],ct.y+H[1]-jt],nn=[0,0];er&&(nn=mi,mi=[0,0]);const Fi=ct.metrics.isDoubleResolution?2:1,gi=(ct.metrics.left-Ut)*ct.scale-Wr+mi[0],ui=(-ct.metrics.top-Ut)*ct.scale+mi[1],Yr=gi+tt.w/Fi*ct.scale/Wt,Si=ui+tt.h/Fi*ct.scale/Wt,ki=new q(gi,ui),si=new q(Yr,ui),Tn=new q(gi,Si),on=new q(Yr,Si);if(er){const Zi=new q(-Wr,Wr- -17),bi=-Math.PI/2,Oi=12-Wr,Pi=new q(22-Oi,-(ct.imageName?Oi:0)),Hi=new q(...nn);ki._rotateAround(bi,Zi)._add(Pi)._add(Hi),si._rotateAround(bi,Zi)._add(Pi)._add(Hi),Tn._rotateAround(bi,Zi)._add(Pi)._add(Hi),on._rotateAround(bi,Zi)._add(Pi)._add(Hi)}if(_t){const Zi=Math.sin(_t),bi=Math.cos(_t),Oi=[bi,-Zi,Zi,bi];ki._matMult(Oi),si._matMult(Oi),Tn._matMult(Oi),on._matMult(Oi)}const Cn=new q(0,0),Jn=new q(0,0);Dt.push({tl:ki,tr:si,bl:Tn,br:on,tex:tt,writingMode:U.writingMode,glyphOffset:Or,sectionIndex:ct.sectionIndex,isSDF:Vt,pixelOffsetTL:Cn,pixelOffsetBR:Jn,minFontScaleX:0,minFontScaleY:0})}return Dt})(0,r,f,s,u,h,o,i.allowVerticalPlacement),F=i.textSizeData;let j=null;F.kind==="source"?(j=[Ko*s.layout.get("text-size").evaluate(h,{})],j[0]>ka&&Yt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):F.kind==="composite"&&(j=[Ko*E.compositeTextSizes[0].evaluate(h,{},z),Ko*E.compositeTextSizes[1].evaluate(h,{},z)],(j[0]>ka||j[1]>ka)&&Yt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,D,j,f,u,h,y,e,g.lineStartIndex,g.lineLength,M,z);for(const J of b)C[J]=i.text.placedSymbolArray.length-1;return 4*D.length}function Qm(i){for(const e in i)return i[e];return null}function _v(i,e,r,o){const s=i.compareText;if(e in s){const u=s[e];for(let h=u.length-1;h>=0;h--)if(o.dist(u[h])<r)return!0}else s[e]=[];return s[e].push(o),!1}const Jm=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Tp{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,o]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const s=o>>4;if(s!==1)throw new Error(`Got v${s} data when expected v1.`);const u=Jm[15&o];if(!u)throw new Error("Unrecognized array type.");const[h]=new Uint16Array(e,2,1),[f]=new Uint32Array(e,4,1);return new Tp(f,h,u,e)}constructor(e,r=64,o=Float64Array,s){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const u=Jm.indexOf(this.ArrayType),h=2*e*this.ArrayType.BYTES_PER_ELEMENT,f=e*this.IndexArrayType.BYTES_PER_ELEMENT,g=(8-f%8)%8;if(u<0)throw new Error(`Unexpected typed array class: ${o}.`);s&&s instanceof ArrayBuffer?(this.data=s,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+f+g,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+h+f+g),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+f+g,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+u]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=r,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Cp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,o,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:h,nodeSize:f}=this,g=[0,u.length-1,0],y=[];for(;g.length;){const b=g.pop()||0,C=g.pop()||0,M=g.pop()||0;if(C-M<=f){for(let F=M;F<=C;F++){const j=h[2*F],J=h[2*F+1];j>=e&&j<=o&&J>=r&&J<=s&&y.push(u[F])}continue}const E=M+C>>1,z=h[2*E],D=h[2*E+1];z>=e&&z<=o&&D>=r&&D<=s&&y.push(u[E]),(b===0?e<=z:r<=D)&&(g.push(M),g.push(E-1),g.push(1-b)),(b===0?o>=z:s>=D)&&(g.push(E+1),g.push(C),g.push(1-b))}return y}within(e,r,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:s,coords:u,nodeSize:h}=this,f=[0,s.length-1,0],g=[],y=o*o;for(;f.length;){const b=f.pop()||0,C=f.pop()||0,M=f.pop()||0;if(C-M<=h){for(let F=M;F<=C;F++)eg(u[2*F],u[2*F+1],e,r)<=y&&g.push(s[F]);continue}const E=M+C>>1,z=u[2*E],D=u[2*E+1];eg(z,D,e,r)<=y&&g.push(s[E]),(b===0?e-o<=z:r-o<=D)&&(f.push(M),f.push(E-1),f.push(1-b)),(b===0?e+o>=z:r+o>=D)&&(f.push(E+1),f.push(C),f.push(1-b))}return g}}function Cp(i,e,r,o,s,u){if(s-o<=r)return;const h=o+s>>1;$m(i,e,h,o,s,u),Cp(i,e,r,o,h-1,1-u),Cp(i,e,r,h+1,s,1-u)}function $m(i,e,r,o,s,u){for(;s>o;){if(s-o>600){const y=s-o+1,b=r-o+1,C=Math.log(y),M=.5*Math.exp(2*C/3),E=.5*Math.sqrt(C*M*(y-M)/y)*(b-y/2<0?-1:1);$m(i,e,r,Math.max(o,Math.floor(r-b*M/y+E)),Math.min(s,Math.floor(r+(y-b)*M/y+E)),u)}const h=e[2*r+u];let f=o,g=s;for(lu(i,e,o,r),e[2*s+u]>h&&lu(i,e,o,s);f<g;){for(lu(i,e,f,g),f++,g--;e[2*f+u]<h;)f++;for(;e[2*g+u]>h;)g--}e[2*o+u]===h?lu(i,e,o,g):(g++,lu(i,e,g,s)),g<=r&&(o=g+1),r<=g&&(s=g-1)}}function lu(i,e,r,o){Sp(i,r,o),Sp(e,2*r,2*o),Sp(e,2*r+1,2*o+1)}function Sp(i,e,r){const o=i[e];i[e]=i[r],i[r]=o}function eg(i,e,r,o){const s=i-r,u=e-o;return s*s+u*u}var Pp;S.cI=void 0,(Pp=S.cI||(S.cI={})).create="create",Pp.load="load",Pp.fullLoad="fullLoad";let Wh=null,cu=[];const Ip=1e3/60,Mp="loadTime",Ep="fullLoadTime",vv={mark(i){performance.mark(i)},frame(i){const e=i;Wh!=null&&cu.push(e-Wh),Wh=e},clearMetrics(){Wh=null,cu=[],performance.clearMeasures(Mp),performance.clearMeasures(Ep);for(const i in S.cI)performance.clearMarks(S.cI[i])},getPerformanceMetrics(){performance.measure(Mp,S.cI.create,S.cI.load),performance.measure(Ep,S.cI.create,S.cI.fullLoad);const i=performance.getEntriesByName(Mp)[0].duration,e=performance.getEntriesByName(Ep)[0].duration,r=cu.length,o=1/(cu.reduce(((u,h)=>u+h),0)/r/1e3),s=cu.filter((u=>u>Ip)).reduce(((u,h)=>u+(h-Ip)/Ip),0);return{loadTime:i,fullLoadTime:e,fps:o,percentDroppedFrames:s/(r+s)*100,totalFrames:r}}};S.$=Z,S.A=vt,S.B=Sa,S.C=Vi,S.D=Jt,S.E=et,S.F=function([i,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(r),y:i*Math.sin(e)*Math.sin(r),z:i*Math.cos(r)}},S.G=di,S.H=$r,S.I=Yd,S.J=hh,S.K=function(i){if(Mt==null){const e=i.navigator?i.navigator.userAgent:null;Mt=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Mt},S.L=class{constructor(i,e){this.target=i,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new D0((()=>this.process())),this.subscription=ur(this.target,"message",(r=>this.receive(r)),!1),this.globalScope=Qt(self)?i:window}registerMessageHandler(i,e){this.messageHandlers[i]=e}unregisterMessageHandler(i){delete this.messageHandlers[i]}sendAsync(i,e){return new Promise(((r,o)=>{const s=Math.round(1e18*Math.random()).toString(36).substring(0,10),u=e?ur(e.signal,"abort",(()=>{u?.unsubscribe(),delete this.resolveRejects[s];const g={id:s,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(g)}),L0):null;this.resolveRejects[s]={resolve:g=>{u?.unsubscribe(),r(g)},reject:g=>{u?.unsubscribe(),o(g)}};const h=[],f=Object.assign(Object.assign({},i),{id:s,sourceMapId:this.mapId,origin:location.origin,data:fs(i.data,h)});this.target.postMessage(f,{transfer:h})}))}receive(i){const e=i.data,r=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!=="resource://android"&&location.origin!=="resource://android"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[r];const o=this.abortControllers[r];return delete this.abortControllers[r],void(o&&o.abort())}if(Qt(self)||e.mustQueue)return this.tasks[r]=e,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,e)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){return l(this,void 0,void 0,(function*(){if(e.type==="<response>"){const s=this.resolveRejects[i];return delete this.resolveRejects[i],s?void(e.error?s.reject(ms(e.error)):s.resolve(ms(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=ms(e.data),o=new AbortController;this.abortControllers[i]=o;try{const s=yield this.messageHandlers[e.type](e.sourceMapId,r,o);this.completeTask(i,null,s)}catch(s){this.completeTask(i,s)}}))}completeTask(i,e,r){const o=[];delete this.abortControllers[i];const s={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?fs(e):null,data:fs(r,o)};this.target.postMessage(s,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},S.M=V,S.N=function(){var i=new vt(16);return vt!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},S.O=function(i,e,r){var o,s,u,h,f,g,y,b,C,M,E,z,D=r[0],F=r[1],j=r[2];return e===i?(i[12]=e[0]*D+e[4]*F+e[8]*j+e[12],i[13]=e[1]*D+e[5]*F+e[9]*j+e[13],i[14]=e[2]*D+e[6]*F+e[10]*j+e[14],i[15]=e[3]*D+e[7]*F+e[11]*j+e[15]):(s=e[1],u=e[2],h=e[3],f=e[4],g=e[5],y=e[6],b=e[7],C=e[8],M=e[9],E=e[10],z=e[11],i[0]=o=e[0],i[1]=s,i[2]=u,i[3]=h,i[4]=f,i[5]=g,i[6]=y,i[7]=b,i[8]=C,i[9]=M,i[10]=E,i[11]=z,i[12]=o*D+f*F+C*j+e[12],i[13]=s*D+g*F+M*j+e[13],i[14]=u*D+y*F+E*j+e[14],i[15]=h*D+b*F+z*j+e[15]),i},S.P=q,S.Q=function(i,e,r){var o=r[0],s=r[1],u=r[2];return i[0]=e[0]*o,i[1]=e[1]*o,i[2]=e[2]*o,i[3]=e[3]*o,i[4]=e[4]*s,i[5]=e[5]*s,i[6]=e[6]*s,i[7]=e[7]*s,i[8]=e[8]*u,i[9]=e[9]*u,i[10]=e[10]*u,i[11]=e[11]*u,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},S.R=wn,S.S=function(i,e,r){var o=e[0],s=e[1],u=e[2],h=e[3],f=e[4],g=e[5],y=e[6],b=e[7],C=e[8],M=e[9],E=e[10],z=e[11],D=e[12],F=e[13],j=e[14],J=e[15],U=r[0],H=r[1],re=r[2],ge=r[3];return i[0]=U*o+H*f+re*C+ge*D,i[1]=U*s+H*g+re*M+ge*F,i[2]=U*u+H*y+re*E+ge*j,i[3]=U*h+H*b+re*z+ge*J,i[4]=(U=r[4])*o+(H=r[5])*f+(re=r[6])*C+(ge=r[7])*D,i[5]=U*s+H*g+re*M+ge*F,i[6]=U*u+H*y+re*E+ge*j,i[7]=U*h+H*b+re*z+ge*J,i[8]=(U=r[8])*o+(H=r[9])*f+(re=r[10])*C+(ge=r[11])*D,i[9]=U*s+H*g+re*M+ge*F,i[10]=U*u+H*y+re*E+ge*j,i[11]=U*h+H*b+re*z+ge*J,i[12]=(U=r[12])*o+(H=r[13])*f+(re=r[14])*C+(ge=r[15])*D,i[13]=U*s+H*g+re*M+ge*F,i[14]=U*u+H*y+re*E+ge*j,i[15]=U*h+H*b+re*z+ge*J,i},S.T=Vd,S.U=function(i,e){const r={};for(let o=0;o<e.length;o++){const s=e[o];s in i&&(r[s]=i[s])}return r},S.V=za,S.W=Ge,S.X=Qf,S.Y=Kf,S.Z=ce,S._=l,S.a=yr,S.a$=Re,S.a0=Ve,S.a1=Et,S.a2=Gn,S.a3=$f,S.a4=Rh,S.a5=Ce,S.a6=function(i,e,r){if(!i)return e||{};if(!e)return i||{};const o=im(i),s=im(e);(function(h,f){f.removeAll&&(h.add.clear(),h.update.clear(),h.remove.clear(),f.remove.clear());for(const g of f.remove)h.add.delete(g),h.update.delete(g);for(const[g,y]of f.update){const b=h.update.get(g);b&&(f.update.set(g,R0(b,y)),h.update.delete(g))}})(o,s);const u={};if((o.removeAll||s.removeAll)&&(u.removeAll=!0),u.remove=new Set([...o.remove,...s.remove]),u.add=new Map([...o.add,...s.add]),u.update=new Map([...o.update,...s.update]),u.remove.size&&u.add.size)for(const h of u.add.keys())u.remove.delete(h);return(function(h){const f={};return h.removeAll&&(f.removeAll=h.removeAll),h.remove&&(f.remove=Array.from(h.remove)),h.add&&(f.add=Array.from(h.add.values())),h.update&&(f.update=Array.from(h.update.values())),f})(u)},S.a7=function(i,e){const r=new Map;if(i==null||i.type==null)return r;if(i.type==="Feature"){const o=np(i,e);return o==null?void 0:(r.set(o,i),r)}if(i.type==="FeatureCollection"){const o=new Set;for(const s of i.features){const u=np(s,e);if(u==null||o.has(u))return;o.add(u),r.set(u,s)}return r}},S.a8=function(i,e,r){var o,s;const u=[];if(e.removeAll)i.clear();else if(e.remove)for(const h of e.remove){const f=i.get(h);f&&(u.push(f.geometry),i.delete(h))}if(e.add)for(const h of e.add){const f=np(h,r);if(f==null)continue;const g=i.get(f);g&&u.push(g.geometry),u.push(h.geometry),i.set(f,h)}if(e.update)for(const h of e.update){const f=i.get(h.id);if(!f)continue;const g=!!h.newGeometry,y=h.removeAllProperties||((o=h.removeProperties)===null||o===void 0?void 0:o.length)>0||((s=h.addOrUpdateProperties)===null||s===void 0?void 0:s.length)>0;if(!g&&!y)continue;u.push(f.geometry);const b=Object.assign({},f);if(i.set(h.id,b),g&&(u.push(h.newGeometry),b.geometry=h.newGeometry),y){if(b.properties=h.removeAllProperties?{}:Object.assign({},b.properties||{}),h.removeProperties)for(const C of h.removeProperties)delete b.properties[C];if(h.addOrUpdateProperties)for(const{key:C,value:M}of h.addOrUpdateProperties)b.properties[C]=M}}return u},S.a9=nu,S.aA=function(i,{uSize:e,uSizeT:r},{lowerSize:o,upperSize:s}){return i.kind==="source"?o/Ko:i.kind==="composite"?di.number(o/Ko,s/Ko,r):e},S.aB=function(i,e){var r=e[0],o=e[1],s=e[2],u=e[3],h=e[4],f=e[5],g=e[6],y=e[7],b=e[8],C=e[9],M=e[10],E=e[11],z=e[12],D=e[13],F=e[14],j=e[15],J=r*f-o*h,U=r*g-s*h,H=r*y-u*h,re=o*g-s*f,ge=o*y-u*f,je=s*y-u*g,mt=b*D-C*z,ht=b*F-M*z,_t=b*j-E*z,Dt=C*F-M*D,Ct=C*j-E*D,ct=M*j-E*F,tt=J*ct-U*Ct+H*Dt+re*_t-ge*ht+je*mt;return tt?(i[0]=(f*ct-g*Ct+y*Dt)*(tt=1/tt),i[1]=(s*Ct-o*ct-u*Dt)*tt,i[2]=(D*je-F*ge+j*re)*tt,i[3]=(M*ge-C*je-E*re)*tt,i[4]=(g*_t-h*ct-y*ht)*tt,i[5]=(r*ct-s*_t+u*ht)*tt,i[6]=(F*H-z*je-j*U)*tt,i[7]=(b*je-M*H+E*U)*tt,i[8]=(h*Ct-f*_t+y*mt)*tt,i[9]=(o*_t-r*Ct-u*mt)*tt,i[10]=(z*ge-D*H+j*J)*tt,i[11]=(C*H-b*ge-E*J)*tt,i[12]=(f*ht-h*Dt-g*mt)*tt,i[13]=(r*Dt-o*ht+s*mt)*tt,i[14]=(D*U-z*re-F*J)*tt,i[15]=(b*re-C*U+M*J)*tt,i):null},S.aC=Se,S.aD=function(i){var e=i[0],r=i[1];return Math.sqrt(e*e+r*r)},S.aE=function(i){return i[0]=0,i[1]=0,i},S.aF=function(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i},S.aG=Jd,S.aH=bt,S.aI=function(i,e,r,o){const s=e.y-i.y,u=e.x-i.x,h=o.y-r.y,f=o.x-r.x,g=h*u-f*s;if(g===0)return null;const y=(f*(i.y-r.y)-h*(i.x-r.x))/g;return new q(i.x+y*u,i.y+y*s)},S.aJ=Bm,S.aK=Tl,S.aL=function(i){let e=1/0,r=1/0,o=-1/0,s=-1/0;for(const u of i)e=Math.min(e,u.x),r=Math.min(r,u.y),o=Math.max(o,u.x),s=Math.max(s,u.y);return[e,r,o,s]},S.aM=Ui,S.aN=we,S.aO=function(i,e,r,o,s=!1){if(!r[0]&&!r[1])return[0,0];const u=s?o==="map"?-i.bearingInRadians:0:o==="viewport"?i.bearingInRadians:0;if(u){const h=Math.sin(u),f=Math.cos(u);r=[r[0]*f-r[1]*h,r[0]*h+r[1]*f]}return[s?r[0]:we(e,r[0],i.zoom),s?r[1]:we(e,r[1],i.zoom)]},S.aQ=Qd,S.aR=wp,S.aS=Kd,S.aT=Tp,S.aU=Ei,S.aV=Eh,S.aW=W,S.aX=Nt,S.aY=Ye,S.aZ=Cr,S.a_=em,S.aa=Es,S.ab=25,S.ac=ip,S.ad=i=>{const e=window.document.createElement("video");return e.muted=!0,new Promise((r=>{e.onloadstart=()=>{r(e)};for(const o of i){const s=window.document.createElement("source");Ae(o)||(e.crossOrigin="Anonymous"),s.src=o,e.appendChild(s)}}))},S.ae=Je,S.af=function(){return it++},S.ag=c,S.ah=kl,S.ai=su,S.aj=os,S.ak=Po,S.al=om,S.am=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((r,o,s,u)=>{const h=s||u;return e[o]=!h||h.toLowerCase(),""})),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e},S.an=De,S.ao=85.051129,S.ap=Ar,S.aq=function(i){return Math.pow(2,i)},S.ar=nt,S.as=Jf,S.at=function(i){return Math.log(i)/Math.LN2},S.au=function(i){var e=i[0],r=i[1];return e*e+r*r},S.av=function(i){if(!i.length)return new Set;const e=Math.max(...i.map((g=>g.canonical.z)));let r=1/0,o=-1/0,s=1/0,u=-1/0;const h=[];for(const g of i){const{x:y,y:b,z:C}=g.canonical,M=Math.pow(2,e-C),E=y*M,z=b*M;h.push({id:g,x:E,y:z}),E<r&&(r=E),E>o&&(o=E),z<s&&(s=z),z>u&&(u=z)}const f=new Set;for(const g of h)g.x!==r&&g.x!==o&&g.y!==s&&g.y!==u||f.add(g.id);return f},S.aw=function(i,e){const r=Math.abs(2*i.wrap)-+(i.wrap<0),o=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||o-r||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x},S.ax=class{constructor(i,e){this.max=i,this.onRemove=e,this.reset()}reset(){for(const i in this.data)for(const e of this.data[i])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(i,e,r){const o=i.wrapped().key;this.data[o]===void 0&&(this.data[o]=[]);const s={value:e,timeout:void 0};if(r!==void 0&&(s.timeout=setTimeout((()=>{this.remove(i,s)}),r)),this.data[o].push(s),this.order.push(o),this.order.length>this.max){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const e=this.data[i].shift();return e.timeout&&clearTimeout(e.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),e.value}getByKey(i){const e=this.data[i];return e?e[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,e){if(!this.has(i))return this;const r=i.wrapped().key,o=e===void 0?0:this.data[r].indexOf(e),s=this.data[r][o];return this.data[r].splice(o,1),s.timeout&&clearTimeout(s.timeout),this.data[r].length===0&&delete this.data[r],this.onRemove(s.value),this.order.splice(this.order.indexOf(r),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(i){const e=[];for(const r in this.data)for(const o of this.data[r])i(o.value)||e.push(o);for(const r of e)this.remove(r.value.tileID,r)}},S.ay=function(i,e){let r=0,o=0;if(i.kind==="constant")o=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:s,minZoom:u,maxZoom:h}=i,f=s?De(cn.interpolationFactor(s,e,u,h),0,1):0;i.kind==="camera"?o=di.number(i.minSize,i.maxSize,f):r=f}return{uSizeT:r,uSize:o}},S.b=Xt,S.b$=Xo,S.b0=lt,S.b1=function(i){var e=new vt(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e},S.b2=function(i,e,r){return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],i},S.b3=function(i,e){var r=e[0],o=e[1],s=e[2],u=r*r+o*o+s*s;return u>0&&(u=1/Math.sqrt(u)),i[0]=e[0]*u,i[1]=e[1]*u,i[2]=e[2]*u,i},S.b4=pt,S.b5=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]},S.b6=function(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i[3]=e[3]*r[3],i},S.b7=Oe,S.b8=function(i,e,r){const o=e[0]*r[0]+e[1]*r[1]+e[2]*r[2];return o===0?null:(-(i[0]*r[0]+i[1]*r[1]+i[2]*r[2])-r[3])/o},S.b9=gt,S.bA=function(){return new Float64Array(3)},S.bB=Be,S.bC=function(i,e,r){var o=r[0],s=r[1],u=r[2],h=r[3],f=e[0],g=e[1],y=e[2],b=s*y-u*g,C=u*f-o*y,M=o*g-s*f;return i[0]=f+h*(b+=b)+s*(M+=M)-u*(C+=C),i[1]=g+h*C+u*b-o*M,i[2]=y+h*M+o*C-s*b,i},S.bD=function(i,e,r){const o=(s=[i[0],i[1],i[2],e[0],e[1],e[2],r[0],r[1],r[2]])[0]*((b=s[8])*(h=s[4])-(f=s[5])*(y=s[7]))+s[1]*(-b*(u=s[3])+f*(g=s[6]))+s[2]*(y*u-h*g);var s,u,h,f,g,y,b;if(o===0)return null;const C=pt([],[e[0],e[1],e[2]],[r[0],r[1],r[2]]),M=pt([],[r[0],r[1],r[2]],[i[0],i[1],i[2]]),E=pt([],[i[0],i[1],i[2]],[e[0],e[1],e[2]]),z=Re([],C,-i[3]);return lt(z,z,Re([],M,-e[3])),lt(z,z,Re([],E,-r[3])),Re(z,z,1/o),z},S.bE=rp,S.bF=function(){return new Float64Array(4)},S.bG=function(i,e,r,o){var s=[],u=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],u[0]=s[0]*Math.cos(o)-s[1]*Math.sin(o),u[1]=s[0]*Math.sin(o)+s[1]*Math.cos(o),u[2]=s[2],i[0]=u[0]+r[0],i[1]=u[1]+r[1],i[2]=u[2]+r[2],i},S.bH=function(i,e,r,o){var s=[],u=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],u[0]=s[0],u[1]=s[1]*Math.cos(o)-s[2]*Math.sin(o),u[2]=s[1]*Math.sin(o)+s[2]*Math.cos(o),i[0]=u[0]+r[0],i[1]=u[1]+r[1],i[2]=u[2]+r[2],i},S.bI=function(i,e,r,o){var s=[],u=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],u[0]=s[2]*Math.sin(o)+s[0]*Math.cos(o),u[1]=s[1],u[2]=s[2]*Math.cos(o)-s[0]*Math.sin(o),i[0]=u[0]+r[0],i[1]=u[1]+r[1],i[2]=u[2]+r[2],i},S.bJ=function(i,e,r){var o=Math.sin(r),s=Math.cos(r),u=e[0],h=e[1],f=e[2],g=e[3],y=e[8],b=e[9],C=e[10],M=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=u*s-y*o,i[1]=h*s-b*o,i[2]=f*s-C*o,i[3]=g*s-M*o,i[8]=u*o+y*s,i[9]=h*o+b*s,i[10]=f*o+C*s,i[11]=g*o+M*s,i},S.bK=function(i,e){const r=be(i,360),o=be(e,360),s=o-r,u=o>r?s-360:s+360;return Math.abs(s)<Math.abs(u)?s:u},S.bL=function(i){return i[0]=0,i[1]=0,i[2]=0,i},S.bM=function(i,e,r,o){const s=Math.sqrt(i*i+e*e),u=Math.sqrt(r*r+o*o);i/=s,e/=s,r/=u,o/=u;const h=Math.acos(i*r+e*o);return-e*r+i*o>0?h:-h},S.bN=function(i,e){const r=be(i,2*Math.PI),o=be(e,2*Math.PI);return Math.min(Math.abs(r-o),Math.abs(r-o+2*Math.PI),Math.abs(r-o-2*Math.PI))},S.bO=function(){const i={},e=pe.$version;for(const r in pe.$root){const o=pe.$root[r];if(o.required){let s=null;s=r==="version"?e:o.type==="array"?[]:{},s!=null&&(i[r]=s)}}return i},S.bP=_e,S.bQ=kc,S.bR=function i(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(let o=0;o<e.length;o++)if(!i(e[o],r[o]))return!1;return!0}if(typeof e=="object"&&e!==null&&r!==null){if(typeof r!="object"||Object.keys(e).length!==Object.keys(r).length)return!1;for(const o in e)if(!i(e[o],r[o]))return!1;return!0}return e===r},S.bS=function(i){i=i.slice();const e=Object.create(null);for(let r=0;r<i.length;r++)e[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=cr(i[r],e[i[r].ref]));return i},S.bT=function(i,e){if(i.type==="custom")return new z0(i,e);switch(i.type){case"background":return new k0(i,e);case"circle":return new m_(i,e);case"color-relief":return new b_(i,e);case"fill":return new F_(i,e);case"fill-extrusion":return new X_(i,e);case"heatmap":return new __(i,e);case"hillshade":return new y_(i,e);case"line":return new t0(i,e);case"raster":return new kd(i,e);case"symbol":return new Lh(i,e)}},S.bU=i=>i.type==="raster",S.bV=Ft,S.bW=function(i,e){if(!i)return[{command:"setStyle",args:[e]}];let r=[];try{if(!Bt(i.version,e.version))return[{command:"setStyle",args:[e]}];Bt(i.center,e.center)||r.push({command:"setCenter",args:[e.center]}),Bt(i.state,e.state)||r.push({command:"setGlobalState",args:[e.state]}),Bt(i.centerAltitude,e.centerAltitude)||r.push({command:"setCenterAltitude",args:[e.centerAltitude]}),Bt(i.zoom,e.zoom)||r.push({command:"setZoom",args:[e.zoom]}),Bt(i.bearing,e.bearing)||r.push({command:"setBearing",args:[e.bearing]}),Bt(i.pitch,e.pitch)||r.push({command:"setPitch",args:[e.pitch]}),Bt(i.roll,e.roll)||r.push({command:"setRoll",args:[e.roll]}),Bt(i.sprite,e.sprite)||r.push({command:"setSprite",args:[e.sprite]}),Bt(i.glyphs,e.glyphs)||r.push({command:"setGlyphs",args:[e.glyphs]}),Bt(i.transition,e.transition)||r.push({command:"setTransition",args:[e.transition]}),Bt(i.light,e.light)||r.push({command:"setLight",args:[e.light]}),Bt(i.terrain,e.terrain)||r.push({command:"setTerrain",args:[e.terrain]}),Bt(i.sky,e.sky)||r.push({command:"setSky",args:[e.sky]}),Bt(i.projection,e.projection)||r.push({command:"setProjection",args:[e.projection]});const o={},s=[];(function(h,f,g,y){let b;for(b in f=f||{},h=h||{})Object.prototype.hasOwnProperty.call(h,b)&&(Object.prototype.hasOwnProperty.call(f,b)||zr(b,g,y));for(b in f)Object.prototype.hasOwnProperty.call(f,b)&&(Object.prototype.hasOwnProperty.call(h,b)?Bt(h[b],f[b])||(h[b].type==="geojson"&&f[b].type==="geojson"&&hr(h,f,b)?qt(g,{command:"setGeoJSONSourceData",args:[b,f[b].data]}):Ir(b,f,g,y)):Ht(b,f,g))})(i.sources,e.sources,s,o);const u=[];i.layers&&i.layers.forEach((h=>{"source"in h&&o[h.source]?r.push({command:"removeLayer",args:[h.id]}):u.push(h)})),r=r.concat(s),(function(h,f,g){f=f||[];const y=(h=h||[]).map(dr),b=f.map(dr),C=h.reduce(fr,{}),M=f.reduce(fr,{}),E=y.slice(),z=Object.create(null);let D,F,j,J,U;for(let H=0,re=0;H<y.length;H++)D=y[H],Object.prototype.hasOwnProperty.call(M,D)?re++:(qt(g,{command:"removeLayer",args:[D]}),E.splice(E.indexOf(D,re),1));for(let H=0,re=0;H<b.length;H++)D=b[b.length-1-H],E[E.length-1-H]!==D&&(Object.prototype.hasOwnProperty.call(C,D)?(qt(g,{command:"removeLayer",args:[D]}),E.splice(E.lastIndexOf(D,E.length-re),1)):re++,J=E[E.length-H],qt(g,{command:"addLayer",args:[M[D],J]}),E.splice(E.length-H,0,D),z[D]=!0);for(let H=0;H<b.length;H++)if(D=b[H],F=C[D],j=M[D],!z[D]&&!Bt(F,j))if(Bt(F.source,j.source)&&Bt(F["source-layer"],j["source-layer"])&&Bt(F.type,j.type)){for(U in xr(F.layout,j.layout,g,D,null,"setLayoutProperty"),xr(F.paint,j.paint,g,D,null,"setPaintProperty"),Bt(F.filter,j.filter)||qt(g,{command:"setFilter",args:[D,j.filter]}),Bt(F.minzoom,j.minzoom)&&Bt(F.maxzoom,j.maxzoom)||qt(g,{command:"setLayerZoomRange",args:[D,j.minzoom,j.maxzoom]}),F)Object.prototype.hasOwnProperty.call(F,U)&&U!=="layout"&&U!=="paint"&&U!=="filter"&&U!=="metadata"&&U!=="minzoom"&&U!=="maxzoom"&&(U.indexOf("paint.")===0?xr(F[U],j[U],g,D,U.slice(6),"setPaintProperty"):Bt(F[U],j[U])||qt(g,{command:"setLayerProperty",args:[D,U,j[U]]}));for(U in j)Object.prototype.hasOwnProperty.call(j,U)&&!Object.prototype.hasOwnProperty.call(F,U)&&U!=="layout"&&U!=="paint"&&U!=="filter"&&U!=="metadata"&&U!=="minzoom"&&U!=="maxzoom"&&(U.indexOf("paint.")===0?xr(F[U],j[U],g,D,U.slice(6),"setPaintProperty"):Bt(F[U],j[U])||qt(g,{command:"setLayerProperty",args:[D,U,j[U]]}))}else qt(g,{command:"removeLayer",args:[D]}),J=E[E.lastIndexOf(D)+1],qt(g,{command:"addLayer",args:[j,J]})})(u,e.layers,r)}catch(o){console.warn("Unable to compute style diff:",o),r=[{command:"setStyle",args:[e]}]}return r},S.bX=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},S.bY=It,S.bZ=Rt,S.b_=class extends fn{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},S.ba=function(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i[3]=e[3]*r,i},S.bb=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]},S.bc=rm,S.bd=zl,S.be=function(i,e,r,o,s){var u=1/Math.tan(e/2);if(i[0]=u/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=u,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,s!=null&&s!==1/0){var h=1/(o-s);i[10]=(s+o)*h,i[14]=2*s*o*h}else i[10]=-1,i[14]=-2*o;return i},S.bf=function(i){var e=new vt(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},S.bg=function(i,e,r){var o=Math.sin(r),s=Math.cos(r),u=e[0],h=e[1],f=e[2],g=e[3],y=e[4],b=e[5],C=e[6],M=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=u*s+y*o,i[1]=h*s+b*o,i[2]=f*s+C*o,i[3]=g*s+M*o,i[4]=y*s-u*o,i[5]=b*s-h*o,i[6]=C*s-f*o,i[7]=M*s-g*o,i},S.bh=function(i,e,r){var o=Math.sin(r),s=Math.cos(r),u=e[4],h=e[5],f=e[6],g=e[7],y=e[8],b=e[9],C=e[10],M=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=u*s+y*o,i[5]=h*s+b*o,i[6]=f*s+C*o,i[7]=g*s+M*o,i[8]=y*s-u*o,i[9]=b*s-h*o,i[10]=C*s-f*o,i[11]=M*s-g*o,i},S.bi=function(){const i=new Float32Array(16);return nt(i),i},S.bj=function(){const i=new Float64Array(16);return nt(i),i},S.bk=function(){return new Float64Array(16)},S.bl=function(i,e,r){const o=new Float64Array(4);return Be(o,i,e-90,r),o},S.bm=function(i,e,r,o){var s,u,h,f,g,y=e[0],b=e[1],C=e[2],M=e[3],E=r[0],z=r[1],D=r[2],F=r[3];return(u=y*E+b*z+C*D+M*F)<0&&(u=-u,E=-E,z=-z,D=-D,F=-F),1-u>ut?(s=Math.acos(u),h=Math.sin(s),f=Math.sin((1-o)*s)/h,g=Math.sin(o*s)/h):(f=1-o,g=o),i[0]=f*y+g*E,i[1]=f*b+g*z,i[2]=f*C+g*D,i[3]=f*M+g*F,i},S.bn=function(i){const e=new Float64Array(9);var r,o,s,u,h,f,g,y,b,C,M,E,z,D,F,j,J,U;C=(s=(o=i)[0])*(g=s+s),M=(u=o[1])*g,z=(h=o[2])*g,D=h*(y=u+u),j=(f=o[3])*g,J=f*y,U=f*(b=h+h),(r=e)[0]=1-(E=u*y)-(F=h*b),r[3]=M-U,r[6]=z+J,r[1]=M+U,r[4]=1-C-F,r[7]=D-j,r[2]=z-J,r[5]=D+j,r[8]=1-C-E;const H=Cr(-Math.asin(De(e[2],-1,1)));let re,ge;return Math.hypot(e[5],e[8])<.001?(re=0,ge=-Cr(Math.atan2(e[3],e[4]))):(re=Cr(e[5]===0&&e[8]===0?0:Math.atan2(e[5],e[8])),ge=Cr(e[1]===0&&e[0]===0?0:Math.atan2(e[1],e[0]))),{roll:re,pitch:H+90,bearing:ge}},S.bo=function(i,e){return i.roll==e.roll&&i.pitch==e.pitch&&i.bearing==e.bearing},S.bp=Lr,S.bq=Wo,S.br=Ml,S.bs=Jc,S.bt=Il,S.bu=ie,S.bv=ee,S.bw=ln,S.bx=function(i,e,r,o,s){return ie(o,s,De((i-e)/(r-e),0,1))},S.by=function(i,e,r,o){return i[0]=e[0]+r[0]*o,i[1]=e[1]+r[1]*o,i[2]=e[2]+r[2]*o,i},S.bz=be,S.c=R,S.c$=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},S.c0=class extends fn{constructor(i,e){super(i,e),this.current=kn}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},S.c1=Ps,S.c2=class extends fn{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},S.c3=class extends fn{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},S.c4=Ke,S.c5=function(i,e){var r=Math.sin(e),o=Math.cos(e);return i[0]=o,i[1]=r,i[2]=0,i[3]=-r,i[4]=o,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},S.c6=function(i,e,r){var o=e[0],s=e[1],u=e[2];return i[0]=o*r[0]+s*r[3]+u*r[6],i[1]=o*r[1]+s*r[4]+u*r[7],i[2]=o*r[2]+s*r[5]+u*r[8],i},S.c7=function(i,e,r,o,s,u,h){var f=1/(e-r),g=1/(o-s),y=1/(u-h);return i[0]=-2*f,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*g,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*y,i[11]=0,i[12]=(e+r)*f,i[13]=(s+o)*g,i[14]=(h+u)*y,i[15]=1,i},S.c8=class extends fn{constructor(i,e){super(i,e),this.current=new Array}set(i){if(i!=this.current){this.current=i;const e=new Float32Array(4*i.length);for(let r=0;r<i.length;r++)e[4*r]=i[r].r,e[4*r+1]=i[r].g,e[4*r+2]=i[r].b,e[4*r+3]=i[r].a;this.gl.uniform4fv(this.location,e)}}},S.c9=class extends fn{constructor(i,e){super(i,e),this.current=new Array}set(i){if(i!=this.current){this.current=i;const e=new Float32Array(i);this.gl.uniform1fv(this.location,e)}}},S.cA=function(i,e){var r;if(!Rr[e])return!1;const o=i?.target,s=((r=o?.ownerDocument)===null||r===void 0?void 0:r.defaultView)||window;return i instanceof s.MouseEvent||i instanceof s.WheelEvent},S.cB=function(i,e){return pr[e]&&"touches"in i},S.cC=function(i){return pr[i]||Rr[i]},S.cD=function(i,e,r){var o=e[0],s=e[1];return i[0]=r[0]*o+r[4]*s+r[12],i[1]=r[1]*o+r[5]*s+r[13],i},S.cE=function(i,e){const{x:r,y:o}=nu.fromLngLat(e);return!(i<0||i>25||o<0||o>=1||r<0||r>=1)},S.cF=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},S.cG=class extends gl{},S.cH=vv,S.cJ=se,S.cK=function(i,e){R.REGISTERED_PROTOCOLS[i]=e},S.cL=function(i){delete R.REGISTERED_PROTOCOLS[i]},S.cM=function(i,e){const r={};for(let s=0;s<i.length;s++){const u=e&&e[i[s].id]||eh(i[s]);e&&(e[i[s].id]=u);let h=r[u];h||(h=r[u]=[]),h.push(i[s])}const o=[];for(const s in r)o.push(r[s]);return o},S.cN=Zt,S.cO=nm,S.cP=Fm,S.cQ=Nf,S.cR=function(i){var e;i.bucket.createArrays(),i.bucket.tilePixelRatio=Ce/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const r=i.bucket.layers[0],o=r.layout,s=r._unevaluatedLayout._values,u={layoutIconSize:s["icon-size"].possiblyEvaluate(new $r(i.bucket.zoom+1),i.canonical),layoutTextSize:s["text-size"].possiblyEvaluate(new $r(i.bucket.zoom+1),i.canonical),textMaxSize:s["text-size"].possiblyEvaluate(new $r(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:b,maxZoom:C}=i.bucket.textSizeData;u.compositeTextSizes=[s["text-size"].possiblyEvaluate(new $r(b),i.canonical),s["text-size"].possiblyEvaluate(new $r(C),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:b,maxZoom:C}=i.bucket.iconSizeData;u.compositeIconSizes=[s["icon-size"].possiblyEvaluate(new $r(b),i.canonical),s["icon-size"].possiblyEvaluate(new $r(C),i.canonical)]}const h=o.get("text-line-height")*Ui,f=o.get("text-rotation-alignment")!=="viewport"&&o.get("symbol-placement")!=="point",g=o.get("text-keep-upright"),y=o.get("text-size");for(const b of i.bucket.features){const C=o.get("text-font").evaluate(b,{},i.canonical).join(","),M=y.evaluate(b,{},i.canonical),E=u.layoutTextSize.evaluate(b,{},i.canonical),z=u.layoutIconSize.evaluate(b,{},i.canonical),D={horizontal:{},vertical:void 0},F=b.text;let j,J=[0,0];if(F){const re=F.toString(),ge=o.get("text-letter-spacing").evaluate(b,{},i.canonical)*Ui,je=Ed(re)?ge:0,mt=o.get("text-anchor").evaluate(b,{},i.canonical),ht=Ym(r,b,i.canonical);if(!ht){const ct=o.get("text-radial-offset").evaluate(b,{},i.canonical);J=ct?Xm(mt,[ct*Ui,bp]):o.get("text-offset").evaluate(b,{},i.canonical).map((tt=>tt*Ui))}let _t=f?"center":o.get("text-justify").evaluate(b,{},i.canonical);const Dt=o.get("symbol-placement")==="point"?o.get("text-max-width").evaluate(b,{},i.canonical)*Ui:1/0,Ct=()=>{i.bucket.allowVerticalPlacement&&Ma(re)&&(D.vertical=zh(F,i.glyphMap,i.glyphPositions,i.imagePositions,C,Dt,h,mt,"left",je,J,S.az.vertical,!0,E,M))};if(!f&&ht){const ct=new Set;if(_t==="auto")for(let Ut=0;Ut<ht.values.length;Ut+=2)ct.add(wp(ht.values[Ut]));else ct.add(_t);let tt=!1;for(const Ut of ct)if(!D.horizontal[Ut])if(tt)D.horizontal[Ut]=D.horizontal[0];else{const Vt=zh(F,i.glyphMap,i.glyphPositions,i.imagePositions,C,Dt,h,"center",Ut,je,J,S.az.horizontal,!1,E,M);Vt&&(D.horizontal[Ut]=Vt,tt=Vt.positionedLines.length===1)}Ct()}else{_t==="auto"&&(_t=wp(mt));const ct=zh(F,i.glyphMap,i.glyphPositions,i.imagePositions,C,Dt,h,mt,_t,je,J,S.az.horizontal,!1,E,M);ct&&(D.horizontal[_t]=ct),Ct(),Ma(re)&&f&&g&&(D.vertical=zh(F,i.glyphMap,i.glyphPositions,i.imagePositions,C,Dt,h,mt,_t,je,J,S.az.vertical,!1,E,M))}}let U=!1;if(b.icon&&b.icon.name){const re=i.imageMap[b.icon.name];re&&(j=I0(i.imagePositions[b.icon.name],o.get("icon-offset").evaluate(b,{},i.canonical),o.get("icon-anchor").evaluate(b,{},i.canonical)),U=!!re.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=U:i.bucket.sdfIcons!==U&&Yt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(re.pixelRatio!==i.bucket.pixelRatio||o.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const H=Qm(D.horizontal)||D.vertical;(e=i.bucket).iconsInText||(e.iconsInText=!!H&&H.iconsInText),(H||j)&&gv(i.bucket,b,D,j,i.imageMap,u,E,z,J,U,i.canonical,i.subdivisionGranularity)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},S.cS=qd,S.cT=Hd,S.cU=Wd,S.cV=function(i){const e=new kh;return(function(r,o){for(const s in r.layers)o.writeMessage(3,rv,r.layers[s])})(i,e),e.finish()},S.cW=function(i,e,r,o,s,u){let h=Nm(i,e,r,s,0);return h=Nm(h,e,o,u,1),h},S.cX=class{constructor(i){this.maxEntries=i,this.map=new Map}get(i){const e=this.map.get(i);return e!==void 0&&(this.map.delete(i),this.map.set(i,e)),e}set(i,e){if(this.map.has(i))this.map.delete(i);else if(this.map.size>=this.maxEntries){const r=this.map.keys().next().value;this.map.delete(r)}this.map.set(i,e)}clear(){this.map.clear()}},S.cY=bf,S.cZ=kh,S.c_=Lm,S.ca=class extends Zo{},S.cb=o0,S.cc=class extends Ss{},S.cd=Nd,S.ce=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},S.cf=af,S.cg=function(i,e,r){var o=e[0],s=e[1],u=e[2],h=r[3]*o+r[7]*s+r[11]*u+r[15];return i[0]=(r[0]*o+r[4]*s+r[8]*u+r[12])/(h=h||1),i[1]=(r[1]*o+r[5]*s+r[9]*u+r[13])/h,i[2]=(r[2]*o+r[6]*s+r[10]*u+r[14])/h,i},S.ch=class extends Bc{},S.ci=class extends t{},S.cj=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]&&i[9]===e[9]&&i[10]===e[10]&&i[11]===e[11]&&i[12]===e[12]&&i[13]===e[13]&&i[14]===e[14]&&i[15]===e[15]},S.ck=function(i,e){var r=i[0],o=i[1],s=i[2],u=i[3],h=i[4],f=i[5],g=i[6],y=i[7],b=i[8],C=i[9],M=i[10],E=i[11],z=i[12],D=i[13],F=i[14],j=i[15],J=e[0],U=e[1],H=e[2],re=e[3],ge=e[4],je=e[5],mt=e[6],ht=e[7],_t=e[8],Dt=e[9],Ct=e[10],ct=e[11],tt=e[12],Ut=e[13],Vt=e[14],Wt=e[15];return Math.abs(r-J)<=ut*Math.max(1,Math.abs(r),Math.abs(J))&&Math.abs(o-U)<=ut*Math.max(1,Math.abs(o),Math.abs(U))&&Math.abs(s-H)<=ut*Math.max(1,Math.abs(s),Math.abs(H))&&Math.abs(u-re)<=ut*Math.max(1,Math.abs(u),Math.abs(re))&&Math.abs(h-ge)<=ut*Math.max(1,Math.abs(h),Math.abs(ge))&&Math.abs(f-je)<=ut*Math.max(1,Math.abs(f),Math.abs(je))&&Math.abs(g-mt)<=ut*Math.max(1,Math.abs(g),Math.abs(mt))&&Math.abs(y-ht)<=ut*Math.max(1,Math.abs(y),Math.abs(ht))&&Math.abs(b-_t)<=ut*Math.max(1,Math.abs(b),Math.abs(_t))&&Math.abs(C-Dt)<=ut*Math.max(1,Math.abs(C),Math.abs(Dt))&&Math.abs(M-Ct)<=ut*Math.max(1,Math.abs(M),Math.abs(Ct))&&Math.abs(E-ct)<=ut*Math.max(1,Math.abs(E),Math.abs(ct))&&Math.abs(z-tt)<=ut*Math.max(1,Math.abs(z),Math.abs(tt))&&Math.abs(D-Ut)<=ut*Math.max(1,Math.abs(D),Math.abs(Ut))&&Math.abs(F-Vt)<=ut*Math.max(1,Math.abs(F),Math.abs(Vt))&&Math.abs(j-Wt)<=ut*Math.max(1,Math.abs(j),Math.abs(Wt))},S.cl=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},S.cm=i=>i.type==="symbol",S.cn=i=>i.type==="circle",S.co=i=>i.type==="heatmap",S.cp=i=>i.type==="line",S.cq=i=>i.type==="fill",S.cr=i=>i.type==="fill-extrusion",S.cs=i=>i.type==="hillshade",S.ct=i=>i.type==="color-relief",S.cu=i=>i.type==="background",S.cv=i=>i.type==="custom",S.cw=Q,S.cx=function(i,e,r){if(e<=0)return i;const o=1/e;return r===void 0||Math.abs(r)<1e-10?Math.round(i*o)/o:(r>0?Math.ceil(i*o-1e-9):Math.floor(i*o+1e-10))/o},S.cy=function(i,e,r){const o=Te(e.x-r.x,e.y-r.y),s=Te(i.x-r.x,i.y-r.y);var u,h;return Cr(Math.atan2(o[0]*s[1]-o[1]*s[0],(u=o)[0]*(h=s)[0]+u[1]*h[1]))},S.cz=ue,S.d=Ae,S.d0=function(i,e,r,o,s){return l(this,void 0,void 0,(function*(){if(Ve())try{return yield Et(i,e,r,o,s)}catch{}return(function(u,h,f,g,y){const b=u.width,C=u.height;Ot&&ar||(Ot=new OffscreenCanvas(b,C),ar=Ot.getContext("2d",{willReadFrequently:!0})),Ot.width=b,Ot.height=C,ar.drawImage(u,0,0,b,C);const M=ar.getImageData(h,f,g,y);return ar.clearRect(0,0,b,C),M.data})(i,e,r,o,s)}))},S.d1=cf,S.d2=xe,S.d3=class{constructor(i,e){this.layers={[su]:this},this.name=su,this.version=e?e.version:1,this.extent=e?e.extent:4096,this.length=i.length,this.features=i}feature(i){return new tv(this.features[i],this.extent)}},S.d4=ns,S.d5=wo,S.e=ot,S.f=i=>l(void 0,void 0,void 0,(function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(e)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),S.g=O,S.h=i=>new Promise(((e,r)=>{const o=new Image;o.onload=()=>{e(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame((()=>{o.src=Sr}))},o.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const s=new Blob([new Uint8Array(i)],{type:"image/png"});o.src=i.byteLength?URL.createObjectURL(s):Sr})),S.i=Qt,S.j=(i,e)=>Le(ot(i,{type:"json"}),e),S.k=ke,S.l=dt,S.m=Le,S.n=(i,e)=>Le(ot(i,{type:"arrayBuffer"}),e),S.o=function(i){return new kh(i).readFields(y0,[])},S.p=Bf,S.q=function(i){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))},S.r=Wc,S.s=ur,S.t=un,S.u=pe,S.v=ds,S.w=Yt,S.x=Fc,S.y=ps,S.z=_s})),me("worker",["./shared"],(function(S){class l{constructor(R,O){this.keyCache={},R&&this.replace(R,O)}replace(R,O){this._layerConfigs={},this._layers={},this.update(R,[],O)}update(R,O,V){for(const _e of R){this._layerConfigs[_e.id]=_e;const Le=this._layers[_e.id]=S.bT(_e,V);Le._featureFilter=S.aj(Le.filter,V),this.keyCache[_e.id]&&delete this.keyCache[_e.id]}for(const _e of O)delete this.keyCache[_e],delete this._layerConfigs[_e],delete this._layers[_e];this.familiesBySource={};const se=S.cM(Object.values(this._layerConfigs),this.keyCache);for(const _e of se){const Le=_e.map((et=>this._layers[et.id])),Ae=Le[0];if(Ae.isHidden())continue;const Pe=Ae.source||"";let ze=this.familiesBySource[Pe];ze||(ze=this.familiesBySource[Pe]={});const dt=Ae.sourceLayer||S.ai;let ke=ze[dt];ke||(ke=ze[dt]=[]),ke.push(Le)}}}class q{constructor(R){const O={},V=[];for(const Ae in R){const Pe=R[Ae],ze=O[Ae]={};for(const dt in Pe){const ke=Pe[+dt];if(!ke||ke.bitmap.width===0||ke.bitmap.height===0)continue;const et={x:0,y:0,w:ke.bitmap.width+2,h:ke.bitmap.height+2};V.push(et),ze[dt]={rect:et,metrics:ke.metrics}}}const{w:se,h:_e}=S.p(V),Le=new S.r({width:se||1,height:_e||1});for(const Ae in R){const Pe=R[Ae];for(const ze in Pe){const dt=Pe[+ze];if(!dt||dt.bitmap.width===0||dt.bitmap.height===0)continue;const ke=O[Ae][ze].rect;S.r.copy(dt.bitmap,Le,{x:0,y:0},{x:ke.x+1,y:ke.y+1},dt.bitmap)}}this.image=Le,this.positions=O}}S.cN("GlyphAtlas",q);class xe{constructor(R){this.tileID=new S.a2(R.tileID.overscaledZ,R.tileID.wrap,R.tileID.canonical.z,R.tileID.canonical.x,R.tileID.canonical.y),this.uid=R.uid,this.zoom=R.zoom,this.pixelRatio=R.pixelRatio,this.tileSize=R.tileSize,this.source=R.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=R.showCollisionBoxes,this.collectResourceTiming=!!R.collectResourceTiming,this.returnDependencies=!!R.returnDependencies,this.promoteId=R.promoteId,this.inFlightDependencies=[]}parse(R,O,V,se,_e){return S._(this,void 0,void 0,(function*(){this.status="parsing",this.data=R,this.collisionBoxArray=new S.ag;const Le=new S.cO(Object.keys(R.layers).sort()),Ae=new S.cP(this.tileID,this.promoteId);Ae.bucketLayerIDs=[];const Pe={},ze={featureIndex:Ae,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:V,subdivisionGranularity:_e},dt=O.familiesBySource[this.source];for(const Je in dt){const Dr=R.layers[Je];if(!Dr)continue;Dr.version===1&&S.w(`Vector tile source "${this.source}" layer "${Je}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const li=Le.encode(Je),Ji=[];for(let Kr=0;Kr<Dr.length;Kr++){const wt=Dr.feature(Kr),rr=Ae.getId(wt,Je);Ji.push({feature:wt,id:rr,index:Kr,sourceLayerIndex:li})}for(const Kr of dt[Je]){const wt=Kr[0];wt.source!==this.source&&S.w(`layer.source = ${wt.source} does not equal this.source = ${this.source}`),wt.isHidden(this.zoom,!0)||(Ie(Kr,this.zoom,V),(Pe[wt.id]=wt.createBucket({index:Ae.bucketLayerIDs.length,layers:Kr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:li,sourceID:this.source})).populate(Ji,ze,this.tileID.canonical),Ae.bucketLayerIDs.push(Kr.map((rr=>rr.id))))}}const ke=S.bY(ze.glyphDependencies,(Je=>Object.keys(Je).map(Number)));this.inFlightDependencies.forEach((Je=>Je?.abort())),this.inFlightDependencies=[];let et=Promise.resolve({});if(Object.keys(ke).length){const Je=new AbortController;this.inFlightDependencies.push(Je),et=se.sendAsync({type:"GG",data:{stacks:ke,source:this.source,tileID:this.tileID,type:"glyphs"}},Je)}const pe=Object.keys(ze.iconDependencies);let Lt=Promise.resolve({});if(pe.length){const Je=new AbortController;this.inFlightDependencies.push(Je),Lt=se.sendAsync({type:"GI",data:{icons:pe,source:this.source,tileID:this.tileID,type:"icons"}},Je)}const cr=Object.keys(ze.patternDependencies);let Bt=Promise.resolve({});if(cr.length){const Je=new AbortController;this.inFlightDependencies.push(Je),Bt=se.sendAsync({type:"GI",data:{icons:cr,source:this.source,tileID:this.tileID,type:"patterns"}},Je)}const qt=ze.dashDependencies;let Ht=Promise.resolve({});if(Object.keys(qt).length){const Je=new AbortController;this.inFlightDependencies.push(Je),Ht=se.sendAsync({type:"GDA",data:{dashes:qt}},Je)}const[zr,Ir,hr,xr]=yield Promise.all([et,Lt,Bt,Ht]),dr=new q(zr),fr=new S.cQ(Ir,hr);for(const Je in Pe){const Dr=Pe[Je];Dr instanceof S.ah?(Ie(Dr.layers,this.zoom,V),S.cR({bucket:Dr,glyphMap:zr,glyphPositions:dr.positions,imageMap:Ir,imagePositions:fr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:ze.subdivisionGranularity})):Dr.hasDependencies&&(Dr instanceof S.cS||Dr instanceof S.cT||Dr instanceof S.cU)&&(Ie(Dr.layers,this.zoom,V),Dr.addFeatures(ze,this.tileID.canonical,fr.patternPositions,xr))}return this.status="done",{buckets:Object.values(Pe).filter((Je=>!Je.isEmpty())),featureIndex:Ae,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:dr.image,imageAtlas:fr,dashPositions:xr,glyphMap:this.returnDependencies?zr:null,iconMap:this.returnDependencies?Ir:null,glyphPositions:this.returnDependencies?dr.positions:null}}))}}function Ie(ce,R,O){const V=new S.H(R);for(const se of ce)se.recalculate(V,O)}class qe{constructor(R,O,V,se,_e){this.type=R,this.properties=V||{},this.extent=_e,this.pointsArray=O,this.id=se}loadGeometry(){return this.pointsArray.map((R=>R.map((O=>new S.P(O.x,O.y)))))}}class Ne{constructor(R,O,V){this.version=2,this._myFeatures=R,this.name=O,this.length=R.length,this.extent=V}feature(R){return this._myFeatures[R]}}class Xe{constructor(){this.layers={}}addLayer(R){this.layers[R.name]=R}}function He(ce){let R=S.cV(ce);return R.byteOffset===0&&R.byteLength===R.buffer.byteLength||(R=new Uint8Array(R)),{vectorTile:ce,rawData:R.buffer}}function Ee(ce,R,O){const{extent:V}=ce,se=Math.pow(2,O.z-R.z),_e=(O.x-R.x*se)*V,Le=(O.y-R.y*se)*V,Ae=[];for(let Pe=0;Pe<ce.length;Pe++){const ze=ce.feature(Pe);let dt=ze.loadGeometry();for(const et of dt)for(const pe of et)pe.x=pe.x*se-_e,pe.y=pe.y*se-Le;const ke=128;dt=S.cW(dt,ze.type,-ke,-ke,V+ke,V+ke),dt.length!==0&&Ae.push(new qe(ze.type,dt,ze.properties,ze.id,V))}return new Ne(Ae,ce.name,V)}class Z{constructor(R,O,V){this.actor=R,this.layerIndex=O,this.availableImages=V,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new S.cX(1e3)}loadVectorTile(R,O){return S._(this,void 0,void 0,(function*(){const V=yield S.n(R.request,O);try{return{vectorTile:R.encoding!=="mlt"?new S.cY(new S.cZ(V.data)):new S.c_(V.data),rawData:V.data,cacheControl:V.cacheControl,expires:V.expires}}catch(se){const _e=new Uint8Array(V.data);let Le=`Unable to parse the tile at ${R.request.url}, `;throw Le+=_e[0]===31&&_e[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${se.message}`,new Error(Le)}}))}loadTile(R){return S._(this,void 0,void 0,(function*(){const{uid:O,overzoomParameters:V}=R;V&&(R.request=V.overzoomRequest);const se=!!(R&&R.request&&R.request.collectResourceTiming)&&new S.c$(R.request),_e=new xe(R);this.loading[O]=_e;const Le=new AbortController;_e.abort=Le;try{const Ae=yield this.loadVectorTile(R,Le);if(delete this.loading[O],!Ae)return null;if(V){const et=this._getOverzoomTile(R,Ae.vectorTile);Ae.rawData=et.rawData,Ae.vectorTile=et.vectorTile}const Pe=Ae.rawData,ze={};Ae.expires&&(ze.expires=Ae.expires),Ae.cacheControl&&(ze.cacheControl=Ae.cacheControl);const dt={};if(se){const et=se.finish();et&&(dt.resourceTiming=JSON.parse(JSON.stringify(et)))}_e.vectorTile=Ae.vectorTile;const ke=_e.parse(Ae.vectorTile,this.layerIndex,this.availableImages,this.actor,R.subdivisionGranularity);this.loaded[O]=_e,this.fetching[O]={rawTileData:Pe,cacheControl:ze,resourceTiming:dt};try{const et=yield ke;return S.e({rawTileData:Pe.slice(0),encoding:R.encoding},et,ze,dt)}finally{delete this.fetching[O]}}catch(Ae){throw delete this.loading[O],_e.status="done",this.loaded[O]=_e,Ae}}))}_getOverzoomTile(R,O){const{tileID:V,source:se,overzoomParameters:_e}=R,{maxZoomTileID:Le}=_e,Ae=`${Le.key}_${V.key}`,Pe=this.overzoomedTileResultCache.get(Ae);if(Pe)return Pe;const ze=new Xe,dt=this.layerIndex.familiesBySource[se];for(const et in dt){const pe=O.layers[et];if(!pe)continue;const Lt=Ee(pe,Le,V.canonical);Lt.length>0&&ze.addLayer(Lt)}const ke=He(ze);return this.overzoomedTileResultCache.set(Ae,ke),ke}reloadTile(R){return S._(this,void 0,void 0,(function*(){const O=R.uid;if(!this.loaded||!this.loaded[O])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const V=this.loaded[O];if(V.showCollisionBoxes=R.showCollisionBoxes,V.status==="parsing"){const se=yield V.parse(V.vectorTile,this.layerIndex,this.availableImages,this.actor,R.subdivisionGranularity);let _e;if(this.fetching[O]){const{rawTileData:Le,cacheControl:Ae,resourceTiming:Pe}=this.fetching[O];delete this.fetching[O],_e=S.e({rawTileData:Le.slice(0),encoding:R.encoding},se,Ae,Pe)}else _e=se;return _e}if(V.status==="done"&&V.vectorTile)return V.parse(V.vectorTile,this.layerIndex,this.availableImages,this.actor,R.subdivisionGranularity)}))}abortTile(R){return S._(this,void 0,void 0,(function*(){const O=this.loading,V=R.uid;O&&O[V]&&O[V].abort&&(O[V].abort.abort(),delete O[V])}))}removeTile(R){return S._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[R.uid]&&delete this.loaded[R.uid]}))}}class Ve{constructor(){this.loaded={}}loadTile(R){return S._(this,void 0,void 0,(function*(){const{uid:O,encoding:V,rawImageData:se,redFactor:_e,greenFactor:Le,blueFactor:Ae,baseShift:Pe}=R,ze=se.width+2,dt=se.height+2,ke=S.b(se)?new S.R({width:ze,height:dt},yield S.d0(se,-1,-1,ze,dt)):se,et=new S.d1(O,ke,V,_e,Le,Ae,Pe);return this.loaded=this.loaded||{},this.loaded[O]=et,et}))}removeTile(R){const O=this.loaded,V=R.uid;O&&O[V]&&delete O[V]}}var ut,vt,Ke=(function(){if(vt)return ut;function ce(O,V){if(O.length!==0){R(O[0],V);for(var se=1;se<O.length;se++)R(O[se],!V)}}function R(O,V){for(var se=0,_e=0,Le=0,Ae=O.length,Pe=Ae-1;Le<Ae;Pe=Le++){var ze=(O[Le][0]-O[Pe][0])*(O[Pe][1]+O[Le][1]),dt=se+ze;_e+=Math.abs(se)>=Math.abs(ze)?se-dt+ze:ze-dt+se,se=dt}se+_e>=0!=!!V&&O.reverse()}return vt=1,ut=function O(V,se){var _e,Le=V&&V.type;if(Le==="FeatureCollection")for(_e=0;_e<V.features.length;_e++)O(V.features[_e],se);else if(Le==="GeometryCollection")for(_e=0;_e<V.geometries.length;_e++)O(V.geometries[_e],se);else if(Le==="Feature")O(V.geometry,se);else if(Le==="Polygon")ce(V.coordinates,se);else if(Le==="MultiPolygon")for(_e=0;_e<V.coordinates.length;_e++)ce(V.coordinates[_e],se);return V}})(),nt=S.d2(Ke);const rt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ce=>ce},Oe=Math.fround||(Fe=new Float32Array(1),ce=>(Fe[0]=+ce,Fe[0]));var Fe;class lt{constructor(R){this.options=Object.assign(Object.create(rt),R),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(R){const{log:O,minZoom:V,maxZoom:se}=this.options;O&&console.time("total time");const _e=`prepare ${R.length} points`;O&&console.time(_e),this.points=R;const Le=[];for(let Pe=0;Pe<R.length;Pe++){const ze=R[Pe];if(!ze.geometry)continue;const[dt,ke]=ze.geometry.coordinates,et=Oe(ft(dt)),pe=Oe(gt(ke));Le.push(et,pe,1/0,Pe,-1,1),this.options.reduce&&Le.push(0)}let Ae=this.trees[se+1]=this._createTree(Le);O&&console.timeEnd(_e);for(let Pe=se;Pe>=V;Pe--){const ze=+Date.now();Ae=this.trees[Pe]=this._createTree(this._cluster(Ae,Pe)),O&&console.log("z%d: %d clusters in %dms",Pe,Ae.numItems,+Date.now()-ze)}return O&&console.timeEnd("total time"),this}getClusters(R,O){let V=((R[0]+180)%360+360)%360-180;const se=Math.max(-90,Math.min(90,R[1]));let _e=R[2]===180?180:((R[2]+180)%360+360)%360-180;const Le=Math.max(-90,Math.min(90,R[3]));if(R[2]-R[0]>=360)V=-180,_e=180;else if(V>_e){const ke=this.getClusters([V,se,180,Le],O),et=this.getClusters([-180,se,_e,Le],O);return ke.concat(et)}const Ae=this.trees[this._limitZoom(O)],Pe=Ae.range(ft(V),gt(Le),ft(_e),gt(se)),ze=Ae.data,dt=[];for(const ke of Pe){const et=this.stride*ke;dt.push(ze[et+5]>1?Re(ze,et,this.clusterProps):this.points[ze[et+3]])}return dt}getChildren(R){const O=this._getOriginId(R),V=this._getOriginZoom(R),se="No cluster with the specified id.",_e=this.trees[V];if(!_e)throw new Error(se);const Le=_e.data;if(O*this.stride>=Le.length)throw new Error(se);const Ae=this.options.radius/(this.options.extent*Math.pow(2,V-1)),Pe=_e.within(Le[O*this.stride],Le[O*this.stride+1],Ae),ze=[];for(const dt of Pe){const ke=dt*this.stride;Le[ke+4]===R&&ze.push(Le[ke+5]>1?Re(Le,ke,this.clusterProps):this.points[Le[ke+3]])}if(ze.length===0)throw new Error(se);return ze}getLeaves(R,O,V){const se=[];return this._appendLeaves(se,R,O=O||10,V=V||0,0),se}getTile(R,O,V){const se=this.trees[this._limitZoom(R)],_e=Math.pow(2,R),{extent:Le,radius:Ae}=this.options,Pe=Ae/Le,ze=(V-Pe)/_e,dt=(V+1+Pe)/_e,ke={features:[]};return this._addTileFeatures(se.range((O-Pe)/_e,ze,(O+1+Pe)/_e,dt),se.data,O,V,_e,ke),O===0&&this._addTileFeatures(se.range(1-Pe/_e,ze,1,dt),se.data,_e,V,_e,ke),O===_e-1&&this._addTileFeatures(se.range(0,ze,Pe/_e,dt),se.data,-1,V,_e,ke),ke.features.length?ke:null}getClusterExpansionZoom(R){let O=this._getOriginZoom(R)-1;for(;O<=this.options.maxZoom;){const V=this.getChildren(R);if(O++,V.length!==1)break;R=V[0].properties.cluster_id}return O}_appendLeaves(R,O,V,se,_e){const Le=this.getChildren(O);for(const Ae of Le){const Pe=Ae.properties;if(Pe&&Pe.cluster?_e+Pe.point_count<=se?_e+=Pe.point_count:_e=this._appendLeaves(R,Pe.cluster_id,V,se,_e):_e<se?_e++:R.push(Ae),R.length===V)break}return _e}_createTree(R){const O=new S.aT(R.length/this.stride|0,this.options.nodeSize,Float32Array);for(let V=0;V<R.length;V+=this.stride)O.add(R[V],R[V+1]);return O.finish(),O.data=R,O}_addTileFeatures(R,O,V,se,_e,Le){for(const Ae of R){const Pe=Ae*this.stride,ze=O[Pe+5]>1;let dt,ke,et;if(ze)dt=pt(O,Pe,this.clusterProps),ke=O[Pe],et=O[Pe+1];else{const cr=this.points[O[Pe+3]];dt=cr.properties;const[Bt,qt]=cr.geometry.coordinates;ke=ft(Bt),et=gt(qt)}const pe={type:1,geometry:[[Math.round(this.options.extent*(ke*_e-V)),Math.round(this.options.extent*(et*_e-se))]],tags:dt};let Lt;Lt=ze||this.options.generateId?O[Pe+3]:this.points[O[Pe+3]].id,Lt!==void 0&&(pe.id=Lt),Le.features.push(pe)}}_limitZoom(R){return Math.max(this.options.minZoom,Math.min(Math.floor(+R),this.options.maxZoom+1))}_cluster(R,O){const{radius:V,extent:se,reduce:_e,minPoints:Le}=this.options,Ae=V/(se*Math.pow(2,O)),Pe=R.data,ze=[],dt=this.stride;for(let ke=0;ke<Pe.length;ke+=dt){if(Pe[ke+2]<=O)continue;Pe[ke+2]=O;const et=Pe[ke],pe=Pe[ke+1],Lt=R.within(Pe[ke],Pe[ke+1],Ae),cr=Pe[ke+5];let Bt=cr;for(const qt of Lt){const Ht=qt*dt;Pe[Ht+2]>O&&(Bt+=Pe[Ht+5])}if(Bt>cr&&Bt>=Le){let qt,Ht=et*cr,zr=pe*cr,Ir=-1;const hr=(ke/dt<<5)+(O+1)+this.points.length;for(const xr of Lt){const dr=xr*dt;if(Pe[dr+2]<=O)continue;Pe[dr+2]=O;const fr=Pe[dr+5];Ht+=Pe[dr]*fr,zr+=Pe[dr+1]*fr,Pe[dr+4]=hr,_e&&(qt||(qt=this._map(Pe,ke,!0),Ir=this.clusterProps.length,this.clusterProps.push(qt)),_e(qt,this._map(Pe,dr)))}Pe[ke+4]=hr,ze.push(Ht/Bt,zr/Bt,1/0,hr,-1,Bt),_e&&ze.push(Ir)}else{for(let qt=0;qt<dt;qt++)ze.push(Pe[ke+qt]);if(Bt>1)for(const qt of Lt){const Ht=qt*dt;if(!(Pe[Ht+2]<=O)){Pe[Ht+2]=O;for(let zr=0;zr<dt;zr++)ze.push(Pe[Ht+zr])}}}}return ze}_getOriginId(R){return R-this.points.length>>5}_getOriginZoom(R){return(R-this.points.length)%32}_map(R,O,V){if(R[O+5]>1){const Le=this.clusterProps[R[O+6]];return V?Object.assign({},Le):Le}const se=this.points[R[O+3]].properties,_e=this.options.map(se);return V&&_e===se?Object.assign({},_e):_e}}function Re(ce,R,O){return{type:"Feature",id:ce[R+3],properties:pt(ce,R,O),geometry:{type:"Point",coordinates:[(V=ce[R],360*(V-.5)),bt(ce[R+1])]}};var V}function pt(ce,R,O){const V=ce[R+5],se=V>=1e4?`${Math.round(V/1e3)}k`:V>=1e3?Math.round(V/100)/10+"k":V,_e=ce[R+6],Le=_e===-1?{}:Object.assign({},O[_e]);return Object.assign(Le,{cluster:!0,cluster_id:ce[R+3],point_count:V,point_count_abbreviated:se})}function ft(ce){return ce/360+.5}function gt(ce){const R=Math.sin(ce*Math.PI/180),O=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return O<0?0:O>1?1:O}function bt(ce){const R=(180-360*ce)*Math.PI/180;return 360*Math.atan(Math.exp(R))/Math.PI-90}function Ue(ce,R,O,V){let se=V;const _e=R+(O-R>>1);let Le,Ae=O-R;const Pe=ce[R],ze=ce[R+1],dt=ce[O],ke=ce[O+1];for(let et=R+3;et<O;et+=3){const pe=Be(ce[et],ce[et+1],Pe,ze,dt,ke);if(pe>se)Le=et,se=pe;else if(pe===se){const Lt=Math.abs(et-_e);Lt<Ae&&(Le=et,Ae=Lt)}}se>V&&(Le-R>3&&Ue(ce,R,Le,V),ce[Le+2]=se,O-Le>3&&Ue(ce,Le,O,V))}function Be(ce,R,O,V,se,_e){let Le=se-O,Ae=_e-V;if(Le!==0||Ae!==0){const Pe=((ce-O)*Le+(R-V)*Ae)/(Le*Le+Ae*Ae);Pe>1?(O=se,V=_e):Pe>0&&(O+=Le*Pe,V+=Ae*Pe)}return Le=ce-O,Ae=R-V,Le*Le+Ae*Ae}function Se(ce,R,O,V){const se={type:R,geom:O},_e={id:ce??null,type:se.type,geometry:se.geom,tags:V,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};switch(se.type){case"Point":case"MultiPoint":case"LineString":Te(_e,se.geom);break;case"Polygon":Te(_e,se.geom[0]);break;case"MultiLineString":for(const Le of se.geom)Te(_e,Le);break;case"MultiPolygon":for(const Le of se.geom)Te(_e,Le[0])}return _e}function Te(ce,R){for(let O=0;O<R.length;O+=3)ce.minX=Math.min(ce.minX,R[O]),ce.minY=Math.min(ce.minY,R[O+1]),ce.maxX=Math.max(ce.maxX,R[O]),ce.maxY=Math.max(ce.maxY,R[O+1])}function Ce(ce,R){const O=[];switch(ce.type){case"FeatureCollection":for(let V=0;V<ce.features.length;V++)we(O,ce.features[V],R,V);break;case"Feature":we(O,ce,R);break;default:we(O,{geometry:ce,properties:void 0},R)}return O}function we(ce,R,O,V){if(!R.geometry)return;if(R.geometry.type==="GeometryCollection"){for(const Ae of R.geometry.geometries)we(ce,{id:R.id,geometry:Ae,properties:R.properties},O,V);return}if(!R.geometry.coordinates?.length)return;const _e=Math.pow(O.tolerance/((1<<O.maxZoom)*O.extent),2);let Le=R.id;switch(O.promoteId?Le=R.properties?.[O.promoteId]:O.generateId&&(Le=V||0),R.geometry.type){case"Point":{const Ae=[];return be(R.geometry.coordinates,Ae),void ce.push(Se(Le,R.geometry.type,Ae,R.properties))}case"MultiPoint":{const Ae=[];for(const Pe of R.geometry.coordinates)be(Pe,Ae);return void ce.push(Se(Le,R.geometry.type,Ae,R.properties))}case"LineString":{const Ae=[];return ie(R.geometry.coordinates,Ae,_e,!1),void ce.push(Se(Le,R.geometry.type,Ae,R.properties))}case"MultiLineString":{if(O.lineMetrics){for(const Pe of R.geometry.coordinates){const ze=[];ie(Pe,ze,_e,!1),ce.push(Se(Le,"LineString",ze,R.properties))}return}const Ae=[];return ee(R.geometry.coordinates,Ae,_e,!1),void ce.push(Se(Le,R.geometry.type,Ae,R.properties))}case"Polygon":{const Ae=[];return ee(R.geometry.coordinates,Ae,_e,!0),void ce.push(Se(Le,R.geometry.type,Ae,R.properties))}case"MultiPolygon":{const Ae=[];for(const Pe of R.geometry.coordinates){const ze=[];ee(Pe,ze,_e,!0),Ae.push(ze)}return void ce.push(Se(Le,R.geometry.type,Ae,R.properties))}default:throw new Error("Input data is not a valid GeoJSON object.")}}function be(ce,R){R.push(Q(ce[0]),ue(ce[1]),0)}function ie(ce,R,O,V){let se,_e,Le=0;for(let Pe=0;Pe<ce.length;Pe++){const ze=Q(ce[Pe][0]),dt=ue(ce[Pe][1]);R.push(ze,dt,0),Pe>0&&(Le+=V?(se*dt-ze*_e)/2:Math.sqrt(Math.pow(ze-se,2)+Math.pow(dt-_e,2))),se=ze,_e=dt}const Ae=R.length-3;R[2]=1,O>0&&Ue(R,0,Ae,O),R[Ae+2]=1,R.size=Math.abs(Le),R.start=0,R.end=R.size}function ee(ce,R,O,V){for(let se=0;se<ce.length;se++){const _e=[];ie(ce[se],_e,O,V),R.push(_e)}}function Q(ce){return ce/360+.5}function ue(ce){const R=Math.sin(ce*Math.PI/180),O=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return O<0?0:O>1?1:O}function De(ce,R,O,V,se,_e,Le,Ae){if(V/=R,_e>=(O/=R)&&Le<V)return ce;if(Le<O||_e>=V)return null;const Pe=[];for(const ze of ce){const dt=se===0?ze.minX:ze.minY,ke=se===0?ze.maxX:ze.maxY;if(dt>=O&&ke<V)Pe.push(ze);else if(!(ke<O||dt>=V))switch(ze.type){case"Point":case"MultiPoint":{const et=[];if(Ge(ze.geometry,et,O,V,se),!et.length)continue;Pe.push(Se(ze.id,et.length===3?"Point":"MultiPoint",et,ze.tags));continue}case"LineString":{const et=[];if(ot(ze.geometry,et,O,V,se,!1,Ae.lineMetrics),!et.length)continue;if(Ae.lineMetrics){for(const pe of et)Pe.push(Se(ze.id,ze.type,pe,ze.tags));continue}if(et.length>1){Pe.push(Se(ze.id,"MultiLineString",et,ze.tags));continue}Pe.push(Se(ze.id,ze.type,et[0],ze.tags));continue}case"MultiLineString":{const et=[];if(It(ze.geometry,et,O,V,se,!1),!et.length)continue;if(et.length===1){Pe.push(Se(ze.id,"LineString",et[0],ze.tags));continue}Pe.push(Se(ze.id,ze.type,et,ze.tags));continue}case"Polygon":{const et=[];if(It(ze.geometry,et,O,V,se,!0),!et.length)continue;Pe.push(Se(ze.id,ze.type,et,ze.tags));continue}case"MultiPolygon":{const et=[];for(const pe of ze.geometry){const Lt=[];It(pe,Lt,O,V,se,!0),Lt.length&&et.push(Lt)}if(!et.length)continue;Pe.push(Se(ze.id,ze.type,et,ze.tags));continue}}}return Pe.length?Pe:null}function Ge(ce,R,O,V,se){for(let _e=0;_e<ce.length;_e+=3){const Le=ce[_e+se];Le>=O&&Le<=V&&Rt(R,ce[_e],ce[_e+1],ce[_e+2])}}function ot(ce,R,O,V,se,_e,Le){let Ae=it(ce);const Pe=se===0?Ft:Kt;let ze,dt,ke=ce.start;for(let Bt=0;Bt<ce.length-3;Bt+=3){const qt=ce[Bt],Ht=ce[Bt+1],zr=ce[Bt+2],Ir=ce[Bt+3],hr=ce[Bt+4],xr=se===0?qt:Ht,dr=se===0?Ir:hr;let fr=!1;Le&&(ze=Math.sqrt(Math.pow(qt-Ir,2)+Math.pow(Ht-hr,2))),xr<O?dr>O&&(dt=Pe(Ae,qt,Ht,Ir,hr,O),Le&&(Ae.start=ke+ze*dt)):xr>V?dr<V&&(dt=Pe(Ae,qt,Ht,Ir,hr,V),Le&&(Ae.start=ke+ze*dt)):Rt(Ae,qt,Ht,zr),dr<O&&xr>=O&&(dt=Pe(Ae,qt,Ht,Ir,hr,O),fr=!0),dr>V&&xr<=V&&(dt=Pe(Ae,qt,Ht,Ir,hr,V),fr=!0),!_e&&fr&&(Le&&(Ae.end=ke+ze*dt),R.push(Ae),Ae=it(ce)),Le&&(ke+=ze)}let et=ce.length-3;const pe=ce[et],Lt=ce[et+1],cr=se===0?pe:Lt;cr>=O&&cr<=V&&Rt(Ae,pe,Lt,ce[et+2]),et=Ae.length-3,_e&&et>=3&&(Ae[et]!==Ae[0]||Ae[et+1]!==Ae[1])&&Rt(Ae,Ae[0],Ae[1],Ae[2]),Ae.length&&R.push(Ae)}function it(ce){const R=[];return R.size=ce.size,R.start=ce.start,R.end=ce.end,R}function It(ce,R,O,V,se,_e){for(const Le of ce)ot(Le,R,O,V,se,_e,!1)}function Rt(ce,R,O,V){ce.push(R,O,V)}function Ft(ce,R,O,V,se,_e){const Le=(_e-R)/(V-R);return Rt(ce,_e,O+(se-O)*Le,1),Le}function Kt(ce,R,O,V,se,_e){const Le=(_e-O)/(se-O);return Rt(ce,R+(V-R)*Le,_e,1),Le}function Yt(ce,R){const O=R.buffer/R.extent;let V=ce;const se=De(ce,1,-1-O,O,0,-1,2,R),_e=De(ce,1,1-O,2+O,0,-1,2,R);return(se||_e)&&(V=De(ce,1,-O,1+O,0,-1,2,R)||[],se&&(V=Tr(se,1).concat(V)),_e&&(V=V.concat(Tr(_e,-1)))),V}function Tr(ce,R){const O=[];for(const V of ce)switch(V.type){case"Point":case"MultiPoint":case"LineString":{const se=Qt(V.geometry,R);O.push(Se(V.id,V.type,se,V.tags));continue}case"MultiLineString":case"Polygon":{const se=[];for(const _e of V.geometry)se.push(Qt(_e,R));O.push(Se(V.id,V.type,se,V.tags));continue}case"MultiPolygon":{const se=[];for(const _e of V.geometry){const Le=[];for(const Ae of _e)Le.push(Qt(Ae,R));se.push(Le)}O.push(Se(V.id,V.type,se,V.tags));continue}}return O}function Qt(ce,R){const O=[];O.size=ce.size,ce.start!==void 0&&(O.start=ce.start,O.end=ce.end);for(let V=0;V<ce.length;V+=3)O.push(ce[V]+R,ce[V+1],ce[V+2]);return O}function Mt(ce,R){if(ce.transformed)return ce;const O=1<<ce.z,V=ce.x,se=ce.y;for(const _e of ce.features){if(_e.type===1){const Ae=[];for(let Pe=0;Pe<_e.geometry.length;Pe+=2)Ae.push(Xt(_e.geometry[Pe],_e.geometry[Pe+1],R,O,V,se));_e.geometry=Ae;continue}const Le=[];for(const Ae of _e.geometry){const Pe=[];for(let ze=0;ze<Ae.length;ze+=2)Pe.push(Xt(Ae[ze],Ae[ze+1],R,O,V,se));Le.push(Pe)}_e.geometry=Le}return ce.transformed=!0,ce}function Xt(ce,R,O,V,se,_e){return[Math.round(O*(ce*V-se)),Math.round(O*(R*V-_e))]}function Sr(ce,R,O,V,se){const _e=R===se.maxZoom?0:se.tolerance/((1<<R)*se.extent),Le={features:[],numPoints:0,numSimplified:0,numFeatures:ce.length,source:null,x:O,y:V,z:R,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ae of ce)Et(Le,Ae,_e,se);return Le}function Et(ce,R,O,V){ce.minX=Math.min(ce.minX,R.minX),ce.minY=Math.min(ce.minY,R.minY),ce.maxX=Math.max(ce.maxX,R.maxX),ce.maxY=Math.max(ce.maxY,R.maxY);let se,_e=R.tags||null;switch(R.type){case"Point":case"MultiPoint":{const Le=[];for(let Ae=0;Ae<R.geometry.length;Ae+=3)Le.push(R.geometry[Ae],R.geometry[Ae+1]),ce.numPoints++,ce.numSimplified++;if(!Le.length)return;se={type:1,tags:_e,geometry:Le};break}case"LineString":{const Le=[];if(Ot(Le,R.geometry,ce,O,!1,!1),!Le.length)return;if(V.lineMetrics){_e={};for(const Ae in R.tags)_e[Ae]=R.tags[Ae];_e.mapbox_clip_start=R.geometry.start/R.geometry.size,_e.mapbox_clip_end=R.geometry.end/R.geometry.size}se={type:2,tags:_e,geometry:Le};break}case"MultiLineString":case"Polygon":{const Le=[];for(let Ae=0;Ae<R.geometry.length;Ae++)Ot(Le,R.geometry[Ae],ce,O,R.type==="Polygon",Ae===0);if(!Le.length)return;se={type:R.type==="Polygon"?3:2,tags:_e,geometry:Le};break}case"MultiPolygon":{const Le=[];for(let Ae=0;Ae<R.geometry.length;Ae++){const Pe=R.geometry[Ae];for(let ze=0;ze<Pe.length;ze++)Ot(Le,Pe[ze],ce,O,!0,ze===0)}if(!Le.length)return;se={type:3,tags:_e,geometry:Le};break}}R.id!==null&&(se.id=R.id),ce.features.push(se)}function Ot(ce,R,O,V,se,_e){const Le=V*V;if(V>0&&R.size<(se?Le:V))return void(O.numPoints+=R.length/3);const Ae=[];for(let Pe=0;Pe<R.length;Pe+=3)(V===0||R[Pe+2]>Le)&&(O.numSimplified++,Ae.push(R[Pe],R[Pe+1])),O.numPoints++;se&&(function(Pe,ze){let dt=0;for(let ke=0,et=Pe.length,pe=et-2;ke<et;pe=ke,ke+=2)dt+=(Pe[ke]-Pe[pe])*(Pe[ke+1]+Pe[pe+1]);if(dt>0===ze)for(let ke=0,et=Pe.length;ke<et/2;ke+=2){const pe=Pe[ke],Lt=Pe[ke+1];Pe[ke]=Pe[et-2-ke],Pe[ke+1]=Pe[et-1-ke],Pe[et-2-ke]=pe,Pe[et-1-ke]=Lt}})(Ae,_e),ce.push(Ae)}function ar(ce,R,O){const V=!!R.newGeometry,se=R.removeAllProperties||R.removeProperties?.length>0||R.addOrUpdateProperties?.length>0;if(V){let _e=Ce({type:"FeatureCollection",features:[{type:"Feature",id:ce.id,geometry:R.newGeometry,properties:se?ur(ce.tags,R):ce.tags}]},O);return _e=Yt(_e,O),_e[0]}if(se){const _e={...ce};return _e.tags=ur(_e.tags,R),_e}return null}function ur(ce,R){if(R.removeAllProperties)return{};const O={...ce||{}};if(R.removeProperties)for(const V of R.removeProperties)delete O[V];if(R.addOrUpdateProperties)for(const{key:V,value:se}of R.addOrUpdateProperties)O[V]=se;return O}const Ar={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,updateable:!1,debug:0};class Cr{options;tiles;tileCoords;stats={};total=0;source;constructor(R,O){const V=(O=this.options=Object.assign({},Ar,O)).debug;if(V&&console.time("preprocess data"),O.maxZoom<0||O.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(O.promoteId&&O.generateId)throw new Error("promoteId and generateId cannot be used together.");let se=Ce(R,O);this.tiles={},this.tileCoords=[],V&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",O.indexMaxZoom,O.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),se=Yt(se,O),se.length&&this.splitTile(se,0,0,0),O.updateable&&(this.source=se),V&&(se.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(R,O,V,se,_e,Le,Ae){const Pe=[R,O,V,se],ze=this.options,dt=ze.debug;for(;Pe.length;){se=Pe.pop(),V=Pe.pop(),O=Pe.pop(),R=Pe.pop();const ke=1<<O,et=pr(O,V,se);let pe=this.tiles[et];if(!pe&&(dt>1&&console.time("creation"),pe=this.tiles[et]=Sr(R,O,V,se,ze),this.tileCoords.push({z:O,x:V,y:se,id:et}),dt)){dt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",O,V,se,pe.numFeatures,pe.numPoints,pe.numSimplified),console.timeEnd("creation"));const fr=`z${O}`;this.stats[fr]=(this.stats[fr]||0)+1,this.total++}if(pe.source=R,_e==null){if(O===ze.indexMaxZoom||pe.numPoints<=ze.indexMaxPoints)continue}else{if(O===ze.maxZoom||O===_e)continue;if(_e!=null){const fr=_e-O;if(V!==Le>>fr||se!==Ae>>fr)continue}}if(pe.source=null,!R.length)continue;dt>1&&console.time("clipping");const Lt=.5*ze.buffer/ze.extent,cr=.5-Lt,Bt=.5+Lt,qt=1+Lt;let Ht=null,zr=null,Ir=null,hr=null;const xr=De(R,ke,V-Lt,V+Bt,0,pe.minX,pe.maxX,ze),dr=De(R,ke,V+cr,V+qt,0,pe.minX,pe.maxX,ze);xr&&(Ht=De(xr,ke,se-Lt,se+Bt,1,pe.minY,pe.maxY,ze),zr=De(xr,ke,se+cr,se+qt,1,pe.minY,pe.maxY,ze)),dr&&(Ir=De(dr,ke,se-Lt,se+Bt,1,pe.minY,pe.maxY,ze),hr=De(dr,ke,se+cr,se+qt,1,pe.minY,pe.maxY,ze)),dt>1&&console.timeEnd("clipping"),Pe.push(Ht||[],O+1,2*V,2*se),Pe.push(zr||[],O+1,2*V,2*se+1),Pe.push(Ir||[],O+1,2*V+1,2*se),Pe.push(hr||[],O+1,2*V+1,2*se+1)}}getTile(R,O,V){R=+R,O=+O,V=+V;const se=this.options,{extent:_e,debug:Le}=se;if(R<0||R>24)return null;const Ae=1<<R,Pe=pr(R,O=O+Ae&Ae-1,V);if(this.tiles[Pe])return Mt(this.tiles[Pe],_e);Le>1&&console.log("drilling down to z%d-%d-%d",R,O,V);let ze,dt=R,ke=O,et=V;for(;!ze&&dt>0;)dt--,ke>>=1,et>>=1,ze=this.tiles[pr(dt,ke,et)];return ze?.source?(Le>1&&(console.log("found parent tile z%d-%d-%d",dt,ke,et),console.time("drilling down")),this.splitTile(ze.source,dt,ke,et,R,O,V),Le>1&&console.timeEnd("drilling down"),this.tiles[Pe]?Mt(this.tiles[Pe],_e):null):null}invalidateTiles(R){const O=this.options,{debug:V}=O;let se=1/0,_e=-1/0,Le=1/0,Ae=-1/0;for(const dt of R)se=Math.min(se,dt.minX),_e=Math.max(_e,dt.maxX),Le=Math.min(Le,dt.minY),Ae=Math.max(Ae,dt.maxY);const Pe=O.buffer/O.extent,ze=new Set;for(const dt in this.tiles){const ke=this.tiles[dt],et=1<<ke.z,pe=(ke.x-Pe)/et,Lt=(ke.x+1+Pe)/et,cr=(ke.y-Pe)/et,Bt=(ke.y+1+Pe)/et;if(_e<pe||se>=Lt||Ae<cr||Le>=Bt)continue;let qt=!1;for(const Ht of R)if(Ht.maxX>=pe&&Ht.minX<Lt&&Ht.maxY>=cr&&Ht.minY<Bt){qt=!0;break}if(qt){if(V){V>1&&console.log("invalidate tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ke.z,ke.x,ke.y,ke.numFeatures,ke.numPoints,ke.numSimplified);const Ht=`z${ke.z}`;this.stats[Ht]=(this.stats[Ht]||0)-1,this.total--}delete this.tiles[dt],ze.add(dt)}}ze.size&&(this.tileCoords=this.tileCoords.filter((dt=>!ze.has(dt.id))))}updateData(R){const O=this.options,V=O.debug;if(!O.updateable)throw new Error("to update tile geojson `updateable` option must be set to true");const{affected:se,source:_e}=(function(ke,et,pe){const Lt=(function(Bt){return Bt?{removeAll:Bt.removeAll,remove:new Set(Bt.remove||[]),add:new Map(Bt.add?.map((qt=>[qt.id,qt]))),update:new Map(Bt.update?.map((qt=>[qt.id,qt])))}:{remove:new Set,add:new Map,update:new Map}})(et);let cr=[];if(Lt.removeAll&&(cr=ke,ke=[]),Lt.remove.size||Lt.add.size){const Bt=[];for(const qt of ke){const{id:Ht}=qt;(Lt.remove.has(Ht)||Lt.add.has(Ht))&&Bt.push(qt)}if(Bt.length){cr.push(...Bt);const qt=new Set(Bt.map((Ht=>Ht.id)));ke=ke.filter((Ht=>!qt.has(Ht.id)))}if(Lt.add.size){let qt=Ce({type:"FeatureCollection",features:Array.from(Lt.add.values())},pe);qt=Yt(qt,pe),cr.push(...qt),ke.push(...qt)}}if(Lt.update.size)for(const[Bt,qt]of Lt.update){const Ht=ke.findIndex((hr=>hr.id===Bt));if(Ht===-1)continue;const zr=ke[Ht],Ir=ar(zr,qt,pe);Ir&&(cr.push(zr,Ir),ke[Ht]=Ir)}return{affected:cr,source:ke}})(this.source,R,O);if(!se.length)return;this.source=_e,V>1&&(console.log("invalidating tiles"),console.time("invalidating")),this.invalidateTiles(se),V>1&&console.timeEnd("invalidating");const[Le,Ae,Pe]=[0,0,0],ze=Sr(this.source,Le,Ae,Pe,this.options);ze.source=this.source;const dt=pr(Le,Ae,Pe);if(this.tiles[dt]=ze,this.tileCoords.push({z:Le,x:Ae,y:Pe,id:dt}),V){const ke=`z${Le}`;this.stats[ke]=(this.stats[ke]||0)+1,this.total++}}}function pr(ce,R,O){return 32*((1<<ce)*O+R)+ce}class Rr extends Z{constructor(R,O,V,se=Pr){super(R,O,V),this._dataUpdateable=new Map,this._createGeoJSONIndex=se}loadVectorTile(R,O){return S._(this,void 0,void 0,(function*(){const V=R.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const se=this._geoJSONIndex.getTile(V.z,V.x,V.y);return se?He(new S.d3(se.features,{version:2,extent:S.a5})):null}))}loadData(R){return S._(this,void 0,void 0,(function*(){var O;(O=this._pendingRequest)===null||O===void 0||O.abort();const V=this._startPerformance(R);this._pendingRequest=new AbortController;try{(!this._pendingData||R.request||R.data||R.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(R,this._pendingRequest));const se=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(se,R),this.loaded={};const _e={};return R.request&&(_e.data=se),this._finishPerformance(V,R,_e),_e}catch(se){if(delete this._pendingRequest,S.Z(se))return{abandoned:!0};throw se}}))}_startPerformance(R){var O;if(!((O=R?.request)===null||O===void 0)&&O.collectResourceTiming)return new S.c$(R.request)}_finishPerformance(R,O,V){if(!R)return;const se=R.finish();se&&(V.resourceTiming={},V.resourceTiming[O.source]=JSON.parse(JSON.stringify(se)))}getData(){return S._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(R){const O=this.loaded;return O&&O[R.uid]?super.reloadTile(R):this.loadTile(R)}loadAndProcessGeoJSON(R,O){return S._(this,void 0,void 0,(function*(){let V;if(R.request?V=yield this.loadGeoJSONFromUrl(R.request,R.promoteId,O):R.data?V=this._loadGeoJSONFromObject(R.data,R.promoteId):R.dataDiff&&(V=this._loadGeoJSONFromDiff(R.dataDiff,R.promoteId,R.source)),delete this._pendingRequest,typeof V!="object")throw new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`);return nt(V,!0),R.filter&&(V=this._filterGeoJSON(V,R.filter)),V}))}loadGeoJSONFromUrl(R,O,V){return S._(this,void 0,void 0,(function*(){const se=yield S.j(R,V);return this._dataUpdateable=S.a7(se.data,O),se.data}))}_loadGeoJSONFromObject(R,O){return this._dataUpdateable=S.a7(R,O),R}_loadGeoJSONFromDiff(R,O,V){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${V}`);S.a8(this._dataUpdateable,R,O);const se=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(se)}_filterGeoJSON(R,O){const V=S.d4(O,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(V.result==="error")throw new Error(V.value.map((_e=>`${_e.key}: ${_e.message}`)).join(", "));const se=R.features.filter((_e=>V.value.evaluate({zoom:0},_e)));return this._toFeatureCollection(se)}_toFeatureCollection(R){return{type:"FeatureCollection",features:R}}removeSource(R){return S._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(R){return this._geoJSONIndex.getClusterExpansionZoom(R.clusterId)}getClusterChildren(R){return this._geoJSONIndex.getChildren(R.clusterId)}getClusterLeaves(R){return this._geoJSONIndex.getLeaves(R.clusterId,R.limit,R.offset)}}function Pr(ce,R){return R.cluster?new lt((function({superclusterOptions:O,clusterProperties:V}){if(!V||!O)return O;const se={},_e={},Le={accumulated:null,zoom:0},Ae={properties:null},Pe=Object.keys(V);for(const ze of Pe){const[dt,ke]=V[ze],et=S.d4(ke),pe=S.d4(typeof dt=="string"?[dt,["accumulated"],["get",ze]]:dt);se[ze]=et.value,_e[ze]=pe.value}return O.map=ze=>{Ae.properties=ze;const dt={};for(const ke of Pe)dt[ke]=se[ke].evaluate(Le,Ae);return dt},O.reduce=(ze,dt)=>{Ae.properties=dt;for(const ke of Pe)Le.accumulated=ze[ke],ze[ke]=_e[ke].evaluate(Le,Ae)},O})(R)).load(ce.features):(function(O,V){return new Cr(O,V)})(ce,R.geojsonVtOptions)}class yr{constructor(R){this.self=R,this.actor=new S.L(R),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(O,V)=>{if(this.externalWorkerSourceTypes[O])throw new Error(`Worker source with name "${O}" already registered.`);this.externalWorkerSourceTypes[O]=V},this.self.addProtocol=S.cK,this.self.removeProtocol=S.cL,this.self.registerRTLTextPlugin=O=>{S.d5.setMethods(O)},this.actor.registerMessageHandler("LDT",((O,V)=>this._getDEMWorkerSource(O,V.source).loadTile(V))),this.actor.registerMessageHandler("RDT",((O,V)=>S._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(O,V.source).removeTile(V)})))),this.actor.registerMessageHandler("GCEZ",((O,V)=>S._(this,void 0,void 0,(function*(){return this._getWorkerSource(O,V.type,V.source).getClusterExpansionZoom(V)})))),this.actor.registerMessageHandler("GCC",((O,V)=>S._(this,void 0,void 0,(function*(){return this._getWorkerSource(O,V.type,V.source).getClusterChildren(V)})))),this.actor.registerMessageHandler("GCL",((O,V)=>S._(this,void 0,void 0,(function*(){return this._getWorkerSource(O,V.type,V.source).getClusterLeaves(V)})))),this.actor.registerMessageHandler("LD",((O,V)=>this._getWorkerSource(O,V.type,V.source).loadData(V))),this.actor.registerMessageHandler("GD",((O,V)=>this._getWorkerSource(O,V.type,V.source).getData())),this.actor.registerMessageHandler("LT",((O,V)=>this._getWorkerSource(O,V.type,V.source).loadTile(V))),this.actor.registerMessageHandler("RT",((O,V)=>this._getWorkerSource(O,V.type,V.source).reloadTile(V))),this.actor.registerMessageHandler("AT",((O,V)=>this._getWorkerSource(O,V.type,V.source).abortTile(V))),this.actor.registerMessageHandler("RMT",((O,V)=>this._getWorkerSource(O,V.type,V.source).removeTile(V))),this.actor.registerMessageHandler("RS",((O,V)=>S._(this,void 0,void 0,(function*(){if(!this.workerSources[O]||!this.workerSources[O][V.type]||!this.workerSources[O][V.type][V.source])return;const se=this.workerSources[O][V.type][V.source];delete this.workerSources[O][V.type][V.source],se.removeSource!==void 0&&se.removeSource(V)})))),this.actor.registerMessageHandler("RM",(O=>S._(this,void 0,void 0,(function*(){delete this.layerIndexes[O],delete this.availableImages[O],delete this.workerSources[O],delete this.demWorkerSources[O],this.globalStates.delete(O)})))),this.actor.registerMessageHandler("SR",((O,V)=>S._(this,void 0,void 0,(function*(){this.referrer=V})))),this.actor.registerMessageHandler("SRPS",((O,V)=>this._syncRTLPluginState(O,V))),this.actor.registerMessageHandler("IS",((O,V)=>S._(this,void 0,void 0,(function*(){this.self.importScripts(V)})))),this.actor.registerMessageHandler("SI",((O,V)=>this._setImages(O,V))),this.actor.registerMessageHandler("UL",((O,V)=>S._(this,void 0,void 0,(function*(){this._getLayerIndex(O).update(V.layers,V.removedIds,this._getGlobalState(O))})))),this.actor.registerMessageHandler("UGS",((O,V)=>S._(this,void 0,void 0,(function*(){const se=this._getGlobalState(O);for(const _e in V)se[_e]=V[_e]})))),this.actor.registerMessageHandler("SL",((O,V)=>S._(this,void 0,void 0,(function*(){this._getLayerIndex(O).replace(V,this._getGlobalState(O))}))))}_getGlobalState(R){let O=this.globalStates.get(R);return O||(O={},this.globalStates.set(R,O)),O}_setImages(R,O){return S._(this,void 0,void 0,(function*(){this.availableImages[R]=O;for(const V in this.workerSources[R]){const se=this.workerSources[R][V];for(const _e in se)se[_e].availableImages=O}}))}_syncRTLPluginState(R,O){return S._(this,void 0,void 0,(function*(){return yield S.d5.syncState(O,this.self.importScripts)}))}_getAvailableImages(R){let O=this.availableImages[R];return O||(O=[]),O}_getLayerIndex(R){let O=this.layerIndexes[R];return O||(O=this.layerIndexes[R]=new l),O}_getWorkerSource(R,O,V){if(this.workerSources[R]||(this.workerSources[R]={}),this.workerSources[R][O]||(this.workerSources[R][O]={}),!this.workerSources[R][O][V]){const se={sendAsync:(_e,Le)=>(_e.targetMapId=R,this.actor.sendAsync(_e,Le))};switch(O){case"vector":this.workerSources[R][O][V]=new Z(se,this._getLayerIndex(R),this._getAvailableImages(R));break;case"geojson":this.workerSources[R][O][V]=new Rr(se,this._getLayerIndex(R),this._getAvailableImages(R));break;default:this.workerSources[R][O][V]=new this.externalWorkerSourceTypes[O](se,this._getLayerIndex(R),this._getAvailableImages(R))}}return this.workerSources[R][O][V]}_getDEMWorkerSource(R,O){return this.demWorkerSources[R]||(this.demWorkerSources[R]={}),this.demWorkerSources[R][O]||(this.demWorkerSources[R][O]=new Ve),this.demWorkerSources[R][O]}}return S.i(self)&&(self.worker=new yr(self)),yr})),me("index",["exports","./shared"],(function(S,l){var q="5.17.0";function xe(){var d=new l.A(4);return l.A!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d}let Ie,qe,Ne;const Xe={frame(d,t,n,a){const c=a||window,p=c.requestAnimationFrame((v=>{m(),t(v)})),{unsubscribe:m}=l.s(d.signal,"abort",(()=>{m(),c.cancelAnimationFrame(p),n(new l.a(d.signal.reason))}),!1)},frameAsync(d,t){return new Promise(((n,a)=>{this.frame(d,n,a,t)}))},getImageData(d,t=0){return this.getImageCanvasContext(d).getImageData(-t,-t,d.width+2*t,d.height+2*t)},getImageCanvasContext(d){const t=window.document.createElement("canvas"),n=t.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return t.width=d.width,t.height=d.height,n.drawImage(d,0,0,d.width,d.height),n},resolveURL:d=>(Ie||(Ie=document.createElement("a")),Ie.href=d,Ie.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return Ne!==void 0?Ne:!!matchMedia&&(qe==null&&(qe=matchMedia("(prefers-reduced-motion: reduce)")),qe.matches)},set prefersReducedMotion(d){Ne=d}},He=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(d){this._frozenAt=d}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function Ee(){return He.getCurrentTime()}class Z{static testProp(t){if(!Z.docStyle)return t[0];for(let n=0;n<t.length;n++)if(t[n]in Z.docStyle)return t[n];return t[0]}static create(t,n,a){const c=window.document.createElement(t);return n!==void 0&&(c.className=n),a&&a.appendChild(c),c}static createNS(t,n){return window.document.createElementNS(t,n)}static disableDrag(){Z.docStyle&&Z.selectProp&&(Z.userSelect=Z.docStyle[Z.selectProp],Z.docStyle[Z.selectProp]="none")}static enableDrag(){Z.docStyle&&Z.selectProp&&(Z.docStyle[Z.selectProp]=Z.userSelect)}static setTransform(t,n){t.style[Z.transformProp]=n}static addEventListener(t,n,a,c={}){t.addEventListener(n,a,"passive"in c?c:c.capture)}static removeEventListener(t,n,a,c={}){t.removeEventListener(n,a,"passive"in c?c:c.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",Z.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Z.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",Z.suppressClickInternal,!0)}),0)}static getScale(t){const n=t.getBoundingClientRect();return{x:n.width/t.offsetWidth||1,y:n.height/t.offsetHeight||1,boundingClientRect:n}}static getPoint(t,n,a){const c=n.boundingClientRect;return new l.P((a.clientX-c.left)/n.x-t.clientLeft,(a.clientY-c.top)/n.y-t.clientTop)}static mousePos(t,n){const a=Z.getScale(t);return Z.getPoint(t,a,n)}static touchPos(t,n){const a=[],c=Z.getScale(t);for(let p=0;p<n.length;p++)a.push(Z.getPoint(t,c,n[p]));return a}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const n=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),a=n.querySelectorAll("script");for(const c of a)c.remove();return Z.clean(n),n.innerHTML}static isPossiblyDangerous(t,n){const a=n.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!a.includes("javascript:")&&!a.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const n=t.children;for(const a of n)Z.removeAttributes(a),Z.clean(a)}static removeAttributes(t){for(const{name:n,value:a}of t.attributes)Z.isPossiblyDangerous(n,a)&&t.removeAttribute(n)}}Z.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,Z.selectProp=Z.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Z.transformProp=Z.testProp(["transform","WebkitTransform"]);const Ve={supported:!1,testSupport:function(d){!Ke&&vt&&(nt?rt(d):ut=d)}};let ut,vt,Ke=!1,nt=!1;function rt(d){const t=d.createTexture();d.bindTexture(d.TEXTURE_2D,t);try{if(d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,vt),d.isContextLost())return;Ve.supported=!0}catch{}d.deleteTexture(t),Ke=!0}var Oe;typeof document<"u"&&(vt=document.createElement("img"),vt.onload=()=>{ut&&rt(ut),ut=null,nt=!0},vt.onerror=()=>{Ke=!0,ut=null},vt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(d){let t,n,a,c;d.resetRequestQueue=()=>{t=[],n=0,a=0,c={}},d.addThrottleControl=x=>{const T=a++;return c[T]=x,T},d.removeThrottleControl=x=>{delete c[x],m()},d.getImage=(x,T,P=!0)=>new Promise(((k,A)=>{Ve.supported&&(x.headers||(x.headers={}),x.headers.accept="image/webp,*/*"),l.e(x,{type:"image"}),t.push({abortController:T,requestParameters:x,supportImageRefresh:P,state:"queued",onError:L=>{A(L)},onSuccess:L=>{k(L)}}),m()}));const p=x=>l._(this,void 0,void 0,(function*(){x.state="running";const{requestParameters:T,supportImageRefresh:P,onError:k,onSuccess:A,abortController:L}=x,N=P===!1&&!l.i(self)&&!l.g(T.url)&&(!T.headers||Object.keys(T.headers).reduce(((X,te)=>X&&te==="accept"),!0));n++;const W=N?v(T,L):l.m(T,L);try{const X=yield W;delete x.abortController,x.state="completed",X.data instanceof HTMLImageElement||l.b(X.data)?A(X):X.data&&A({data:yield(Y=X.data,typeof createImageBitmap=="function"?l.f(Y):l.h(Y)),cacheControl:X.cacheControl,expires:X.expires})}catch(X){delete x.abortController,k(X)}finally{n--,m()}var Y})),m=()=>{const x=(()=>{for(const T of Object.keys(c))if(c[T]())return!0;return!1})()?l.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let T=n;T<x&&t.length>0;T++){const P=t.shift();P.abortController.signal.aborted?T--:p(P)}},v=(x,T)=>new Promise(((P,k)=>{const A=new Image,L=x.url,N=x.credentials;N&&N==="include"?A.crossOrigin="use-credentials":(N&&N==="same-origin"||!l.d(L))&&(A.crossOrigin="anonymous"),T.signal.addEventListener("abort",(()=>{A.src="",k(new l.a(T.signal.reason))})),A.fetchPriority="high",A.onload=()=>{A.onerror=A.onload=null,P({data:A})},A.onerror=()=>{A.onerror=A.onload=null,T.signal.aborted||k(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},A.src=L}))})(Oe||(Oe={})),Oe.resetRequestQueue();class Fe{constructor(t){this._transformRequestFn=t??null}transformRequest(t,n){return this._transformRequestFn&&this._transformRequestFn(t,n)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function lt(d){const t=[];if(typeof d=="string")t.push({id:"default",url:d});else if(d&&d.length>0){const n=[];for(const{id:a,url:c}of d){const p=`${a}${c}`;n.indexOf(p)===-1&&(n.push(p),t.push({id:a,url:c}))}}return t}function Re(d,t,n){try{const a=new URL(d);return a.pathname+=`${t}${n}`,a.toString()}catch{throw new Error(`Invalid sprite URL "${d}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function pt(d){const{userImage:t}=d;return!!(t&&t.render&&t.render())&&(d.data.replace(new Uint8Array(t.data.buffer)),!0)}class ft extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const t of Object.keys(this.images))this.removeImage(t);this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:n,promiseResolve:a}of this.requestors)a(this._getImagesForIds(n));this.requestors=[]}}getImage(t){const n=this.images[t];if(n&&!n.data&&n.spriteData){const a=n.spriteData;n.data=new l.R({width:a.width,height:a.height},a.context.getImageData(a.x,a.y,a.width,a.height).data),n.spriteData=null}return n}addImage(t,n){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,n)&&(this.images[t]=n)}_validate(t,n){let a=!0;const c=n.data||n.spriteData;return this._validateStretch(n.stretchX,c&&c.width)||(this.fire(new l.k(new Error(`Image "${t}" has invalid "stretchX" value`))),a=!1),this._validateStretch(n.stretchY,c&&c.height)||(this.fire(new l.k(new Error(`Image "${t}" has invalid "stretchY" value`))),a=!1),this._validateContent(n.content,n)||(this.fire(new l.k(new Error(`Image "${t}" has invalid "content" value`))),a=!1),a}_validateStretch(t,n){if(!t)return!0;let a=0;for(const c of t){if(c[0]<a||c[1]<c[0]||n<c[1])return!1;a=c[1]}return!0}_validateContent(t,n){if(!t)return!0;if(t.length!==4)return!1;const a=n.spriteData,c=a&&a.width||n.data.width,p=a&&a.height||n.data.height;return!(t[0]<0||c<t[0]||t[1]<0||p<t[1]||t[2]<0||c<t[2]||t[3]<0||p<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,n,a=!0){const c=this.getImage(t);if(a&&(c.data.width!==n.data.width||c.data.height!==n.data.height))throw new Error(`size mismatch between old image (${c.data.width}x${c.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=c.version+1,this.images[t]=n,this.updatedImages[t]=!0}removeImage(t){const n=this.images[t];delete this.images[t],delete this.patterns[t],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise(((n,a)=>{let c=!0;if(!this.isLoaded())for(const p of t)this.images[p]||(c=!1);this.isLoaded()||c?n(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:n})}))}_getImagesForIds(t){const n={};for(const a of t){let c=this.getImage(a);c||(this.fire(new l.l("styleimagemissing",{id:a})),c=this.getImage(a)),c?n[a]={data:c.data.clone(),pixelRatio:c.pixelRatio,sdf:c.sdf,version:c.version,stretchX:c.stretchX,stretchY:c.stretchY,content:c.content,textFitWidth:c.textFitWidth,textFitHeight:c.textFitHeight,hasRenderCallback:!!(c.userImage&&c.userImage.render)}:l.w(`Image "${a}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return n}getPixelSize(){const{width:t,height:n}=this.atlasImage;return{width:t,height:n}}getPattern(t){const n=this.patterns[t],a=this.getImage(t);if(!a)return null;if(n&&n.position.version===a.version)return n.position;if(n)n.position.version=a.version;else{const c={w:a.data.width+2,h:a.data.height+2,x:0,y:0},p=new l.I(c,a);this.patterns[t]={bin:c,position:p}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const n=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new l.T(t,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const p in this.patterns)t.push(this.patterns[p].bin);const{w:n,h:a}=l.p(t),c=this.atlasImage;c.resize({width:n||1,height:a||1});for(const p in this.patterns){const{bin:m}=this.patterns[p],v=m.x+1,x=m.y+1,T=this.getImage(p).data,P=T.width,k=T.height;l.R.copy(T,c,{x:0,y:0},{x:v,y:x},{width:P,height:k}),l.R.copy(T,c,{x:0,y:k-1},{x:v,y:x-1},{width:P,height:1}),l.R.copy(T,c,{x:0,y:0},{x:v,y:x+k},{width:P,height:1}),l.R.copy(T,c,{x:P-1,y:0},{x:v-1,y:x},{width:1,height:k}),l.R.copy(T,c,{x:0,y:0},{x:v+P,y:x},{width:1,height:k})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const n of t){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const a=this.getImage(n);a||l.w(`Image with ID: "${n}" was not found`),pt(a)&&this.updateImage(n,a)}}cloneImages(){const t={};for(const n in this.images){const a=this.images[n];t[n]=Object.assign(Object.assign({},a),{data:a.data?a.data.clone():null})}return t}}const gt=1e20;function bt(d,t,n,a,c,p,m,v,x){for(let T=t;T<t+a;T++)Ue(d,n*p+T,p,c,m,v,x);for(let T=n;T<n+c;T++)Ue(d,T*p+t,1,a,m,v,x)}function Ue(d,t,n,a,c,p,m){p[0]=0,m[0]=-gt,m[1]=gt,c[0]=d[t];for(let v=1,x=0,T=0;v<a;v++){c[v]=d[t+v*n];const P=v*v;do{const k=p[x];T=(c[v]-c[k]+P-k*k)/(v-k)/2}while(T<=m[x]&&--x>-1);x++,p[x]=v,m[x]=T,m[x+1]=gt}for(let v=0,x=0;v<a;v++){for(;m[x+1]<v;)x++;const T=p[x],P=v-T;d[t+v*n]=c[T]+P*P}}const Be=l.v.layout_symbol["text-font"].default.join(",");class Se{constructor(t,n,a){this.requestManager=t,this.localIdeographFontFamily=n,this.entries={},this.lang=a}setURL(t){this.url=t}getGlyphs(t){return l._(this,void 0,void 0,(function*(){const n=[];for(const p in t)for(const m of t[p])n.push(this._getAndCacheGlyphsPromise(p,m));const a=yield Promise.all(n),c={};for(const{stack:p,id:m,glyph:v}of a)c[p]||(c[p]={}),c[p][m]=v&&{id:v.id,bitmap:v.bitmap.clone(),metrics:v.metrics};return c}))}_getAndCacheGlyphsPromise(t,n){return l._(this,void 0,void 0,(function*(){let a=this.entries[t];a||(a=this.entries[t]={glyphs:{},requests:{},ranges:{}});let c=a.glyphs[n];return c!==void 0?{stack:t,id:n,glyph:c}:!this.url||this._charUsesLocalIdeographFontFamily(n)?(c=a.glyphs[n]=this._drawGlyph(a,t,n),{stack:t,id:n,glyph:c}):yield this._downloadAndCacheRangePromise(t,n)}))}_downloadAndCacheRangePromise(t,n){return l._(this,void 0,void 0,(function*(){const a=this.entries[t],c=Math.floor(n/256);if(a.ranges[c])return{stack:t,id:n,glyph:null};if(!a.requests[c]){const p=Se.loadGlyphRange(t,c,this.url,this.requestManager);a.requests[c]=p}try{const p=yield a.requests[c];for(const m in p)a.glyphs[+m]=p[+m];return a.ranges[c]=!0,{stack:t,id:n,glyph:p[n]||null}}catch(p){const m=a.glyphs[n]=this._drawGlyph(a,t,n);return this._warnOnMissingGlyphRange(m,c,n,p),{stack:t,id:n,glyph:m}}}))}_warnOnMissingGlyphRange(t,n,a,c){const p=256*n,m=p+255,v=a.toString(16).padStart(4,"0").toUpperCase();l.w(`Unable to load glyph range ${n}, ${p}-${m}. Rendering codepoint U+${v} locally instead. ${c}`)}_charUsesLocalIdeographFontFamily(t){return!!this.localIdeographFontFamily&&l.q(t)}_drawGlyph(t,n,a){const c=n===Be&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(a),p=c?"ideographTinySDF":"tinySDF";t[p]||(t[p]=this._createTinySDF(c?this.localIdeographFontFamily:n));const m=t[p].draw(String.fromCodePoint(a)),v=new RegExp("^\\p{gc=Cf}+$","u").test(String.fromCodePoint(a));return{id:a,bitmap:new l.r({width:m.width||60,height:m.height||60},m.data),metrics:{width:v?0:m.glyphWidth/2||24,height:m.glyphHeight/2||24,left:m.glyphLeft/2+.5||0,top:m.glyphTop/2-27.5||-8,advance:v?0:m.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(t){const n=t?t.split(","):[];n.push("sans-serif");const a=n.map((c=>/[-\w]+/.test(c)?c:`'${CSS.escape(c)}'`)).join(",");return new Se.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:a,fontWeight:this._fontWeight(n[0]),fontStyle:this._fontStyle(n[0]),lang:this.lang})}_fontStyle(t){return/italic/i.test(t)?"italic":/oblique/i.test(t)?"oblique":"normal"}_fontWeight(t){const n={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let a;for(const[c,p]of Object.entries(n))new RegExp(`\\b${c}\\b`,"i").test(t)&&(a=`${p}`);return a}destroy(){for(const t in this.entries){const n=this.entries[t];n.tinySDF&&(n.tinySDF=null),n.ideographTinySDF&&(n.ideographTinySDF=null),n.glyphs={},n.requests={},n.ranges={}}this.entries={}}}Se.loadGlyphRange=function(d,t,n,a){return l._(this,void 0,void 0,(function*(){const c=256*t,p=c+255,m=a.transformRequest(n.replace("{fontstack}",d).replace("{range}",`${c}-${p}`),"Glyphs"),v=yield l.n(m,new AbortController);if(!v||!v.data)throw new Error(`Could not load glyph range. range: ${t}, ${c}-${p}`);const x={};for(const T of l.o(v.data))x[T.id]=T;return x}))},Se.TinySDF=class{constructor({fontSize:d=24,buffer:t=3,radius:n=8,cutoff:a=.25,fontFamily:c="sans-serif",fontWeight:p="normal",fontStyle:m="normal",lang:v=null}={}){this.buffer=t,this.cutoff=a,this.radius=n,this.lang=v;const x=this.size=d+4*t,T=this._createCanvas(x),P=this.ctx=T.getContext("2d",{willReadFrequently:!0});P.font=`${m} ${p} ${d}px ${c}`,P.textBaseline="alphabetic",P.textAlign="left",P.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(d){const t=document.createElement("canvas");return t.width=t.height=d,t}draw(d){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:a,actualBoundingBoxLeft:c,actualBoundingBoxRight:p}=this.ctx.measureText(d),m=Math.ceil(n),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-c))),x=Math.min(this.size-this.buffer,m+Math.ceil(a)),T=v+2*this.buffer,P=x+2*this.buffer,k=Math.max(T*P,0),A=new Uint8ClampedArray(k),L={data:A,width:T,height:P,glyphWidth:v,glyphHeight:x,glyphTop:m,glyphLeft:0,glyphAdvance:t};if(v===0||x===0)return L;const{ctx:N,buffer:W,gridInner:Y,gridOuter:X}=this;this.lang&&(N.lang=this.lang),N.clearRect(W,W,v,x),N.fillText(d,W,W+m);const te=N.getImageData(W,W,v,x);X.fill(gt,0,k),Y.fill(0,0,k);for(let fe=0;fe<x;fe++)for(let $=0;$<v;$++){const he=te.data[4*(fe*v+$)+3]/255;if(he===0)continue;const ve=(fe+W)*T+$+W;if(he===1)X[ve]=0,Y[ve]=gt;else{const le=.5-he;X[ve]=le>0?le*le:0,Y[ve]=le<0?le*le:0}}bt(X,0,0,T,P,T,this.f,this.v,this.z),bt(Y,W,W,v,x,T,this.f,this.v,this.z);for(let fe=0;fe<k;fe++){const $=Math.sqrt(X[fe])-Math.sqrt(Y[fe]);A[fe]=Math.round(255-255*($/this.radius+this.cutoff))}return L}};class Te{constructor(){this.specification=l.u.light.position}possiblyEvaluate(t,n){return l.F(t.expression.evaluate(n))}interpolate(t,n,a){return{x:l.G.number(t.x,n.x,a),y:l.G.number(t.y,n.y,a),z:l.G.number(t.z,n.z,a)}}}let Ce;class we extends l.E{constructor(t){super(),Ce=Ce||new l.t({anchor:new l.D(l.u.light.anchor),position:new Te,color:new l.D(l.u.light.color),intensity:new l.D(l.u.light.intensity)}),this._transitionable=new l.x(Ce,void 0),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n={}){if(!this._validate(l.y,t,n))for(const a in t){const c=t[a];a.endsWith(l.z)?this._transitionable.setTransition(a.slice(0,-l.z.length),c):this._transitionable.setValue(a,c)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,a){return(!a||a.validate!==!1)&&l.B(this,t.call(l.C,{value:n,style:{glyphs:!0,sprite:!0},styleSpec:l.u}))}}const be=new l.t({"sky-color":new l.D(l.u.sky["sky-color"]),"horizon-color":new l.D(l.u.sky["horizon-color"]),"fog-color":new l.D(l.u.sky["fog-color"]),"fog-ground-blend":new l.D(l.u.sky["fog-ground-blend"]),"horizon-fog-blend":new l.D(l.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new l.D(l.u.sky["sky-horizon-blend"]),"atmosphere-blend":new l.D(l.u.sky["atmosphere-blend"])});class ie extends l.E{constructor(t){super(),this._transitionable=new l.x(be,void 0),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.H(0))}setSky(t,n={}){if(!this._validate(l.J,t,n)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const a in t){const c=t[a];a.endsWith(l.z)?this._transitionable.setTransition(a.slice(0,-l.z.length),c):this._transitionable.setValue(a,c)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,a={}){return a?.validate!==!1&&l.B(this,t.call(l.C,l.e({value:n,style:{glyphs:!0,sprite:!0},styleSpec:l.u})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class ee{constructor(t,n){this.width=t,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,n){const a=t.join(",")+String(n);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(t,n)),this.dashEntry[a]}getDashRanges(t,n,a){const c=[];let p=t.length%2==1?-t[t.length-1]*a:0,m=t[0]*a,v=!0;c.push({left:p,right:m,isDash:v,zeroLength:t[0]===0});let x=t[0];for(let T=1;T<t.length;T++){v=!v;const P=t[T];p=x*a,x+=P,m=x*a,c.push({left:p,right:m,isDash:v,zeroLength:P===0})}return c}addRoundDash(t,n,a){const c=n/2;for(let p=-a;p<=a;p++){const m=this.width*(this.nextRow+a+p);let v=0,x=t[v];for(let T=0;T<this.width;T++){T/x.right>1&&(x=t[++v]);const P=Math.abs(T-x.left),k=Math.abs(T-x.right),A=Math.min(P,k);let L;const N=p/a*(c+1);if(x.isDash){const W=c-Math.abs(N);L=Math.sqrt(A*A+W*W)}else L=c-Math.sqrt(A*A+N*N);this.data[m+T]=Math.max(0,Math.min(255,L+128))}}}addRegularDash(t){for(let v=t.length-1;v>=0;--v){const x=t[v],T=t[v+1];x.zeroLength?t.splice(v,1):T&&T.isDash===x.isDash&&(T.left=x.left,t.splice(v,1))}const n=t[0],a=t[t.length-1];n.isDash===a.isDash&&(n.left=a.left-this.width,a.right=n.right+this.width);const c=this.width*this.nextRow;let p=0,m=t[p];for(let v=0;v<this.width;v++){v/m.right>1&&(m=t[++p]);const x=Math.abs(v-m.left),T=Math.abs(v-m.right),P=Math.min(x,T);this.data[c+v]=Math.max(0,Math.min(255,(m.isDash?P:-P)+128))}}addDash(t,n){const a=n?7:0,c=2*a+1;if(this.nextRow+c>this.height)return l.w("LineAtlas out of space"),null;let p=0;for(let v=0;v<t.length;v++)p+=t[v];if(p!==0){const v=this.width/p,x=this.getDashRanges(t,this.width,v);n?this.addRoundDash(x,v,a):this.addRegularDash(x)}const m={y:this.nextRow+a,height:2*a,width:p};return this.nextRow+=c,this.dirty=!0,m}bind(t){const n=t.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}const Q="maplibre_preloaded_worker_pool";class ue{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<ue.workerCount;)this.workers.push(new Worker(l.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach((n=>{n.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Q]}numActive(){return Object.keys(this.active).length}}const De=Math.floor(Xe.hardwareConcurrency/2);let Ge,ot;function it(){return Ge||(Ge=new ue),Ge}ue.workerCount=l.K(globalThis)?Math.max(Math.min(De,3),1):1;class It{constructor(t,n){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=n;const a=this.workerPool.acquire(n);for(let c=0;c<a.length;c++){const p=new l.L(a[c],n);p.name=`Worker ${c}`,this.actors.push(p)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,n){const a=[];for(const c of this.actors)a.push(c.sendAsync({type:t,data:n}));return Promise.all(a)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach((n=>{n.remove()})),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,n){for(const a of this.actors)a.registerMessageHandler(t,n)}unregisterMessageHandler(t){for(const n of this.actors)n.unregisterMessageHandler(t)}}function Rt(){return ot||(ot=new It(it(),l.M),ot.registerMessageHandler("GR",((d,t,n)=>l.m(t,n)))),ot}function Ft(d,t){const n=l.N();return l.O(n,n,[1,1,0]),l.Q(n,n,[.5*d.width,.5*d.height,1]),d.calculatePosMatrix?l.S(n,n,d.calculatePosMatrix(t.toUnwrapped())):n}function Kt(d,t,n,a,c,p,m){var v;const x=(function(A,L,N){if(A)for(const W of A){const Y=L[W];if(Y&&Y.source===N&&Y.type==="fill-extrusion")return!0}else for(const W in L){const Y=L[W];if(Y.source===N&&Y.type==="fill-extrusion")return!0}return!1})((v=c?.layers)!==null&&v!==void 0?v:null,t,d.id),T=p.maxPitchScaleFactor(),P=d.tilesIn(a,T,x);P.sort(Yt);const k=[];for(const A of P)k.push({wrappedTileID:A.tileID.wrapped().key,queryResults:A.tile.queryRenderedFeatures(t,n,d.getState(),A.queryGeometry,A.cameraQueryGeometry,A.scale,c,p,T,Ft(p,A.tileID),m?(L,N)=>m(A.tileID,L,N):void 0)});return(function(A,L){for(const N in A)for(const W of A[N])Tr(W,L);return A})((function(A){const L={},N={};for(const W of A){const Y=W.queryResults,X=W.wrappedTileID,te=N[X]=N[X]||{};for(const fe in Y){const $=Y[fe],he=te[fe]=te[fe]||{},ve=L[fe]=L[fe]||[];for(const le of $)he[le.featureIndex]||(he[le.featureIndex]=!0,ve.push(le))}}return L})(k),d)}function Yt(d,t){const n=d.tileID,a=t.tileID;return n.overscaledZ-a.overscaledZ||n.canonical.y-a.canonical.y||n.wrap-a.wrap||n.canonical.x-a.canonical.x}function Tr(d,t){const n=d.feature,a=t.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=a}function Qt(d,t,n,a){return l._(this,void 0,void 0,(function*(){let c=d;if(d.url?c=(yield l.j(t.transformRequest(d.url,"Source"),n)).data:yield Xe.frameAsync(n,a),!c)return null;const p=l.U(l.e(c,d),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in c&&c.vector_layers&&(p.vectorLayerIds=c.vector_layers.map((m=>m.id))),p}))}class Mt{constructor(t,n){t&&(n?this.setSouthWest(t).setNorthEast(n):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof l.V?new l.V(t.lng,t.lat):l.V.convert(t),this}setSouthWest(t){return this._sw=t instanceof l.V?new l.V(t.lng,t.lat):l.V.convert(t),this}extend(t){const n=this._sw,a=this._ne;let c,p;if(t instanceof l.V)c=t,p=t;else{if(!(t instanceof Mt))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Mt.convert(t)):this.extend(l.V.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(l.V.convert(t)):this;if(c=t._sw,p=t._ne,!c||!p)return this}return n||a?(n.lng=Math.min(c.lng,n.lng),n.lat=Math.min(c.lat,n.lat),a.lng=Math.max(p.lng,a.lng),a.lat=Math.max(p.lat,a.lat)):(this._sw=new l.V(c.lng,c.lat),this._ne=new l.V(p.lng,p.lat)),this}getCenter(){return new l.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.V(this.getWest(),this.getNorth())}getSouthEast(){return new l.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:n,lat:a}=l.V.convert(t);let c=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&c}intersects(t){if(!((t=Mt.convert(t)).getNorth()>=this.getSouth()&&t.getSouth()<=this.getNorth()))return!1;const n=Math.abs(this.getEast()-this.getWest()),a=Math.abs(t.getEast()-t.getWest());if(n>=360||a>=360)return!0;const c=l.W(this.getWest(),-180,180),p=l.W(this.getEast(),-180,180),m=l.W(t.getWest(),-180,180),v=l.W(t.getEast(),-180,180),x=c>=p,T=m>=v;return!(!x||!T)||(x?v>=c||m<=p:T?p>=m||c<=v:m<=p&&v>=c)}static convert(t){return t instanceof Mt?t:t&&new Mt(t)}static fromLngLat(t,n=0){const a=360*n/40075017,c=a/Math.cos(Math.PI/180*t.lat);return new Mt(new l.V(t.lng-c,t.lat-a),new l.V(t.lng+c,t.lat+a))}adjustAntiMeridian(){const t=new l.V(this._sw.lng,this._sw.lat),n=new l.V(this._ne.lng,this._ne.lat);return new Mt(t,t.lng>n.lng?new l.V(n.lng+360,n.lat):n)}}class Xt{constructor(t,n,a){this.bounds=Mt.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=a||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),a=Math.floor(l.Y(this.bounds.getWest())*n),c=Math.floor(l.X(this.bounds.getNorth())*n),p=Math.ceil(l.Y(this.bounds.getEast())*n),m=Math.ceil(l.X(this.bounds.getSouth())*n);return t.x>=a&&t.x<p&&t.y>=c&&t.y<m}}class Sr extends l.E{constructor(t,n,a,c){if(super(),this.id=t,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.U(n,["url","scheme","tileSize","promoteId","encoding"])),this._options=l.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(c)}load(){return l._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Qt(this._options,this.map._requestManager,this._tileJSONRequest,this.map._ownerWindow);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),t&&(l.e(this,t),t.bounds&&(this.tileBounds=new Xt(t.bounds,this.minzoom,this.maxzoom)),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this._loaded=!0,l.Z(t)||this.fire(new l.k(t))}}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(t){return l._(this,void 0,void 0,(function*(){const n=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a={request:this.map._requestManager.transformRequest(n,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(t)};a.request.collectResourceTiming=this._collectResourceTiming;let c="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise(((p,m)=>{t.reloadPromise={resolve:p,reject:m}}))}else t.actor=this.dispatcher.getActor(),c="LT";t.abortController=new AbortController;try{const p=yield t.actor.sendAsync({type:c,data:a},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,p)}catch(p){if(delete t.abortController,t.aborted)return;if(p&&p.status!==404)throw p;this._afterTileLoadWorkerResponse(t,null)}}))}_getOverzoomParameters(t){if(t.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const n=t.tileID.scaledTo(this.maxzoom).canonical,a=n.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:n,overzoomRequest:this.map._requestManager.transformRequest(a,"Tile")}}_afterTileLoadWorkerResponse(t,n){if(n&&n.resourceTiming&&(t.resourceTiming=n.resourceTiming),n&&this.map._refreshExpiredTiles&&t.setExpiryData(n),t.loadVectorData(n,this.map.painter),t.reloadPromise){const a=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(a.resolve).catch(a.reject)}}abortTile(t){return l._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}unloadTile(t){return l._(this,void 0,void 0,(function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class Et extends l.E{constructor(t,n,a,c){super(),this.id=t,this.dispatcher=a,this.setEventedParent(c),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},n),l.e(this,l.U(n,["url","scheme","tileSize"]))}load(){return l._(this,arguments,void 0,(function*(t=!1){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const n=yield Qt(this._options,this.map._requestManager,this._tileJSONRequest,this.map._ownerWindow);this._tileJSONRequest=null,this._loaded=!0,n&&(l.e(this,n),n.bounds&&(this.tileBounds=new Xt(n.bounds,this.minzoom,this.maxzoom)),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(n){this._tileJSONRequest=null,this._loaded=!0,l.Z(n)||this.fire(new l.k(n))}}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}serialize(){return l.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return l._(this,void 0,void 0,(function*(){const n=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const a=yield Oe.getImage(this.map._requestManager.transformRequest(n,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(a&&a.data){this.map._refreshExpiredTiles&&(a.cacheControl||a.expires)&&t.setExpiryData({cacheControl:a.cacheControl,expires:a.expires});const c=this.map.painter.context,p=c.gl,m=a.data;t.texture=this.map.painter.getTileTexture(m.width),t.texture?t.texture.update(m,{useMipmap:!0}):(t.texture=new l.T(c,m,p.RGBA,{useMipmap:!0}),t.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE,p.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(a){if(delete t.abortController,t.aborted)t.state="unloaded";else if(a)throw t.state="errored",a}}))}abortTile(t){return l._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)}))}unloadTile(t){return l._(this,void 0,void 0,(function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)}))}hasTransition(){return!1}}class Ot extends Et{constructor(t,n,a,c){super(t,n,a,c),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(t){return l._(this,void 0,void 0,(function*(){const n=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a=this.map._requestManager.transformRequest(n,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const c=yield Oe.getImage(a,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(c&&c.data){const p=c.data;this.map._refreshExpiredTiles&&(c.cacheControl||c.expires)&&t.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});const m=l.b(p)&&l.$()?p:yield this.readImageNow(p),v={type:this.type,uid:t.uid,source:this.id,rawImageData:m,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const x=yield t.actor.sendAsync({type:"LDT",data:v});t.dem=x,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(c){if(delete t.abortController,t.aborted)t.state="unloaded";else if(c)throw t.state="errored",c}}))}readImageNow(t){return l._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&l.a0()){const n=t.width+2,a=t.height+2;try{return new l.R({width:n,height:a},yield l.a1(t,-1,-1,n,a))}catch{}}return Xe.getImageData(t,1)}))}_getNeighboringTiles(t){const n=t.canonical,a=Math.pow(2,n.z),c=(n.x-1+a)%a,p=n.x===0?t.wrap-1:t.wrap,m=(n.x+1+a)%a,v=n.x+1===a?t.wrap+1:t.wrap,x={};return x[new l.a2(t.overscaledZ,p,n.z,c,n.y).key]={backfilled:!1},x[new l.a2(t.overscaledZ,v,n.z,m,n.y).key]={backfilled:!1},n.y>0&&(x[new l.a2(t.overscaledZ,p,n.z,c,n.y-1).key]={backfilled:!1},x[new l.a2(t.overscaledZ,t.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},x[new l.a2(t.overscaledZ,v,n.z,m,n.y-1).key]={backfilled:!1}),n.y+1<a&&(x[new l.a2(t.overscaledZ,p,n.z,c,n.y+1).key]={backfilled:!1},x[new l.a2(t.overscaledZ,t.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},x[new l.a2(t.overscaledZ,v,n.z,m,n.y+1).key]={backfilled:!1}),x}unloadTile(t){return l._(this,void 0,void 0,(function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))}))}}function ar(d){return d.type==="GeometryCollection"?d.geometries.map((t=>t.coordinates)).flat(1/0):d.coordinates.flat(1/0)}function ur(d){const t=new Mt;let n;switch(d.type){case"FeatureCollection":n=d.features.map((a=>ar(a.geometry))).flat(1/0);break;case"Feature":n=ar(d.geometry);break;default:n=ar(d)}if(n.length==0)return t;for(let a=0;a<n.length-1;a+=2)t.extend([n[a],n[a+1]]);return t}class Ar extends l.E{constructor(t,n,a,c){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:n.data},this.actor=a.getActor(),this.setEventedParent(c),this._data=typeof n.data=="string"?{url:n.data}:{geojson:n.data},this._options=l.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId,n.clusterMaxZoom!==void 0&&this.maxzoom<=n.clusterMaxZoom&&l.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${n.clusterMaxZoom}".`),this.workerOptions=l.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(n.buffer!==void 0?n.buffer:128),tolerance:this._pixelsToTileUnits(n.tolerance!==void 0?n.tolerance:.375),extent:l.a5,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(n.clusterMaxZoom),minPoints:Math.max(2,n.clusterMinPoints||2),extent:l.a5,radius:this._pixelsToTileUnits(n.clusterRadius||50),log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(t){return t*(l.a5/this.tileSize)}_getClusterMaxZoom(t){const n=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||t===void 0||l.w(`Integer expected for option 'clusterMaxZoom': provided value "${t}" rounded to "${n}"`),n}load(){return l._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(t){this.map=t,this.load()}setData(t,n){this._data=typeof t=="string"?{url:t}:{geojson:t},this._pendingWorkerUpdate={data:t};const a=this._updateWorkerData();return n?a:this}updateData(t,n){this._pendingWorkerUpdate.diff=l.a6(this._pendingWorkerUpdate.diff,t);const a=this._updateWorkerData();return n?a:this}getData(){return l._(this,void 0,void 0,(function*(){const t=l.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})}))}getBounds(){return l._(this,void 0,void 0,(function*(){return ur(yield this.getData())}))}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,n,a){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:n,offset:a}})}_updateWorkerData(){return l._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void l.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:t,diff:n}=this._pendingWorkerUpdate,a=this._getLoadGeoJSONParameters(t,n);t!==void 0?this._pendingWorkerUpdate.data=void 0:n&&(this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,yield this._dispatchWorkerUpdate(a)}))}_getLoadGeoJSONParameters(t,n){const a=l.e({type:this.type},this.workerOptions);return typeof t=="string"?(a.request=this.map._requestManager.transformRequest(Xe.resolveURL(t),"Source"),a.request.collectResourceTiming=this._collectResourceTiming,a):t!==void 0?(a.data=t,a):(n&&(a.dataDiff=n),a)}_dispatchWorkerUpdate(t){return l._(this,void 0,void 0,(function*(){this._isUpdatingWorker=!0,this.fire(new l.l("dataloading",{dataType:"source"}));try{const n=yield this.actor.sendAsync({type:"LD",data:t});if(this._isUpdatingWorker=!1,this._removed||n.abandoned)return void this.fire(new l.l("dataabort",{dataType:"source"}));n.data&&(this._data={geojson:n.data});const a=this._applyDiffToSource(t.dataDiff),c=this._getShouldReloadTileOptions(a),p={dataType:"source"};this._applyResourceTiming(p,n),this.fire(new l.l("data",Object.assign(Object.assign({},p),{sourceDataType:"metadata"}))),this.fire(new l.l("data",Object.assign(Object.assign({},p),{sourceDataType:"content",shouldReloadTileOptions:c})))}catch(n){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new l.l("dataabort",{dataType:"source"}));this.fire(new l.k(n))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyResourceTiming(t,n){var a;if(!this._collectResourceTiming)return;const c=(a=n.resourceTiming)===null||a===void 0?void 0:a[this.id];if(!c)return;const p=c.slice(0);p?.length&&l.e(t,{resourceTiming:p})}_applyDiffToSource(t){if(!t)return;const n=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){const c=l.a7(this._data.geojson,n);if(!c)throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:c}}if(!this._data.updateable)return;const a=l.a8(this._data.updateable,t,n);return t.removeAll||this._options.cluster?void 0:a}_getShouldReloadTileOptions(t){if(t)return{affectedBounds:t.filter(Boolean).map((n=>ur(n)))}}shouldReloadTile(t,{affectedBounds:n}){if(t.state==="loading")return!0;if(t.state==="unloaded")return!1;const{buffer:a,extent:c}=this.workerOptions.geojsonVtOptions,p=(function({x:m,y:v,z:x},T=0){const P=l.a3((m-T)/Math.pow(2,x)),k=l.a4((v+1+T)/Math.pow(2,x)),A=l.a3((m+1+T)/Math.pow(2,x)),L=l.a4((v-T)/Math.pow(2,x));return new Mt([P,k],[A,L])})(t.tileID.canonical,a/c);for(const m of n)if(p.intersects(m))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(t){return l._(this,void 0,void 0,(function*(){const n=t.actor?"RT":"LT";t.actor=this.actor;const a={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};t.abortController=new AbortController;const c=yield this.actor.sendAsync({type:n,data:a},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(c,this.map.painter,n==="RT")}))}abortTile(t){return l._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0}))}unloadTile(t){return l._(this,void 0,void 0,(function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class Cr extends l.E{constructor(t,n,a,c){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=a,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(c),this.options=n}load(t){return l._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const n=yield Oe.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,n&&n.data&&(this.image=n.data,t&&(this.coordinates=t),this._finishLoading())}catch(n){this._request=null,this._loaded=!0,l.Z(n)||this.fire(new l.k(n))}}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const n=t.map(l.a9.fromLngLat);var a;return this.tileID=(function(c){const p=l.aa.fromPoints(c),m=p.width(),v=p.height(),x=Math.max(m,v),T=Math.max(0,Math.floor(-Math.log(x)/Math.LN2)),P=Math.pow(2,T);return new l.ac(T,Math.floor((p.minX+p.maxX)/2*P),Math.floor((p.minY+p.maxY)/2*P))})(n),this.terrainTileRanges=this._getOverlappingTileRanges(n),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=n.map((c=>this.tileID.getTilePoint(c)._round())),this.flippedWindingOrder=((a=this.tileCoords)[1].x-a[0].x)*(a[2].y-a[0].y)-(a[1].y-a[0].y)*(a[2].x-a[0].x)<0,this.fire(new l.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,n=t.gl;this.texture||(this.texture=new l.T(t,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let a=!1;for(const c in this.tiles){const p=this.tiles[c];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,a=!0)}a&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return l._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:n,minY:a,maxX:c,maxY:p}=l.aa.fromPoints(t),m={};for(let v=0;v<=l.ab;v++){const x=Math.pow(2,v),T=Math.floor(n*x),P=Math.floor(a*x),k=Math.floor(c*x),A=Math.floor(p*x),L=(T%x+x)%x,N=k%x,W=Math.floor(T/x),Y=Math.floor(k/x);m[v]={minWrap:W,maxWrap:Y,minTileXWrapped:L,maxTileXWrapped:N,minTileY:P,maxTileY:A}}return m}}class pr extends Cr{constructor(t,n,a,c){super(t,n,a,c),this.roundZoom=!0,this.type="video",this.options=n}load(){return l._(this,void 0,void 0,(function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const n of t.urls)this.urls.push(this.map._requestManager.transformRequest(n,"Source").url);try{const n=yield l.ad(this.urls);if(this._loaded=!0,!n)return;this.video=n,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(n){this.fire(new l.k(n))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const n=this.video.seekable;t<n.start(0)||t>n.end(0)?this.fire(new l.k(new l.ae(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,n=t.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new l.T(t,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let a=!1;for(const c in this.tiles){const p=this.tiles[c];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,a=!0)}a&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Rr extends Cr{constructor(t,n,a,c){super(t,n,a,c),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some((p=>!Array.isArray(p)||p.length!==2||p.some((m=>typeof m!="number"))))||this.fire(new l.k(new l.ae(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.k(new l.ae(`sources.${t}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new l.k(new l.ae(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new l.k(new l.ae(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.k(new l.ae(`sources.${t}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){return l._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context,a=n.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new l.T(n,this.canvas,a.RGBA,{premultiply:!0}),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let c=!1;for(const p in this.tiles){const m=this.tiles[p];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,c=!0)}c&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Pr={},yr=d=>{switch(d){case"geojson":return Ar;case"image":return Cr;case"raster":return Et;case"raster-dem":return Ot;case"vector":return Sr;case"video":return pr;case"canvas":return Rr}return Pr[d]},ce="RTLPluginLoaded";class R extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Rt()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch((n=>{throw this.status="error",n}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return l._(this,arguments,void 0,(function*(n,a=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Xe.resolveURL(n),!this.url)throw new Error(`requested url ${n} is invalid`);if(this.status==="unavailable"){if(!a)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return l._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.l(ce))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let O=null;function V(){return O||(O=new R),O}var se,_e;(function(d){d[d.Base=0]="Base",d[d.Parent=1]="Parent"})(se||(se={})),(function(d){d[d.Departing=0]="Departing",d[d.Incoming=1]="Incoming"})(_e||(_e={}));class Le{constructor(t,n){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=t,this.uid=l.af(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(t){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(t||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:t,fadingDirection:n,fadingParentID:a,fadeEndTime:c}){this.resetFadeLogic(),this.fadingRole=t,this.fadingDirection=n,this.fadingParentID=a,this.fadeEndTime=c}setSelfFadeLogic(t){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=t}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=Ee(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,n,a){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData,this.latestFeatureIndex.encoding=t.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=(function(c,p){const m={};if(!p)return m;for(const v of c){const x=v.layerIds.map((T=>p.getLayer(T))).filter(Boolean);if(x.length!==0){v.layers=x,v.stateDependentLayerIds&&(v.stateDependentLayers=v.stateDependentLayerIds.map((T=>x.filter((P=>P.id===T))[0])));for(const T of x)m[T.id]=v}}return m})(t.buckets,n?.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const p=this.buckets[c];if(p instanceof l.ah){if(this.hasSymbolBuckets=!0,!a)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const p=this.buckets[c];if(p instanceof l.ah&&p.hasRTLText){this.hasRTLText=!0,V().lazyLoad();break}}this.queryPadding=0;for(const c in this.buckets){const p=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(c).queryRadius(p))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),this.dashPositions=t.dashPositions}else this.collisionBoxArray=new l.ag}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const a in this.buckets){const c=this.buckets[a];c.uploadPending()&&c.upload(t)}const n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new l.T(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new l.T(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,n,a,c,p,m,v,x,T,P,k){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:c,cameraQueryGeometry:p,scale:m,tileSize:this.tileSize,pixelPosMatrix:P,transform:x,params:v,queryPadding:this.queryPadding*T,getElevation:k},t,n,a):{}}querySourceFeatures(t,n){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const c=a.loadVTLayers(),p=n&&n.sourceLayer?n.sourceLayer:"",m=c[l.ai]||c[p];if(!m)return;const v=l.aj(n?.filter,n?.globalState),{z:x,x:T,y:P}=this.tileID.canonical,k={z:x,x:T,y:P};for(let A=0;A<m.length;A++){const L=m.feature(A);if(v.needGeometry){const Y=l.ak(L,!0);if(!v.filter(new l.H(this.tileID.overscaledZ),Y,this.tileID.canonical))continue}else if(!v.filter(new l.H(this.tileID.overscaledZ),L))continue;const N=a.getId(L,p),W=new l.al(L,x,T,P,N);W.tile=k,t.push(W)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const a=l.am(t.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const a=Date.now();let c=!1;if(this.expirationTime>a)c=!1;else if(n)if(this.expirationTime<n)c=!0;else{const p=this.expirationTime-n;p?this.expirationTime=a+Math.max(p,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const a=this.latestFeatureIndex.loadVTLayers();for(const c in this.buckets){if(!n.style.hasLayer(c))continue;const p=this.buckets[c],m=p.layers[0].sourceLayer||l.ai,v=a[m],x=t[m];if(!v||!x||Object.keys(x).length===0)continue;p.update(x,v,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const T=n&&n.style&&n.style.getLayer(c);T&&(this.queryPadding=Math.max(this.queryPadding,T.queryRadius(p)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ee()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(t){this.symbolFadeHoldUntil=Ee()+t}setDependencies(t,n){const a={};for(const c of n)a[c]=!0;this.dependencies[t]=a}hasDependency(t,n){for(const a of t){const c=this.dependencies[a];if(c){for(const p of n)if(c[p])return!0}}return!1}}class Ae{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,a){const c=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][c]=this.stateChanges[t][c]||{},l.e(this.stateChanges[t][c],a),this.deletedStates[t]===null){this.deletedStates[t]={};for(const p in this.state[t])p!==c&&(this.deletedStates[t][p]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][c]===null){this.deletedStates[t][c]={};for(const p in this.state[t][c])a[p]||(this.deletedStates[t][c][p]=null)}else for(const p in a)this.deletedStates[t]&&this.deletedStates[t][c]&&this.deletedStates[t][c][p]===null&&delete this.deletedStates[t][c][p]}removeFeatureState(t,n,a){if(this.deletedStates[t]===null)return;const c=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},a&&n!==void 0)this.deletedStates[t][c]!==null&&(this.deletedStates[t][c]=this.deletedStates[t][c]||{},this.deletedStates[t][c][a]=null);else if(n!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][c])for(a in this.deletedStates[t][c]={},this.stateChanges[t][c])this.deletedStates[t][c][a]=null;else this.deletedStates[t][c]=null;else this.deletedStates[t]=null}getState(t,n){const a=String(n),c=l.e({},(this.state[t]||{})[a],(this.stateChanges[t]||{})[a]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const p=this.deletedStates[t][n];if(p===null)return{};for(const m in p)delete c[m]}return c}initializeTileState(t,n){t.setFeatureState(this.state,n)}coalesceChanges(t,n){const a={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const p={};for(const m in this.stateChanges[c])this.state[c][m]||(this.state[c][m]={}),l.e(this.state[c][m],this.stateChanges[c][m]),p[m]=this.state[c][m];a[c]=p}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const p={};if(this.deletedStates[c]===null)for(const m in this.state[c])p[m]={},this.state[c][m]={};else for(const m in this.deletedStates[c]){if(this.deletedStates[c][m]===null)this.state[c][m]={};else for(const v of Object.keys(this.deletedStates[c][m]))delete this.state[c][m][v];p[m]=this.state[c][m]}a[c]=a[c]||{},l.e(a[c],p)}this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0&&t.setFeatureState(a,n)}}const Pe=89.25;function ze(d,t){const n=l.an(t.lat,-l.ao,l.ao);return new l.P(l.Y(t.lng)*d,l.X(n)*d)}function dt(d,t){return new l.a9(t.x/d,t.y/d).toLngLat()}function ke(d){return d.cameraToCenterDistance*Math.min(.85*Math.tan(l.ap(90-d.pitch)),Math.tan(l.ap(Pe-d.pitch)))}function et(d,t){const n=d.canonical,a=t/l.aq(n.z),c=n.x+Math.pow(2,n.z)*d.wrap,p=l.ar(new Float64Array(16));return l.O(p,p,[c*a,n.y*a,0]),l.Q(p,p,[a/l.a5,a/l.a5,1]),p}function pe(d,t,n,a,c){const p=l.a9.fromLngLat(d,t),m=c*l.as(1,d.lat),{x:v,y:x,z:T}=Lt(n,a);return new l.a9(p.x+m*-v,p.y+m*-x,p.z+m*-T)}function Lt(d,t){const n=l.ap(d),a=l.ap(t),c=Math.cos(-n),p=Math.sin(n);return{x:p*Math.sin(a),y:-p*Math.cos(a),z:c}}function cr(d,t,n){const a=t.intersectsFrustum(d);if(!n||a===0)return a;const c=t.intersectsPlane(n);return c===0?0:a===2&&c===2?2:1}function Bt(d,t,n){let a=0;const c=(n-t)/10;for(let p=0;p<10;p++)a+=c*Math.pow(Math.cos(t+(p+.5)/10*(n-t)),d);return a}function qt(d,t){return function(n,a,c,p,m){const v=2*((d-1)/l.at(Math.cos(l.ap(Pe-m))/Math.cos(l.ap(Pe)))-1),x=Math.acos(c/p),T=2*Bt(v-1,0,l.ap(m/2)),P=Math.min(l.ap(Pe),x+l.ap(m/2)),k=Bt(v-1,Math.min(P,x-l.ap(m/2)),P),A=Math.atan(a/c),L=Math.hypot(a,c);let N=n;return N+=l.at(p/L/Math.max(.5,Math.cos(l.ap(m/2)))),N+=v*l.at(Math.cos(A))/2,N-=l.at(Math.max(1,k/T/t))/2,N}}const Ht=qt(9.314,3);function zr(d,t){const n=(t.roundZoom?Math.round:Math.floor)(d.zoom+l.at(d.tileSize/t.tileSize));return Math.max(0,n)}function Ir(d,t){const n=d.getCameraFrustum(),a=d.getClippingPlane(),c=d.screenPointToMercatorCoordinate(d.getCameraPoint()),p=l.a9.fromLngLat(d.center,d.elevation);c.z=p.z+Math.cos(d.pitchInRadians)*d.cameraToCenterDistance/d.worldSize;const m=d.getCoveringTilesDetailsProvider(),v=m.allowVariableZoom(d,t),x=zr(d,t),T=t.minzoom||0,P=t.maxzoom!==void 0?t.maxzoom:d.maxZoom,k=Math.min(Math.max(0,x),P),A=Math.pow(2,k),L=[A*c.x,A*c.y,0],N=[A*p.x,A*p.y,0],W=Math.hypot(p.x-c.x,p.y-c.y),Y=Math.abs(p.z-c.z),X=Math.hypot(W,Y),te=he=>({zoom:0,x:0,y:0,wrap:he,fullyVisible:!1}),fe=[],$=[];if(d.renderWorldCopies&&m.allowWorldCopies())for(let he=1;he<=3;he++)fe.push(te(-he)),fe.push(te(he));for(fe.push(te(0));fe.length>0;){const he=fe.pop(),ve=he.x,le=he.y;let Me=he.fullyVisible;const $e={x:ve,y:le,z:he.zoom},Ze=m.getTileBoundingVolume($e,he.wrap,d.elevation,t);if(!Me){const kt=cr(n,Ze,a);if(kt===0)continue;Me=kt===2}const We=m.distanceToTile2d(c.x,c.y,$e,Ze);let Ye=x;v&&(Ye=(t.calculateTileZoom||Ht)(d.zoom+l.at(d.tileSize/t.tileSize),We,Y,X,d.fov)),Ye=(t.roundZoom?Math.round:Math.floor)(Ye),Ye=Math.max(0,Ye);const At=Math.min(Ye,P);if(he.wrap=m.getWrap(p,$e,he.wrap),he.zoom>=At){if(he.zoom<T)continue;const kt=k-he.zoom,yt=L[0]-.5-(ve<<kt),Nt=L[1]-.5-(le<<kt),Mr=t.reparseOverscaled?Math.max(he.zoom,Ye):he.zoom;$.push({tileID:new l.a2(he.zoom===P?Mr:he.zoom,he.wrap,he.zoom,ve,le),distanceSq:l.au([N[0]-.5-ve,N[1]-.5-le]),tileDistanceToCamera:Math.sqrt(yt*yt+Nt*Nt)})}else for(let kt=0;kt<4;kt++)fe.push({zoom:he.zoom+1,x:(ve<<1)+kt%2,y:(le<<1)+(kt>>1),wrap:he.wrap,fullyVisible:Me})}return $.sort(((he,ve)=>he.distanceSq-ve.distanceSq)).map((he=>he.tileID))}const hr=l.aa.fromPoints([new l.P(0,0),new l.P(l.a5,l.a5)]);function xr(d){return d==="raster"||d==="image"||d==="video"}function dr(d,t,n,a,c,p,m){if(!t.hasData())return!1;const{tileID:v,fadingRole:x,fadingDirection:T,fadingParentID:P}=t;if(x===se.Base&&T===_e.Incoming&&P)return n[P.key]=P,!0;const k=Math.max(v.overscaledZ-c,p);for(let A=v.overscaledZ-1;A>=k;A--){const L=v.scaledTo(A),N=d.getLoadedTile(L);if(N)return t.setCrossFadeLogic({fadingRole:se.Base,fadingDirection:_e.Incoming,fadingParentID:N.tileID,fadeEndTime:a+m}),N.setCrossFadeLogic({fadingRole:se.Parent,fadingDirection:_e.Departing,fadeEndTime:a+m}),n[L.key]=L,!0}return!1}function fr(d,t,n,a,c,p){if(!t.hasData())return!1;const m=t.tileID.children(c);let v=Je(d,t,m,n,a,c,p);if(v)return!0;for(const x of m)Je(d,t,x.children(c),n,a,c,p)&&(v=!0);return v}function Je(d,t,n,a,c,p,m){if(n[0].overscaledZ>=p)return!1;let v=!1;for(const x of n){const T=d.getLoadedTile(x);if(!T)continue;const{fadingRole:P,fadingDirection:k,fadingParentID:A}=T;P===se.Base&&k===_e.Departing&&A||(T.setCrossFadeLogic({fadingRole:se.Base,fadingDirection:_e.Departing,fadingParentID:t.tileID,fadeEndTime:c+m}),t.setCrossFadeLogic({fadingRole:se.Parent,fadingDirection:_e.Incoming,fadeEndTime:c+m})),a[x.key]=x,v=!0}return v}function Dr(d,t,n,a){const c=d.tileID;return!!d.selfFading||!d.hasData()&&!!t.has(c)&&(d.setSelfFadeLogic(n+a),!0)}function li(d,t){var n;d.needsHillshadePrepare=!0,d.needsTerrainPrepare=!0;let a=t.tileID.canonical.x-d.tileID.canonical.x;const c=t.tileID.canonical.y-d.tileID.canonical.y,p=Math.pow(2,d.tileID.canonical.z),m=t.tileID.key;a===0&&c===0||Math.abs(c)>1||(Math.abs(a)>1&&(Math.abs(a+p)===1?a+=p:Math.abs(a-p)===1&&(a-=p)),t.dem&&d.dem&&(d.dem.backfillBorder(t.dem,a,c),!((n=d.neighboringTiles)===null||n===void 0)&&n[m]&&(d.neighboringTiles[m].backfilled=!0)))}class Ji{constructor(){this._tiles={}}handleWrapJump(t){const n={};for(const a in this._tiles){const c=this._tiles[a];c.tileID=c.tileID.unwrapTo(c.tileID.wrap+t),n[c.tileID.key]=c}this._tiles=n}setFeatureState(t,n){for(const a in this._tiles)this._tiles[a].setFeatureState(t,n)}getAllTiles(){return Object.values(this._tiles)}getAllIds(t=!1){return t?Object.values(this._tiles).map((n=>n.tileID)).sort(l.aw).map((n=>n.key)):Object.keys(this._tiles)}getTileById(t){return this._tiles[t]}setTile(t,n){this._tiles[t]=n}deleteTileById(t){delete this._tiles[t]}getLoadedTile(t){const n=this.getTileById(t.key);return n?.hasData()?n:null}isIdRenderable(t,n=!1){var a;return(a=this.getTileById(t))===null||a===void 0?void 0:a.isRenderable(n)}getRenderableIds(t=0,n){const a=[];for(const c of this.getAllIds())this.isIdRenderable(c,n)&&a.push(this.getTileById(c));return n?a.sort(((c,p)=>{const m=c.tileID,v=p.tileID,x=new l.P(m.canonical.x,m.canonical.y)._rotate(-t),T=new l.P(v.canonical.x,v.canonical.y)._rotate(-t);return m.overscaledZ-v.overscaledZ||T.y-x.y||T.x-x.x})).map((c=>c.tileID.key)):a.map((c=>c.tileID)).sort(l.aw).map((c=>c.key))}}class Kr extends l.E{constructor(t,n,a){super(),this.id=t,this.dispatcher=a,this.on("data",(c=>this._dataHandler(c))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((c,p,m,v)=>{const x=new(yr(p.type))(c,p,m,v);if(x.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${x.id}`);return x})(t,n,a,this),this._inViewTiles=new Ji,this._outOfViewCache=new l.ax(0,(c=>this._unloadTile(c))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new Ae,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){for(const n of this._inViewTiles.getAllTiles())n.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t),this._inViewTiles=new Ji}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,n,a){return l._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,n,a)}catch(c){t.state="errored",c.status!==404?this._source.fire(new l.k(c,{tile:t})):this.update(this.transform,this.terrain)}}))}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new l.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const n of this._inViewTiles.getAllTiles())n.upload(t),n.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(t){var n;return this._inViewTiles.getRenderableIds((n=this.transform)===null||n===void 0?void 0:n.bearingInRadians,t)}hasRenderableParent(t){const n=t.overscaledZ-1;if(n>=this._source.minzoom){const a=this.getLoadedTile(t.scaledTo(n));if(a)return this._inViewTiles.isIdRenderable(a.tileID.key)}return!1}reload(t,n=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const a of this._inViewTiles.getAllIds()){const c=this._inViewTiles.getTileById(a);n&&!this._source.shouldReloadTile(c,n)||(t?this._reloadTile(a,"expired"):c.state!=="errored"&&this._reloadTile(a,"reloading"))}}}_reloadTile(t,n){return l._(this,void 0,void 0,(function*(){const a=this._inViewTiles.getTileById(t);a&&(a.state!=="loading"&&(a.state=n),yield this._loadTile(a,t,n))}))}_tileLoaded(t,n,a){t.timeAdded=Ee(),t.selfFading&&(t.fadeEndTime=t.timeAdded+this._rasterFadeDuration),a==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),this.getSource().type==="raster-dem"&&t.dem&&(function(c,p){var m,v;const x=p.getRenderableIds();for(const T of x){if(!c.neighboringTiles||!c.neighboringTiles[T])continue;const P=p.getTileById(T);c.neighboringTiles[T].backfilled||li(c,P),!((v=(m=P.neighboringTiles)===null||m===void 0?void 0:m[c.tileID.key])===null||v===void 0)&&v.backfilled||li(P,c)}})(t,this._inViewTiles),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new l.l("data",{dataType:"source",tile:t,coord:t.tileID}))}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._inViewTiles.getTileById(t)}_retainLoadedChildren(t,n){const a=this._getLoadedDescendents(n),c=new Set;for(const p of n){const m=a[p.key];if(!m?.length){c.add(p);continue}const v=p.overscaledZ+Kr.maxOverzooming,x=m.filter((k=>k.tileID.overscaledZ<=v));if(!x.length){c.add(p);continue}const T=Math.min(...x.map((k=>k.tileID.overscaledZ))),P=x.filter((k=>k.tileID.overscaledZ===T)).map((k=>k.tileID));for(const k of P)t[k.key]=k;this._areDescendentsComplete(P,T,p.overscaledZ)||c.add(p)}return c}_getLoadedDescendents(t){var n;const a={};for(const c of this._inViewTiles.getAllTiles().filter((p=>p.hasData())))for(const p of t)c.tileID.isChildOf(p)&&(a[n=p.key]||(a[n]=[])).push(c);return a}_areDescendentsComplete(t,n,a){return t.length===1&&t[0].isOverscaled()?t[0].overscaledZ===n:Math.pow(4,n-a)===t.length}getLoadedTile(t){return this._inViewTiles.getLoadedTile(t)}updateCacheSize(t){const n=Math.ceil(t.width/this._source.tileSize)+1,a=Math.ceil(t.height/this._source.tileSize)+1,c=Math.floor(n*a*(this._maxTileCacheZoomLevels===null?l.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),p=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,c):c;this._outOfViewCache.setMaxSize(p)}handleWrapJump(t){const n=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);this._prevLng=t,n&&(this._inViewTiles.handleWrapJump(n),this._resetTileReloadTimers())}update(t,n){if(!this._sourceLoaded||this._paused)return;let a;this.transform=t,this.terrain=n,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?a=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((x=>new l.a2(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y))):(a=Ir(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?t.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(a=a.filter((x=>this._source.hasTile(x))))):a=[],this.usedForTerrain&&(a=this._addTerrainIdealTiles(a));const c=a.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,c&&this.fire(new l.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const p=zr(t,this._source),m=this._updateRetainedTiles(a,p),v=xr(this._source.type);v&&this._rasterFadeDuration>0&&!n&&(function(x,T,P,k,A,L,N){const W=Ee(),Y=l.av(T);for(const X of T){const te=x.getTileById(X.key);te.fadingDirection!==_e.Departing&&te.fadeOpacity!==0||te.resetFadeLogic(),dr(x,te,P,W,k,A,N)||fr(x,te,P,W,L,N)||Dr(te,Y,W,N)||te.resetFadeLogic()}})(this._inViewTiles,a,m,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),v?this._cleanUpRasterTiles(m):this._cleanUpVectorTiles(m)}_cleanUpRasterTiles(t){for(const n of this._inViewTiles.getAllIds())t[n]||this._removeTile(n)}_cleanUpVectorTiles(t){for(const n of this._inViewTiles.getAllIds()){const a=this._inViewTiles.getTileById(n);t[n]?a.clearSymbolFadeHold():a.hasSymbolBuckets?a.holdingForSymbolFade()?a.symbolFadeFinished()&&this._removeTile(n):a.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(n)}}_addTerrainIdealTiles(t){const n=[];for(const a of t)if(a.canonical.z>this._source.minzoom){const c=a.scaledTo(a.canonical.z-1);n.push(c);const p=a.scaledTo(Math.max(this._source.minzoom,Math.min(a.canonical.z,5)));n.push(p)}return t.concat(n)}releaseSymbolFadeTiles(){for(const t of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(t).holdingForSymbolFade()&&this._removeTile(t)}_updateRetainedTiles(t,n){var a;const c=new Set;for(const T of t)this._addTile(T).hasData()||c.add(T);const p=t.reduce(((T,P)=>(T[P.key]=P,T)),{}),m=this._retainLoadedChildren(p,c),v={},x=Math.max(n-Kr.maxUnderzooming,this._source.minzoom);for(const T of m){let P=this._inViewTiles.getTileById(T.key),k=P?.wasRequested();for(let A=T.overscaledZ-1;A>=x;--A){const L=T.scaledTo(A);if(v[L.key])break;if(v[L.key]=!0,P=this.getTile(L),!P&&k&&(P=this._addTile(L)),P){const N=P.hasData();if((N||!(!((a=this.map)===null||a===void 0)&&a.cancelPendingTileRequestsWhileZooming)||k)&&(p[L.key]=L),k=P.wasRequested(),N)break}}}return p}_addTile(t){let n=this._inViewTiles.getTileById(t.key);if(n)return n;n=this._outOfViewCache.getAndRemove(t),n&&(n.resetFadeLogic(),this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null));const a=n;return n||(n=new Le(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(n,t.key,n.state)),n.uses++,this._inViewTiles.setTile(t.key,n),a||this._source.fire(new l.l("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(t,n){this._clearTileReloadTimer(t);const a=n.getExpiryTimeout();a&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),a))}_clearTileReloadTimer(t){const n=this._timers[t];n&&(clearTimeout(n),delete this._timers[t])}_resetTileReloadTimers(){for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t of this._inViewTiles.getAllIds()){const n=this._inViewTiles.getTileById(t);this._setTileReloadTimer(t,n)}}refreshTiles(t){for(const n of this._inViewTiles.getAllIds()){const a=this._inViewTiles.getTileById(n);(this._inViewTiles.isIdRenderable(n)||a.state=="errored")&&t.some((c=>c.equals(a.tileID.canonical)))&&this._reloadTile(n,"expired")}}_removeTile(t){const n=this._inViewTiles.getTileById(t);n&&(n.uses--,this._inViewTiles.deleteTileById(t),this._clearTileReloadTimer(t),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._outOfViewCache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}_dataHandler(t){t.dataType==="source"&&(t.sourceDataType!=="metadata"?t.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(t.sourceDataChanged,t.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t of this._inViewTiles.getAllIds())this._removeTile(t);this._outOfViewCache.reset()}tilesIn(t,n,a){const c=[],p=this.transform;if(!p)return c;const m=p.getCoveringTilesDetailsProvider().allowWorldCopies(),v=a?p.getCameraQueryGeometry(t):t,x=L=>p.screenPointToMercatorCoordinate(L,this.terrain),T=this.transformBbox(t,x,!m),P=this.transformBbox(v,x,!m),k=this.getIds(),A=l.aa.fromPoints(P);for(let L=0;L<k.length;L++){const N=this._inViewTiles.getTileById(k[L]);if(N.holdingForSymbolFade())continue;const W=m?[N.tileID]:[N.tileID.unwrapTo(-1),N.tileID.unwrapTo(0)],Y=Math.pow(2,p.zoom-N.tileID.overscaledZ),X=n*N.queryPadding*l.a5/N.tileSize/Y;for(const te of W){const fe=A.map(($=>te.getTilePoint(new l.a9($.x,$.y))));if(fe.expandBy(X),fe.intersects(hr)){const $=T.map((ve=>te.getTilePoint(ve))),he=P.map((ve=>te.getTilePoint(ve)));c.push({tile:N,tileID:m?te:te.unwrapTo(0),queryGeometry:$,cameraQueryGeometry:he,scale:Y})}}}return c}transformBbox(t,n,a){let c=t.map(n);if(a){const p=l.aa.fromPoints(t);p.shrinkBy(.001*Math.min(p.width(),p.height()));const m=p.map(n);l.aa.fromPoints(c).covers(m)||(c=c.map((v=>v.x>.5?new l.a9(v.x-1,v.y,v.z):v)))}return c}getVisibleCoordinates(t){const n=this.getRenderableIds(t).map((a=>this._inViewTiles.getTileById(a).tileID));return this.transform&&this.transform.populateCache(n),n}hasTransition(){return!!this._source.hasTransition()||!(!xr(this._source.type)||!(function(t,n){if(n<=0)return!1;const a=Ee();for(const c of t.getAllTiles())if(c.fadeEndTime>=a)return!0;return!1})(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(t){this._rasterFadeDuration=t}setFeatureState(t,n,a){this._state.updateState(t=t||l.ai,n,a)}removeFeatureState(t,n,a){this._state.removeFeatureState(t=t||l.ai,n,a)}getFeatureState(t,n){return this._state.getState(t=t||l.ai,n)}setDependencies(t,n,a){const c=this._inViewTiles.getTileById(t);c&&c.setDependencies(n,a)}reloadTilesForDependencies(t,n){for(const a of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(a).hasDependency(t,n)&&this._reloadTile(a,"reloading");this._outOfViewCache.filter((a=>!a.hasDependency(t,n)))}areTilesLoaded(){for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}}Kr.maxUnderzooming=10,Kr.maxOverzooming=3;class wt{constructor(t,n){this.reset(t,n)}reset(t,n){this.points=t||[],this._distances=[0];for(let a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=l.an(t,0,1);let n=1,a=this._distances[n];const c=t*this.paddedLength+this.padding;for(;a<c&&n<this._distances.length;)a=this._distances[++n];const p=n-1,m=this._distances[p],v=a-m,x=v>0?(c-m)/v:0;return this.points[p].mult(1-x).add(this.points[n].mult(x))}}function rr(d,t){let n=!0;return d==="always"||d!=="never"&&t!=="never"||(n=!1),n}class br{constructor(t,n,a){const c=this.boxCells=[],p=this.circleCells=[];this.xCellCount=Math.ceil(t/a),this.yCellCount=Math.ceil(n/a);for(let m=0;m<this.xCellCount*this.yCellCount;m++)c.push([]),p.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,n,a,c,p){this._forEachCell(n,a,c,p,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(p)}insertCircle(t,n,a,c){this._forEachCell(n-c,a-c,n+c,a+c,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(n),this.circles.push(a),this.circles.push(c)}_insertBoxCell(t,n,a,c,p,m){this.boxCells[p].push(m)}_insertCircleCell(t,n,a,c,p,m){this.circleCells[p].push(m)}_query(t,n,a,c,p,m,v){if(a<0||t>this.width||c<0||n>this.height)return[];const x=[];if(t<=0&&n<=0&&this.width<=a&&this.height<=c){if(p)return[{key:null,x1:t,y1:n,x2:a,y2:c}];for(let T=0;T<this.boxKeys.length;T++)x.push({key:this.boxKeys[T],x1:this.bboxes[4*T],y1:this.bboxes[4*T+1],x2:this.bboxes[4*T+2],y2:this.bboxes[4*T+3]});for(let T=0;T<this.circleKeys.length;T++){const P=this.circles[3*T],k=this.circles[3*T+1],A=this.circles[3*T+2];x.push({key:this.circleKeys[T],x1:P-A,y1:k-A,x2:P+A,y2:k+A})}}else this._forEachCell(t,n,a,c,this._queryCell,x,{hitTest:p,overlapMode:m,seenUids:{box:{},circle:{}}},v);return x}query(t,n,a,c){return this._query(t,n,a,c,!1,null)}hitTest(t,n,a,c,p,m){return this._query(t,n,a,c,!0,p,m).length>0}hitTestCircle(t,n,a,c,p){const m=t-a,v=t+a,x=n-a,T=n+a;if(v<0||m>this.width||T<0||x>this.height)return!1;const P=[];return this._forEachCell(m,x,v,T,this._queryCellCircle,P,{hitTest:!0,overlapMode:c,circle:{x:t,y:n,radius:a},seenUids:{box:{},circle:{}}},p),P.length>0}_queryCell(t,n,a,c,p,m,v,x){const{seenUids:T,hitTest:P,overlapMode:k}=v,A=this.boxCells[p];if(A!==null){const N=this.bboxes;for(const W of A)if(!T.box[W]){T.box[W]=!0;const Y=4*W,X=this.boxKeys[W];if(t<=N[Y+2]&&n<=N[Y+3]&&a>=N[Y+0]&&c>=N[Y+1]&&(!x||x(X))&&(!P||!rr(k,X.overlapMode))&&(m.push({key:X,x1:N[Y],y1:N[Y+1],x2:N[Y+2],y2:N[Y+3]}),P))return!0}}const L=this.circleCells[p];if(L!==null){const N=this.circles;for(const W of L)if(!T.circle[W]){T.circle[W]=!0;const Y=3*W,X=this.circleKeys[W];if(this._circleAndRectCollide(N[Y],N[Y+1],N[Y+2],t,n,a,c)&&(!x||x(X))&&(!P||!rr(k,X.overlapMode))){const te=N[Y],fe=N[Y+1],$=N[Y+2];if(m.push({key:X,x1:te-$,y1:fe-$,x2:te+$,y2:fe+$}),P)return!0}}}return!1}_queryCellCircle(t,n,a,c,p,m,v,x){const{circle:T,seenUids:P,overlapMode:k}=v,A=this.boxCells[p];if(A!==null){const N=this.bboxes;for(const W of A)if(!P.box[W]){P.box[W]=!0;const Y=4*W,X=this.boxKeys[W];if(this._circleAndRectCollide(T.x,T.y,T.radius,N[Y+0],N[Y+1],N[Y+2],N[Y+3])&&(!x||x(X))&&!rr(k,X.overlapMode))return m.push(!0),!0}}const L=this.circleCells[p];if(L!==null){const N=this.circles;for(const W of L)if(!P.circle[W]){P.circle[W]=!0;const Y=3*W,X=this.circleKeys[W];if(this._circlesCollide(N[Y],N[Y+1],N[Y+2],T.x,T.y,T.radius)&&(!x||x(X))&&!rr(k,X.overlapMode))return m.push(!0),!0}}}_forEachCell(t,n,a,c,p,m,v,x){const T=this._convertToXCellCoord(t),P=this._convertToYCellCoord(n),k=this._convertToXCellCoord(a),A=this._convertToYCellCoord(c);for(let L=T;L<=k;L++)for(let N=P;N<=A;N++)if(p.call(this,t,n,a,c,this.xCellCount*N+L,m,v,x))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,n,a,c,p,m){const v=c-t,x=p-n,T=a+m;return T*T>v*v+x*x}_circleAndRectCollide(t,n,a,c,p,m,v){const x=(m-c)/2,T=Math.abs(t-(c+x));if(T>x+a)return!1;const P=(v-p)/2,k=Math.abs(n-(p+P));if(k>P+a)return!1;if(T<=x||k<=P)return!0;const A=T-x,L=k-P;return A*A+L*L<=a*a}}function oi(d,t,n){const a=l.N();if(!d){const{vecSouth:k,vecEast:A}=zi(t),L=xe();L[0]=A[0],L[1]=A[1],L[2]=k[0],L[3]=k[1],c=L,(P=(m=(p=L)[0])*(T=p[3])-(x=p[2])*(v=p[1]))&&(c[0]=T*(P=1/P),c[1]=-v*P,c[2]=-x*P,c[3]=m*P),a[0]=L[0],a[1]=L[1],a[4]=L[2],a[5]=L[3]}var c,p,m,v,x,T,P;return l.Q(a,a,[1/n,1/n,1]),a}function $i(d,t,n,a){if(d){const c=l.N();if(!t){const{vecSouth:p,vecEast:m}=zi(n);c[0]=m[0],c[1]=m[1],c[4]=p[0],c[5]=p[1]}return l.Q(c,c,[a,a,1]),c}return n.pixelsToClipSpaceMatrix}function zi(d){const t=Math.cos(d.rollInRadians),n=Math.sin(d.rollInRadians),a=Math.cos(d.pitchInRadians),c=Math.cos(d.bearingInRadians),p=Math.sin(d.bearingInRadians),m=l.aC();m[0]=-c*a*n-p*t,m[1]=-p*a*n+c*t;const v=l.aD(m);v<1e-9?l.aE(m):l.aF(m,m,1/v);const x=l.aC();x[0]=c*a*t-p*n,x[1]=p*a*t+c*n;const T=l.aD(x);return T<1e-9?l.aE(x):l.aF(x,x,1/T),{vecEast:x,vecSouth:m}}function mr(d,t,n,a){let c;a?(c=[d,t,a(d,t),1],l.aH(c,c,n)):(c=[d,t,0,1],Bs(c,c,n));const p=c[3];return{point:new l.P(c[0]/p,c[1]/p),signedDistanceFromCamera:p,isOccluded:!1}}function Ln(d,t){return .5+d/t*.5}function yn(d,t){return d.x>=-t[0]&&d.x<=t[0]&&d.y>=-t[1]&&d.y<=t[1]}function Eo(d,t,n,a,c,p,m,v,x,T,P,k,A){const L=n?d.textSizeData:d.iconSizeData,N=l.ay(L,t.transform.zoom),W=[256/t.width*2+1,256/t.height*2+1],Y=n?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;Y.clear();const X=d.lineVertexArray,te=n?d.text.placedSymbolArray:d.icon.placedSymbolArray,fe=t.transform.width/t.transform.height;let $=!1;for(let he=0;he<te.length;he++){const ve=te.get(he);if(ve.hidden||ve.writingMode===l.az.vertical&&!$){ko(ve.numGlyphs,Y);continue}$=!1;const le=new l.P(ve.anchorX,ve.anchorY),Me={getElevation:A,pitchedLabelPlaneMatrix:a,lineVertexArray:X,pitchWithMap:p,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:le,unwrappedTileID:x,width:T,height:P,translation:k},$e=aa(ve.anchorX,ve.anchorY,Me);if(!yn($e.point,W)){ko(ve.numGlyphs,Y);continue}const Ze=Ln(t.transform.cameraToCenterDistance,$e.signedDistanceFromCamera),We=l.aA(L,N,ve),Ye=p?We*t.transform.getPitchedTextCorrection(ve.anchorX,ve.anchorY,x)/Ze:We*Ze,At=oa({projectionContext:Me,pitchedLabelPlaneMatrixInverse:c,symbol:ve,fontSize:Ye,flip:!1,keepUpright:m,glyphOffsetArray:d.glyphOffsetArray,dynamicLayoutVertexArray:Y,aspectRatio:fe,rotateToLine:v});$=At.useVertical,(At.notEnoughRoom||$||At.needsFlipping&&oa({projectionContext:Me,pitchedLabelPlaneMatrixInverse:c,symbol:ve,fontSize:Ye,flip:!0,keepUpright:m,glyphOffsetArray:d.glyphOffsetArray,dynamicLayoutVertexArray:Y,aspectRatio:fe,rotateToLine:v}).notEnoughRoom)&&ko(ve.numGlyphs,Y)}n?d.text.dynamicLayoutVertexBuffer.updateData(Y):d.icon.dynamicLayoutVertexBuffer.updateData(Y)}function na(d,t,n,a,c,p,m,v){const x=p.glyphStartIndex+p.numGlyphs,T=p.lineStartIndex,P=p.lineStartIndex+p.lineLength,k=t.getoffsetX(p.glyphStartIndex),A=t.getoffsetX(x-1),L=Rn(d*k,n,a,c,p.segment,T,P,v,m);if(!L)return null;const N=Rn(d*A,n,a,c,p.segment,T,P,v,m);return N?v.projectionCache.anyProjectionOccluded?null:{first:L,last:N}:null}function Ga(d,t,n,a){return d===l.az.horizontal&&Math.abs(n.y-t.y)>Math.abs(n.x-t.x)*a?{useVertical:!0}:(d===l.az.vertical?t.y<n.y:t.x>n.x)?{needsFlipping:!0}:null}function oa(d){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:n,symbol:a,fontSize:c,flip:p,keepUpright:m,glyphOffsetArray:v,dynamicLayoutVertexArray:x,aspectRatio:T,rotateToLine:P}=d,k=c/24,A=a.lineOffsetX*k,L=a.lineOffsetY*k;let N;if(a.numGlyphs>1){const W=a.glyphStartIndex+a.numGlyphs,Y=a.lineStartIndex,X=a.lineStartIndex+a.lineLength,te=na(k,v,A,L,p,a,P,t);if(!te)return{notEnoughRoom:!0};const fe=Os(te.first.point.x,te.first.point.y,t,n),$=Os(te.last.point.x,te.last.point.y,t,n);if(m&&!p){const he=Ga(a.writingMode,fe,$,T);if(he)return he}N=[te.first];for(let he=a.glyphStartIndex+1;he<W-1;he++){const ve=Rn(k*v.getoffsetX(he),A,L,p,a.segment,Y,X,t,P);if(!ve)return{notEnoughRoom:!0};N.push(ve)}N.push(te.last)}else{if(m&&!p){const Y=Jr(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,X=a.lineStartIndex+a.segment+1,te=new l.P(t.lineVertexArray.getx(X),t.lineVertexArray.gety(X)),fe=Jr(te.x,te.y,t),$=fe.signedDistanceFromCamera>0?fe.point:qa(t.tileAnchorPoint,te,Y,1,t),he=Os(Y.x,Y.y,t,n),ve=Os($.x,$.y,t,n),le=Ga(a.writingMode,he,ve,T);if(le)return le}const W=Rn(k*v.getoffsetX(a.glyphStartIndex),A,L,p,a.segment,a.lineStartIndex,a.lineStartIndex+a.lineLength,t,P);if(!W||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};N=[W]}for(const W of N)l.aG(x,W.point,W.angle);return{}}function qa(d,t,n,a,c){const p=d.add(d.sub(t)._unit()),m=Jr(p.x,p.y,c).point,v=n.sub(m);return n.add(v._mult(a/v.mag()))}function an(d,t,n){const a=t.projectionCache;if(a.projections[d])return a.projections[d];const c=new l.P(t.lineVertexArray.getx(d),t.lineVertexArray.gety(d)),p=Jr(c.x,c.y,t);if(p.signedDistanceFromCamera>0)return a.projections[d]=p.point,a.anyProjectionOccluded=a.anyProjectionOccluded||p.isOccluded,p.point;const m=d-n.direction;return qa(n.distanceFromAnchor===0?t.tileAnchorPoint:new l.P(t.lineVertexArray.getx(m),t.lineVertexArray.gety(m)),c,n.previousVertex,n.absOffsetX-n.distanceFromAnchor+1,t)}function Jr(d,t,n){const a=d+n.translation[0],c=t+n.translation[1];let p;return n.pitchWithMap?(p=mr(a,c,n.pitchedLabelPlaneMatrix,n.getElevation),p.isOccluded=!1):(p=n.transform.projectTileCoordinates(a,c,n.unwrappedTileID,n.getElevation),p.point.x=(.5*p.point.x+.5)*n.width,p.point.y=(.5*-p.point.y+.5)*n.height),p}function Os(d,t,n,a){if(n.pitchWithMap){const c=[d,t,0,1];return l.aH(c,c,a),n.transform.projectTileCoordinates(c[0]/c[3],c[1]/c[3],n.unwrappedTileID,n.getElevation).point}return{x:d/n.width*2-1,y:1-t/n.height*2}}function aa(d,t,n){return n.transform.projectTileCoordinates(d,t,n.unwrappedTileID,n.getElevation)}function Za(d,t,n){return d._unit()._perp()._mult(t*n)}function Ao(d,t,n,a,c,p,m,v,x){if(v.projectionCache.offsets[d])return v.projectionCache.offsets[d];const T=n.add(t);if(d+x.direction<a||d+x.direction>=c)return v.projectionCache.offsets[d]=T,T;const P=an(d+x.direction,v,x),k=Za(P.sub(n),m,x.direction),A=n.add(k),L=P.add(k);return v.projectionCache.offsets[d]=l.aI(p,T,A,L)||T,v.projectionCache.offsets[d]}function Rn(d,t,n,a,c,p,m,v,x){const T=a?d-t:d+t;let P=T>0?1:-1,k=0;a&&(P*=-1,k=Math.PI),P<0&&(k+=Math.PI);let A,L=P>0?p+c:p+c+1;v.projectionCache.cachedAnchorPoint?A=v.projectionCache.cachedAnchorPoint:(A=Jr(v.tileAnchorPoint.x,v.tileAnchorPoint.y,v).point,v.projectionCache.cachedAnchorPoint=A);let N,W,Y=A,X=A,te=0,fe=0;const $=Math.abs(T),he=[];let ve;for(;te+fe<=$;){if(L+=P,L<p||L>=m)return null;te+=fe,X=Y,W=N;const $e={absOffsetX:$,direction:P,distanceFromAnchor:te,previousVertex:X};if(Y=an(L,v,$e),n===0)he.push(X),ve=Y.sub(X);else{let Ze;const We=Y.sub(X);Ze=We.mag()===0?Za(an(L+P,v,$e).sub(Y),n,P):Za(We,n,P),W||(W=X.add(Ze)),N=Ao(L,Ze,Y,p,m,W,n,v,$e),he.push(W),ve=N.sub(W)}fe=ve.mag()}const le=ve._mult(($-te)/fe)._add(W||X),Me=k+Math.atan2(Y.y-X.y,Y.x-X.x);return he.push(le),{point:le,angle:x?Me:0,path:he}}const xu=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ko(d,t){for(let n=0;n<d;n++){const a=t.length;t.resize(a+4),t.float32.set(xu,3*a)}}function Bs(d,t,n){const a=t[0],c=t[1];return d[0]=n[0]*a+n[4]*c+n[12],d[1]=n[1]*a+n[5]*c+n[13],d[3]=n[3]*a+n[7]*c+n[15],d}const wi=100;class bu{constructor(t,n=new br(t.width+200,t.height+200,25),a=new br(t.width+200,t.height+200,25)){this.transform=t,this.grid=n,this.ignoredGrid=a,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+wi,this.screenBottomBoundary=t.height+wi,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,n,a,c,p,m,v,x,T,P,k,A){const L=this.projectAndGetPerspectiveRatio(t.anchorPointX+x[0],t.anchorPointY+x[1],p,P,A),N=a*L.perspectiveRatio;let W;if(m||v)W=this._projectCollisionBox(t,N,c,p,m,v,x,L,P,k,A);else{const ve=L.x+(k?k.x*N:0),le=L.y+(k?k.y*N:0);W={allPointsOccluded:!1,box:[ve+t.x1*N,le+t.y1*N,ve+t.x2*N,le+t.y2*N]}}const[Y,X,te,fe]=W.box,$=m?W.allPointsOccluded:L.isOccluded;let he=$;return he||(he=L.perspectiveRatio<this.perspectiveRatioCutoff),he||(he=!this.isInsideGrid(Y,X,te,fe)),he||n!=="always"&&this.grid.hitTest(Y,X,te,fe,n,T)?{box:[Y,X,te,fe],placeable:!1,offscreen:!1,occluded:$}:{box:[Y,X,te,fe],placeable:!0,offscreen:this.isOffscreen(Y,X,te,fe),occluded:$}}placeCollisionCircles(t,n,a,c,p,m,v,x,T,P,k,A,L,N){const W=[],Y=new l.P(n.anchorX,n.anchorY),X=this.getPerspectiveRatio(Y.x,Y.y,m,N),te=(T?p*this.transform.getPitchedTextCorrection(n.anchorX,n.anchorY,m)/X:p*X)/l.aM,fe={getElevation:N,pitchedLabelPlaneMatrix:v,lineVertexArray:a,pitchWithMap:T,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:Y,unwrappedTileID:m,width:this.transform.width,height:this.transform.height,translation:L},$=na(te,c,n.lineOffsetX*te,n.lineOffsetY*te,!1,n,!1,fe);let he=!1,ve=!1,le=!0;if($){const Me=.5*k*X+A,$e=new l.P(-100,-100),Ze=new l.P(this.screenRightBoundary,this.screenBottomBoundary),We=new wt,Ye=$.first,At=$.last;let kt=[];for(let Mr=Ye.path.length-1;Mr>=1;Mr--)kt.push(Ye.path[Mr]);for(let Mr=1;Mr<At.path.length;Mr++)kt.push(At.path[Mr]);const yt=2.5*Me;if(T){const Mr=this.projectPathToScreenSpace(kt,fe);kt=Mr.some((Qr=>Qr.signedDistanceFromCamera<=0))?[]:Mr.map((Qr=>Qr.point))}let Nt=[];if(kt.length>0){const Mr=kt[0].clone(),Qr=kt[0].clone();for(let ci=1;ci<kt.length;ci++)Mr.x=Math.min(Mr.x,kt[ci].x),Mr.y=Math.min(Mr.y,kt[ci].y),Qr.x=Math.max(Qr.x,kt[ci].x),Qr.y=Math.max(Qr.y,kt[ci].y);Nt=Mr.x>=$e.x&&Qr.x<=Ze.x&&Mr.y>=$e.y&&Qr.y<=Ze.y?[kt]:Qr.x<$e.x||Mr.x>Ze.x||Qr.y<$e.y||Mr.y>Ze.y?[]:l.aJ([kt],$e.x,$e.y,Ze.x,Ze.y)}for(const Mr of Nt){We.reset(Mr,.25*Me);let Qr=0;Qr=We.length<=.5*Me?1:Math.ceil(We.paddedLength/yt)+1;for(let ci=0;ci<Qr;ci++){const ri=ci/Math.max(Qr-1,1),pi=We.lerp(ri),ii=pi.x+wi,Ci=pi.y+wi;W.push(ii,Ci,Me,0);const fi=ii-Me,ji=Ci-Me,Di=ii+Me,Ai=Ci+Me;if(le=le&&this.isOffscreen(fi,ji,Di,Ai),ve=ve||this.isInsideGrid(fi,ji,Di,Ai),t!=="always"&&this.grid.hitTestCircle(ii,Ci,Me,t,P)&&(he=!0,!x))return{circles:[],offscreen:!1,collisionDetected:he}}}}return{circles:!x&&he||!ve||X<this.perspectiveRatioCutoff?[]:W,offscreen:le,collisionDetected:he}}projectPathToScreenSpace(t,n){const a=(function(c,p){const m=l.N();return l.aB(m,p.pitchedLabelPlaneMatrix),c.map((v=>{const x=mr(v.x,v.y,m,p.getElevation),T=p.transform.projectTileCoordinates(x.point.x,x.point.y,p.unwrappedTileID,p.getElevation);return T.point.x=(.5*T.point.x+.5)*p.width,T.point.y=(.5*-T.point.y+.5)*p.height,T}))})(t,n);return(function(c){let p=0,m=0,v=0,x=0;for(let T=0;T<c.length;T++)c[T].isOccluded?(v=T+1,x=0):(x++,x>m&&(m=x,p=v));return c.slice(p,p+m)})(a)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[],a=new l.aa;for(const k of t){const A=new l.P(k.x+wi,k.y+wi);a.extend(A),n.push(A)}const{minX:c,minY:p,maxX:m,maxY:v}=a,x=this.grid.query(c,p,m,v).concat(this.ignoredGrid.query(c,p,m,v)),T={},P={};for(const k of x){const A=k.key;if(T[A.bucketInstanceId]===void 0&&(T[A.bucketInstanceId]={}),T[A.bucketInstanceId][A.featureIndex])continue;const L=[new l.P(k.x1,k.y1),new l.P(k.x2,k.y1),new l.P(k.x2,k.y2),new l.P(k.x1,k.y2)];l.aK(n,L)&&(T[A.bucketInstanceId][A.featureIndex]=!0,P[A.bucketInstanceId]===void 0&&(P[A.bucketInstanceId]=[]),P[A.bucketInstanceId].push(A.featureIndex))}return P}insertCollisionBox(t,n,a,c,p,m){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:p,collisionGroupID:m,overlapMode:n},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,n,a,c,p,m){const v=a?this.ignoredGrid:this.grid,x={bucketInstanceId:c,featureIndex:p,collisionGroupID:m,overlapMode:n};for(let T=0;T<t.length;T+=4)v.insertCircle(x,t[T],t[T+1],t[T+2])}projectAndGetPerspectiveRatio(t,n,a,c,p){if(p){let m;c?(m=[t,n,c(t,n),1],l.aH(m,m,p)):(m=[t,n,0,1],Bs(m,m,p));const v=m[3];return{x:(m[0]/v+1)/2*this.transform.width+wi,y:(-m[1]/v+1)/2*this.transform.height+wi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/v*.5,isOccluded:!1,signedDistanceFromCamera:v}}{const m=this.transform.projectTileCoordinates(t,n,a,c);return{x:(m.point.x+1)/2*this.transform.width+wi,y:(1-m.point.y)/2*this.transform.height+wi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/m.signedDistanceFromCamera*.5,isOccluded:m.isOccluded,signedDistanceFromCamera:m.signedDistanceFromCamera}}}getPerspectiveRatio(t,n,a,c){const p=this.transform.projectTileCoordinates(t,n,a,c);return .5+this.transform.cameraToCenterDistance/p.signedDistanceFromCamera*.5}isOffscreen(t,n,a,c){return a<wi||t>=this.screenRightBoundary||c<wi||n>this.screenBottomBoundary}isInsideGrid(t,n,a,c){return a>=0&&t<this.gridRightBoundary&&c>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const t=l.ar([]);return l.O(t,t,[-100,-100,0]),t}_projectCollisionBox(t,n,a,c,p,m,v,x,T,P,k){let A=1,L=0,N=0,W=1;const Y=t.anchorPointX+v[0],X=t.anchorPointY+v[1];if(m&&!p){const kt=this.projectAndGetPerspectiveRatio(Y+1,X,c,T,k),yt=kt.x-x.x,Nt=Math.atan((kt.y-x.y)/yt)+(yt<0?Math.PI:0),Mr=Math.sin(Nt),Qr=Math.cos(Nt);A=Qr,L=Mr,N=-Mr,W=Qr}else if(!m&&p){const kt=zi(this.transform);A=kt.vecEast[0],L=kt.vecEast[1],N=kt.vecSouth[0],W=kt.vecSouth[1]}let te=x.x,fe=x.y,$=n;p&&(te=Y,fe=X,$=Math.pow(2,-(this.transform.zoom-a.overscaledZ)),$*=this.transform.getPitchedTextCorrection(Y,X,c),P||($*=l.an(.5+x.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),P&&(te+=A*P.x*$+N*P.y*$,fe+=L*P.x*$+W*P.y*$);const he=t.x1*$,ve=t.x2*$,le=(he+ve)/2,Me=t.y1*$,$e=t.y2*$,Ze=(Me+$e)/2,We=[{offsetX:he,offsetY:Me},{offsetX:le,offsetY:Me},{offsetX:ve,offsetY:Me},{offsetX:ve,offsetY:Ze},{offsetX:ve,offsetY:$e},{offsetX:le,offsetY:$e},{offsetX:he,offsetY:$e},{offsetX:he,offsetY:Ze}];let Ye=[];for(const{offsetX:kt,offsetY:yt}of We)Ye.push(new l.P(te+A*kt+N*yt,fe+L*kt+W*yt));let At=!1;if(p){const kt=Ye.map((yt=>this.projectAndGetPerspectiveRatio(yt.x,yt.y,c,T,k)));At=kt.some((yt=>!yt.isOccluded)),Ye=kt.map((yt=>new l.P(yt.x,yt.y)))}else At=!0;return{box:l.aL(Ye),allPointsOccluded:!At}}}class wu{constructor(t,n,a,c){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):c&&a?1:0,this.placed=a}isHidden(){return this.opacity===0&&!this.placed}}class Ha{constructor(t,n,a,c,p){this.text=new wu(t?t.text:null,n,a,p),this.icon=new wu(t?t.icon:null,n,c,p)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Tu{constructor(t,n,a){this.text=t,this.icon=n,this.skipFade=a}}class Cu{constructor(t,n,a,c,p){this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=a,this.bucketIndex=c,this.tileID=p}}class Su{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const n=++this.maxGroupID;this.collisionGroups[t]={ID:n,predicate:a=>a.collisionGroupID===n}}return this.collisionGroups[t]}}function Ns(d,t,n,a,c){const{horizontalAlign:p,verticalAlign:m}=l.aS(d);return new l.P(-(p-.5)*t+a[0]*c,-(m-.5)*n+a[1]*c)}class Kl{constructor(t,n,a,c,p){this.transform=t.clone(),this.terrain=n,this.collisionIndex=new bu(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new Su(c),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=p,p&&(p.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const n=this.terrain;return n?(a,c)=>n.getElevation(t,a,c):null}getBucketParts(t,n,a,c){const p=a.getBucket(n),m=a.latestFeatureIndex;if(!p||!m||n.id!==p.layerIds[0])return;const v=a.collisionBoxArray,x=p.layers[0].layout,T=p.layers[0].paint,P=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),k=a.tileSize/l.a5,A=a.tileID.toUnwrapped(),L=x.get("text-rotation-alignment")==="map",N=l.aN(a,1,this.transform.zoom),W=l.aO(this.collisionIndex.transform,a,T.get("text-translate"),T.get("text-translate-anchor")),Y=l.aO(this.collisionIndex.transform,a,T.get("icon-translate"),T.get("icon-translate-anchor")),X=oi(L,this.transform,N);this.retainedQueryData[p.bucketInstanceId]=new Cu(p.bucketInstanceId,m,p.sourceLayerIndex,p.index,a.tileID);const te={bucket:p,layout:x,translationText:W,translationIcon:Y,unwrappedTileID:A,pitchedLabelPlaneMatrix:X,scale:P,textPixelRatio:k,holdingForFade:a.holdingForSymbolFade(),collisionBoxArray:v,partiallyEvaluatedTextSize:l.ay(p.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(p.sourceID)};if(c)for(const fe of p.sortKeyRanges){const{sortKey:$,symbolInstanceStart:he,symbolInstanceEnd:ve}=fe;t.push({sortKey:$,symbolInstanceStart:he,symbolInstanceEnd:ve,parameters:te})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:p.symbolInstances.length,parameters:te})}attemptAnchorPlacement(t,n,a,c,p,m,v,x,T,P,k,A,L,N,W,Y,X,te,fe,$){const he=l.aP[t.textAnchor],ve=[t.textOffset0,t.textOffset1],le=Ns(he,a,c,ve,p),Me=this.collisionIndex.placeCollisionBox(n,A,x,T,P,v,m,Y,k.predicate,fe,le,$);if((!te||this.collisionIndex.placeCollisionBox(te,A,x,T,P,v,m,X,k.predicate,fe,le,$).placeable)&&Me.placeable){let $e;if(this.prevPlacement&&this.prevPlacement.variableOffsets[L.crossTileID]&&this.prevPlacement.placements[L.crossTileID]&&this.prevPlacement.placements[L.crossTileID].text&&($e=this.prevPlacement.variableOffsets[L.crossTileID].anchor),L.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[L.crossTileID]={textOffset:ve,width:a,height:c,anchor:he,textBoxScale:p,prevAnchor:$e},this.markUsedJustification(N,he,L,W),N.allowVerticalPlacement&&(this.markUsedOrientation(N,W,L),this.placedOrientations[L.crossTileID]=W),{shift:le,placedGlyphBoxes:Me}}}placeLayerBucketPart(t,n,a){const{bucket:c,layout:p,translationText:m,translationIcon:v,unwrappedTileID:x,pitchedLabelPlaneMatrix:T,textPixelRatio:P,holdingForFade:k,collisionBoxArray:A,partiallyEvaluatedTextSize:L,collisionGroup:N}=t.parameters,W=p.get("text-optional"),Y=p.get("icon-optional"),X=l.aQ(p,"text-overlap","text-allow-overlap"),te=X==="always",fe=l.aQ(p,"icon-overlap","icon-allow-overlap"),$=fe==="always",he=p.get("text-rotation-alignment")==="map",ve=p.get("text-pitch-alignment")==="map",le=p.get("icon-text-fit")!=="none",Me=p.get("symbol-z-order")==="viewport-y",$e=te&&($||!c.hasIconData()||Y),Ze=$&&(te||!c.hasTextData()||W);!c.collisionArrays&&A&&c.deserializeCollisionBoxes(A);const We=this.retainedQueryData[c.bucketInstanceId].tileID,Ye=this._getTerrainElevationFunc(We),At=this.transform.getFastPathSimpleProjectionMatrix(We),kt=(yt,Nt,Mr)=>{var Qr,ci;if(n[yt.crossTileID])return;if(k)return void(this.placements[yt.crossTileID]=new Tu(!1,!1,!1));let ri=!1,pi=!1,ii=!0,Ci=null,fi={box:null,placeable:!1,offscreen:null,occluded:!1},ji={placeable:!1},Di=null,Ai=null,Yi=null,To=0,ro=0,Kn=0;Nt.textFeatureIndex?To=Nt.textFeatureIndex:yt.useRuntimeCollisionCircles&&(To=yt.featureIndex),Nt.verticalTextFeatureIndex&&(ro=Nt.verticalTextFeatureIndex);const fn=Nt.textBox;if(fn){const kn=ai=>{let ni=l.az.horizontal;if(c.allowVerticalPlacement&&!ai&&this.prevPlacement){const Bi=this.prevPlacement.placedOrientations[yt.crossTileID];Bi&&(this.placedOrientations[yt.crossTileID]=Bi,ni=Bi,this.markUsedOrientation(c,ni,yt))}return ni},Qn=(ai,ni)=>{if(c.allowVerticalPlacement&&yt.numVerticalGlyphVertices>0&&Nt.verticalTextBox){for(const Bi of c.writingModes)if(Bi===l.az.vertical?(fi=ni(),ji=fi):fi=ai(),fi&&fi.placeable)break}else fi=ai()},jn=yt.textAnchorOffsetStartIndex,Un=yt.textAnchorOffsetEndIndex;if(Un===jn){const ai=(ni,Bi)=>{const Ni=this.collisionIndex.placeCollisionBox(ni,X,P,We,x,ve,he,m,N.predicate,Ye,void 0,At);return Ni&&Ni.placeable&&(this.markUsedOrientation(c,Bi,yt),this.placedOrientations[yt.crossTileID]=Bi),Ni};Qn((()=>ai(fn,l.az.horizontal)),(()=>{const ni=Nt.verticalTextBox;return c.allowVerticalPlacement&&yt.numVerticalGlyphVertices>0&&ni?ai(ni,l.az.vertical):{box:null,offscreen:null}})),kn(fi&&fi.placeable)}else{let ai=l.aP[(ci=(Qr=this.prevPlacement)===null||Qr===void 0?void 0:Qr.variableOffsets[yt.crossTileID])===null||ci===void 0?void 0:ci.anchor];const ni=(Ni,xh,bh)=>{const Yo=Ni.x2-Ni.x1,Dd=Ni.y2-Ni.y1,wh=yt.textBoxScale,qc=le&&fe==="never"?xh:null;let Co=null,So=X==="never"?1:2,Po="never";ai&&So++;for(let Zc=0;Zc<So;Zc++){for(let Hc=jn;Hc<Un;Hc++){const wl=c.textAnchorOffsets.get(Hc);if(ai&&wl.textAnchor!==ai)continue;const Tl=this.attemptAnchorPlacement(wl,Ni,Yo,Dd,wh,he,ve,P,We,x,N,Po,yt,c,bh,m,v,qc,Ye);if(Tl&&(Co=Tl.placedGlyphBoxes,Co&&Co.placeable))return ri=!0,Ci=Tl.shift,Co}ai?ai=null:Po=X}return a&&!Co&&(Co={box:this.collisionIndex.placeCollisionBox(fn,"always",P,We,x,ve,he,m,N.predicate,Ye,void 0,At).box,offscreen:!1,placeable:!1,occluded:!1}),Co};Qn((()=>ni(fn,Nt.iconBox,l.az.horizontal)),(()=>{const Ni=Nt.verticalTextBox;return c.allowVerticalPlacement&&(!fi||!fi.placeable)&&yt.numVerticalGlyphVertices>0&&Ni?ni(Ni,Nt.verticalIconBox,l.az.vertical):{box:null,occluded:!0,offscreen:null}})),fi&&(ri=fi.placeable,ii=fi.offscreen);const Bi=kn(fi&&fi.placeable);if(!ri&&this.prevPlacement){const Ni=this.prevPlacement.variableOffsets[yt.crossTileID];Ni&&(this.variableOffsets[yt.crossTileID]=Ni,this.markUsedJustification(c,Ni.anchor,yt,Bi))}}}if(Di=fi,ri=Di&&Di.placeable,ii=Di&&Di.offscreen,yt.useRuntimeCollisionCircles&&yt.centerJustifiedTextSymbolIndex>=0){const kn=c.text.placedSymbolArray.get(yt.centerJustifiedTextSymbolIndex),Qn=l.aA(c.textSizeData,L,kn),jn=p.get("text-padding");Ai=this.collisionIndex.placeCollisionCircles(X,kn,c.lineVertexArray,c.glyphOffsetArray,Qn,x,T,a,ve,N.predicate,yt.collisionCircleDiameter,jn,m,Ye),Ai.circles.length&&Ai.collisionDetected&&!a&&l.w("Collisions detected, but collision boxes are not shown"),ri=te||Ai.circles.length>0&&!Ai.collisionDetected,ii=ii&&Ai.offscreen}if(Nt.iconFeatureIndex&&(Kn=Nt.iconFeatureIndex),Nt.iconBox){const kn=Qn=>this.collisionIndex.placeCollisionBox(Qn,fe,P,We,x,ve,he,v,N.predicate,Ye,le&&Ci?Ci:void 0,At);ji&&ji.placeable&&Nt.verticalIconBox?(Yi=kn(Nt.verticalIconBox),pi=Yi.placeable):(Yi=kn(Nt.iconBox),pi=Yi.placeable),ii=ii&&Yi.offscreen}const Wo=W||yt.numHorizontalGlyphVertices===0&&yt.numVerticalGlyphVertices===0,Ps=Y||yt.numIconVertices===0;Wo||Ps?Ps?Wo||(pi=pi&&ri):ri=pi&&ri:pi=ri=pi&&ri;const Xo=pi&&Yi.placeable;if(ri&&Di.placeable&&this.collisionIndex.insertCollisionBox(Di.box,X,p.get("text-ignore-placement"),c.bucketInstanceId,ji&&ji.placeable&&ro?ro:To,N.ID),Xo&&this.collisionIndex.insertCollisionBox(Yi.box,fe,p.get("icon-ignore-placement"),c.bucketInstanceId,Kn,N.ID),Ai&&ri&&this.collisionIndex.insertCollisionCircles(Ai.circles,X,p.get("text-ignore-placement"),c.bucketInstanceId,To,N.ID),a&&this.storeCollisionData(c.bucketInstanceId,Mr,Nt,Di,Yi,Ai),yt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(c.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[yt.crossTileID]=new Tu((ri||$e)&&!Di?.occluded,(pi||Ze)&&!Yi?.occluded,ii||c.justReloaded),n[yt.crossTileID]=!0};if(Me){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const yt=c.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Nt=yt.length-1;Nt>=0;--Nt){const Mr=yt[Nt];kt(c.symbolInstances.get(Mr),c.collisionArrays[Mr],Mr)}}else for(let yt=t.symbolInstanceStart;yt<t.symbolInstanceEnd;yt++)kt(c.symbolInstances.get(yt),c.collisionArrays[yt],yt);c.justReloaded=!1}storeCollisionData(t,n,a,c,p,m){if(a.textBox||a.iconBox){let v,x;this.collisionBoxArrays.has(t)?v=this.collisionBoxArrays.get(t):(v=new Map,this.collisionBoxArrays.set(t,v)),v.has(n)?x=v.get(n):(x={text:null,icon:null},v.set(n,x)),a.textBox&&(x.text=c.box),a.iconBox&&(x.icon=p.box)}if(m){let v=this.collisionCircleArrays[t];v===void 0&&(v=this.collisionCircleArrays[t]=[]);for(let x=0;x<m.circles.length;x+=4)v.push(m.circles[x+0]-wi),v.push(m.circles[x+1]-wi),v.push(m.circles[x+2]),v.push(m.collisionDetected?1:0)}}markUsedJustification(t,n,a,c){let p;p=c===l.az.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[l.aR(n)];const m=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];for(const v of m)v>=0&&(t.text.placedSymbolArray.get(v).crossTileID=p>=0&&v!==p?0:a.crossTileID)}markUsedOrientation(t,n,a){const c=n===l.az.horizontal||n===l.az.horizontalOnly?n:0,p=n===l.az.vertical?n:0,m=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];for(const v of m)t.text.placedSymbolArray.get(v).placedOrientation=c;a.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=p)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let a=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const c=n?n.symbolFadeChange(t):1,p=n?n.opacities:{},m=n?n.variableOffsets:{},v=n?n.placedOrientations:{};for(const x in this.placements){const T=this.placements[x],P=p[x];P?(this.opacities[x]=new Ha(P,c,T.text,T.icon),a=a||T.text!==P.text.placed||T.icon!==P.icon.placed):(this.opacities[x]=new Ha(null,c,T.text,T.icon,T.skipFade),a=a||T.text||T.icon)}for(const x in p){const T=p[x];if(!this.opacities[x]){const P=new Ha(T,c,!1,!1);P.isHidden()||(this.opacities[x]=P,a=a||T.text.placed||T.icon.placed)}}for(const x in m)this.variableOffsets[x]||!this.opacities[x]||this.opacities[x].isHidden()||(this.variableOffsets[x]=m[x]);for(const x in v)this.placedOrientations[x]||!this.opacities[x]||this.opacities[x].isHidden()||(this.placedOrientations[x]=v[x]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");a?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:t)}updateLayerOpacities(t,n){const a={};for(const c of n){const p=c.getBucket(t);p&&c.latestFeatureIndex&&t.id===p.layerIds[0]&&this.updateBucketOpacities(p,c.tileID,a,c.collisionBoxArray)}}updateBucketOpacities(t,n,a,c){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const p=t.layers[0],m=p.layout,v=new Ha(null,0,!1,!1,!0),x=m.get("text-allow-overlap"),T=m.get("icon-allow-overlap"),P=p._unevaluatedLayout.hasValue("text-variable-anchor")||p._unevaluatedLayout.hasValue("text-variable-anchor-offset"),k=m.get("text-rotation-alignment")==="map",A=m.get("text-pitch-alignment")==="map",L=m.get("icon-text-fit")!=="none",N=new Ha(null,0,x&&(T||!t.hasIconData()||m.get("icon-optional")),T&&(x||!t.hasTextData()||m.get("text-optional")),!0);!t.collisionArrays&&c&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(c);const W=(X,te,fe)=>{for(let $=0;$<te/4;$++)X.opacityVertexArray.emplaceBack(fe);X.hasVisibleVertices=X.hasVisibleVertices||fe!==Xa},Y=this.collisionBoxArrays.get(t.bucketInstanceId);for(let X=0;X<t.symbolInstances.length;X++){const te=t.symbolInstances.get(X),{numHorizontalGlyphVertices:fe,numVerticalGlyphVertices:$,crossTileID:he}=te;let ve=this.opacities[he];a[he]?ve=v:ve||(ve=N,this.opacities[he]=ve),a[he]=!0;const le=te.numIconVertices>0,Me=this.placedOrientations[te.crossTileID],$e=Me===l.az.vertical,Ze=Me===l.az.horizontal||Me===l.az.horizontalOnly;if(fe>0||$>0){const Ye=ec(ve.text);W(t.text,fe,$e?Xa:Ye),W(t.text,$,Ze?Xa:Ye);const At=ve.text.isHidden();[te.rightJustifiedTextSymbolIndex,te.centerJustifiedTextSymbolIndex,te.leftJustifiedTextSymbolIndex].forEach((Nt=>{Nt>=0&&(t.text.placedSymbolArray.get(Nt).hidden=At||$e?1:0)})),te.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(te.verticalPlacedTextSymbolIndex).hidden=At||Ze?1:0);const kt=this.variableOffsets[te.crossTileID];kt&&this.markUsedJustification(t,kt.anchor,te,Me);const yt=this.placedOrientations[te.crossTileID];yt&&(this.markUsedJustification(t,"left",te,yt),this.markUsedOrientation(t,yt,te))}if(le){const Ye=ec(ve.icon),At=!(L&&te.verticalPlacedIconSymbolIndex&&$e);te.placedIconSymbolIndex>=0&&(W(t.icon,te.numIconVertices,At?Ye:Xa),t.icon.placedSymbolArray.get(te.placedIconSymbolIndex).hidden=ve.icon.isHidden()),te.verticalPlacedIconSymbolIndex>=0&&(W(t.icon,te.numVerticalIconVertices,At?Xa:Ye),t.icon.placedSymbolArray.get(te.verticalPlacedIconSymbolIndex).hidden=ve.icon.isHidden())}const We=Y&&Y.has(X)?Y.get(X):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ye=t.collisionArrays[X];if(Ye){let At=new l.P(0,0);if(Ye.textBox||Ye.verticalTextBox){let kt=!0;if(P){const yt=this.variableOffsets[he];yt?(At=Ns(yt.anchor,yt.width,yt.height,yt.textOffset,yt.textBoxScale),k&&At._rotate(A?-this.transform.bearingInRadians:this.transform.bearingInRadians)):kt=!1}if(Ye.textBox||Ye.verticalTextBox){let yt;Ye.textBox&&(yt=$e),Ye.verticalTextBox&&(yt=Ze),Ql(t.textCollisionBox.collisionVertexArray,ve.text.placed,!kt||yt,We.text,At.x,At.y)}}if(Ye.iconBox||Ye.verticalIconBox){const kt=!!(!Ze&&Ye.verticalIconBox);let yt;Ye.iconBox&&(yt=kt),Ye.verticalIconBox&&(yt=!kt),Ql(t.iconCollisionBox.collisionVertexArray,ve.icon.placed,yt,We.icon,L?At.x:0,L?At.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,n){const a=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*a>t}setStale(){this.stale=!0}}function Ql(d,t,n,a,c,p){a&&a.length!==0||(a=[0,0,0,0]);const m=a[0]-wi,v=a[1]-wi,x=a[2]-wi,T=a[3]-wi;d.emplaceBack(t?1:0,n?1:0,c||0,p||0,m,v),d.emplaceBack(t?1:0,n?1:0,c||0,p||0,x,v),d.emplaceBack(t?1:0,n?1:0,c||0,p||0,x,T),d.emplaceBack(t?1:0,n?1:0,c||0,p||0,m,T)}const Jl=Math.pow(2,25),$l=Math.pow(2,24),ld=Math.pow(2,17),Wa=Math.pow(2,16),Vs=Math.pow(2,9),Pu=Math.pow(2,8),sa=Math.pow(2,1);function ec(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const t=d.placed?1:0,n=Math.floor(127*d.opacity);return n*Jl+t*$l+n*ld+t*Wa+n*Vs+t*Pu+n*sa+t}const Xa=0;class fo{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,n,a,c,p){const m=this._bucketParts;for(;this._currentTileIndex<t.length;)if(n.getBucketParts(m,c,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,p())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,m.sort(((v,x)=>v.sortKey-x.sortKey)));this._currentPartIndex<m.length;)if(n.placeLayerBucketPart(m[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,p())return!0;return!1}}class la{constructor(t,n,a,c,p,m,v,x){this.placement=new Kl(t,n,m,v,x),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(t,n,a){const c=Ee(),p=()=>!this._forceFullPlacement&&Ee()-c>2;for(;this._currentPlacementIndex>=0;){const m=n[t[this._currentPlacementIndex]],v=this.placement.collisionIndex.transform.zoom;if(m.type==="symbol"&&(!m.minzoom||m.minzoom<=v)&&(!m.maxzoom||m.maxzoom>v)){if(this._inProgressLayer||(this._inProgressLayer=new fo(m)),this._inProgressLayer.continuePlacement(a[m.source],this.placement,this._showCollisionBoxes,m,p))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Lr=512/l.a5/2;class tc{constructor(t,n,a){this.tileID=t,this.bucketInstanceId=a,this._symbolsByKey={};const c=new Map;for(let p=0;p<n.length;p++){const m=n.get(p),v=m.key,x=c.get(v);x?x.push(m):c.set(v,[m])}for(const[p,m]of c){const v={positions:m.map((x=>({x:Math.floor(x.anchorX*Lr),y:Math.floor(x.anchorY*Lr)}))),crossTileIDs:m.map((x=>x.crossTileID))};if(v.positions.length>128){const x=new l.aT(v.positions.length,16,Uint16Array);for(const{x:T,y:P}of v.positions)x.add(T,P);x.finish(),delete v.positions,v.index=x}this._symbolsByKey[p]=v}}getScaledCoordinates(t,n){const{x:a,y:c,z:p}=this.tileID.canonical,{x:m,y:v,z:x}=n.canonical,T=Lr/Math.pow(2,x-p),P=(v*l.a5+t.anchorY)*T,k=c*l.a5*Lr;return{x:Math.floor((m*l.a5+t.anchorX)*T-a*l.a5*Lr),y:Math.floor(P-k)}}findMatches(t,n,a){const c=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let p=0;p<t.length;p++){const m=t.get(p);if(m.crossTileID)continue;const v=this._symbolsByKey[m.key];if(!v)continue;const x=this.getScaledCoordinates(m,n);if(v.index){const T=v.index.range(x.x-c,x.y-c,x.x+c,x.y+c).sort();for(const P of T){const k=v.crossTileIDs[P];if(!a[k]){a[k]=!0,m.crossTileID=k;break}}}else if(v.positions)for(let T=0;T<v.positions.length;T++){const P=v.positions[T],k=v.crossTileIDs[T];if(Math.abs(P.x-x.x)<=c&&Math.abs(P.y-x.y)<=c&&!a[k]){a[k]=!0,m.crossTileID=k;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:t})=>t))}}class cd{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class rc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const n=Math.round((t-this.lng)/360);if(n!==0)for(const a in this.indexes){const c=this.indexes[a],p={};for(const m in c){const v=c[m];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+n),p[v.tileID.key]=v}this.indexes[a]=p}this.lng=t}addBucket(t,n,a){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let p=0;p<n.symbolInstances.length;p++)n.symbolInstances.get(p).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const c=this.usedCrossTileIDs[t.overscaledZ];for(const p in this.indexes){const m=this.indexes[p];if(Number(p)>t.overscaledZ)for(const v in m){const x=m[v];x.tileID.isChildOf(t)&&x.findMatches(n.symbolInstances,t,c)}else{const v=m[t.scaledTo(Number(p)).key];v&&v.findMatches(n.symbolInstances,t,c)}}for(let p=0;p<n.symbolInstances.length;p++){const m=n.symbolInstances.get(p);m.crossTileID||(m.crossTileID=a.generate(),c[m.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new tc(t,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(t,n){for(const a of n.getCrossTileIDsLists())for(const c of a)delete this.usedCrossTileIDs[t][c]}removeStaleBuckets(t){let n=!1;for(const a in this.indexes){const c=this.indexes[a];for(const p in c)t[c[p].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,c[p]),delete c[p],n=!0)}return n}}class dn{constructor(){this.layerIndexes={},this.crossTileIDs=new cd,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,n,a){let c=this.layerIndexes[t.id];c===void 0&&(c=this.layerIndexes[t.id]=new rc);let p=!1;const m={};c.handleWrapJump(a);for(const v of n){const x=v.getBucket(t);x&&t.id===x.layerIds[0]&&(x.bucketInstanceId||(x.bucketInstanceId=++this.maxBucketInstanceId),c.addBucket(v.tileID,x,this.crossTileIDs)&&(p=!0),m[x.bucketInstanceId]=!0)}return c.removeStaleBuckets(m)&&(p=!0),p}pruneUnusedLayers(t){const n={};t.forEach((a=>{n[a]=!0}));for(const a in this.layerIndexes)n[a]||delete this.layerIndexes[a]}}var en="void main() {fragColor=vec4(1.0);}";const yi={prelude:gr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:gr("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:gr("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:gr(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:gr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:gr(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:gr(en,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:gr(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:gr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:gr("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:gr("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:gr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:gr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:gr(en,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:gr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:gr(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:gr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:gr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:gr(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:gr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:gr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:gr(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:gr(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:gr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:gr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:gr(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:gr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:gr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:gr(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:gr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:gr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:gr("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:gr("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:gr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:gr("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:gr(`#ifdef GL_ES
precision highp float;
#endif
in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:gr("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function gr(d,t){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,a=t.match(/in ([\w]+) ([\w]+)/g),c=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),p=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),m=p?p.concat(c):c,v={};return{fragmentSource:d=d.replace(n,((x,T,P,k,A)=>(v[A]=!0,T==="define"?`
#ifndef HAS_UNIFORM_u_${A}
in ${P} ${k} ${A};
#else
uniform ${P} ${k} u_${A};
#endif
`:`
#ifdef HAS_UNIFORM_u_${A}
    ${P} ${k} ${A} = u_${A};
#endif
`))),vertexSource:t=t.replace(n,((x,T,P,k,A)=>{const L=k==="float"?"vec2":"vec4",N=A.match(/color/)?"color":L;return v[A]?T==="define"?`
#ifndef HAS_UNIFORM_u_${A}
uniform lowp float u_${A}_t;
in ${P} ${L} a_${A};
out ${P} ${k} ${A};
#else
uniform ${P} ${k} u_${A};
#endif
`:N==="vec4"?`
#ifndef HAS_UNIFORM_u_${A}
    ${A} = a_${A};
#else
    ${P} ${k} ${A} = u_${A};
#endif
`:`
#ifndef HAS_UNIFORM_u_${A}
    ${A} = unpack_mix_${N}(a_${A}, u_${A}_t);
#else
    ${P} ${k} ${A} = u_${A};
#endif
`:T==="define"?`
#ifndef HAS_UNIFORM_u_${A}
uniform lowp float u_${A}_t;
in ${P} ${L} a_${A};
#else
uniform ${P} ${k} u_${A};
#endif
`:N==="vec4"?`
#ifndef HAS_UNIFORM_u_${A}
    ${P} ${k} ${A} = a_${A};
#else
    ${P} ${k} ${A} = u_${A};
#endif
`:`
#ifndef HAS_UNIFORM_u_${A}
    ${P} ${k} ${A} = unpack_mix_${N}(a_${A}, u_${A}_t);
#else
    ${P} ${k} ${A} = u_${A};
#endif
`})),staticAttributes:a,staticUniforms:m}}class ei{constructor(t,n,a){this.vertexBuffer=t,this.indexBuffer=n,this.segments=a}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var mo=l.aU([{name:"a_pos",type:"Int16",components:2}]);const sn="#define PROJECTION_MERCATOR",xn="mercator";class ln{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return xn}get shaderDefine(){return sn}get shaderPreludeCode(){return yi.projectionMercator}get vertexShaderPreludeCode(){return yi.projectionMercator.vertexSource}get subdivisionGranularity(){return l.aV.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,n,a,c,p){if(this._cachedMesh)return this._cachedMesh;const m=new l.aW;m.emplaceBack(0,0),m.emplaceBack(l.a5,0),m.emplaceBack(0,l.a5),m.emplaceBack(l.a5,l.a5);const v=t.createVertexBuffer(m,mo.members),x=l.aX.simpleSegment(0,0,4,2),T=new l.aY;T.emplaceBack(1,0,2),T.emplaceBack(1,2,3);const P=t.createIndexBuffer(T);return this._cachedMesh=new ei(v,P,x),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class ca{constructor(t=0,n=0,a=0,c=0){if(isNaN(t)||t<0||isNaN(n)||n<0||isNaN(a)||a<0||isNaN(c)||c<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=a,this.right=c}interpolate(t,n,a){return n.top!=null&&t.top!=null&&(this.top=l.G.number(t.top,n.top,a)),n.bottom!=null&&t.bottom!=null&&(this.bottom=l.G.number(t.bottom,n.bottom,a)),n.left!=null&&t.left!=null&&(this.left=l.G.number(t.left,n.left,a)),n.right!=null&&t.right!=null&&(this.right=l.G.number(t.right,n.right,a)),this}getCenter(t,n){const a=l.an((this.left+t-this.right)/2,0,t),c=l.an((this.top+n-this.bottom)/2,0,n);return new l.P(a,c)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ca(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function go(d,t){if(!d.renderWorldCopies||d.lngRange)return;const n=t.lng-d.center.lng;t.lng+=n>180?-360:n<-180?360:0}function Ii(d){return Math.max(0,Math.floor(d))}class zo{constructor(t,n){var a;this.applyConstrain=(c,p)=>this._constrainOverride!==null?this._constrainOverride(c,p):this._callbacks.defaultConstrain(c,p),this._callbacks=t,this._tileSize=512,this._renderWorldCopies=n?.renderWorldCopies===void 0||!!n?.renderWorldCopies,this._minZoom=n?.minZoom||0,this._maxZoom=n?.maxZoom||22,this._minPitch=n?.minPitch==null?0:n?.minPitch,this._maxPitch=n?.maxPitch==null?60:n?.maxPitch,this._constrainOverride=(a=n?.constrainOverride)!==null&&a!==void 0?a:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new l.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Ii(this._zoom),this._scale=l.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new ca,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,n,a){this._constrainOverride=t.constrainOverride,this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=Ii(this._zoom),this._scale=l.aq(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new ca(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!a&&t.autoCalculateNearFarZ,n&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get constrainOverride(){return this._constrainOverride}setConstrainOverride(t){t===void 0&&(t=null),this._constrainOverride!==t&&(this._constrainOverride=t,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const n=l.W(t,-180,180)*Math.PI/180;var a,c,p,m,v,x,T,P,k;this._bearingInRadians!==n&&(this._unmodified=!1,this._bearingInRadians=n,this._calcMatrices(),this._rotationMatrix=xe(),a=this._rotationMatrix,p=-this._bearingInRadians,m=(c=this._rotationMatrix)[0],v=c[1],x=c[2],T=c[3],P=Math.sin(p),k=Math.cos(p),a[0]=m*k+x*P,a[1]=v*k+T*P,a[2]=m*-P+x*k,a[3]=v*-P+T*k)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const n=l.an(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==n&&(this._unmodified=!1,this._pitchInRadians=n,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const n=t/180*Math.PI;this._rollInRadians!==n&&(this._unmodified=!1,this._rollInRadians=n,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return l.aZ(this._fovInRadians)}setFov(t){t=l.an(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=l.ap(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const n=this.applyConstrain(this._center,t).zoom;this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this._tileZoom=Math.max(0,Math.floor(n)),this._scale=l.aq(n),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,n){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=n,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,n,a){this._unmodified=!1,this._edgeInsets.interpolate(t,n,a),this.constrainInternal(),this._calcMatrices()}resize(t,n,a=!0){this._width=t,this._height=n,a&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Mt([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-l.ao,l.ao])}getCameraQueryGeometry(t,n){if(n.length===1)return[n[0],t];{const{minX:a,minY:c,maxX:p,maxY:m}=l.aa.fromPoints(n).extend(t);return[new l.P(a,c),new l.P(p,c),new l.P(p,m),new l.P(a,m),new l.P(a,c)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:n,zoom:a}=this.applyConstrain(this.center,this.zoom);this.setCenter(n),this.setZoom(a),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=l.ar(new Float64Array(16));l.Q(t,t,[this._width/2,-this._height/2,1]),l.O(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=l.ar(new Float64Array(16)),l.Q(t,t,[1,-1,1]),l.O(t,t,[-1,-1,0]),l.Q(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,n,a,c){const p=a!==void 0?a:this.bearing,m=c=c!==void 0?c:this.pitch,{distanceToCenter:v,clampedElevation:x}=this._distanceToCenterFromAltElevationPitch(n,this.elevation,m),{x:T,y:P}=Lt(m,p),k=l.a9.fromLngLat(t,n);let A,L,N=l.a_(1,k.y),W=0;do{if(W+=1,W>10)break;L=v/N,A=new l.a9(k.x+T*L,k.y+P*L),N=1/A.meterInMercatorCoordinateUnits()}while(Math.abs(v-L*N)>1e-12);return{center:A.toLngLat(),elevation:x,zoom:l.at(this.height/2/Math.tan(this.fovInRadians/2)/L/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const n=1/this.worldSize,a=l.as(1,this.center.lat)*this.worldSize,c=l.a9.fromLngLat(this.center,this.elevation),p=c.x/n,m=c.y/n,v=c.z/n,x=this.pitch,T=this.bearing,{x:P,y:k,z:A}=Lt(x,T),L=this.cameraToCenterDistance,N=p+L*-P,W=m+L*-k,Y=v+L*A,{distanceToCenter:X,clampedElevation:te}=this._distanceToCenterFromAltElevationPitch(Y/a,t,x),fe=X*a,$=new l.a9((N+P*fe)*n,(W+k*fe)*n,0).toLngLat(),he=l.as(1,$.lat),ve=l.at(this.height/2/Math.tan(this.fovInRadians/2)/X/he/this.tileSize);this._elevation=te,this._center=$,this.setZoom(ve)}_distanceToCenterFromAltElevationPitch(t,n,a){const c=-Math.cos(l.ap(a)),p=t-n;let m,v=n;return c*p>=0||Math.abs(c)<.1?(m=1e4,v=t+m*c):m=-p/c,{distanceToCenter:m,clampedElevation:v}}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=l.as(1,this.center.lat)*this.worldSize;return pe(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const n=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/n,t.canonical.y/n,1/n/l.a5,1/n/l.a5]}}class Xn{constructor(t,n){this.min=t,this.max=n,this.center=l.a$([],l.b0([],this.min,this.max),.5)}quadrant(t){const n=[t%2==0,t<2],a=l.b1(this.min),c=l.b1(this.max);for(let p=0;p<n.length;p++)a[p]=n[p]?this.min[p]:this.center[p],c[p]=n[p]?this.center[p]:this.max[p];return c[2]=this.max[2],new Xn(a,c)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let n=!0;for(let a=0;a<t.planes.length;a++){const c=this.intersectsPlane(t.planes[a]);if(c===0)return 0;c===1&&(n=!1)}return n?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let n=t[3],a=t[3];for(let c=0;c<3;c++)t[c]>0?(n+=t[c]*this.min[c],a+=t[c]*this.max[c]):(a+=t[c]*this.min[c],n+=t[c]*this.max[c]);return n>=0?2:a<0?0:1}}class js{distanceToTile2d(t,n,a,c){const p=c.distanceX([t,n]),m=c.distanceY([t,n]);return Math.hypot(p,m)}getWrap(t,n,a){return a}getTileBoundingVolume(t,n,a,c){var p,m;let v=0,x=0;if(c?.terrain){const P=new l.a2(t.z,n,t.z,t.x,t.y),k=c.terrain.getMinMaxElevation(P);v=(p=k.minElevation)!==null&&p!==void 0?p:Math.min(0,a),x=(m=k.maxElevation)!==null&&m!==void 0?m:Math.max(0,a)}const T=1<<t.z;return new Xn([n+t.x/T,t.y/T,v],[n+(t.x+1)/T,(t.y+1)/T,x])}allowVariableZoom(t,n){const a=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,c=l.an(78.5-a/2,0,60);return!!n.terrain||t.pitch>c}allowWorldCopies(){return!0}prepareNextFrame(){}}class pn{constructor(t,n,a){this.points=t,this.planes=n,this.aabb=a}static fromInvProjectionMatrix(t,n=1,a=0,c,p){const m=p?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],v=Math.pow(2,a),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((A=>(function(L,N,W,Y){const X=l.aH([],L,N),te=1/X[3]/W*Y;return l.b6(X,X,[te,te,1/X[3],te])})(A,t,n,v)));c&&(function(A,L,N,W){const Y=W?4:0,X=W?0:4;let te=0;const fe=[],$=[];for(let le=0;le<4;le++){const Me=l.b2([],A[le+X],A[le+Y]),$e=l.b7(Me);l.a$(Me,Me,1/$e),fe.push($e),$.push(Me)}for(let le=0;le<4;le++){const Me=l.b8(A[le+Y],$[le],N);te=Me!==null&&Me>=0?Math.max(te,Me):Math.max(te,fe[le])}const he=(function(le,Me){const $e=l.b2([],le[Me[0]],le[Me[1]]),Ze=l.b2([],le[Me[2]],le[Me[1]]),We=[0,0,0,0];return l.b3(We,l.b4([],$e,Ze)),We[3]=-l.b5(We,le[Me[0]]),We})(A,L),ve=(function(le,Me){const $e=l.b9(le),Ze=l.ba([],le,1/$e),We=l.b2([],Me,l.a$([],Ze,l.b5(Me,Ze))),Ye=l.b9(We);if(Ye>0){const At=Math.sqrt(1-Ze[3]*Ze[3]),kt=l.a$([],Ze,-Ze[3]),yt=l.b0([],kt,l.a$([],We,At/Ye));return l.bb(Me,yt)}return null})(N,he);if(ve!==null){const le=ve/l.b5($[0],he);te=Math.min(te,le)}for(let le=0;le<4;le++){const Me=Math.min(te,fe[le]);A[le+X]=[A[le+Y][0]+$[le][0]*Me,A[le+Y][1]+$[le][1]*Me,A[le+Y][2]+$[le][2]*Me,1]}})(x,m[0],c,p);const T=m.map((A=>{const L=l.b2([],x[A[0]],x[A[1]]),N=l.b2([],x[A[2]],x[A[1]]),W=l.b3([],l.b4([],L,N)),Y=-l.b5(W,x[A[1]]);return W.concat(Y)})),P=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],k=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const A of x)for(let L=0;L<3;L++)P[L]=Math.min(P[L],A[L]),k[L]=Math.max(k[L],A[L]);return new pn(x,T,new Xn(P,k))}}class Do{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,n,a){return this._helper.interpolatePadding(t,n,a)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,n,a=!0){this._helper.resize(t,n,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,n){this._helper.overrideNearFarZ(t,n)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,n){}constructor(t){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(n,a)=>{a=l.an(+a,this.minZoom,this.maxZoom);const c={center:new l.V(n.lng,n.lat),zoom:a};let p=this._helper._lngRange;if(!this._helper._renderWorldCopies&&p===null){const $=179.9999999999;p=[-$,$]}const m=this.tileSize*l.aq(c.zoom);let v=0,x=m,T=0,P=m,k=0,A=0;const{x:L,y:N}=this.size;if(this._helper._latRange){const $=this._helper._latRange;v=l.X($[1])*m,x=l.X($[0])*m,x-v<N&&(k=N/(x-v))}p&&(T=l.W(l.Y(p[0])*m,0,m),P=l.W(l.Y(p[1])*m,0,m),P<T&&(P+=m),P-T<L&&(A=L/(P-T)));const{x:W,y:Y}=ze(m,n);let X,te;const fe=Math.max(A||0,k||0);if(fe){const $=new l.P(A?(P+T)/2:W,k?(x+v)/2:Y);return c.center=dt(m,$).wrap(),c.zoom+=l.at(fe),c}if(this._helper._latRange){const $=N/2;Y-$<v&&(te=v+$),Y+$>x&&(te=x-$)}if(p){const $=(T+P)/2;let he=W;this._helper._renderWorldCopies&&(he=l.W(W,$-m/2,$+m/2));const ve=L/2;he-ve<T&&(X=T+ve),he+ve>P&&(X=P-ve)}if(X!==void 0||te!==void 0){const $=new l.P(X??W,te??Y);c.center=dt(m,$).wrap()}return c},this.applyConstrain=(n,a)=>this._helper.applyConstrain(n,a),this._helper=new zo({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(n,a)=>this.defaultConstrain(n,a)},t),this._coveringTilesDetailsProvider=new js}clone(){const t=new Do;return t.apply(this,!1),t}apply(t,n,a){this._helper.apply(t,n,a)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const n=[new l.bc(0,t)];if(this._helper._renderWorldCopies){const a=this.screenPointToMercatorCoordinate(new l.P(0,0)),c=this.screenPointToMercatorCoordinate(new l.P(this._helper._width,0)),p=this.screenPointToMercatorCoordinate(new l.P(this._helper._width,this._helper._height)),m=this.screenPointToMercatorCoordinate(new l.P(0,this._helper._height)),v=Math.floor(Math.min(a.x,c.x,p.x,m.x)),x=Math.floor(Math.max(a.x,c.x,p.x,m.x)),T=1;for(let P=v-T;P<=x+T;P++)P!==0&&n.push(new l.bc(P,t))}return n}getCameraFrustum(){return pn.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const n=this.screenPointToLocation(this.centerPoint,t),a=t?t.getElevationForLngLatZoom(n,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(a)}setLocationAtPoint(t,n){const a=l.as(this.elevation,this.center.lat),c=this.screenPointToMercatorCoordinateAtZ(n,a),p=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,a),m=l.a9.fromLngLat(t),v=new l.a9(m.x-(c.x-p.x),m.y-(c.y-p.y));this.setCenter(v?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,n){return n?this.coordinatePoint(l.a9.fromLngLat(t),n.getElevationForLngLat(t,this),this._pixelMatrix3D):this.coordinatePoint(l.a9.fromLngLat(t))}screenPointToLocation(t,n){var a;return(a=this.screenPointToMercatorCoordinate(t,n))===null||a===void 0?void 0:a.toLngLat()}screenPointToMercatorCoordinate(t,n){if(n){const a=n.pointCoordinate(t);if(a!=null)return a}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,n){const a=n||0,c=[t.x,t.y,0,1],p=[t.x,t.y,1,1];l.aH(c,c,this._pixelMatrixInverse),l.aH(p,p,this._pixelMatrixInverse);const m=c[3],v=p[3],x=c[1]/m,T=p[1]/v,P=c[2]/m,k=p[2]/v,A=P===k?0:(a-P)/(k-P);return new l.a9(l.G.number(c[0]/m,p[0]/v,A)/this.worldSize,l.G.number(x,T,A)/this.worldSize,a)}coordinatePoint(t,n=0,a=this._pixelMatrix){const c=[t.x*this.worldSize,t.y*this.worldSize,n,1];return l.aH(c,c,a),new l.P(c[0]/c[3],c[1]/c[3])}getBounds(){const t=Math.max(0,this._helper._height/2-ke(this));return new Mt().extend(this.screenPointToLocation(new l.P(0,t))).extend(this.screenPointToLocation(new l.P(this._helper._width,t))).extend(this.screenPointToLocation(new l.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new l.P(0,this._helper._height)))}isPointOnMapSurface(t,n){return n?n.pointCoordinate(t)!=null:t.y>this.height/2-ke(this)}calculatePosMatrix(t,n=!1,a){var c;const p=(c=t.key)!==null&&c!==void 0?c:l.bd(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),m=n?this._alignedPosMatrixCache:this._posMatrixCache;if(m.has(p)){const T=m.get(p);return a?T.f32:T.f64}const v=et(t,this.worldSize);l.S(v,n?this._alignedProjMatrix:this._viewProjMatrix,v);const x={f64:v,f32:new Float32Array(v)};return m.set(p,x),a?x.f32:x.f64}calculateFogMatrix(t){const n=t.key,a=this._fogMatrixCacheF32;if(a.has(n))return a.get(n);const c=et(t,this.worldSize);return l.S(c,this._fogMatrix,c),a.set(n,new Float32Array(c)),a.get(n)}calculateCenterFromCameraLngLatAlt(t,n,a,c){return this._helper.calculateCenterFromCameraLngLatAlt(t,n,a,c)}_calculateNearFarZIfNeeded(t,n,a){if(!this._helper.autoCalculateNearFarZ)return;const c=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),p=t-c*this._helper._pixelPerMeter/Math.cos(n),m=c<0?p:t,v=Math.PI/2+this.pitchInRadians,x=l.ap(this.fov)*(Math.abs(Math.cos(l.ap(this.roll)))*this.height+Math.abs(Math.sin(l.ap(this.roll)))*this.width)/this.height*(.5+a.y/this.height),T=Math.sin(x)*m/Math.sin(l.an(Math.PI-v-x,.01,Math.PI-.01)),P=ke(this),k=Math.atan(P/this._helper.cameraToCenterDistance),A=l.ap(.75),L=k>A?2*k*(.5+a.y/(2*P)):A,N=Math.sin(L)*m/Math.sin(l.an(Math.PI-v-L,.01,Math.PI-.01)),W=Math.min(T,N);this._helper._farZ=1.01*(Math.cos(Math.PI/2-n)*W+m),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,n=ze(this.worldSize,this.center),a=n.x,c=n.y;this._helper._pixelPerMeter=l.as(1,this.center.lat)*this.worldSize;const p=l.ap(Math.min(this.pitch,Pe)),m=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(p));let v;this._calculateNearFarZIfNeeded(m,p,t),v=new Float64Array(16),l.be(v,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),l.aB(this._invProjMatrix,v),v[8]=2*-t.x/this._helper._width,v[9]=2*t.y/this._helper._height,this._projectionMatrix=l.bf(v),l.Q(v,v,[1,-1,1]),l.O(v,v,[0,0,-this._helper.cameraToCenterDistance]),l.bg(v,v,-this.rollInRadians),l.bh(v,v,this.pitchInRadians),l.bg(v,v,-this.bearingInRadians),l.O(v,v,[-a,-c,0]),this._mercatorMatrix=l.Q([],v,[this.worldSize,this.worldSize,this.worldSize]),l.Q(v,v,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=l.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,v),l.O(v,v,[0,0,-this.elevation]),this._viewProjMatrix=v,this._invViewProjMatrix=l.aB([],v);const x=[0,0,-1,1];l.aH(x,x,this._invViewProjMatrix),this._cameraPosition=[x[0]/x[3],x[1]/x[3],x[2]/x[3]],this._fogMatrix=new Float64Array(16),l.be(this._fogMatrix,this.fovInRadians,this.width/this.height,m,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,l.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),l.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),l.bg(this._fogMatrix,this._fogMatrix,-this.rollInRadians),l.bh(this._fogMatrix,this._fogMatrix,this.pitchInRadians),l.bg(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),l.O(this._fogMatrix,this._fogMatrix,[-a,-c,0]),l.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),l.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=l.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,v);const T=this._helper._width%2/2,P=this._helper._height%2/2,k=Math.cos(this.bearingInRadians),A=Math.sin(-this.bearingInRadians),L=a-Math.round(a)+k*T+A*P,N=c-Math.round(c)+k*P+A*T,W=new Float64Array(v);if(l.O(W,W,[L>.5?L-1:L,N>.5?N-1:N,0]),this._alignedProjMatrix=W,v=l.aB(new Float64Array(16),this._pixelMatrix),!v)throw new Error("failed to invert matrix");this._pixelMatrixInverse=v,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new l.P(0,0)),n=[t.x*this.worldSize,t.y*this.worldSize,0,1];return l.aH(n,n,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=l.as(1,this.center.lat)*this.worldSize;return pe(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,n){const a=l.a9.fromLngLat(t),c=[a.x*this.worldSize,a.y*this.worldSize,n,1];return l.aH(c,c,this._viewProjMatrix),c[2]/c[3]}getProjectionData(t){const{overscaledTileID:n,aligned:a,applyTerrainMatrix:c}=t,p=this._helper.getMercatorTileCoordinates(n),m=n?this.calculatePosMatrix(n,a,!0):null;let v;return v=n&&n.terrainRttPosMatrix32f&&c?n.terrainRttPosMatrix32f:m||l.bi(),{mainMatrix:v,tileMercatorCoords:p,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:v}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,n,a){return 1}transformLightDirection(t){return l.b1(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,n,a,c){const p=this.calculatePosMatrix(a);let m;c?(m=[t,n,c(t,n),1],l.aH(m,m,p)):(m=[t,n,0,1],Bs(m,m,p));const v=m[3];return{point:new l.P(m[0]/v,m[1]/v),signedDistanceFromCamera:v,isOccluded:!1}}populateCache(t){for(const n of t)this.calculatePosMatrix(n)}getMatrixForModel(t,n){const a=l.a9.fromLngLat(t,n),c=a.meterInMercatorCoordinateUnits(),p=l.bj();return l.O(p,p,[a.x,a.y,a.z]),l.bg(p,p,Math.PI),l.bh(p,p,Math.PI/2),l.Q(p,p,[-c,c,c]),p}getProjectionDataForCustomLayer(t=!0){const n=new l.a2(0,0,0,0,0),a=this.getProjectionData({overscaledTileID:n,applyGlobeMatrix:t}),c=et(n,this.worldSize);l.S(c,this._viewProjMatrix,c),a.tileMercatorCoords=[0,0,1,1];const p=[l.a5,l.a5,this.worldSize/this._helper.pixelsPerMeter],m=l.bk();return l.Q(m,c,p),a.fallbackMatrix=m,a.mainMatrix=m,a}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function eo(){l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Iu(d){if(d.useSlerp)if(d.k<1){const t=l.bl(d.startEulerAngles.roll,d.startEulerAngles.pitch,d.startEulerAngles.bearing),n=l.bl(d.endEulerAngles.roll,d.endEulerAngles.pitch,d.endEulerAngles.bearing),a=new Float64Array(4);l.bm(a,t,n,d.k);const c=l.bn(a);d.tr.setRoll(c.roll),d.tr.setPitch(c.pitch),d.tr.setBearing(c.bearing)}else d.tr.setRoll(d.endEulerAngles.roll),d.tr.setPitch(d.endEulerAngles.pitch),d.tr.setBearing(d.endEulerAngles.bearing);else d.tr.setRoll(l.G.number(d.startEulerAngles.roll,d.endEulerAngles.roll,d.k)),d.tr.setPitch(l.G.number(d.startEulerAngles.pitch,d.endEulerAngles.pitch,d.k)),d.tr.setBearing(l.G.number(d.startEulerAngles.bearing,d.endEulerAngles.bearing,d.k))}function ic(d,t,n,a,c){const p=c.padding,m=ze(c.worldSize,n.getNorthWest()),v=ze(c.worldSize,n.getNorthEast()),x=ze(c.worldSize,n.getSouthEast()),T=ze(c.worldSize,n.getSouthWest()),P=l.ap(-a),k=m.rotate(P),A=v.rotate(P),L=x.rotate(P),N=T.rotate(P),W=new l.P(Math.max(k.x,A.x,N.x,L.x),Math.max(k.y,A.y,N.y,L.y)),Y=new l.P(Math.min(k.x,A.x,N.x,L.x),Math.min(k.y,A.y,N.y,L.y)),X=W.sub(Y),te=(c.width-(p.left+p.right+t.left+t.right))/X.x,fe=(c.height-(p.top+p.bottom+t.top+t.bottom))/X.y;if(fe<0||te<0)return void eo();const $=Math.min(l.at(c.scale*Math.min(te,fe)),d.maxZoom),he=l.P.convert(d.offset),ve=new l.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(l.ap(a)),le=he.add(ve).mult(c.scale/l.aq($));return{center:dt(c.worldSize,m.add(x).div(2).sub(le)),zoom:$,bearing:a}}class Lo{get useGlobeControls(){return!1}handlePanInertia(t,n){const a=t.mag(),c=Math.abs(ke(n));return{easingOffset:t.mult(Math.min(.75*c/a,1)),easingCenter:n.center}}handleMapControlsRollPitchBearingZoom(t,n){t.bearingDelta&&n.setBearing(n.bearing+t.bearingDelta),t.pitchDelta&&n.setPitch(n.pitch+t.pitchDelta),t.rollDelta&&n.setRoll(n.roll+t.rollDelta),t.zoomDelta&&n.setZoom(n.zoom+t.zoomDelta)}handleMapControlsPan(t,n,a){t.around.distSqr(n.centerPoint)<.01||n.setLocationAtPoint(a,t.around)}cameraForBoxAndBearing(t,n,a,c,p){return ic(t,n,a,c,p)}handleJumpToCenterZoom(t,n){t.zoom!==(n.zoom!==void 0?+n.zoom:t.zoom)&&t.setZoom(+n.zoom),n.center!==void 0&&t.setCenter(l.V.convert(n.center))}handleEaseTo(t,n){const a=t.zoom,c=t.padding,p={roll:t.roll,pitch:t.pitch,bearing:t.bearing},m={roll:n.roll===void 0?t.roll:n.roll,pitch:n.pitch===void 0?t.pitch:n.pitch,bearing:n.bearing===void 0?t.bearing:n.bearing},v=n.zoom!==void 0,x=!t.isPaddingEqual(n.padding);let T=!1;const P=v?+n.zoom:t.zoom;let k=t.centerPoint.add(n.offsetAsPoint);const A=t.screenPointToLocation(k),{center:L,zoom:N}=t.applyConstrain(l.V.convert(n.center||A),P??a);go(t,L);const W=ze(t.worldSize,A),Y=ze(t.worldSize,L).sub(W),X=l.aq(N-a);return T=N!==a,{easeFunc:te=>{if(T&&t.setZoom(l.G.number(a,N,te)),l.bo(p,m)||Iu({startEulerAngles:p,endEulerAngles:m,tr:t,k:te,useSlerp:p.roll!=m.roll}),x&&(t.interpolatePadding(c,n.padding,te),k=t.centerPoint.add(n.offsetAsPoint)),n.around)t.setLocationAtPoint(n.around,n.aroundPoint);else{const fe=l.aq(t.zoom-a),$=N>a?Math.min(2,X):Math.max(.5,X),he=Math.pow($,1-te),ve=dt(t.worldSize,W.add(Y.mult(te*he)).mult(fe));t.setLocationAtPoint(t.renderWorldCopies?ve.wrap():ve,k)}},isZooming:T,elevationCenter:L}}handleFlyTo(t,n){const a=n.zoom!==void 0,c=t.zoom,p=t.applyConstrain(l.V.convert(n.center||n.locationAtOffset),a?+n.zoom:c),m=p.center,v=p.zoom;go(t,m);const x=ze(t.worldSize,n.locationAtOffset),T=ze(t.worldSize,m).sub(x),P=T.mag(),k=l.aq(v-c);let A;if(n.minZoom!==void 0){const L=Math.min(+n.minZoom,c,v),N=t.applyConstrain(m,L).zoom;A=l.aq(N-c)}return{easeFunc:(L,N,W,Y)=>{t.setZoom(L===1?v:c+l.at(N));const X=L===1?m:dt(t.worldSize,x.add(T.mult(W)).mult(N));t.setLocationAtPoint(t.renderWorldCopies?X.wrap():X,Y)},scaleOfZoom:k,targetCenter:m,scaleOfMinZoom:A,pixelPathLength:P}}}class ti{constructor(t,n,a){this.blendFunction=t,this.blendColor=n,this.mask=a}}ti.Replace=[1,0],ti.disabled=new ti(ti.Replace,l.bp.transparent,[!1,!1,!1,!1]),ti.unblended=new ti(ti.Replace,l.bp.transparent,[!0,!0,!0,!0]),ti.alphaBlended=new ti([1,771],l.bp.transparent,[!0,!0,!0,!0]);const ua=2305;class Gr{constructor(t,n,a){this.enable=t,this.mode=n,this.frontFace=a}}Gr.disabled=new Gr(!1,1029,ua),Gr.backCCW=new Gr(!0,1029,ua),Gr.frontCCW=new Gr(!0,1028,ua);class kr{constructor(t,n,a){this.func=t,this.mask=n,this.range=a}}kr.ReadOnly=!1,kr.ReadWrite=!0,kr.disabled=new kr(519,kr.ReadOnly,[0,1]);const ha=7680;class Hr{constructor(t,n,a,c,p,m){this.test=t,this.ref=n,this.mask=a,this.fail=c,this.depthFail=p,this.pass=m}}Hr.disabled=new Hr({func:519,mask:0},0,0,ha,ha,ha);const Ya=new WeakMap;function In(d){var t;if(Ya.has(d))return Ya.get(d);{const n=(t=d.getParameter(d.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Ya.set(d,n),n}}class da{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const n=t.context,a=n.gl;this._texFormat=a.RGBA,this._texType=a.UNSIGNED_BYTE;const c=new l.aW;c.emplaceBack(-1,-1),c.emplaceBack(2,-1),c.emplaceBack(-1,2);const p=new l.aY;p.emplaceBack(0,1,2),this._fullscreenTriangle=new ei(n.createVertexBuffer(c,mo.members),n.createIndexBuffer(p),l.aX.simpleSegment(0,0,c.length,p.length)),this._resultBuffer=new Uint8Array(4),n.activeTexture.set(a.TEXTURE1);const m=a.createTexture();a.bindTexture(a.TEXTURE_2D,m),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texImage2D(a.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=n.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(m),In(a)&&(this._pbo=a.createBuffer(),a.bindBuffer(a.PIXEL_PACK_BUFFER,this._pbo),a.bufferData(a.PIXEL_PACK_BUFFER,4,a.STREAM_READ),a.bindBuffer(a.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,n){const a=this._updateCount;return this._readbackQueue?a>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():a>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,n),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,n=t.gl;t.activeTexture.set(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,n){const a=this._cachedRenderContext.context,c=a.gl;if(this._bindFramebuffer(),a.viewport.set([0,0,this._texWidth,this._texHeight]),a.clear({color:l.bp.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(a,c.TRIANGLES,kr.disabled,Hr.disabled,ti.unblended,Gr.disabled,((p,m)=>({u_input:p,u_output_expected:m}))(t,n),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&In(c)){c.bindBuffer(c.PIXEL_PACK_BUFFER,this._pbo),c.readBuffer(c.COLOR_ATTACHMENT0),c.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),c.bindBuffer(c.PIXEL_PACK_BUFFER,null);const p=c.fenceSync(c.SYNC_GPU_COMMANDS_COMPLETE,0);c.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:p}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&In(t)){const n=t.clientWaitSync(this._readbackQueue.sync,0,0);if(n===t.WAIT_FAILED)return l.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(n===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=da._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let n=0;return n+=t[0]/256,n+=t[1]/65536,n+=t[2]/16777216,t[3]<127&&(n=-n),n/128}}const _o=l.a5/128;function Mu(d,t){const n=d.granularity!==void 0?Math.max(d.granularity,1):1,a=n+(d.generateBorders?2:0),c=n+(d.extendToNorthPole||d.generateBorders?1:0)+(d.extendToSouthPole||d.generateBorders?1:0),p=a+1,m=c+1,v=d.generateBorders?-1:0,x=d.generateBorders||d.extendToNorthPole?-1:0,T=n+(d.generateBorders?1:0),P=n+(d.generateBorders||d.extendToSouthPole?1:0),k=p*m,A=a*c*6,L=p*m>65536;if(L&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const N=L||t==="32bit",W=new Int16Array(2*k);let Y=0;for(let fe=x;fe<=P;fe++)for(let $=v;$<=T;$++){let he=$/n*l.a5;$===-1&&(he=-_o),$===n+1&&(he=l.a5+_o);let ve=fe/n*l.a5;fe===-1&&(ve=d.extendToNorthPole?l.br:-_o),fe===n+1&&(ve=d.extendToSouthPole?l.bs:l.a5+_o),W[Y++]=he,W[Y++]=ve}const X=N?new Uint32Array(A):new Uint16Array(A);let te=0;for(let fe=0;fe<c;fe++)for(let $=0;$<a;$++){const he=$+1+fe*p,ve=$+(fe+1)*p,le=$+1+(fe+1)*p;X[te++]=$+fe*p,X[te++]=ve,X[te++]=he,X[te++]=he,X[te++]=ve,X[te++]=le}return{vertices:W.buffer.slice(0),indices:X.buffer.slice(0),uses32bitIndices:N}}const Ka=new l.aV({fill:new l.bt(128,2),line:new l.bt(512,0),tile:new l.bt(128,32),stencil:new l.bt(128,1),circle:3});class nc{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return yi.projectionGlobe}get vertexShaderPreludeCode(){return yi.projectionMercator.vertexSource}get subdivisionGranularity(){return Ka}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new da(t));const n=l.X(this._errorQueryLatitudeDegrees),a=2*Math.atan(Math.exp(Math.PI-n*Math.PI*2))-.5*Math.PI,c=this._errorMeasurement.updateErrorLoop(n,a),p=Ee();c!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=c,this._errorMeasurementLastChangeTime=p);const m=Math.min(Math.max((p-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=l.bu(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,l.bv(m))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,n,a,c,p){const m=(p==="stencil"?Ka.stencil:Ka.tile).getGranularityForZoomLevel(n.z);return this._getMesh(t,{granularity:m,generateBorders:a,extendToNorthPole:n.y===0&&c,extendToSouthPole:n.y===(1<<n.z)-1&&c})}_getMesh(t,n){const a=this._getMeshKey(n);if(a in this._tileMeshCache)return this._tileMeshCache[a];const c=(function(p,m){const v=Mu(m,"16bit"),x=l.aW.deserialize({arrayBuffer:v.vertices,length:v.vertices.byteLength/2/2}),T=l.aY.deserialize({arrayBuffer:v.indices,length:v.indices.byteLength/2/3});return new ei(p.createVertexBuffer(x,mo.members),p.createIndexBuffer(T),l.aX.simpleSegment(0,0,x.length,T.length))})(t,n);return this._tileMeshCache[a]=c,c}recalculate(t){}hasTransition(){const t=Ee();let n=!1;return n=n||(t-this._errorMeasurementLastChangeTime)/1e3<.7,n=n||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,n}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const ud=new l.t({type:new l.D(l.u.projection.type)});class Eu extends l.E{constructor(t){super(),this._transitionable=new l.x(ud,void 0),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.H(0)),this._mercatorProjection=new ln,this._verticalPerspectiveProjection=new nc}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof l.bw){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,n,a,c,p){return this.currentProjection.getMeshFromTileID(t,n,a,c,p)}setProjection(t){this._transitionable.setValue("type",t?.type||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function cn(d){const t=Ro(d.worldSize,d.center.lat);return 2*Math.PI*t}function Yn(d,t,n,a,c){const p=1/(1<<c),m=t/l.a5*p+a*p,v=l.bz((d/l.a5*p+n*p)*Math.PI*2+Math.PI,2*Math.PI),x=2*Math.atan(Math.exp(Math.PI-m*Math.PI*2))-.5*Math.PI,T=Math.cos(x),P=new Float64Array(3);return P[0]=Math.sin(v)*T,P[1]=Math.sin(x),P[2]=Math.cos(v)*T,P}function di(d){return(function(t,n){const a=Math.cos(n),c=new Float64Array(3);return c[0]=Math.sin(t)*a,c[1]=Math.sin(n),c[2]=Math.cos(t)*a,c})(d.lng*Math.PI/180,d.lat*Math.PI/180)}function Ro(d,t){return d/(2*Math.PI)/Math.cos(t*Math.PI/180)}function oc(d){const t=Math.asin(d[1])/Math.PI*180,n=Math.sqrt(d[0]*d[0]+d[2]*d[2]);if(n>1e-6){const a=d[0]/n,c=Math.acos(d[2]/n),p=(a>0?c:-c)/Math.PI*180;return new l.V(l.W(p,-180,180),t)}return new l.V(0,t)}function Qa(d){return Math.cos(d*Math.PI/180)}function Ti(d,t){const n=Qa(d),a=Qa(t);return l.at(a/n)}function Au(d,t){const n=d.rotate(t.bearingInRadians),a=t.zoom+Ti(t.center.lat,0),c=l.bu(1/Qa(t.center.lat),1/Qa(Math.min(Math.abs(t.center.lat),60)),l.bx(a,7,3,0,1)),p=360/cn({worldSize:t.worldSize,center:{lat:t.center.lat}});return new l.V(t.center.lng-n.x*p*c,l.an(t.center.lat+n.y*p,-l.ao,l.ao))}function ac(d){const t=.5*d,n=Math.sin(t),a=Math.cos(t);return Math.log(n+a)-Math.log(a-n)}function ku(d,t,n,a){const c=d.lat+n*a;if(Math.abs(n)>1){const p=(Math.sign(d.lat+n)!==Math.sign(d.lat)?-Math.abs(d.lat):Math.abs(d.lat))*Math.PI/180,m=Math.abs(d.lat+n)*Math.PI/180,v=ac(p+a*(m-p)),x=ac(p),T=ac(m);return new l.V(d.lng+t*((v-x)/(T-x)),c)}return new l.V(d.lng+t*a,c)}class hd{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,n,a,c){const p=`${t.z}_${t.x}_${t.y}_${c?.terrain?"t":""}`,m=this._cache.get(p);if(m)return m;const v=this._cachePrevious.get(p);if(v)return this._cache.set(p,v),v;const x=this._boundingVolumeFactory(t,n,a,c);return this._cache.set(p,x),this._hadAnyChanges=!0,x}}class pa{constructor(t,n,a,c){this.min=a,this.max=c,this.points=t,this.planes=n}static fromAabb(t,n){const a=[];for(let c=0;c<8;c++)a.push([1&~c?t[0]:n[0],(c>>1&1)==1?n[1]:t[1],(c>>2&1)==1?n[2]:t[2]]);return new pa(a,[[-1,0,0,n[0]],[1,0,0,-t[0]],[0,-1,0,n[1]],[0,1,0,-t[1]],[0,0,-1,n[2]],[0,0,1,-t[2]]],t,n)}static fromCenterSizeAngles(t,n,a){const c=l.bB([],a[0],a[1],a[2]),p=l.bC([],[n[0],0,0],c),m=l.bC([],[0,n[1],0],c),v=l.bC([],[0,0,n[2]],c),x=[...t],T=[...t];for(let k=0;k<8;k++)for(let A=0;A<3;A++){const L=t[A]+p[A]*(1&~k?-1:1)+m[A]*((k>>1&1)==1?1:-1)+v[A]*((k>>2&1)==1?1:-1);x[A]=Math.min(x[A],L),T[A]=Math.max(T[A],L)}const P=[];for(let k=0;k<8;k++){const A=[...t];l.b0(A,A,l.a$([],p,1&~k?-1:1)),l.b0(A,A,l.a$([],m,(k>>1&1)==1?1:-1)),l.b0(A,A,l.a$([],v,(k>>2&1)==1?1:-1)),P.push(A)}return new pa(P,[[...p,-l.b5(p,P[0])],[...m,-l.b5(m,P[0])],[...v,-l.b5(v,P[0])],[-p[0],-p[1],-p[2],-l.b5(p,P[7])],[-m[0],-m[1],-m[2],-l.b5(m,P[7])],[-v[0],-v[1],-v[2],-l.b5(v,P[7])]],x,T)}intersectsFrustum(t){let n=!0;const a=this.points.length,c=this.planes.length,p=t.planes.length,m=t.points.length;for(let v=0;v<p;v++){const x=t.planes[v];let T=0;for(let P=0;P<a;P++){const k=this.points[P];x[0]*k[0]+x[1]*k[1]+x[2]*k[2]+x[3]>=0&&T++}if(T===0)return 0;T<a&&(n=!1)}if(n)return 2;for(let v=0;v<c;v++){const x=this.planes[v];let T=0;for(let P=0;P<m;P++){const k=t.points[P];x[0]*k[0]+x[1]*k[1]+x[2]*k[2]+x[3]>=0&&T++}if(T===0)return 0}return 1}intersectsPlane(t){const n=this.points.length;let a=0;for(let c=0;c<n;c++){const p=this.points[c];t[0]*p[0]+t[1]*p[1]+t[2]*p[2]+t[3]>=0&&a++}return a===n?2:a===0?0:1}}function Us(d,t,n){const a=d-t;return a<0?-a:Math.max(0,a-n)}function fa(d,t,n,a,c){const p=d-n;let m;return m=p<0?Math.min(-p,1+p-c):p>1?Math.min(Math.max(p-c,0),1-p):0,Math.max(m,Us(t,a,c))}class sc{constructor(){this._boundingVolumeCache=new hd(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,n,a,c){const p=1<<a.z,m=1/p,v=a.x/p,x=a.y/p;let T=2;return T=Math.min(T,fa(t,n,v,x,m)),T=Math.min(T,fa(t,n,v+.5,-x-m,m)),T=Math.min(T,fa(t,n,v+.5,2-x-m,m)),T}getWrap(t,n,a){const c=1<<n.z,p=1/c,m=n.x/c,v=Us(t.x,m,p),x=Us(t.x,m-1,p),T=Us(t.x,m+1,p),P=Math.min(v,x,T);return P===T?1:P===x?-1:0}allowVariableZoom(t,n){return zr(t,n)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,n,a,c){return this._boundingVolumeCache.getTileBoundingVolume(t,n,a,c)}_computeTileBoundingVolume(t,n,a,c){var p,m;let v=0,x=0;if(c?.terrain){const T=new l.a2(t.z,n,t.z,t.x,t.y),P=c.terrain.getMinMaxElevation(T);v=(p=P.minElevation)!==null&&p!==void 0?p:Math.min(0,a),x=(m=P.maxElevation)!==null&&m!==void 0?m:Math.max(0,a)}if(v/=l.bE,x/=l.bE,v+=1,x+=1,t.z<=0)return pa.fromAabb([-x,-x,-x],[x,x,x]);if(t.z===1)return pa.fromAabb([t.x===0?-x:0,t.y===0?0:-x,-x],[t.x===0?0:x,t.y===0?x:0,x]);{const T=[Yn(0,0,t.x,t.y,t.z),Yn(l.a5,0,t.x,t.y,t.z),Yn(l.a5,l.a5,t.x,t.y,t.z),Yn(0,l.a5,t.x,t.y,t.z)],P=[];for(const We of T)P.push(l.a$([],We,x));if(x!==v)for(const We of T)P.push(l.a$([],We,v));t.y===0&&P.push([0,1,0]),t.y===(1<<t.z)-1&&P.push([0,-1,0]);const k=[1,1,1],A=[-1,-1,-1];for(const We of P)for(let Ye=0;Ye<3;Ye++)k[Ye]=Math.min(k[Ye],We[Ye]),A[Ye]=Math.max(A[Ye],We[Ye]);const L=Yn(l.a5/2,l.a5/2,t.x,t.y,t.z),N=l.b4([],[0,1,0],L);l.b3(N,N);const W=l.b4([],L,N);l.b3(W,W);const Y=l.b4([],T[2],T[1]);l.b3(Y,Y);const X=l.b4([],T[0],T[3]);l.b3(X,X),P.push(l.a$([],L,x)),t.y>=(1<<t.z)/2&&P.push(l.a$([],Yn(l.a5/2,0,t.x,t.y,t.z),x)),t.y<(1<<t.z)/2&&P.push(l.a$([],Yn(l.a5/2,l.a5,t.x,t.y,t.z),x));const te=Ja(L,P),fe=Ja(W,P),$=[-L[0],-L[1],-L[2],te.max],he=[L[0],L[1],L[2],-te.min],ve=[-W[0],-W[1],-W[2],fe.max],le=[W[0],W[1],W[2],-fe.min],Me=[...Y,0],$e=[...X,0],Ze=[];return t.y===0?Ze.push(l.bD($e,Me,$),l.bD($e,Me,he)):Ze.push(l.bD(ve,Me,$),l.bD(ve,Me,he),l.bD(ve,$e,$),l.bD(ve,$e,he)),t.y===(1<<t.z)-1?Ze.push(l.bD($e,Me,$),l.bD($e,Me,he)):Ze.push(l.bD(le,Me,$),l.bD(le,Me,he),l.bD(le,$e,$),l.bD(le,$e,he)),new pa(Ze,[$,he,ve,le,Me,$e],k,A)}}}function Ja(d,t){let n=1/0,a=-1/0;for(const c of t){const p=l.b5(d,c);n=Math.min(n,p),a=Math.max(a,p)}return{min:n,max:a}}class ma{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,n,a){return this._helper.interpolatePadding(t,n,a)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,n){this._helper.resize(t,n)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,n){this._helper.overrideNearFarZ(t,n)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(t){this._cachedClippingPlane=l.bF(),this._projectionMatrix=l.bj(),this._globeViewProjMatrix32f=l.bi(),this._globeViewProjMatrixNoCorrection=l.bj(),this._globeViewProjMatrixNoCorrectionInverted=l.bj(),this._globeProjMatrixInverted=l.bj(),this._cameraPosition=l.bA(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(n,a)=>{const c=l.an(n.lat,-l.ao,l.ao),p=l.an(+a,this.minZoom+Ti(0,c),this.maxZoom);return{center:new l.V(n.lng,c),zoom:p}},this.applyConstrain=(n,a)=>this._helper.applyConstrain(n,a),this._helper=new zo({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(n,a)=>this.defaultConstrain(n,a)},t),this._coveringTilesDetailsProvider=new sc}clone(){const t=new ma;return t.apply(this,!1),t}apply(t,n,a){this._globeLatitudeErrorCorrectionRadians=a||0,this._helper.apply(t,n)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=l.bA();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:n,applyGlobeMatrix:a}=t,c=this._helper.getMercatorTileCoordinates(n);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:c,clippingPlane:this._cachedClippingPlane,projectionTransition:a?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const n=this.pitchInRadians,a=this.cameraToCenterDistance/t,c=Math.sin(n)*a,p=Math.cos(n)*a+1,m=1/Math.sqrt(c*c+p*p)*1;let v=-c,x=p;const T=Math.sqrt(v*v+x*x);v/=T,x/=T;const P=[0,v,x];l.bG(P,P,[0,0,0],-this.bearingInRadians),l.bH(P,P,[0,0,0],-1*this.center.lat*Math.PI/180),l.bI(P,P,[0,0,0],this.center.lng*Math.PI/180);const k=1/l.b7(P);return l.a$(P,P,k),[...P,-m*k]}isLocationOccluded(t){return!this.isSurfacePointVisible(di(t))}transformLightDirection(t){const n=this._helper._center.lng*Math.PI/180,a=this._helper._center.lat*Math.PI/180,c=Math.cos(a),p=[Math.sin(n)*c,Math.sin(a),Math.cos(n)*c],m=[p[2],0,-p[0]],v=[0,0,0];l.b4(v,m,p),l.b3(m,m),l.b3(v,v);const x=[0,0,0];return l.b3(x,[m[0]*t[0]+v[0]*t[1]+p[0]*t[2],m[1]*t[0]+v[1]*t[1]+p[1]*t[2],m[2]*t[0]+v[2]*t[1]+p[2]*t[2]]),x}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,n,a){const c=(function(v,x,T){const P=1/(1<<T.z);return new l.a9(v/l.a5*P+T.x*P,x/l.a5*P+T.y*P)})(t,n,a.canonical),p=(m=c.y,[l.bz(c.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-m*Math.PI*2))-.5*Math.PI]);var m;return this.getCircleRadiusCorrection()/Math.cos(p[1])}projectTileCoordinates(t,n,a,c){const p=a.canonical,m=Yn(t,n,p.x,p.y,p.z),v=1+(c?c(t,n):0)/l.bE,x=[m[0]*v,m[1]*v,m[2]*v,1];l.aH(x,x,this._globeViewProjMatrixNoCorrection);const T=this._cachedClippingPlane,P=T[0]*m[0]+T[1]*m[1]+T[2]*m[2]+T[3]<0;return{point:new l.P(x[0]/x[3],x[1]/x[3]),signedDistanceFromCamera:x[3],isOccluded:P}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=Ro(this.worldSize,this.center.lat),n=l.bk(),a=l.bk();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),l.be(n,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const c=this.centerOffset;n[8]=2*-c.x/this._helper._width,n[9]=2*c.y/this._helper._height,this._projectionMatrix=l.bf(n),this._globeProjMatrixInverted=l.bk(),l.aB(this._globeProjMatrixInverted,n),l.O(n,n,[0,0,-this.cameraToCenterDistance]),l.bg(n,n,this.rollInRadians),l.bh(n,n,-this.pitchInRadians),l.bg(n,n,this.bearingInRadians),l.O(n,n,[0,0,-t]);const p=l.bA();p[0]=t,p[1]=t,p[2]=t,l.bh(a,n,this.center.lat*Math.PI/180),l.bJ(a,a,-this.center.lng*Math.PI/180),l.Q(a,a,p),this._globeViewProjMatrixNoCorrection=a,l.bh(n,n,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),l.bJ(n,n,-this.center.lng*Math.PI/180),l.Q(n,n,p),this._globeViewProjMatrix32f=new Float32Array(n),this._globeViewProjMatrixNoCorrectionInverted=l.bk(),l.aB(this._globeViewProjMatrixNoCorrectionInverted,a);const m=l.bA();this._cameraPosition=l.bA(),this._cameraPosition[2]=this.cameraToCenterDistance/t,l.bG(this._cameraPosition,this._cameraPosition,m,-this.rollInRadians),l.bH(this._cameraPosition,this._cameraPosition,m,this.pitchInRadians),l.bG(this._cameraPosition,this._cameraPosition,m,-this.bearingInRadians),l.b0(this._cameraPosition,this._cameraPosition,[0,0,1]),l.bH(this._cameraPosition,this._cameraPosition,m,-this.center.lat*Math.PI/180),l.bI(this._cameraPosition,this._cameraPosition,m,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const v=l.bf(this._globeViewProjMatrixNoCorrectionInverted);l.Q(v,v,[1,1,-1]),this._cachedFrustum=pn.fromInvProjectionMatrix(v,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){l.w("calculateFogMatrix is not supported on globe projection.");const n=l.bk();return l.ar(n),n}getVisibleUnwrappedCoordinates(t){return[new l.bc(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&l.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,n){if(!this._globeViewProjMatrixNoCorrection)return 1;const a=di(t);l.a$(a,a,1+n/l.bE);const c=l.bF();return l.aH(c,[a[0],a[1],a[2],1],this._globeViewProjMatrixNoCorrection),c[2]/c[3]}populateCache(t){}getBounds(){const t=.5*this.width,n=.5*this.height,a=[new l.P(0,0),new l.P(t,0),new l.P(this.width,0),new l.P(this.width,n),new l.P(this.width,this.height),new l.P(t,this.height),new l.P(0,this.height),new l.P(0,n)],c=[];for(const k of a)c.push(this.unprojectScreenPoint(k));let p=0,m=0,v=0,x=0;const T=this.center;for(const k of c){const A=l.bK(T.lng,k.lng),L=l.bK(T.lat,k.lat);A<m&&(m=A),A>p&&(p=A),L<x&&(x=L),L>v&&(v=L)}const P=[T.lng+m,T.lat+x,T.lng+p,T.lat+v];return this.isSurfacePointOnScreen([0,1,0])&&(P[3]=90,P[0]=-180,P[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(P[1]=-90,P[0]=-180,P[2]=180),new Mt(P)}calculateCenterFromCameraLngLatAlt(t,n,a,c){return this._helper.calculateCenterFromCameraLngLatAlt(t,n,a,c)}setLocationAtPoint(t,n){const a=di(this.unprojectScreenPoint(n)),c=di(t),p=l.bA();l.bL(p);const m=l.bA();l.bI(m,a,p,-this.center.lng*Math.PI/180),l.bH(m,m,p,this.center.lat*Math.PI/180);const v=c[0]*c[0]+c[2]*c[2],x=m[0]*m[0];if(v<x)return;const T=Math.sqrt(v-x),P=-T,k=l.bM(c[0],c[2],m[0],T),A=l.bM(c[0],c[2],m[0],P),L=l.bA();l.bI(L,c,p,-k);const N=l.bM(L[1],L[2],m[1],m[2]),W=l.bA();l.bI(W,c,p,-A);const Y=l.bM(W[1],W[2],m[1],m[2]),X=.5*Math.PI,te=N>=-X&&N<=X,fe=Y>=-X&&Y<=X;let $,he;if(te&&fe){const $e=this.center.lng*Math.PI/180,Ze=this.center.lat*Math.PI/180;l.bN(k,$e)+l.bN(N,Ze)<l.bN(A,$e)+l.bN(Y,Ze)?($=k,he=N):($=A,he=Y)}else if(te)$=k,he=N;else{if(!fe)return;$=A,he=Y}const ve=$/Math.PI*180,le=he/Math.PI*180,Me=this.center.lat;this.setCenter(new l.V(ve,l.an(le,-90,90))),this.setZoom(this.zoom+Ti(Me,this.center.lat))}locationToScreenPoint(t,n){const a=di(t);if(n){const c=n.getElevationForLngLatZoom(t,this._helper._tileZoom);l.a$(a,a,1+c/l.bE)}return this._projectSurfacePointToScreen(a)}_projectSurfacePointToScreen(t){const n=l.bF();return l.aH(n,[...t,1],this._globeViewProjMatrixNoCorrection),n[0]/=n[3],n[1]/=n[3],new l.P((.5*n[0]+.5)*this.width,(.5*-n[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,n){if(n){const a=n.pointCoordinate(t);if(a)return a}return l.a9.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,n){var a;return(a=this.screenPointToMercatorCoordinate(t,n))===null||a===void 0?void 0:a.toLngLat()}isPointOnMapSurface(t,n){const a=this._cameraPosition,c=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(a,c)}getRayDirectionFromPixel(t){const n=l.bF();n[0]=t.x/this.width*2-1,n[1]=-1*(t.y/this.height*2-1),n[2]=1,n[3]=1,l.aH(n,n,this._globeViewProjMatrixNoCorrectionInverted),n[0]/=n[3],n[1]/=n[3],n[2]/=n[3];const a=l.bA();a[0]=n[0]-this._cameraPosition[0],a[1]=n[1]-this._cameraPosition[1],a[2]=n[2]-this._cameraPosition[2];const c=l.bA();return l.b3(c,a),c}isSurfacePointVisible(t){const n=this._cachedClippingPlane;return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const n=l.bF();return l.aH(n,[...t,1],this._globeViewProjMatrixNoCorrection),n[0]/=n[3],n[1]/=n[3],n[2]/=n[3],n[0]>-1&&n[0]<1&&n[1]>-1&&n[1]<1&&n[2]>-1&&n[2]<1}rayPlanetIntersection(t,n){const a=l.b5(t,n),c=l.bA(),p=l.bA();l.a$(p,n,a),l.b2(c,t,p);const m=1-l.b5(c,c);if(m<0)return null;const v=l.b5(t,t)-1,x=-a+(a<0?1:-1)*Math.sqrt(m),T=v/x,P=x;return{tMin:Math.min(T,P),tMax:Math.max(T,P)}}unprojectScreenPoint(t){const n=this._cameraPosition,a=this.getRayDirectionFromPixel(t),c=this.rayPlanetIntersection(n,a);if(c){const P=l.bA();l.b0(P,n,[a[0]*c.tMin,a[1]*c.tMin,a[2]*c.tMin]);const k=l.bA();return l.b3(k,P),oc(k)}const p=this._cachedClippingPlane,m=p[0]*a[0]+p[1]*a[1]+p[2]*a[2],v=-l.bb(p,n)/m,x=l.bA();if(v>0)l.b0(x,n,[a[0]*v,a[1]*v,a[2]*v]);else{const P=l.bA();l.b0(P,n,[2*a[0],2*a[1],2*a[2]]);const k=l.bb(this._cachedClippingPlane,P);l.b2(x,P,[this._cachedClippingPlane[0]*k,this._cachedClippingPlane[1]*k,this._cachedClippingPlane[2]*k])}const T=(function(P){const k=l.bA();return k[0]=P[0]*-P[3],k[1]=P[1]*-P[3],k[2]=P[2]*-P[3],{center:k,radius:Math.sqrt(1-P[3]*P[3])}})(p);return oc((function(P,k,A){const L=l.bA();l.b2(L,A,P);const N=l.bA();return l.by(N,P,L,k/l.b9(L)),N})(T.center,T.radius,x))}getMatrixForModel(t,n){const a=l.V.convert(t),c=1/l.bE,p=l.bj();return l.bJ(p,p,a.lng/180*Math.PI),l.bh(p,p,-a.lat/180*Math.PI),l.O(p,p,[0,0,1+n/l.bE]),l.bh(p,p,.5*Math.PI),l.Q(p,p,[c,c,c]),p}getProjectionDataForCustomLayer(t=!0){const n=this.getProjectionData({overscaledTileID:new l.a2(0,0,0,0,0),applyGlobeMatrix:t});return n.tileMercatorCoords=[0,0,1,1],n}getFastPathSimpleProjectionMatrix(t){}}class ga{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,n,a){return this._helper.interpolatePadding(t,n,a)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,n,a=!0){this._helper.resize(t,n,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,n){this._helper.overrideNearFarZ(t,n)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,n){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=n,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(t){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(n,a)=>this.currentTransform.defaultConstrain(n,a),this.applyConstrain=(n,a)=>this._helper.applyConstrain(n,a),this._helper=new zo({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(n,a)=>this.defaultConstrain(n,a)},t),this._globeness=1,this._mercatorTransform=new Do,this._verticalPerspectiveTransform=new ma}clone(){const t=new ga;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this,!1),t}apply(t,n){this._helper.apply(t,n),this._mercatorTransform.apply(this,!1),this._verticalPerspectiveTransform.apply(this,!1,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const n=this._mercatorTransform.getProjectionData(t),a=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?a.mainMatrix:n.mainMatrix,clippingPlane:a.clippingPlane,tileMercatorCoords:a.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:n.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return l.bu(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return l.bu(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,n,a){const c=this._mercatorTransform.getPitchedTextCorrection(t,n,a),p=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,n,a);return l.bu(c,p,this._globeness)}projectTileCoordinates(t,n,a,c){return this.currentTransform.projectTileCoordinates(t,n,a,c)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,!1,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,n){return this.currentTransform.lngLatToCameraDepth(t,n)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(t,n,a,c){return this._helper.calculateCenterFromCameraLngLatAlt(t,n,a,c)}setLocationAtPoint(t,n){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,n),void this.apply(this._mercatorTransform,!1);this._verticalPerspectiveTransform.setLocationAtPoint(t,n),this.apply(this._verticalPerspectiveTransform,!1)}locationToScreenPoint(t,n){return this.currentTransform.locationToScreenPoint(t,n)}screenPointToMercatorCoordinate(t,n){return this.currentTransform.screenPointToMercatorCoordinate(t,n)}screenPointToLocation(t,n){return this.currentTransform.screenPointToLocation(t,n)}isPointOnMapSurface(t,n){return this.currentTransform.isPointOnMapSurface(t,n)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,n){return this.currentTransform.getMatrixForModel(t,n)}getProjectionDataForCustomLayer(t=!0){const n=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return n;const a=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return a.fallbackMatrix=n.mainMatrix,a}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class Ri{get useGlobeControls(){return!0}handlePanInertia(t,n){const a=Au(t,n);return Math.abs(a.lng-n.center.lng)>180&&(a.lng=n.center.lng+179.5*Math.sign(a.lng-n.center.lng)),{easingCenter:a,easingOffset:new l.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,n){const a=t.around,c=n.screenPointToLocation(a);t.bearingDelta&&n.setBearing(n.bearing+t.bearingDelta),t.pitchDelta&&n.setPitch(n.pitch+t.pitchDelta),t.rollDelta&&n.setRoll(n.roll+t.rollDelta);const p=n.zoom;t.zoomDelta&&n.setZoom(n.zoom+t.zoomDelta);const m=n.zoom-p;if(m===0)return;const v=l.bK(n.center.lng,c.lng),x=v/(Math.abs(v/180)+1),T=l.bK(n.center.lat,c.lat),P=n.getRayDirectionFromPixel(a),k=n.cameraPosition,A=-1*l.b5(k,P),L=l.bA();l.b0(L,k,[P[0]*A,P[1]*A,P[2]*A]);const N=l.b7(L)-1,W=Math.exp(.5*-Math.max(N-.3,0)),Y=Ro(n.worldSize,n.center.lat)/Math.min(n.width,n.height),X=l.bx(Y,.9,.5,1,.25),te=(1-l.aq(-m))*Math.min(W,X),fe=n.center.lat,$=n.zoom,he=new l.V(n.center.lng+x*te,l.an(n.center.lat+T*te,-l.ao,l.ao));n.setLocationAtPoint(c,a);const ve=n.center,le=l.bx(Math.abs(v),45,85,0,1),Me=l.bx(Y,.75,.35,0,1),$e=Math.pow(Math.max(le,Me),.25),Ze=l.bK(ve.lng,he.lng),We=l.bK(ve.lat,he.lat);n.setCenter(new l.V(ve.lng+Ze*$e,ve.lat+We*$e).wrap()),n.setZoom($+Ti(fe,n.center.lat))}handleMapControlsPan(t,n,a){if(!t.panDelta)return;const c=n.center.lat,p=n.zoom;n.setCenter(Au(t.panDelta,n).wrap()),n.setZoom(p+Ti(c,n.center.lat))}cameraForBoxAndBearing(t,n,a,c,p){const m=ic(t,n,a,c,p),v=n.left/p.width*2-1,x=(p.width-n.right)/p.width*2-1,T=n.top/p.height*-2+1,P=(p.height-n.bottom)/p.height*-2+1,k=l.bK(a.getWest(),a.getEast())<0,A=k?a.getEast():a.getWest(),L=k?a.getWest():a.getEast(),N=Math.max(a.getNorth(),a.getSouth()),W=Math.min(a.getNorth(),a.getSouth()),Y=A+.5*l.bK(A,L),X=N+.5*l.bK(N,W),te=p.clone();te.setCenter(m.center),te.setBearing(m.bearing),te.setPitch(0),te.setRoll(0),te.setZoom(m.zoom);const fe=te.modelViewProjectionMatrix,$=[di(a.getNorthWest()),di(a.getNorthEast()),di(a.getSouthWest()),di(a.getSouthEast()),di(new l.V(L,X)),di(new l.V(A,X)),di(new l.V(Y,N)),di(new l.V(Y,W))],he=di(m.center);let ve=Number.POSITIVE_INFINITY;for(const le of $)v<0&&(ve=Ri.getLesserNonNegativeNonNull(ve,Ri.solveVectorScale(le,he,fe,"x",v))),x>0&&(ve=Ri.getLesserNonNegativeNonNull(ve,Ri.solveVectorScale(le,he,fe,"x",x))),T>0&&(ve=Ri.getLesserNonNegativeNonNull(ve,Ri.solveVectorScale(le,he,fe,"y",T))),P<0&&(ve=Ri.getLesserNonNegativeNonNull(ve,Ri.solveVectorScale(le,he,fe,"y",P)));if(Number.isFinite(ve)&&ve!==0)return m.zoom=te.zoom+l.at(ve),m;eo()}handleJumpToCenterZoom(t,n){const a=t.center.lat,c=t.applyConstrain(n.center?l.V.convert(n.center):t.center,t.zoom).center;t.setCenter(c.wrap());const p=n.zoom!==void 0?+n.zoom:t.zoom+Ti(a,c.lat);t.zoom!==p&&t.setZoom(p)}handleEaseTo(t,n){const a=t.zoom,c=t.center,p=t.padding,m={roll:t.roll,pitch:t.pitch,bearing:t.bearing},v={roll:n.roll===void 0?t.roll:n.roll,pitch:n.pitch===void 0?t.pitch:n.pitch,bearing:n.bearing===void 0?t.bearing:n.bearing},x=n.zoom!==void 0,T=!t.isPaddingEqual(n.padding);let P=!1;const k=n.center?l.V.convert(n.center):c,A=t.applyConstrain(k,a).center;go(t,A);const L=t.clone();L.setCenter(A),L.setZoom(x?+n.zoom:a+Ti(c.lat,k.lat)),L.setBearing(n.bearing);const N=new l.P(l.an(t.centerPoint.x+n.offsetAsPoint.x,0,t.width),l.an(t.centerPoint.y+n.offsetAsPoint.y,0,t.height));L.setLocationAtPoint(A,N);const W=(n.offset&&n.offsetAsPoint.mag())>0?L.center:A,Y=x?+n.zoom:a+Ti(c.lat,W.lat),X=a+Ti(c.lat,0),te=Y+Ti(W.lat,0),fe=l.bK(c.lng,W.lng),$=l.bK(c.lat,W.lat),he=l.aq(te-X);return P=Y!==a,{easeFunc:ve=>{if(l.bo(m,v)||Iu({startEulerAngles:m,endEulerAngles:v,tr:t,k:ve,useSlerp:m.roll!=v.roll}),T&&t.interpolatePadding(p,n.padding,ve),n.around)l.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(n.around,n.aroundPoint);else{const le=te>X?Math.min(2,he):Math.max(.5,he),Me=Math.pow(le,1-ve),$e=ku(c,fe,$,ve*Me);t.setCenter($e.wrap())}if(P){const le=l.G.number(X,te,ve)+Ti(0,t.center.lat);t.setZoom(le)}},isZooming:P,elevationCenter:W}}handleFlyTo(t,n){const a=n.zoom!==void 0,c=t.center,p=t.zoom,m=t.padding,v=!t.isPaddingEqual(n.padding),x=t.applyConstrain(l.V.convert(n.center||n.locationAtOffset),p).center,T=a?+n.zoom:t.zoom+Ti(t.center.lat,x.lat),P=t.clone();P.setCenter(x),P.setZoom(T),P.setBearing(n.bearing);const k=new l.P(l.an(t.centerPoint.x+n.offsetAsPoint.x,0,t.width),l.an(t.centerPoint.y+n.offsetAsPoint.y,0,t.height));P.setLocationAtPoint(x,k);const A=P.center;go(t,A);const L=(function($,he,ve){const le=di(he),Me=di(ve),$e=l.b5(le,Me),Ze=Math.acos($e),We=cn($);return Ze/(2*Math.PI)*We})(t,c,A),N=p+Ti(c.lat,0),W=T+Ti(A.lat,0),Y=l.aq(W-N);let X;if(typeof n.minZoom=="number"){const $=+n.minZoom+Ti(A.lat,0),he=Math.min($,N,W)+Ti(0,A.lat),ve=t.applyConstrain(A,he).zoom+Ti(A.lat,0);X=l.aq(ve-N)}const te=l.bK(c.lng,A.lng),fe=l.bK(c.lat,A.lat);return{easeFunc:($,he,ve,le)=>{const Me=ku(c,te,fe,ve);v&&t.interpolatePadding(m,n.padding,$);const $e=$===1?A:Me;t.setCenter($e.wrap());const Ze=N+l.at(he);t.setZoom($===1?T:Ze+Ti(0,$e.lat))},scaleOfZoom:Y,targetCenter:A,scaleOfMinZoom:X,pixelPathLength:L}}static solveVectorScale(t,n,a,c,p){const m=c==="x"?[a[0],a[4],a[8],a[12]]:[a[1],a[5],a[9],a[13]],v=[a[3],a[7],a[11],a[15]],x=t[0]*m[0]+t[1]*m[1]+t[2]*m[2],T=t[0]*v[0]+t[1]*v[1]+t[2]*v[2],P=n[0]*m[0]+n[1]*m[1]+n[2]*m[2],k=n[0]*v[0]+n[1]*v[1]+n[2]*v[2];return P+p*T===x+p*k||v[3]*(x-P)+m[3]*(k-T)+x*k==P*T?null:(P+m[3]-p*k-p*v[3])/(P-x-p*k+p*T)}static getLesserNonNegativeNonNull(t,n){return n!==null&&n>=0&&n<t?n:t}}class zu{constructor(t){this._globe=t,this._mercatorCameraHelper=new Lo,this._verticalPerspectiveCameraHelper=new Ri}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,n){return this.currentHelper.handlePanInertia(t,n)}handleMapControlsRollPitchBearingZoom(t,n){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,n)}handleMapControlsPan(t,n,a){this.currentHelper.handleMapControlsPan(t,n,a)}cameraForBoxAndBearing(t,n,a,c,p){return this.currentHelper.cameraForBoxAndBearing(t,n,a,c,p)}handleJumpToCenterZoom(t,n){this.currentHelper.handleJumpToCenterZoom(t,n)}handleEaseTo(t,n){return this.currentHelper.handleEaseTo(t,n)}handleFlyTo(t,n){return this.currentHelper.handleFlyTo(t,n)}}const _a=(d,t)=>l.B(d,t&&t.filter((n=>n.identifier!=="source.canvas"))),$a=l.bO();class Fo extends l.E{constructor(t,n={}){var a,c;super(),this._rtlPluginLoaded=()=>{for(const m in this.tileManagers){const v=this.tileManagers[m].getSource().type;v!=="vector"&&v!=="geojson"||this.tileManagers[m].reload()}},this.map=t,this.dispatcher=new It(it(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",((m,v)=>this.getGlyphs(m,v))),this.dispatcher.registerMessageHandler("GI",((m,v)=>this.getImages(m,v))),this.dispatcher.registerMessageHandler("GDA",((m,v)=>this.getDashes(m,v))),this.imageManager=new ft,this.imageManager.setEventedParent(this);const p=((a=t._container)===null||a===void 0?void 0:a.lang)||typeof document<"u"&&((c=document.documentElement)===null||c===void 0?void 0:c.lang)||void 0;this.glyphManager=new Se(t._requestManager,n.localIdeographFontFamily,p),this.lineAtlas=new ee(256,512),this.crossTileSymbolIndex=new dn,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",l.bP()),V().on(ce,this._rtlPluginLoaded),this.on("data",(m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const v=this.tileManagers[m.sourceId];if(!v)return;const x=v.getSource();if(x&&x.vectorLayerIds)for(const T in this._layers){const P=this._layers[T];P.source===x.id&&this._validateLayer(P)}}))}_setInitialValues(){var t;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new l.bQ,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((t=this.crossTileSymbolIndex)===null||t===void 0?void 0:t.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(t,n){var a,c,p;this._checkLoaded();const m=n===null?(p=(c=(a=this.stylesheet.state)===null||a===void 0?void 0:a[t])===null||c===void 0?void 0:c.default)!==null&&p!==void 0?p:null:n;if(l.bR(m,this._globalState[t]))return this;this._globalState[t]=m,this._applyGlobalStateChanges([t])}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const n=[];for(const a in t)!l.bR(this._globalState[a],t[a].default)&&(n.push(a),this._globalState[a]=t[a].default);this._applyGlobalStateChanges(n)}_applyGlobalStateChanges(t){if(t.length===0)return;const n=new Set,a={};for(const c of t){a[c]=this._globalState[c];for(const p in this._layers){const m=this._layers[p],v=m.getLayoutAffectingGlobalStateRefs(),x=m.getPaintAffectingGlobalStateRefs(),T=m.getVisibilityAffectingGlobalStateRefs();if(v.has(c)&&n.add(m.source),x.has(c))for(const{name:P,value:k}of x.get(c))this._updatePaintProperty(m,P,k);T?.has(c)&&(m.recalculateVisibility(),this._updateLayer(m))}}this.dispatcher.broadcast("UGS",a);for(const c in this.tileManagers)n.has(c)&&(this._reloadSource(c),this._changed=!0)}loadURL(t,n={},a){this.fire(new l.l("dataloading",{dataType:"style"})),n.validate=typeof n.validate!="boolean"||n.validate;const c=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const p=this._loadStyleRequest;l.j(c,this._loadStyleRequest).then((m=>{this._loadStyleRequest=null,this._load(m.data,n,a)})).catch((m=>{this._loadStyleRequest=null,m&&!p.signal.aborted&&this.fire(new l.k(m))}))}loadJSON(t,n={},a){this.fire(new l.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Xe.frameAsync(this._frameRequest,this.map._ownerWindow).then((()=>{this._frameRequest=null,n.validate=n.validate!==!1,this._load(t,n,a)})).catch((()=>{}))}loadEmpty(){this.fire(new l.l("dataloading",{dataType:"style"})),this._load($a,{validate:!1})}_load(t,n,a){var c,p;let m=n.transformStyle?n.transformStyle(a,t):t;if(!n.validate||!_a(this,l.C(m))){m=Object.assign({},m),this._loaded=!0,this.stylesheet=m;for(const v in m.sources)this.addSource(v,m.sources[v],{validate:!1});m.sprite?this._loadSprite(m.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(m.glyphs),this._createLayers(),this.light=new we(this.stylesheet.light),this._setProjectionInternal(((c=this.stylesheet.projection)===null||c===void 0?void 0:c.type)||"mercator"),this.sky=new ie(this.stylesheet.sky),this.map.setTerrain((p=this.stylesheet.terrain)!==null&&p!==void 0?p:null),this.fire(new l.l("data",{dataType:"style"})),this.fire(new l.l("style.load"))}}_createLayers(){var t,n,a;const c=l.bS(this.stylesheet.layers);this.setGlobalState((t=this.stylesheet.state)!==null&&t!==void 0?t:null),this.dispatcher.broadcast("SL",c),this._order=c.map((p=>p.id)),this._layers={},this._serializedLayers=null;for(const p of c){const m=l.bT(p,this._globalState);if(m.setEventedParent(this,{layer:{id:p.id}}),this._layers[p.id]=m,l.bU(m)&&this.tileManagers[m.source]){const v=(a=(n=p.paint)===null||n===void 0?void 0:n["raster-fade-duration"])!==null&&a!==void 0?a:m.paint.get("raster-fade-duration");this.tileManagers[m.source].setRasterFadeDuration(v)}}}_loadSprite(t,n=!1,a=void 0){this.imageManager.setLoaded(!1);const c=new AbortController;let p;this._spriteRequest=c,(function(m,v,x,T){return l._(this,void 0,void 0,(function*(){const P=lt(m),k=x>1?"@2x":"",A={},L={};for(const{id:N,url:W}of P){const Y=v.transformRequest(Re(W,k,".json"),"SpriteJSON");A[N]=l.j(Y,T);const X=v.transformRequest(Re(W,k,".png"),"SpriteImage");L[N]=Oe.getImage(X,T)}return yield Promise.all([...Object.values(A),...Object.values(L)]),(function(N,W){return l._(this,void 0,void 0,(function*(){const Y={};for(const X in N){Y[X]={};const te=Xe.getImageCanvasContext((yield W[X]).data),fe=(yield N[X]).data;for(const $ in fe){const{width:he,height:ve,x:le,y:Me,sdf:$e,pixelRatio:Ze,stretchX:We,stretchY:Ye,content:At,textFitWidth:kt,textFitHeight:yt}=fe[$];Y[X][$]={data:null,pixelRatio:Ze,sdf:$e,stretchX:We,stretchY:Ye,content:At,textFitWidth:kt,textFitHeight:yt,spriteData:{width:he,height:ve,x:le,y:Me,context:te}}}}return Y}))})(A,L)}))})(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((m=>{if(this._spriteRequest=null,m)for(const v in m){this._spritesImagesIds[v]=[];const x=this._spritesImagesIds[v]?this._spritesImagesIds[v].filter((T=>!(T in m))):[];for(const T of x)this.imageManager.removeImage(T),this._changedImages[T]=!0;for(const T in m[v]){const P=v==="default"?T:`${v}:${T}`;this._spritesImagesIds[v].push(P),P in this.imageManager.images?this.imageManager.updateImage(P,m[v][T],!1):this.imageManager.addImage(P,m[v][T]),n&&(this._changedImages[P]=!0)}}})).catch((m=>{this._spriteRequest=null,p=m,c.signal.aborted||this.fire(new l.k(p))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"})),a&&a(p)}))}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}_validateLayer(t){const n=this.tileManagers[t.source];if(!n)return;const a=t.sourceLayer;if(!a)return;const c=n.getSource();(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(a)===-1)&&this.fire(new l.k(new Error(`Source layer "${a}" does not exist on source "${c.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.tileManagers)if(!this.tileManagers[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,n=!1){const a=this._serializedAllLayers();if(!t||t.length===0)return Object.values(n?l.bV(a):a);const c=[];for(const p of t)if(a[p]){const m=n?l.bV(a[p]):a[p];c.push(m)}return c}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const n=Object.keys(this._layers);for(const a of n){const c=this._layers[a];c.type!=="custom"&&(t[a]=c.serialize())}return t}hasTransitions(){var t,n,a;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((n=this.sky)===null||n===void 0)&&n.hasTransition()||!((a=this.projection)===null||a===void 0)&&a.hasTransition())return!0;for(const c in this.tileManagers)if(this.tileManagers[c].hasTransition())return!0;for(const c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const n=this._changed;if(n){const c=Object.keys(this._updatedLayers),p=Object.keys(this._removedLayers);(c.length||p.length)&&this._updateWorkerLayers(c,p);for(const m in this._updatedSources){const v=this._updatedSources[m];if(v==="reload")this._reloadSource(m);else{if(v!=="clear")throw new Error(`Invalid action ${v}`);this._clearSource(m)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const m in this._updatedPaintProps)this._layers[m].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const a={};for(const c in this.tileManagers){const p=this.tileManagers[c];a[c]=p.used,p.used=!1}for(const c of this._order){const p=this._layers[c];p.recalculate(t,this._availableImages),!p.isHidden(t.zoom)&&p.source&&(this.tileManagers[p.source].used=!0)}for(const c in a){const p=this.tileManagers[c];!!a[c]!=!!p.used&&p.fire(new l.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:c}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,n&&this.fire(new l.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const n in this.tileManagers)this.tileManagers[n].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.tileManagers)this.tileManagers[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,n){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,n={}){var a;this._checkLoaded();const c=this.serialize();if(t=n.transformStyle?n.transformStyle(c,t):t,((a=n.validate)===null||a===void 0||a)&&_a(this,l.C(t)))return!1;(t=l.bV(t)).layers=l.bS(t.layers);const p=l.bW(c,t),m=this._getOperationsToPerform(p);if(m.unimplemented.length>0)throw new Error(`Unimplemented: ${m.unimplemented.join(", ")}.`);if(m.operations.length===0)return!1;for(const v of m.operations)v();return this.stylesheet=t,this._serializedLayers=null,this.fire(new l.l("style.load",{style:this})),!0}_getOperationsToPerform(t){const n=[],a=[];for(const c of t)switch(c.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":n.push((()=>this.addLayer.apply(this,c.args)));break;case"removeLayer":n.push((()=>this.removeLayer.apply(this,c.args)));break;case"setPaintProperty":n.push((()=>this.setPaintProperty.apply(this,c.args)));break;case"setLayoutProperty":n.push((()=>this.setLayoutProperty.apply(this,c.args)));break;case"setFilter":n.push((()=>this.setFilter.apply(this,c.args)));break;case"addSource":n.push((()=>this.addSource.apply(this,c.args)));break;case"removeSource":n.push((()=>this.removeSource.apply(this,c.args)));break;case"setLayerZoomRange":n.push((()=>this.setLayerZoomRange.apply(this,c.args)));break;case"setLight":n.push((()=>this.setLight.apply(this,c.args)));break;case"setGeoJSONSourceData":n.push((()=>this.setGeoJSONSourceData.apply(this,c.args)));break;case"setGlyphs":n.push((()=>this.setGlyphs.apply(this,c.args)));break;case"setSprite":n.push((()=>this.setSprite.apply(this,c.args)));break;case"setTerrain":n.push((()=>this.map.setTerrain.apply(this,c.args)));break;case"setSky":n.push((()=>this.setSky.apply(this,c.args)));break;case"setProjection":this.setProjection.apply(this,c.args);break;case"setGlobalState":n.push((()=>this.setGlobalState.apply(this,c.args)));break;case"setTransition":n.push((()=>{}));break;default:a.push(c.command)}return{operations:n,unimplemented:a}}addImage(t,n){if(this.getImage(t))return this.fire(new l.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,n),this._afterImageUpdated(t)}updateImage(t,n){this.imageManager.updateImage(t,n)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new l.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,n,a={}){if(this._checkLoaded(),this.tileManagers[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(l.C.source,`sources.${t}`,n,null,a))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const c=this.tileManagers[t]=new Kr(t,n,this.dispatcher);c.style=this,c.setEventedParent(this,(()=>({isSourceLoaded:c.loaded(),source:c.serialize(),sourceId:t}))),c.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error("There is no source with this ID");for(const a in this._layers)if(this._layers[a].source===t)return this.fire(new l.k(new Error(`Source "${t}" cannot be removed while layer "${a}" is using it.`)));const n=this.tileManagers[t];delete this.tileManagers[t],delete this._updatedSources[t],n.fire(new l.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,n){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const a=this.tileManagers[t].getSource();if(a.type!=="geojson")throw new Error(`geojsonSource.type is ${a.type}, which is !== 'geojson`);a.setData(n),this._changed=!0}getSource(t){return this.tileManagers[t]&&this.tileManagers[t].getSource()}addLayer(t,n,a={}){this._checkLoaded();const c=t.id;if(this.getLayer(c))return void this.fire(new l.k(new Error(`Layer "${c}" already exists on this map.`)));let p;if(t.type==="custom"){if(_a(this,l.bX(t)))return;p=l.bT(t,this._globalState)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(c,t.source),t=l.bV(t),t=l.e(t,{source:c})),this._validate(l.C.layer,`layers.${c}`,t,{arrayIndex:-1},a))return;p=l.bT(t,this._globalState),this._validateLayer(p),p.setEventedParent(this,{layer:{id:c}})}const m=n?this._order.indexOf(n):this._order.length;if(n&&m===-1)this.fire(new l.k(new Error(`Cannot add layer "${c}" before non-existing layer "${n}".`)));else{if(this._order.splice(m,0,c),this._layerOrderChanged=!0,this._layers[c]=p,this._removedLayers[c]&&p.source&&p.type!=="custom"){const v=this._removedLayers[c];delete this._removedLayers[c],v.type!==p.type?this._updatedSources[p.source]="clear":(this._updatedSources[p.source]="reload",this.tileManagers[p.source].pause())}this._updateLayer(p),p.onAdd&&p.onAdd(this.map)}}moveLayer(t,n){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new l.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===n)return;const a=this._order.indexOf(t);this._order.splice(a,1);const c=n?this._order.indexOf(n):this._order.length;n&&c===-1?this.fire(new l.k(new Error(`Cannot move layer "${t}" before non-existing layer "${n}".`))):(this._order.splice(c,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const n=this._layers[t];if(!n)return void this.fire(new l.k(new Error(`Cannot remove non-existing layer "${t}".`)));n.setEventedParent(null);const a=this._order.indexOf(t);this._order.splice(a,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=n,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],n.onRemove&&n.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,n,a){this._checkLoaded();const c=this.getLayer(t);c?c.minzoom===n&&c.maxzoom===a||(n!=null&&(c.minzoom=n),a!=null&&(c.maxzoom=a),this._updateLayer(c)):this.fire(new l.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,n,a={}){this._checkLoaded();const c=this.getLayer(t);if(c){if(!l.bR(c.filter,n))return n==null?(c.setFilter(void 0),void this._updateLayer(c)):void(this._validate(l.C.filter,`layers.${c.id}.filter`,n,null,a)||(c.setFilter(l.bV(n)),this._updateLayer(c)))}else this.fire(new l.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return l.bV(this.getLayer(t).filter)}setLayoutProperty(t,n,a,c={}){this._checkLoaded();const p=this.getLayer(t);p?l.bR(p.getLayoutProperty(n),a)||(p.setLayoutProperty(n,a,c),this._updateLayer(p)):this.fire(new l.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,n){const a=this.getLayer(t);if(a)return a.getLayoutProperty(n);this.fire(new l.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,n,a,c={}){this._checkLoaded();const p=this.getLayer(t);p?l.bR(p.getPaintProperty(n),a)||this._updatePaintProperty(p,n,a,c):this.fire(new l.k(new Error(`Cannot style non-existing layer "${t}".`)))}_updatePaintProperty(t,n,a,c={}){t.setPaintProperty(n,a,c)&&this._updateLayer(t),l.bU(t)&&n==="raster-fade-duration"&&this.tileManagers[t.source].setRasterFadeDuration(a),this._changed=!0,this._updatedPaintProps[t.id]=!0,this._serializedLayers=null}getPaintProperty(t,n){return this.getLayer(t).getPaintProperty(n)}setFeatureState(t,n){this._checkLoaded();const a=t.source,c=t.sourceLayer,p=this.tileManagers[a];if(p===void 0)return void this.fire(new l.k(new Error(`The source '${a}' does not exist in the map's style.`)));const m=p.getSource().type;m==="geojson"&&c?this.fire(new l.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):m!=="vector"||c?(t.id===void 0&&this.fire(new l.k(new Error("The feature id parameter must be provided."))),p.setFeatureState(c,t.id,n)):this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,n){this._checkLoaded();const a=t.source,c=this.tileManagers[a];if(c===void 0)return void this.fire(new l.k(new Error(`The source '${a}' does not exist in the map's style.`)));const p=c.getSource().type,m=p==="vector"?t.sourceLayer:void 0;p!=="vector"||m?n&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new l.k(new Error("A feature id is required to remove its specific state property."))):c.removeFeatureState(m,t.id,n):this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const n=t.source,a=t.sourceLayer,c=this.tileManagers[n];if(c!==void 0)return c.getSource().type!=="vector"||a?(t.id===void 0&&this.fire(new l.k(new Error("The feature id parameter must be provided."))),c.getFeatureState(a,t.id)):void this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.k(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=l.bY(this.tileManagers,(p=>p.serialize())),n=this._serializeByIds(this._order,!0),a=this.map.getTerrain()||void 0,c=this.stylesheet;return l.bZ({version:c.version,name:c.name,metadata:c.metadata,light:c.light,sky:c.sky,center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,sprite:c.sprite,glyphs:c.glyphs,transition:c.transition,projection:c.projection,sources:t,layers:n,terrain:a},(p=>p!==void 0))}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.tileManagers[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.tileManagers[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const n=m=>this._layers[m].type==="fill-extrusion",a={},c=[];for(let m=this._order.length-1;m>=0;m--){const v=this._order[m];if(n(v)){a[v]=m;for(const x of t){const T=x[v];if(T)for(const P of T)c.push(P)}}}c.sort(((m,v)=>v.intersectionZ-m.intersectionZ));const p=[];for(let m=this._order.length-1;m>=0;m--){const v=this._order[m];if(n(v))for(let x=c.length-1;x>=0;x--){const T=c[x].feature;if(a[T.layer.id]<m)break;p.push(T),c.pop()}else for(const x of t){const T=x[v];if(T)for(const P of T)p.push(P.feature)}}return p}queryRenderedFeatures(t,n,a){n&&n.filter&&this._validate(l.C.filter,"queryRenderedFeatures.filter",n.filter,null,n);const c={};if(n&&n.layers){if(!(Array.isArray(n.layers)||n.layers instanceof Set))return this.fire(new l.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const T of n.layers){const P=this._layers[T];if(!P)return this.fire(new l.k(new Error(`The layer '${T}' does not exist in the map's style and cannot be queried for features.`))),[];c[P.source]=!0}}const p=[];n.availableImages=this._availableImages;const m=this._serializedAllLayers(),v=n.layers instanceof Set?n.layers:Array.isArray(n.layers)?new Set(n.layers):null,x=Object.assign(Object.assign({},n),{layers:v,globalState:this._globalState});for(const T in this.tileManagers)n.layers&&!c[T]||p.push(Kt(this.tileManagers[T],this._layers,m,t,x,a,this.map.terrain?(P,k,A)=>this.map.terrain.getElevation(P,k,A):void 0));return this.placement&&p.push((function(T,P,k,A,L,N,W){const Y={},X=N.queryRenderedSymbols(A),te=[];for(const fe of Object.keys(X).map(Number))te.push(W[fe]);te.sort(Yt);for(const fe of te){const $=fe.featureIndex.lookupSymbolFeatures(X[fe.bucketInstanceId],P,fe.bucketIndex,fe.sourceLayerIndex,{filterSpec:L.filter,globalState:L.globalState},L.layers,L.availableImages,T);for(const he in $){const ve=Y[he]=Y[he]||[],le=$[he];le.sort(((Me,$e)=>{const Ze=fe.featureSortOrder;if(Ze){const We=Ze.indexOf(Me.featureIndex);return Ze.indexOf($e.featureIndex)-We}return $e.featureIndex-Me.featureIndex}));for(const Me of le)ve.push(Me)}}return(function(fe,$,he){for(const ve in fe)for(const le of fe[ve])Tr(le,he[$[ve].source]);return fe})(Y,T,k)})(this._layers,m,this.tileManagers,t,x,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(p)}querySourceFeatures(t,n){n?.filter&&this._validate(l.C.filter,"querySourceFeatures.filter",n.filter,null,n);const a=this.tileManagers[t];return a?(function(c,p){const m=c.getRenderableIds().map((T=>c.getTileByID(T))),v=[],x={};for(let T=0;T<m.length;T++){const P=m[T],k=P.tileID.canonical.key;x[k]||(x[k]=!0,P.querySourceFeatures(v,p))}return v})(a,n?Object.assign(Object.assign({},n),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(t,n={}){this._checkLoaded();const a=this.light.getLight();let c=!1;for(const m in t)if(!l.bR(t[m],a[m])){c=!0;break}if(!c)return;const p={now:Ee(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,n),this.light.updateTransitions(p)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,n={}){this._checkLoaded();const a=this.getSky();let c=!1;if(!t&&!a)return;if(t&&!a)c=!0;else if(!t&&a)c=!0;else for(const m in t)if(!l.bR(t[m],a[m])){c=!0;break}if(!c)return;const p={now:Ee(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,n),this.sky.updateTransitions(p)}_setProjectionInternal(t){const n=(function(a,c){const p={constrainOverride:c};if(Array.isArray(a)){const m=new Eu({type:a});return{projection:m,transform:new ga(p),cameraHelper:new zu(m)}}switch(a){case"mercator":return{projection:new ln,transform:new Do(p),cameraHelper:new Lo};case"globe":{const m=new Eu({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:m,transform:new ga(p),cameraHelper:new zu(m)}}case"vertical-perspective":return{projection:new nc,transform:new ma(p),cameraHelper:new Ri};default:return l.w(`Unknown projection name: ${a}. Falling back to mercator projection.`),{projection:new ln,transform:new Do(p),cameraHelper:new Lo}}})(t,this.map.transformConstrain);this.projection=n.projection,this.map.migrateProjection(n.transform,n.cameraHelper);for(const a in this.tileManagers)this.tileManagers[a].reload()}_validate(t,n,a,c,p={}){return(!p||p.validate!==!1)&&_a(this,t.call(l.C,l.e({key:n,style:this.serialize(),value:a,styleSpec:l.u},c)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),V().off(ce,this._rtlPluginLoaded);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this.tileManagers){const a=this.tileManagers[n];a.setEventedParent(null),a.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.tileManagers[t].clearTiles()}_reloadSource(t){this.tileManagers[t].resume(),this.tileManagers[t].reload()}_updateSources(t){for(const n in this.tileManagers)this.tileManagers[n].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.tileManagers)this._reloadSource(t)}_updatePlacement(t,n,a,c,p=!1){let m=!1,v=!1;const x={};for(const T of this._order){const P=this._layers[T];if(P.type!=="symbol")continue;if(!x[P.source]){const A=this.tileManagers[P.source];x[P.source]=A.getRenderableIds(!0).map((L=>A.getTileByID(L))).sort(((L,N)=>N.tileID.overscaledZ-L.tileID.overscaledZ||(L.tileID.isLessThan(N.tileID)?-1:1)))}const k=this.crossTileSymbolIndex.addLayer(P,x[P.source],t.center.lng);m=m||k}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((p=p||this._layerOrderChanged||a===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Ee(),t.zoom))&&(this.pauseablePlacement=new la(t,this.map.terrain,this._order,p,n,a,c,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,x),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Ee()),v=!0),m&&this.pauseablePlacement.placement.setStale()),v||m)for(const T of this._order){const P=this._layers[T];P.type==="symbol"&&this.placement.updateLayerOpacities(P,x[P.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Ee())}_releaseSymbolFadeTiles(){for(const t in this.tileManagers)this.tileManagers[t].releaseSymbolFadeTiles()}getImages(t,n){return l._(this,void 0,void 0,(function*(){const a=yield this.imageManager.getImages(n.icons);this._updateTilesForChangedImages();const c=this.tileManagers[n.source];return c&&c.setDependencies(n.tileID.key,n.type,n.icons),a}))}getGlyphs(t,n){return l._(this,void 0,void 0,(function*(){const a=yield this.glyphManager.getGlyphs(n.stacks),c=this.tileManagers[n.source];return c&&c.setDependencies(n.tileID.key,n.type,[""]),a}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,n={}){this._checkLoaded(),t&&this._validate(l.C.glyphs,"glyphs",t,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}getDashes(t,n){return l._(this,void 0,void 0,(function*(){const a={};for(const[c,p]of Object.entries(n.dashes))a[c]=this.lineAtlas.getDash(p.dasharray,p.round);return a}))}addSprite(t,n,a={},c){this._checkLoaded();const p=[{id:t,url:n}],m=[...lt(this.stylesheet.sprite),...p];this._validate(l.C.sprite,"sprite",m,null,a)||(this.stylesheet.sprite=m,this._loadSprite(p,!0,c))}removeSprite(t){this._checkLoaded();const n=lt(this.stylesheet.sprite);if(n.find((a=>a.id===t))){if(this._spritesImagesIds[t])for(const a of this._spritesImagesIds[t])this.imageManager.removeImage(a),this._changedImages[a]=!0;n.splice(n.findIndex((a=>a.id===t)),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}else this.fire(new l.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return lt(this.stylesheet.sprite)}setSprite(t,n={},a){this._checkLoaded(),t&&this._validate(l.C.sprite,"sprite",t,null,n)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,a):(this._unloadSprite(),a&&a(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const t in this.tileManagers){const n=this.tileManagers[t];n.setEventedParent(null),n.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const t in this._layers){const n=this._layers[t];n.setEventedParent(null),n.onRemove&&n.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var dd=l.aU([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Gs{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,n,a,c,p,m,v,x,T){this.context=t;let P=this.boundPaintVertexBuffers.length!==c.length;for(let k=0;!P&&k<c.length;k++)this.boundPaintVertexBuffers[k]!==c[k]&&(P=!0);!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==a||P||this.boundIndexBuffer!==p||this.boundVertexOffset!==m||this.boundDynamicVertexBuffer!==v||this.boundDynamicVertexBuffer2!==x||this.boundDynamicVertexBuffer3!==T?this.freshBind(n,a,c,p,m,v,x,T):(t.bindVertexArray.set(this.vao),v&&v.bind(),p&&p.dynamicDraw&&p.bind(),x&&x.bind(),T&&T.bind())}freshBind(t,n,a,c,p,m,v,x){const T=t.numAttributes,P=this.context,k=P.gl;this.vao&&this.destroy(),this.vao=P.createVertexArray(),P.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=c,this.boundVertexOffset=p,this.boundDynamicVertexBuffer=m,this.boundDynamicVertexBuffer2=v,this.boundDynamicVertexBuffer3=x,n.enableAttributes(k,t);for(const A of a)A.enableAttributes(k,t);m&&m.enableAttributes(k,t),v&&v.enableAttributes(k,t),x&&x.enableAttributes(k,t),n.bind(),n.setVertexAttribPointers(k,t,p);for(const A of a)A.bind(),A.setVertexAttribPointers(k,t,p);m&&(m.bind(),m.setVertexAttribPointers(k,t,p)),c&&c.bind(),v&&(v.bind(),v.setVertexAttribPointers(k,t,p)),x&&(x.bind(),x.setVertexAttribPointers(k,t,p)),P.currentNumAttributes=T}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const pd=(d,t,n,a,c)=>({u_texture:0,u_ele_delta:d,u_fog_matrix:t,u_fog_color:n?n.properties.get("fog-color"):l.bp.white,u_fog_ground_blend:n?n.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:c?0:n?n.calculateFogBlendOpacity(a):0,u_horizon_color:n?n.properties.get("horizon-color"):l.bp.white,u_horizon_fog_blend:n?n.properties.get("horizon-fog-blend"):1,u_is_globe_mode:c?1:0}),va={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function qs(d){const t=[];for(let n=0;n<d.length;n++){if(d[n]===null)continue;const a=d[n].split(" ");t.push(a.pop())}return t}class Du{constructor(t,n,a,c,p,m,v,x,T=[]){const P=t.gl;this.program=P.createProgram();const k=qs(n.staticAttributes),A=a?a.getBinderAttributes():[],L=k.concat(A),N=yi.prelude.staticUniforms?qs(yi.prelude.staticUniforms):[],W=v.staticUniforms?qs(v.staticUniforms):[],Y=n.staticUniforms?qs(n.staticUniforms):[],X=a?a.getBinderUniforms():[],te=N.concat(W).concat(Y).concat(X),fe=[];for(const Ze of te)fe.indexOf(Ze)<0&&fe.push(Ze);const $=a?a.defines():[];In(P)&&$.unshift("#version 300 es"),p&&$.push("#define OVERDRAW_INSPECTOR;"),m&&$.push("#define TERRAIN3D;"),x&&$.push(x),T&&$.push(...T);let he=$.concat(yi.prelude.fragmentSource,v.fragmentSource,n.fragmentSource).join(`
`),ve=$.concat(yi.prelude.vertexSource,v.vertexSource,n.vertexSource).join(`
`);In(P)||(he=(function(Ze){return Ze.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(he),ve=(function(Ze){return Ze.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(ve));const le=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);if(P.shaderSource(le,he),P.compileShader(le),!P.getShaderParameter(le,P.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${P.getShaderInfoLog(le)}`);P.attachShader(this.program,le);const Me=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);if(P.shaderSource(Me,ve),P.compileShader(Me),!P.getShaderParameter(Me,P.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${P.getShaderInfoLog(Me)}`);P.attachShader(this.program,Me),this.attributes={};const $e={};this.numAttributes=L.length;for(let Ze=0;Ze<this.numAttributes;Ze++)L[Ze]&&(P.bindAttribLocation(this.program,Ze,L[Ze]),this.attributes[L[Ze]]=Ze);if(P.linkProgram(this.program),!P.getProgramParameter(this.program,P.LINK_STATUS))throw new Error(`Program failed to link: ${P.getProgramInfoLog(this.program)}`);P.deleteShader(Me),P.deleteShader(le);for(let Ze=0;Ze<fe.length;Ze++){const We=fe[Ze];if(We&&!$e[We]){const Ye=P.getUniformLocation(this.program,We);Ye&&($e[We]=Ye)}}this.fixedUniforms=c(t,$e),this.terrainUniforms=((Ze,We)=>({u_depth:new l.b_(Ze,We.u_depth),u_terrain:new l.b_(Ze,We.u_terrain),u_terrain_dim:new l.bq(Ze,We.u_terrain_dim),u_terrain_matrix:new l.c0(Ze,We.u_terrain_matrix),u_terrain_unpack:new l.c1(Ze,We.u_terrain_unpack),u_terrain_exaggeration:new l.bq(Ze,We.u_terrain_exaggeration)}))(t,$e),this.projectionUniforms=((Ze,We)=>({u_projection_matrix:new l.c0(Ze,We.u_projection_matrix),u_projection_tile_mercator_coords:new l.c1(Ze,We.u_projection_tile_mercator_coords),u_projection_clipping_plane:new l.c1(Ze,We.u_projection_clipping_plane),u_projection_transition:new l.bq(Ze,We.u_projection_transition),u_projection_fallback_matrix:new l.c0(Ze,We.u_projection_fallback_matrix)}))(t,$e),this.binderUniforms=a?a.getUniforms(t,$e):[]}draw(t,n,a,c,p,m,v,x,T,P,k,A,L,N,W,Y,X,te,fe){const $=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(a),t.setStencilMode(c),t.setColorMode(p),t.setCullFace(m),x){t.activeTexture.set($.TEXTURE2),$.bindTexture($.TEXTURE_2D,x.depthTexture),t.activeTexture.set($.TEXTURE3),$.bindTexture($.TEXTURE_2D,x.texture);for(const ve in this.terrainUniforms)this.terrainUniforms[ve].set(x[ve])}if(T)for(const ve in T)this.projectionUniforms[va[ve]].set(T[ve]);if(v)for(const ve in this.fixedUniforms)this.fixedUniforms[ve].set(v[ve]);Y&&Y.setUniforms(t,this.binderUniforms,N,{zoom:W});let he=0;switch(n){case $.LINES:he=2;break;case $.TRIANGLES:he=3;break;case $.LINE_STRIP:he=1}for(const ve of L.get()){const le=ve.vaos||(ve.vaos={});(le[P]||(le[P]=new Gs)).bind(t,this,k,Y?Y.getPaintVertexBuffers():[],A,ve.vertexOffset,X,te,fe),$.drawElements(n,ve.primitiveLength*he,$.UNSIGNED_SHORT,ve.primitiveOffset*he*2)}}}function Lu(d,t,n){const a=1/l.aN(n,1,t.transform.tileZoom),c=Math.pow(2,n.tileID.overscaledZ),p=n.tileSize*Math.pow(2,t.transform.tileZoom)/c,m=p*(n.tileID.canonical.x+n.tileID.wrap*c),v=p*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[a,d.fromScale,d.toScale],u_fade:d.t,u_pixel_coord_upper:[m>>16,v>>16],u_pixel_coord_lower:[65535&m,65535&v]}}const lc=(d,t,n,a)=>{const c=d.style.light,p=c.properties.get("position"),m=[p.x,p.y,p.z],v=l.c4();c.properties.get("anchor")==="viewport"&&l.c5(v,d.transform.bearingInRadians),l.c6(m,m,v);const x=d.transform.transformLightDirection(m),T=c.properties.get("color");return{u_lightpos:m,u_lightpos_globe:x,u_lightintensity:c.properties.get("intensity"),u_lightcolor:[T.r,T.g,T.b],u_vertical_gradient:+t,u_opacity:n,u_fill_translate:a}},cc=(d,t,n,a,c,p,m)=>l.e(lc(d,t,n,a),Lu(p,d,m),{u_height_factor:-Math.pow(2,c.overscaledZ)/m.tileSize/8}),uc=(d,t,n,a)=>l.e(Lu(t,d,n),{u_fill_translate:a}),Ru=(d,t)=>({u_world:d,u_fill_translate:t}),Fu=(d,t,n,a,c)=>l.e(uc(d,t,n,c),{u_world:a}),Ou=(d,t,n,a,c)=>{const p=d.transform;let m,v,x=0;if(n.paint.get("circle-pitch-alignment")==="map"){const T=l.aN(t,1,p.zoom);m=!0,v=[T,T],x=T/(l.a5*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*c}else m=!1,v=p.pixelsToGLUnits;return{u_camera_to_center_distance:p.cameraToCenterDistance,u_scale_with_map:+(n.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+m,u_device_pixel_ratio:d.pixelRatio,u_extrude_scale:v,u_globe_extrude_scale:x,u_translate:a}},Oo=d=>({u_pixel_extrude_scale:[1/d.width,1/d.height]}),Bu=d=>({u_viewport_size:[d.width,d.height]}),hc=(d,t=1)=>({u_color:d,u_overlay:0,u_overlay_scale:t}),ya=(d,t,n,a)=>{const c=l.aN(d,1,t)/(l.a5*Math.pow(2,d.tileID.overscaledZ))*2*Math.PI*a;return{u_extrude_scale:l.aN(d,1,t),u_intensity:n,u_globe_extrude_scale:c}},Nu=(d,t,n,a)=>{const c=l.N();l.c7(c,0,d.width,d.height,0,0,1);const p=d.context.gl;return{u_matrix:c,u_world:[p.drawingBufferWidth,p.drawingBufferHeight],u_image:n,u_color_ramp:a,u_opacity:t.paint.get("heatmap-opacity")}},Zs=(d,t,n)=>{const a=n.paint.get("hillshade-accent-color");let c;switch(n.paint.get("hillshade-method")){case"basic":c=4;break;case"combined":c=1;break;case"igor":c=2;break;case"multidirectional":c=3;break;default:c=0}const p=n.getIlluminationProperties();for(let m=0;m<p.directionRadians.length;m++)n.paint.get("hillshade-illumination-anchor")==="viewport"&&(p.directionRadians[m]+=d.transform.bearingInRadians);return{u_image:0,u_latrange:md(0,t.tileID),u_exaggeration:n.paint.get("hillshade-exaggeration"),u_altitudes:p.altitudeRadians,u_azimuths:p.directionRadians,u_accent:a,u_method:c,u_highlights:p.highlightColor,u_shadows:p.shadowColor}},fd=(d,t)=>{const n=t.stride,a=l.N();return l.c7(a,0,l.a5,-l.a5,0,0,1),l.O(a,a,[0,-l.a5,0]),{u_matrix:a,u_image:1,u_dimension:[n,n],u_zoom:d.overscaledZ,u_unpack:t.getUnpackVector()}};function md(d,t){const n=Math.pow(2,t.canonical.z),a=t.canonical.y;return[new l.a9(0,a/n).toLngLat().lat,new l.a9(0,(a+1)/n).toLngLat().lat]}const Vu=(d,t,n=0)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:n,u_opacity:d.paint.get("color-relief-opacity")}),es=(d,t,n,a)=>{const c=d.transform;return{u_translation:Ws(d,t,n),u_ratio:a/l.aN(t,1,c.zoom),u_device_pixel_ratio:d.pixelRatio,u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]]}},ju=(d,t,n,a,c)=>l.e(es(d,t,n,a),{u_image:0,u_image_height:c}),dc=(d,t,n,a,c)=>{const p=d.transform,m=Fn(t,p);return{u_translation:Ws(d,t,n),u_texsize:t.imageAtlasTexture.size,u_ratio:a/l.aN(t,1,p.zoom),u_device_pixel_ratio:d.pixelRatio,u_image:0,u_scale:[m,c.fromScale,c.toScale],u_fade:c.t,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},Uu=(d,t,n,a,c)=>{const p=Fn(t,d.transform);return l.e(es(d,t,n,a),{u_tileratio:p,u_crossfade_from:c.fromScale,u_crossfade_to:c.toScale,u_image:0,u_mix:c.t,u_lineatlas_width:d.lineAtlas.width,u_lineatlas_height:d.lineAtlas.height})},Hs=(d,t,n,a,c,p)=>{const m=Fn(t,d.transform);return l.e(es(d,t,n,a),{u_image:0,u_image_height:p,u_tileratio:m,u_crossfade_from:c.fromScale,u_crossfade_to:c.toScale,u_image_dash:1,u_mix:c.t,u_lineatlas_width:d.lineAtlas.width,u_lineatlas_height:d.lineAtlas.height})};function Fn(d,t){return 1/l.aN(d,1,t.tileZoom)}function Ws(d,t,n){return l.aO(d.transform,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const pc=(d,t,n,a,c)=>{return{u_tl_parent:d,u_scale_parent:t,u_buffer_scale:1,u_fade_t:n.mix,u_opacity:n.opacity*a.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:a.paint.get("raster-brightness-min"),u_brightness_high:a.paint.get("raster-brightness-max"),u_saturation_factor:(m=a.paint.get("raster-saturation"),m>0?1-1/(1.001-m):-m),u_contrast_factor:(p=a.paint.get("raster-contrast"),p>0?1/(1-p):1+p),u_spin_weights:fc(a.paint.get("raster-hue-rotate")),u_coords_top:[c[0].x,c[0].y,c[1].x,c[1].y],u_coords_bottom:[c[3].x,c[3].y,c[2].x,c[2].y]};var p,m};function fc(d){d*=Math.PI/180;const t=Math.sin(d),n=Math.cos(d);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const mc=(d,t,n,a,c,p,m,v,x,T,P,k,A)=>{const L=m.transform;return{u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:L.cameraToCenterDistance,u_pitch:L.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:L.width/L.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_label_plane_matrix:v,u_coord_matrix:x,u_is_text:+P,u_pitch_with_map:+a,u_is_along_line:c,u_is_variable_anchor:p,u_texsize:k,u_texture:0,u_translation:T,u_pitched_scale:A}},Xs=(d,t,n,a,c,p,m,v,x,T,P,k,A,L)=>{const N=m.transform;return l.e(mc(d,t,n,a,c,p,m,v,x,T,P,k,L),{u_gamma_scale:a?Math.cos(N.pitch*Math.PI/180)*N.cameraToCenterDistance:1,u_device_pixel_ratio:m.pixelRatio,u_is_halo:1})},Bo=(d,t,n,a,c,p,m,v,x,T,P,k,A)=>l.e(Xs(d,t,n,a,c,p,m,v,x,T,!0,P,0,A),{u_texsize_icon:k,u_texture_icon:1}),gc=(d,t)=>({u_opacity:d,u_color:t}),gd=(d,t,n,a,c)=>l.e((function(p,m,v,x){const T=v.imageManager.getPattern(p.from.toString()),P=v.imageManager.getPattern(p.to.toString()),{width:k,height:A}=v.imageManager.getPixelSize(),L=Math.pow(2,x.tileID.overscaledZ),N=x.tileSize*Math.pow(2,v.transform.tileZoom)/L,W=N*(x.tileID.canonical.x+x.tileID.wrap*L),Y=N*x.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:T.tl,u_pattern_br_a:T.br,u_pattern_tl_b:P.tl,u_pattern_br_b:P.br,u_texsize:[k,A],u_mix:m.t,u_pattern_size_a:T.displaySize,u_pattern_size_b:P.displaySize,u_scale_a:m.fromScale,u_scale_b:m.toScale,u_tile_units_to_pixels:1/l.aN(x,1,v.transform.tileZoom),u_pixel_coord_upper:[W>>16,Y>>16],u_pixel_coord_lower:[65535&W,65535&Y]}})(n,c,t,a),{u_opacity:d}),Gu=(d,t)=>{},_d={fillExtrusion:(d,t)=>({u_lightpos:new l.c2(d,t.u_lightpos),u_lightpos_globe:new l.c2(d,t.u_lightpos_globe),u_lightintensity:new l.bq(d,t.u_lightintensity),u_lightcolor:new l.c2(d,t.u_lightcolor),u_vertical_gradient:new l.bq(d,t.u_vertical_gradient),u_opacity:new l.bq(d,t.u_opacity),u_fill_translate:new l.c3(d,t.u_fill_translate)}),fillExtrusionPattern:(d,t)=>({u_lightpos:new l.c2(d,t.u_lightpos),u_lightpos_globe:new l.c2(d,t.u_lightpos_globe),u_lightintensity:new l.bq(d,t.u_lightintensity),u_lightcolor:new l.c2(d,t.u_lightcolor),u_vertical_gradient:new l.bq(d,t.u_vertical_gradient),u_height_factor:new l.bq(d,t.u_height_factor),u_opacity:new l.bq(d,t.u_opacity),u_fill_translate:new l.c3(d,t.u_fill_translate),u_image:new l.b_(d,t.u_image),u_texsize:new l.c3(d,t.u_texsize),u_pixel_coord_upper:new l.c3(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.c3(d,t.u_pixel_coord_lower),u_scale:new l.c2(d,t.u_scale),u_fade:new l.bq(d,t.u_fade)}),fill:(d,t)=>({u_fill_translate:new l.c3(d,t.u_fill_translate)}),fillPattern:(d,t)=>({u_image:new l.b_(d,t.u_image),u_texsize:new l.c3(d,t.u_texsize),u_pixel_coord_upper:new l.c3(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.c3(d,t.u_pixel_coord_lower),u_scale:new l.c2(d,t.u_scale),u_fade:new l.bq(d,t.u_fade),u_fill_translate:new l.c3(d,t.u_fill_translate)}),fillOutline:(d,t)=>({u_world:new l.c3(d,t.u_world),u_fill_translate:new l.c3(d,t.u_fill_translate)}),fillOutlinePattern:(d,t)=>({u_world:new l.c3(d,t.u_world),u_image:new l.b_(d,t.u_image),u_texsize:new l.c3(d,t.u_texsize),u_pixel_coord_upper:new l.c3(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.c3(d,t.u_pixel_coord_lower),u_scale:new l.c2(d,t.u_scale),u_fade:new l.bq(d,t.u_fade),u_fill_translate:new l.c3(d,t.u_fill_translate)}),circle:(d,t)=>({u_camera_to_center_distance:new l.bq(d,t.u_camera_to_center_distance),u_scale_with_map:new l.b_(d,t.u_scale_with_map),u_pitch_with_map:new l.b_(d,t.u_pitch_with_map),u_extrude_scale:new l.c3(d,t.u_extrude_scale),u_device_pixel_ratio:new l.bq(d,t.u_device_pixel_ratio),u_globe_extrude_scale:new l.bq(d,t.u_globe_extrude_scale),u_translate:new l.c3(d,t.u_translate)}),collisionBox:(d,t)=>({u_pixel_extrude_scale:new l.c3(d,t.u_pixel_extrude_scale)}),collisionCircle:(d,t)=>({u_viewport_size:new l.c3(d,t.u_viewport_size)}),debug:(d,t)=>({u_color:new l.b$(d,t.u_color),u_overlay:new l.b_(d,t.u_overlay),u_overlay_scale:new l.bq(d,t.u_overlay_scale)}),depth:Gu,clippingMask:Gu,heatmap:(d,t)=>({u_extrude_scale:new l.bq(d,t.u_extrude_scale),u_intensity:new l.bq(d,t.u_intensity),u_globe_extrude_scale:new l.bq(d,t.u_globe_extrude_scale)}),heatmapTexture:(d,t)=>({u_matrix:new l.c0(d,t.u_matrix),u_world:new l.c3(d,t.u_world),u_image:new l.b_(d,t.u_image),u_color_ramp:new l.b_(d,t.u_color_ramp),u_opacity:new l.bq(d,t.u_opacity)}),hillshade:(d,t)=>({u_image:new l.b_(d,t.u_image),u_latrange:new l.c3(d,t.u_latrange),u_exaggeration:new l.bq(d,t.u_exaggeration),u_altitudes:new l.c9(d,t.u_altitudes),u_azimuths:new l.c9(d,t.u_azimuths),u_accent:new l.b$(d,t.u_accent),u_method:new l.b_(d,t.u_method),u_shadows:new l.c8(d,t.u_shadows),u_highlights:new l.c8(d,t.u_highlights)}),hillshadePrepare:(d,t)=>({u_matrix:new l.c0(d,t.u_matrix),u_image:new l.b_(d,t.u_image),u_dimension:new l.c3(d,t.u_dimension),u_zoom:new l.bq(d,t.u_zoom),u_unpack:new l.c1(d,t.u_unpack)}),colorRelief:(d,t)=>({u_image:new l.b_(d,t.u_image),u_unpack:new l.c1(d,t.u_unpack),u_dimension:new l.c3(d,t.u_dimension),u_elevation_stops:new l.b_(d,t.u_elevation_stops),u_color_stops:new l.b_(d,t.u_color_stops),u_color_ramp_size:new l.b_(d,t.u_color_ramp_size),u_opacity:new l.bq(d,t.u_opacity)}),line:(d,t)=>({u_translation:new l.c3(d,t.u_translation),u_ratio:new l.bq(d,t.u_ratio),u_device_pixel_ratio:new l.bq(d,t.u_device_pixel_ratio),u_units_to_pixels:new l.c3(d,t.u_units_to_pixels)}),lineGradient:(d,t)=>({u_translation:new l.c3(d,t.u_translation),u_ratio:new l.bq(d,t.u_ratio),u_device_pixel_ratio:new l.bq(d,t.u_device_pixel_ratio),u_units_to_pixels:new l.c3(d,t.u_units_to_pixels),u_image:new l.b_(d,t.u_image),u_image_height:new l.bq(d,t.u_image_height)}),linePattern:(d,t)=>({u_translation:new l.c3(d,t.u_translation),u_texsize:new l.c3(d,t.u_texsize),u_ratio:new l.bq(d,t.u_ratio),u_device_pixel_ratio:new l.bq(d,t.u_device_pixel_ratio),u_image:new l.b_(d,t.u_image),u_units_to_pixels:new l.c3(d,t.u_units_to_pixels),u_scale:new l.c2(d,t.u_scale),u_fade:new l.bq(d,t.u_fade)}),lineSDF:(d,t)=>({u_translation:new l.c3(d,t.u_translation),u_ratio:new l.bq(d,t.u_ratio),u_device_pixel_ratio:new l.bq(d,t.u_device_pixel_ratio),u_units_to_pixels:new l.c3(d,t.u_units_to_pixels),u_image:new l.b_(d,t.u_image),u_mix:new l.bq(d,t.u_mix),u_tileratio:new l.bq(d,t.u_tileratio),u_crossfade_from:new l.bq(d,t.u_crossfade_from),u_crossfade_to:new l.bq(d,t.u_crossfade_to),u_lineatlas_width:new l.bq(d,t.u_lineatlas_width),u_lineatlas_height:new l.bq(d,t.u_lineatlas_height)}),lineGradientSDF:(d,t)=>({u_translation:new l.c3(d,t.u_translation),u_ratio:new l.bq(d,t.u_ratio),u_device_pixel_ratio:new l.bq(d,t.u_device_pixel_ratio),u_units_to_pixels:new l.c3(d,t.u_units_to_pixels),u_image:new l.b_(d,t.u_image),u_image_height:new l.bq(d,t.u_image_height),u_tileratio:new l.bq(d,t.u_tileratio),u_crossfade_from:new l.bq(d,t.u_crossfade_from),u_crossfade_to:new l.bq(d,t.u_crossfade_to),u_image_dash:new l.b_(d,t.u_image_dash),u_mix:new l.bq(d,t.u_mix),u_lineatlas_width:new l.bq(d,t.u_lineatlas_width),u_lineatlas_height:new l.bq(d,t.u_lineatlas_height)}),raster:(d,t)=>({u_tl_parent:new l.c3(d,t.u_tl_parent),u_scale_parent:new l.bq(d,t.u_scale_parent),u_buffer_scale:new l.bq(d,t.u_buffer_scale),u_fade_t:new l.bq(d,t.u_fade_t),u_opacity:new l.bq(d,t.u_opacity),u_image0:new l.b_(d,t.u_image0),u_image1:new l.b_(d,t.u_image1),u_brightness_low:new l.bq(d,t.u_brightness_low),u_brightness_high:new l.bq(d,t.u_brightness_high),u_saturation_factor:new l.bq(d,t.u_saturation_factor),u_contrast_factor:new l.bq(d,t.u_contrast_factor),u_spin_weights:new l.c2(d,t.u_spin_weights),u_coords_top:new l.c1(d,t.u_coords_top),u_coords_bottom:new l.c1(d,t.u_coords_bottom)}),symbolIcon:(d,t)=>({u_is_size_zoom_constant:new l.b_(d,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.b_(d,t.u_is_size_feature_constant),u_size_t:new l.bq(d,t.u_size_t),u_size:new l.bq(d,t.u_size),u_camera_to_center_distance:new l.bq(d,t.u_camera_to_center_distance),u_pitch:new l.bq(d,t.u_pitch),u_rotate_symbol:new l.b_(d,t.u_rotate_symbol),u_aspect_ratio:new l.bq(d,t.u_aspect_ratio),u_fade_change:new l.bq(d,t.u_fade_change),u_label_plane_matrix:new l.c0(d,t.u_label_plane_matrix),u_coord_matrix:new l.c0(d,t.u_coord_matrix),u_is_text:new l.b_(d,t.u_is_text),u_pitch_with_map:new l.b_(d,t.u_pitch_with_map),u_is_along_line:new l.b_(d,t.u_is_along_line),u_is_variable_anchor:new l.b_(d,t.u_is_variable_anchor),u_texsize:new l.c3(d,t.u_texsize),u_texture:new l.b_(d,t.u_texture),u_translation:new l.c3(d,t.u_translation),u_pitched_scale:new l.bq(d,t.u_pitched_scale)}),symbolSDF:(d,t)=>({u_is_size_zoom_constant:new l.b_(d,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.b_(d,t.u_is_size_feature_constant),u_size_t:new l.bq(d,t.u_size_t),u_size:new l.bq(d,t.u_size),u_camera_to_center_distance:new l.bq(d,t.u_camera_to_center_distance),u_pitch:new l.bq(d,t.u_pitch),u_rotate_symbol:new l.b_(d,t.u_rotate_symbol),u_aspect_ratio:new l.bq(d,t.u_aspect_ratio),u_fade_change:new l.bq(d,t.u_fade_change),u_label_plane_matrix:new l.c0(d,t.u_label_plane_matrix),u_coord_matrix:new l.c0(d,t.u_coord_matrix),u_is_text:new l.b_(d,t.u_is_text),u_pitch_with_map:new l.b_(d,t.u_pitch_with_map),u_is_along_line:new l.b_(d,t.u_is_along_line),u_is_variable_anchor:new l.b_(d,t.u_is_variable_anchor),u_texsize:new l.c3(d,t.u_texsize),u_texture:new l.b_(d,t.u_texture),u_gamma_scale:new l.bq(d,t.u_gamma_scale),u_device_pixel_ratio:new l.bq(d,t.u_device_pixel_ratio),u_is_halo:new l.b_(d,t.u_is_halo),u_translation:new l.c3(d,t.u_translation),u_pitched_scale:new l.bq(d,t.u_pitched_scale)}),symbolTextAndIcon:(d,t)=>({u_is_size_zoom_constant:new l.b_(d,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.b_(d,t.u_is_size_feature_constant),u_size_t:new l.bq(d,t.u_size_t),u_size:new l.bq(d,t.u_size),u_camera_to_center_distance:new l.bq(d,t.u_camera_to_center_distance),u_pitch:new l.bq(d,t.u_pitch),u_rotate_symbol:new l.b_(d,t.u_rotate_symbol),u_aspect_ratio:new l.bq(d,t.u_aspect_ratio),u_fade_change:new l.bq(d,t.u_fade_change),u_label_plane_matrix:new l.c0(d,t.u_label_plane_matrix),u_coord_matrix:new l.c0(d,t.u_coord_matrix),u_is_text:new l.b_(d,t.u_is_text),u_pitch_with_map:new l.b_(d,t.u_pitch_with_map),u_is_along_line:new l.b_(d,t.u_is_along_line),u_is_variable_anchor:new l.b_(d,t.u_is_variable_anchor),u_texsize:new l.c3(d,t.u_texsize),u_texsize_icon:new l.c3(d,t.u_texsize_icon),u_texture:new l.b_(d,t.u_texture),u_texture_icon:new l.b_(d,t.u_texture_icon),u_gamma_scale:new l.bq(d,t.u_gamma_scale),u_device_pixel_ratio:new l.bq(d,t.u_device_pixel_ratio),u_is_halo:new l.b_(d,t.u_is_halo),u_translation:new l.c3(d,t.u_translation),u_pitched_scale:new l.bq(d,t.u_pitched_scale)}),background:(d,t)=>({u_opacity:new l.bq(d,t.u_opacity),u_color:new l.b$(d,t.u_color)}),backgroundPattern:(d,t)=>({u_opacity:new l.bq(d,t.u_opacity),u_image:new l.b_(d,t.u_image),u_pattern_tl_a:new l.c3(d,t.u_pattern_tl_a),u_pattern_br_a:new l.c3(d,t.u_pattern_br_a),u_pattern_tl_b:new l.c3(d,t.u_pattern_tl_b),u_pattern_br_b:new l.c3(d,t.u_pattern_br_b),u_texsize:new l.c3(d,t.u_texsize),u_mix:new l.bq(d,t.u_mix),u_pattern_size_a:new l.c3(d,t.u_pattern_size_a),u_pattern_size_b:new l.c3(d,t.u_pattern_size_b),u_scale_a:new l.bq(d,t.u_scale_a),u_scale_b:new l.bq(d,t.u_scale_b),u_pixel_coord_upper:new l.c3(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.c3(d,t.u_pixel_coord_lower),u_tile_units_to_pixels:new l.bq(d,t.u_tile_units_to_pixels)}),terrain:(d,t)=>({u_texture:new l.b_(d,t.u_texture),u_ele_delta:new l.bq(d,t.u_ele_delta),u_fog_matrix:new l.c0(d,t.u_fog_matrix),u_fog_color:new l.b$(d,t.u_fog_color),u_fog_ground_blend:new l.bq(d,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new l.bq(d,t.u_fog_ground_blend_opacity),u_horizon_color:new l.b$(d,t.u_horizon_color),u_horizon_fog_blend:new l.bq(d,t.u_horizon_fog_blend),u_is_globe_mode:new l.bq(d,t.u_is_globe_mode)}),terrainDepth:(d,t)=>({u_ele_delta:new l.bq(d,t.u_ele_delta)}),terrainCoords:(d,t)=>({u_texture:new l.b_(d,t.u_texture),u_terrain_coords_id:new l.bq(d,t.u_terrain_coords_id),u_ele_delta:new l.bq(d,t.u_ele_delta)}),projectionErrorMeasurement:(d,t)=>({u_input:new l.bq(d,t.u_input),u_output_expected:new l.bq(d,t.u_output_expected)}),atmosphere:(d,t)=>({u_sun_pos:new l.c2(d,t.u_sun_pos),u_atmosphere_blend:new l.bq(d,t.u_atmosphere_blend),u_globe_position:new l.c2(d,t.u_globe_position),u_globe_radius:new l.bq(d,t.u_globe_radius),u_inv_proj_matrix:new l.c0(d,t.u_inv_proj_matrix)}),sky:(d,t)=>({u_sky_color:new l.b$(d,t.u_sky_color),u_horizon_color:new l.b$(d,t.u_horizon_color),u_horizon:new l.c3(d,t.u_horizon),u_horizon_normal:new l.c3(d,t.u_horizon_normal),u_sky_horizon_blend:new l.bq(d,t.u_sky_horizon_blend),u_sky_blend:new l.bq(d,t.u_sky_blend)})};class vd{constructor(t,n,a){this.context=t;const c=t.gl;this.buffer=c.createBuffer(),this.dynamicDraw=!!a,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const qu={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class yd{constructor(t,n,a,c){this.length=n.length,this.attributes=a,this.itemSize=n.bytesPerElement,this.dynamicDraw=c,this.context=t;const p=t.gl;this.buffer=p.createBuffer(),t.bindVertexBuffer.set(this.buffer),p.bufferData(p.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,n){for(let a=0;a<this.attributes.length;a++){const c=n.attributes[this.attributes[a].name];c!==void 0&&t.enableVertexAttribArray(c)}}setVertexAttribPointers(t,n,a){for(let c=0;c<this.attributes.length;c++){const p=this.attributes[c],m=n.attributes[p.name];m!==void 0&&t.vertexAttribPointer(m,p.components,t[qu[p.type]],!1,this.itemSize,p.offset+this.itemSize*(a||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Xr{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ys extends Xr{getDefault(){return l.bp.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Ks extends Xr{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Qs extends Xr{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class _c extends Xr{getDefault(){return[!0,!0,!0,!0]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class No extends Xr{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class ts extends Xr{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class xa extends Xr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const n=this.current;(t.func!==n.func||t.ref!==n.ref||t.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Mn extends Xr{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Zu extends Xr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=t,this.dirty=!1}}class Hu extends Xr{getDefault(){return[0,1]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class vc extends Xr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=t,this.dirty=!1}}class Vo extends Xr{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Js extends Xr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.BLEND):n.disable(n.BLEND),this.current=t,this.dirty=!1}}class $s extends Xr{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class rs extends Xr{getDefault(){return l.bp.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class el extends Xr{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Wu extends Xr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=t,this.dirty=!1}}class ba extends Xr{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class wa extends Xr{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Xu extends Xr{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class yc extends Xr{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Fr extends Xr{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class tl extends Xr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class xd extends Xr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Yu extends Xr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class is extends Xr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class bd extends Xr{getDefault(){return null}set(t){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class wd extends Xr{getDefault(){return null}set(t){var n;if(t===this.current&&!this.dirty)return;const a=this.gl;In(a)?a.bindVertexArray(t):(n=a.getExtension("OES_vertex_array_object"))===null||n===void 0||n.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Ku extends Xr{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Td extends Xr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class xc extends Xr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Ta extends Xr{constructor(t,n){super(t),this.context=t,this.parent=n}getDefault(){return null}}class ns extends Ta{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class rl extends Ta{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class bc extends Ta{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const wc="Framebuffer is not complete";class il{constructor(t,n,a,c,p){this.context=t,this.width=n,this.height=a;const m=t.gl,v=this.framebuffer=m.createFramebuffer();if(this.colorAttachment=new ns(t,v),c)this.depthAttachment=p?new bc(t,v):new rl(t,v);else if(p)throw new Error("Stencil cannot be set without depth");if(m.checkFramebufferStatus(m.FRAMEBUFFER)!==m.FRAMEBUFFER_COMPLETE)throw new Error(wc)}destroy(){const t=this.context.gl,n=this.colorAttachment.get();if(n&&t.deleteTexture(n),this.depthAttachment){const a=this.depthAttachment.get();a&&t.deleteRenderbuffer(a)}t.deleteFramebuffer(this.framebuffer)}}class nl{constructor(t){var n,a;if(this.gl=t,this.clearColor=new Ys(this),this.clearDepth=new Ks(this),this.clearStencil=new Qs(this),this.colorMask=new _c(this),this.depthMask=new No(this),this.stencilMask=new ts(this),this.stencilFunc=new xa(this),this.stencilOp=new Mn(this),this.stencilTest=new Zu(this),this.depthRange=new Hu(this),this.depthTest=new vc(this),this.depthFunc=new Vo(this),this.blend=new Js(this),this.blendFunc=new $s(this),this.blendColor=new rs(this),this.blendEquation=new el(this),this.cullFace=new Wu(this),this.cullFaceSide=new ba(this),this.frontFace=new wa(this),this.program=new Xu(this),this.activeTexture=new yc(this),this.viewport=new Fr(this),this.bindFramebuffer=new tl(this),this.bindRenderbuffer=new xd(this),this.bindTexture=new Yu(this),this.bindVertexBuffer=new is(this),this.bindElementBuffer=new bd(this),this.bindVertexArray=new wd(this),this.pixelStoreUnpack=new Ku(this),this.pixelStoreUnpackPremultiplyAlpha=new Td(this),this.pixelStoreUnpackFlipY=new xc(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),In(t)){this.HALF_FLOAT=t.HALF_FLOAT;const c=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(n=t.RGBA16F)!==null&&n!==void 0?n:c?.RGBA16F_EXT,this.RGB16F=(a=t.RGB16F)!==null&&a!==void 0?a:c?.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const c=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=c?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,n){return new vd(this,t,n)}createVertexBuffer(t,n,a){return new yd(this,t,n,a)}createRenderbuffer(t,n,a){const c=this.gl,p=c.createRenderbuffer();return this.bindRenderbuffer.set(p),c.renderbufferStorage(c.RENDERBUFFER,t,n,a),this.bindRenderbuffer.set(null),p}createFramebuffer(t,n,a,c){return new il(this,t,n,a,c)}clear({color:t,depth:n,stencil:a}){const c=this.gl;let p=0;t&&(p|=c.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(p|=c.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),a!==void 0&&(p|=c.STENCIL_BUFFER_BIT,this.clearStencil.set(a),this.stencilMask.set(255)),c.clear(p)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){l.bR(t.blendFunction,ti.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return In(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var n;return In(this.gl)?this.gl.deleteVertexArray(t):(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let vo;function jo(d,t,n,a,c){const p=d.context,m=d.transform,v=p.gl,x=d.useProgram("collisionBox"),T=[];let P=0,k=0;for(let X=0;X<a.length;X++){const te=a[X],fe=t.getTile(te).getBucket(n);if(!fe)continue;const $=c?fe.textCollisionBox:fe.iconCollisionBox,he=fe.collisionCircleArray;he.length>0&&(T.push({circleArray:he,circleOffset:k,coord:te}),P+=he.length/4,k=P),$&&x.draw(p,v.LINES,kr.disabled,Hr.disabled,d.colorModeForRenderPass(),Gr.disabled,Oo(d.transform),d.style.map.terrain&&d.style.map.terrain.getTerrainData(te),m.getProjectionData({overscaledTileID:te,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),n.id,$.layoutVertexBuffer,$.indexBuffer,$.segments,null,d.transform.zoom,null,null,$.collisionVertexBuffer)}if(!c||!T.length)return;const A=d.useProgram("collisionCircle"),L=new l.ca;L.resize(4*P),L._trim();let N=0;for(const X of T)for(let te=0;te<X.circleArray.length/4;te++){const fe=4*te,$=X.circleArray[fe+0],he=X.circleArray[fe+1],ve=X.circleArray[fe+2],le=X.circleArray[fe+3];L.emplace(N++,$,he,ve,le,0),L.emplace(N++,$,he,ve,le,1),L.emplace(N++,$,he,ve,le,2),L.emplace(N++,$,he,ve,le,3)}(!vo||vo.length<2*P)&&(vo=(function(X){const te=2*X,fe=new l.cc;fe.resize(te),fe._trim();for(let $=0;$<te;$++){const he=6*$;fe.uint16[he+0]=4*$+0,fe.uint16[he+1]=4*$+1,fe.uint16[he+2]=4*$+2,fe.uint16[he+3]=4*$+2,fe.uint16[he+4]=4*$+3,fe.uint16[he+5]=4*$+0}return fe})(P));const W=p.createIndexBuffer(vo,!0),Y=p.createVertexBuffer(L,l.cb.members,!0);for(const X of T){const te=Bu(d.transform);A.draw(p,v.TRIANGLES,kr.disabled,Hr.disabled,d.colorModeForRenderPass(),Gr.disabled,te,d.style.map.terrain&&d.style.map.terrain.getTerrainData(X.coord),null,n.id,Y,W,l.aX.simpleSegment(0,2*X.circleOffset,X.circleArray.length,X.circleArray.length/2),null,d.transform.zoom,null,null,null)}Y.destroy(),W.destroy()}const Tc=l.ar(new Float32Array(16));function Cd(d,t,n,a,c,p){const{horizontalAlign:m,verticalAlign:v}=l.aS(d);return new l.P((-(m-.5)*t/c+a[0])*p,(-(v-.5)*n/c+a[1])*p)}function os(d,t,n,a,c,p){const m=t.tileAnchorPoint.add(new l.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let v=a.mult(p);n||(v=v.rotate(-c));const x=m.add(v);return mr(x.x,x.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(n){const v=Jr(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(d),x=Math.atan(v.y/v.x)+(v.x<0?Math.PI:0);return d.add(a.rotate(x))}return d.add(a)}function Sd(d,t,n,a,c,p,m,v,x,T,P,k){const A=d.text.placedSymbolArray,L=d.text.dynamicLayoutVertexArray,N=d.icon.dynamicLayoutVertexArray,W={};L.clear();for(let Y=0;Y<A.length;Y++){const X=A.get(Y),te=X.hidden||!X.crossTileID||d.allowVerticalPlacement&&!X.placedOrientation?null:a[X.crossTileID];if(te){const fe=new l.P(X.anchorX,X.anchorY),$={getElevation:k,width:c.width,height:c.height,pitchedLabelPlaneMatrix:p,pitchWithMap:n,transform:c,tileAnchorPoint:fe,translation:T,unwrappedTileID:P},he=n?aa(fe.x,fe.y,$):Jr(fe.x,fe.y,$),ve=Ln(c.cameraToCenterDistance,he.signedDistanceFromCamera);let le=l.aA(d.textSizeData,v,X)*ve/l.aM;n&&(le*=d.tilePixelRatio/m);const{width:Me,height:$e,anchor:Ze,textOffset:We,textBoxScale:Ye}=te,At=Cd(Ze,Me,$e,We,Ye,le),kt=c.getPitchedTextCorrection(fe.x+T[0],fe.y+T[1],P),yt=os(he.point,$,t,At,-c.bearingInRadians,kt),Nt=d.allowVerticalPlacement&&X.placedOrientation===l.az.vertical?Math.PI/2:0;for(let Mr=0;Mr<X.numGlyphs;Mr++)l.aG(L,yt,Nt);x&&X.associatedIconIndex>=0&&(W[X.associatedIconIndex]={shiftedAnchor:yt,angle:Nt})}else ko(X.numGlyphs,L)}if(x){N.clear();const Y=d.icon.placedSymbolArray;for(let X=0;X<Y.length;X++){const te=Y.get(X);if(te.hidden)ko(te.numGlyphs,N);else{const fe=W[X];if(fe)for(let $=0;$<te.numGlyphs;$++)l.aG(N,fe.shiftedAnchor,fe.angle);else ko(te.numGlyphs,N)}}d.icon.dynamicLayoutVertexBuffer.updateData(N)}d.text.dynamicLayoutVertexBuffer.updateData(L)}function Qu(d,t,n){return n.iconsInText&&t?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function as(d,t,n,a,c,p,m,v,x,T,P,k,A){const L=d.context,N=L.gl,W=d.transform,Y=v==="map",X=x==="map",te=v!=="viewport"&&n.layout.get("symbol-placement")!=="point",fe=Y&&!X&&!te,$=!n.layout.get("symbol-sort-key").isConstant();let he=!1;const ve=d.getDepthModeForSublayer(0,kr.ReadOnly),le=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Me=[],$e=W.getCircleRadiusCorrection();for(const Ze of a){const We=t.getTile(Ze),Ye=We.getBucket(n);if(!Ye)continue;const At=c?Ye.text:Ye.icon;if(!At||!At.segments.get().length||!At.hasVisibleVertices)continue;const kt=At.programConfigurations.get(n.id),yt=c||Ye.sdfIcons,Nt=c?Ye.textSizeData:Ye.iconSizeData,Mr=X||W.pitch!==0,Qr=d.useProgram(Qu(yt,c,Ye),kt),ci=l.ay(Nt,W.zoom),ri=d.style.map.terrain&&d.style.map.terrain.getTerrainData(Ze);let pi,ii,Ci,fi,ji=[0,0],Di=null;if(c)ii=We.glyphAtlasTexture,Ci=N.LINEAR,pi=We.glyphAtlasTexture.size,Ye.iconsInText&&(ji=We.imageAtlasTexture.size,Di=We.imageAtlasTexture,fi=Mr||d.options.rotating||d.options.zooming||Nt.kind==="composite"||Nt.kind==="camera"?N.LINEAR:N.NEAREST);else{const ai=n.layout.get("icon-size").constantOr(0)!==1||Ye.iconsNeedLinear;ii=We.imageAtlasTexture,Ci=yt||d.options.rotating||d.options.zooming||ai||Mr?N.LINEAR:N.NEAREST,pi=We.imageAtlasTexture.size}const Ai=l.aN(We,1,d.transform.zoom),Yi=oi(Y,d.transform,Ai),To=l.N();l.aB(To,Yi);const ro=$i(X,Y,d.transform,Ai),Kn=l.aO(W,We,p,m),fn=W.getProjectionData({overscaledTileID:Ze,applyGlobeMatrix:!A,applyTerrainMatrix:!0}),Wo=le&&Ye.hasTextData(),Ps=n.layout.get("icon-text-fit")!=="none"&&Wo&&Ye.hasIconData();if(te){const ai=d.style.map.terrain?(Bi,Ni)=>d.style.map.terrain.getElevation(Ze,Bi,Ni):null,ni=n.layout.get("text-rotation-alignment")==="map";Eo(Ye,d,c,Yi,To,X,T,ni,Ze.toUnwrapped(),W.width,W.height,Kn,ai)}const Xo=c&&le||Ps,kn=te||Xo?Tc:X?Yi:d.transform.clipSpaceToPixelsMatrix,Qn=yt&&n.paint.get(c?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let jn;jn=yt?Ye.iconsInText?Bo(Nt.kind,ci,fe,X,te,Xo,d,kn,ro,Kn,pi,ji,$e):Xs(Nt.kind,ci,fe,X,te,Xo,d,kn,ro,Kn,c,pi,0,$e):mc(Nt.kind,ci,fe,X,te,Xo,d,kn,ro,Kn,c,pi,$e);const Un={program:Qr,buffers:At,uniformValues:jn,projectionData:fn,atlasTexture:ii,atlasTextureIcon:Di,atlasInterpolation:Ci,atlasInterpolationIcon:fi,isSDF:yt,hasHalo:Qn};if($&&Ye.canOverlap){he=!0;const ai=At.segments.get();for(const ni of ai)Me.push({segments:new l.aX([ni]),sortKey:ni.sortKey,state:Un,terrainData:ri})}else Me.push({segments:At.segments,sortKey:0,state:Un,terrainData:ri})}he&&Me.sort(((Ze,We)=>Ze.sortKey-We.sortKey));for(const Ze of Me){const We=Ze.state;if(L.activeTexture.set(N.TEXTURE0),We.atlasTexture.bind(We.atlasInterpolation,N.CLAMP_TO_EDGE),We.atlasTextureIcon&&(L.activeTexture.set(N.TEXTURE1),We.atlasTextureIcon&&We.atlasTextureIcon.bind(We.atlasInterpolationIcon,N.CLAMP_TO_EDGE)),We.isSDF){const Ye=We.uniformValues;We.hasHalo&&(Ye.u_is_halo=1,ol(We.buffers,Ze.segments,n,d,We.program,ve,P,k,Ye,We.projectionData,Ze.terrainData)),Ye.u_is_halo=0}ol(We.buffers,Ze.segments,n,d,We.program,ve,P,k,We.uniformValues,We.projectionData,Ze.terrainData)}}function ol(d,t,n,a,c,p,m,v,x,T,P){const k=a.context;c.draw(k,k.gl.TRIANGLES,p,m,v,Gr.backCCW,x,P,T,n.id,d.layoutVertexBuffer,d.indexBuffer,t,n.paint,a.transform.zoom,d.programConfigurations.get(n.id),d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer)}function Ju(d,t,n,a,c){const p=d.context,m=p.gl,v=Hr.disabled,x=new ti([m.ONE,m.ONE],l.bp.transparent,[!0,!0,!0,!0]),T=t.getBucket(n);if(!T)return;const P=a.key;let k=n.heatmapFbos.get(P);k||(k=ss(p,t.tileSize,t.tileSize),n.heatmapFbos.set(P,k)),p.bindFramebuffer.set(k.framebuffer),p.viewport.set([0,0,t.tileSize,t.tileSize]),p.clear({color:l.bp.transparent});const A=T.programConfigurations.get(n.id),L=d.useProgram("heatmap",A,!c),N=d.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),W=d.style.map.terrain.getTerrainData(a);L.draw(p,m.TRIANGLES,kr.disabled,v,x,Gr.disabled,ya(t,d.transform.zoom,n.paint.get("heatmap-intensity"),1),W,N,n.id,T.layoutVertexBuffer,T.indexBuffer,T.segments,n.paint,d.transform.zoom,A)}function $u(d,t,n,a,c){const p=d.context,m=p.gl,v=d.transform;p.setColorMode(d.colorModeForRenderPass());const x=al(p,t),T=n.key,P=t.heatmapFbos.get(T);if(!P)return;p.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,P.colorAttachment.get()),p.activeTexture.set(m.TEXTURE1),x.bind(m.LINEAR,m.CLAMP_TO_EDGE);const k=v.getProjectionData({overscaledTileID:n,applyTerrainMatrix:c,applyGlobeMatrix:!a});d.useProgram("heatmapTexture").draw(p,m.TRIANGLES,kr.disabled,Hr.disabled,d.colorModeForRenderPass(),Gr.disabled,Nu(d,t,0,1),null,k,t.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments,t.paint,v.zoom),P.destroy(),t.heatmapFbos.delete(T)}function ss(d,t,n){var a,c;const p=d.gl,m=p.createTexture();p.bindTexture(p.TEXTURE_2D,m),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.LINEAR);const v=(a=d.HALF_FLOAT)!==null&&a!==void 0?a:p.UNSIGNED_BYTE,x=(c=d.RGBA16F)!==null&&c!==void 0?c:p.RGBA;p.texImage2D(p.TEXTURE_2D,0,x,t,n,0,p.RGBA,v,null);const T=d.createFramebuffer(t,n,!1,!1);return T.colorAttachment.set(m),T}function al(d,t){return t.colorRampTexture||(t.colorRampTexture=new l.T(d,t.colorRamp,d.gl.RGBA)),t.colorRampTexture}function eh(d,t,n,a,c,p,m,v){let x=256;if(c.stepInterpolant){const T=t.getSource().maxzoom,P=m.canonical.z===T?Math.ceil(1<<d.transform.maxZoom-m.canonical.z):1;x=l.an(l.ce(p.maxLineLength/l.a5*1024*P),256,n.maxTextureSize)}return v.gradient=l.cf({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:x,image:v.gradient||void 0,clips:p.lineClipsArray}),v.texture?v.texture.update(v.gradient):v.texture=new l.T(n,v.gradient,a.RGBA),v.version=c.gradientVersion,v.texture}function th(d,t,n,a,c){d.activeTexture.set(t.TEXTURE0),n.imageAtlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE),a.updatePaintBuffers(c)}function Mi(d,t,n,a,c,p){(c||d.lineAtlas.dirty)&&(t.activeTexture.set(n.TEXTURE0),d.lineAtlas.bind(t)),a.updatePaintBuffers(p)}function Uo(d,t,n,a,c,p,m){const v=p.gradients[c.id];let x=v.texture;c.gradientVersion!==v.version&&(x=eh(d,t,n,a,c,p,m,v)),n.activeTexture.set(a.TEXTURE0),x.bind(c.stepInterpolant?a.NEAREST:a.LINEAR,a.CLAMP_TO_EDGE)}function bn(d,t,n,a,c,p,m,v,x){const T=p.gradients[c.id];let P=T.texture;c.gradientVersion!==T.version&&(P=eh(d,t,n,a,c,p,m,T)),n.activeTexture.set(a.TEXTURE0),P.bind(c.stepInterpolant?a.NEAREST:a.LINEAR,a.CLAMP_TO_EDGE),n.activeTexture.set(a.TEXTURE1),d.lineAtlas.bind(n),v.updatePaintBuffers(x)}function sl(d,t,n,a,c){if(!n||!a||!a.imageAtlas)return;const p=a.imageAtlas.patternPositions;let m=p[n.to.toString()],v=p[n.from.toString()];if(!m&&v&&(m=v),!v&&m&&(v=m),!m||!v){const x=c.getPaintProperty(t);m=p[x],v=p[x]}m&&v&&d.setConstantPatternPositions(m,v)}function ls(d,t,n,a,c,p,m,v){const x=d.context.gl,T="fill-pattern",P=n.paint.get(T),k=P&&P.constantOr(1),A=n.getCrossfadeParameters();let L,N,W,Y,X;const te=d.transform,fe=n.paint.get("fill-translate"),$=n.paint.get("fill-translate-anchor");m?(N=k&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=x.LINES):(N=k?"fillPattern":"fill",L=x.TRIANGLES);const he=P.constantOr(null);for(const ve of a){const le=t.getTile(ve);if(k&&!le.patternsLoaded())continue;const Me=le.getBucket(n);if(!Me)continue;const $e=Me.programConfigurations.get(n.id),Ze=d.useProgram(N,$e),We=d.style.map.terrain&&d.style.map.terrain.getTerrainData(ve);k&&(d.context.activeTexture.set(x.TEXTURE0),le.imageAtlasTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),$e.updatePaintBuffers(A)),sl($e,T,he,le,n);const Ye=te.getProjectionData({overscaledTileID:ve,applyGlobeMatrix:!v,applyTerrainMatrix:!0}),At=l.aO(te,le,fe,$);if(m){Y=Me.indexBuffer2,X=Me.segments2;const yt=[x.drawingBufferWidth,x.drawingBufferHeight];W=N==="fillOutlinePattern"&&k?Fu(d,A,le,yt,At):Ru(yt,At)}else Y=Me.indexBuffer,X=Me.segments,W=k?uc(d,A,le,At):{u_fill_translate:At};const kt=d.stencilModeForClipping(ve);Ze.draw(d.context,L,c,kt,p,Gr.backCCW,W,We,Ye,n.id,Me.layoutVertexBuffer,Y,X,n.paint,d.transform.zoom,$e)}}function ll(d,t,n,a,c,p,m,v){const x=d.context,T=x.gl,P="fill-extrusion-pattern",k=n.paint.get(P),A=k.constantOr(1),L=n.getCrossfadeParameters(),N=n.paint.get("fill-extrusion-opacity"),W=k.constantOr(null),Y=d.transform;for(const X of a){const te=t.getTile(X),fe=te.getBucket(n);if(!fe)continue;const $=d.style.map.terrain&&d.style.map.terrain.getTerrainData(X),he=fe.programConfigurations.get(n.id),ve=d.useProgram(A?"fillExtrusionPattern":"fillExtrusion",he);A&&(d.context.activeTexture.set(T.TEXTURE0),te.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),he.updatePaintBuffers(L));const le=Y.getProjectionData({overscaledTileID:X,applyGlobeMatrix:!v,applyTerrainMatrix:!0});sl(he,P,W,te,n);const Me=l.aO(Y,te,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),$e=n.paint.get("fill-extrusion-vertical-gradient"),Ze=A?cc(d,$e,N,Me,X,L,te):lc(d,$e,N,Me);ve.draw(x,x.gl.TRIANGLES,c,p,m,Gr.backCCW,Ze,$,le,n.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,n.paint,d.transform.zoom,he,d.style.map.terrain&&fe.centroidVertexBuffer)}}function yo(d,t,n,a,c,p,m,v,x){var T;const P=d.style.projection,k=d.context,A=d.transform,L=k.gl,N=[`#define NUM_ILLUMINATION_SOURCES ${n.paint.get("hillshade-highlight-color").values.length}`],W=d.useProgram("hillshade",null,!1,N),Y=!d.options.moving;for(const X of a){const te=t.getTile(X),fe=te.fbo;if(!fe)continue;const $=P.getMeshFromTileID(k,X.canonical,v,!0,"raster"),he=(T=d.style.map.terrain)===null||T===void 0?void 0:T.getTerrainData(X);k.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,fe.colorAttachment.get());const ve=A.getProjectionData({overscaledTileID:X,aligned:Y,applyGlobeMatrix:!x,applyTerrainMatrix:!0});W.draw(k,L.TRIANGLES,p,c[X.overscaledZ],m,Gr.backCCW,Zs(d,te,n),he,ve,n.id,$.vertexBuffer,$.indexBuffer,$.segments)}}function cs(d,t,n,a,c,p,m,v,x){var T;const P=d.style.projection,k=d.context,A=d.transform,L=k.gl,N=d.useProgram("colorRelief"),W=!d.options.moving;let Y=!0,X=0;for(const te of a){const fe=t.getTile(te),$=fe.dem;if(Y){const Ze=L.getParameter(L.MAX_TEXTURE_SIZE),{elevationTexture:We,colorTexture:Ye}=n.getColorRampTextures(k,Ze,$.getUnpackVector());k.activeTexture.set(L.TEXTURE1),We.bind(L.NEAREST,L.CLAMP_TO_EDGE),k.activeTexture.set(L.TEXTURE4),Ye.bind(L.LINEAR,L.CLAMP_TO_EDGE),Y=!1,X=We.size[0]}if(!$||!$.data)continue;const he=$.stride,ve=$.getPixels();if(k.activeTexture.set(L.TEXTURE0),k.pixelStoreUnpackPremultiplyAlpha.set(!1),fe.demTexture=fe.demTexture||d.getTileTexture(he),fe.demTexture){const Ze=fe.demTexture;Ze.update(ve,{premultiply:!1}),Ze.bind(L.LINEAR,L.CLAMP_TO_EDGE)}else fe.demTexture=new l.T(k,ve,L.RGBA,{premultiply:!1}),fe.demTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE);const le=P.getMeshFromTileID(k,te.canonical,v,!0,"raster"),Me=(T=d.style.map.terrain)===null||T===void 0?void 0:T.getTerrainData(te),$e=A.getProjectionData({overscaledTileID:te,aligned:W,applyGlobeMatrix:!x,applyTerrainMatrix:!0});N.draw(k,L.TRIANGLES,p,c[te.overscaledZ],m,Gr.backCCW,Vu(n,fe.dem,X),Me,$e,n.id,le.vertexBuffer,le.indexBuffer,le.segments)}}const Go=[new l.P(0,0),new l.P(l.a5,0),new l.P(l.a5,l.a5),new l.P(0,l.a5)];function Ca(d,t,n,a,c,p,m,v,x=!1,T=!1){const P=a[a.length-1].overscaledZ,k=d.context,A=k.gl,L=d.useProgram("raster"),N=d.transform,W=d.style.projection,Y=d.colorModeForRenderPass(),X=!d.options.moving,te=n.paint.get("raster-opacity"),fe=n.paint.get("raster-resampling"),$=n.paint.get("raster-fade-duration"),he=!!d.style.map.terrain;for(const ve of a){const le=d.getDepthModeForSublayer(ve.overscaledZ-P,te===1?kr.ReadWrite:kr.ReadOnly,A.LESS),Me=t.getTile(ve),$e=fe==="nearest"?A.NEAREST:A.LINEAR;k.activeTexture.set(A.TEXTURE0),Me.texture.bind($e,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),k.activeTexture.set(A.TEXTURE1);const{parentTile:Ze,parentScaleBy:We,parentTopLeft:Ye,fadeValues:At}=rh(Me,t,$,he);Me.fadeOpacity=At.tileOpacity,Ze?(Ze.fadeOpacity=At.parentTileOpacity,Ze.texture.bind($e,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST)):Me.texture.bind($e,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),Me.texture.useMipmap&&k.extTextureFilterAnisotropic&&d.transform.pitch>20&&A.texParameterf(A.TEXTURE_2D,k.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,k.extTextureFilterAnisotropicMax);const kt=d.style.map.terrain&&d.style.map.terrain.getTerrainData(ve),yt=N.getProjectionData({overscaledTileID:ve,aligned:X,applyGlobeMatrix:!T,applyTerrainMatrix:!0}),Nt=pc(Ye,We,At.fadeMix,n,v),Mr=W.getMeshFromTileID(k,ve.canonical,p,m,"raster");L.draw(k,A.TRIANGLES,le,c?c[ve.overscaledZ]:Hr.disabled,Y,x?Gr.frontCCW:Gr.backCCW,Nt,kt,yt,n.id,Mr.vertexBuffer,Mr.indexBuffer,Mr.segments)}}function rh(d,t,n,a){const c={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(n===0||a)return c;if(d.fadingParentID){const p=t.getLoadedTile(d.fadingParentID);if(!p)return c;const m=Math.pow(2,p.tileID.overscaledZ-d.tileID.overscaledZ),v=[d.tileID.canonical.x*m%1,d.tileID.canonical.y*m%1],x=(function(T,P,k){const A=Ee(),L=(A-P.timeAdded)/k,N=T.fadingDirection===_e.Incoming,W=l.an((A-T.timeAdded)/k,0,1),Y=l.an(1-L,0,1),X=N?W:Y;return{tileOpacity:X,parentTileOpacity:N?Y:W,fadeMix:{opacity:1,mix:1-X}}})(d,p,n);return{parentTile:p,parentScaleBy:m,parentTopLeft:v,fadeValues:x}}if(d.selfFading){const p=(function(m,v){const x=(Ee()-m.timeAdded)/v,T=l.an(x,0,1);return{tileOpacity:T,fadeMix:{opacity:T,mix:0}}})(d,n);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:p}}return c}const ih=new l.bp(1,0,0,1),nh=new l.bp(0,1,0,1),oh=new l.bp(0,0,1,1),ah=new l.bp(1,0,1,1),xo=new l.bp(0,1,1,1);function Cc(d,t,n,a){us(d,0,t+n/2,d.transform.width,n,a)}function Sc(d,t,n,a){us(d,t-n/2,0,n,d.transform.height,a)}function us(d,t,n,a,c,p){const m=d.context,v=m.gl;v.enable(v.SCISSOR_TEST),v.scissor(t*d.pixelRatio,n*d.pixelRatio,a*d.pixelRatio,c*d.pixelRatio),m.clear({color:p}),v.disable(v.SCISSOR_TEST)}function sh(d,t,n){const a=d.context,c=a.gl,p=d.useProgram("debug"),m=kr.disabled,v=Hr.disabled,x=d.colorModeForRenderPass(),T="$debug",P=d.style.map.terrain&&d.style.map.terrain.getTerrainData(n);a.activeTexture.set(c.TEXTURE0);const k=t.getTileByID(n.key).latestRawTileData,A=Math.floor((k&&k.byteLength||0)/1024),L=t.getTile(n).tileSize,N=512/Math.min(L,512)*(n.overscaledZ/d.transform.zoom)*.5;let W=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(W+=` => ${n.overscaledZ}`),(function(X,te){X.initDebugOverlayCanvas();const fe=X.debugOverlayCanvas,$=X.context.gl,he=X.debugOverlayCanvas.getContext("2d");he.clearRect(0,0,fe.width,fe.height),he.shadowColor="white",he.shadowBlur=2,he.lineWidth=1.5,he.strokeStyle="white",he.textBaseline="top",he.font="bold 36px Open Sans, sans-serif",he.fillText(te,5,5),he.strokeText(te,5,5),X.debugOverlayTexture.update(fe),X.debugOverlayTexture.bind($.LINEAR,$.CLAMP_TO_EDGE)})(d,`${W} ${A}kB`);const Y=d.transform.getProjectionData({overscaledTileID:n,applyGlobeMatrix:!0,applyTerrainMatrix:!0});p.draw(a,c.TRIANGLES,m,v,ti.alphaBlended,Gr.disabled,hc(l.bp.transparent,N),null,Y,T,d.debugBuffer,d.quadTriangleIndexBuffer,d.debugSegments),p.draw(a,c.LINE_STRIP,m,v,x,Gr.disabled,hc(l.bp.red),P,Y,T,d.debugBuffer,d.tileBorderIndexBuffer,d.debugSegments)}function Pc(d,t,n,a){const{isRenderingGlobe:c}=a,p=d.context,m=p.gl,v=d.transform,x=d.colorModeForRenderPass(),T=d.getDepthModeFor3D(),P=d.useProgram("terrain");p.bindFramebuffer.set(null),p.viewport.set([0,0,d.width,d.height]);for(const k of n){const A=t.getTerrainMesh(k.tileID),L=d.renderToTexture.getTexture(k),N=t.getTerrainData(k.tileID);p.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,L.texture);const W=t.getMeshFrameDelta(v.zoom),Y=v.calculateFogMatrix(k.tileID.toUnwrapped()),X=pd(W,Y,d.style.sky,v.pitch,c),te=v.getProjectionData({overscaledTileID:k.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});P.draw(p,m.TRIANGLES,T,Hr.disabled,x,Gr.backCCW,X,N,te,"terrain",A.vertexBuffer,A.indexBuffer,A.segments)}}function Ic(d,t){if(!t.mesh){const n=new l.aW;n.emplaceBack(-1,-1),n.emplaceBack(1,-1),n.emplaceBack(1,1),n.emplaceBack(-1,1);const a=new l.aY;a.emplaceBack(0,1,2),a.emplaceBack(0,2,3),t.mesh=new ei(d.createVertexBuffer(n,mo.members),d.createIndexBuffer(a),l.aX.simpleSegment(0,0,n.length,a.length))}return t.mesh}class lh{constructor(t,n){this.context=new nl(t),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Kr.maxOverzooming+Kr.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new dn}resize(t,n,a){if(this.width=Math.floor(t*a),this.height=Math.floor(n*a),this.pixelRatio=a,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style._order)this.style._layers[c].resize()}setup(){const t=this.context,n=new l.aW;n.emplaceBack(0,0),n.emplaceBack(l.a5,0),n.emplaceBack(0,l.a5),n.emplaceBack(l.a5,l.a5),this.tileExtentBuffer=t.createVertexBuffer(n,mo.members),this.tileExtentSegments=l.aX.simpleSegment(0,0,4,2);const a=new l.aW;a.emplaceBack(0,0),a.emplaceBack(l.a5,0),a.emplaceBack(0,l.a5),a.emplaceBack(l.a5,l.a5),this.debugBuffer=t.createVertexBuffer(a,mo.members),this.debugSegments=l.aX.simpleSegment(0,0,4,5);const c=new l.ch;c.emplaceBack(0,0,0,0),c.emplaceBack(l.a5,0,l.a5,0),c.emplaceBack(0,l.a5,0,l.a5),c.emplaceBack(l.a5,l.a5,l.a5,l.a5),this.rasterBoundsBuffer=t.createVertexBuffer(c,dd.members),this.rasterBoundsSegments=l.aX.simpleSegment(0,0,4,2);const p=new l.aW;p.emplaceBack(0,0),p.emplaceBack(l.a5,0),p.emplaceBack(0,l.a5),p.emplaceBack(l.a5,l.a5),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(p,mo.members),this.rasterBoundsSegmentsPosOnly=l.aX.simpleSegment(0,0,4,5);const m=new l.aW;m.emplaceBack(0,0),m.emplaceBack(1,0),m.emplaceBack(0,1),m.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(m,mo.members),this.viewportSegments=l.aX.simpleSegment(0,0,4,2);const v=new l.ci;v.emplaceBack(0),v.emplaceBack(1),v.emplaceBack(3),v.emplaceBack(2),v.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(v);const x=new l.aY;x.emplaceBack(1,0,2),x.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(x);const T=this.context.gl;this.stencilClearMode=new Hr({func:T.ALWAYS,mask:0},0,255,T.ZERO,T.ZERO,T.ZERO),this.tileExtentMesh=new ei(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,n=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const a=l.N();l.c7(a,0,this.width,this.height,0,0,1),l.Q(a,a,[n.drawingBufferWidth,n.drawingBufferHeight,0]);const c={mainMatrix:a,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:a};this.useProgram("clippingMask",null,!0).draw(t,n.TRIANGLES,kr.disabled,this.stencilClearMode,ti.disabled,Gr.disabled,null,null,c,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,n,a){if(this.currentStencilSource===t.source||!t.isTileClipped()||!n||!n.length)return;this.currentStencilSource=t.source,this.nextStencilID+n.length>256&&this.clearStencil();const c=this.context;c.setColorMode(ti.disabled),c.setDepthMode(kr.disabled);const p={};for(const m of n)p[m.key]=this.nextStencilID++;this._renderTileMasks(p,n,a,!0),this._renderTileMasks(p,n,a,!1),this._tileClippingMaskIDs=p}_renderTileMasks(t,n,a,c){const p=this.context,m=p.gl,v=this.style.projection,x=this.transform,T=this.useProgram("clippingMask");for(const P of n){const k=t[P.key],A=this.style.map.terrain&&this.style.map.terrain.getTerrainData(P),L=v.getMeshFromTileID(this.context,P.canonical,c,!0,"stencil"),N=x.getProjectionData({overscaledTileID:P,applyGlobeMatrix:!a,applyTerrainMatrix:!0});T.draw(p,m.TRIANGLES,kr.disabled,new Hr({func:m.ALWAYS,mask:0},k,255,m.KEEP,m.KEEP,m.REPLACE),ti.disabled,a?Gr.disabled:Gr.backCCW,null,A,N,"$clipping",L.vertexBuffer,L.indexBuffer,L.segments)}}_renderTilesDepthBuffer(){const t=this.context,n=t.gl,a=this.style.projection,c=this.transform,p=this.useProgram("depth"),m=this.getDepthModeFor3D(),v=Ir(c,{tileSize:c.tileSize});for(const x of v){const T=this.style.map.terrain&&this.style.map.terrain.getTerrainData(x),P=a.getMeshFromTileID(this.context,x.canonical,!0,!0,"raster"),k=c.getProjectionData({overscaledTileID:x,applyGlobeMatrix:!0,applyTerrainMatrix:!0});p.draw(t,n.TRIANGLES,m,Hr.disabled,ti.disabled,Gr.backCCW,null,T,k,"$clipping",P.vertexBuffer,P.indexBuffer,P.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new Hr({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){const n=this.context.gl;return new Hr({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const n=this.context.gl,a=t.sort(((m,v)=>v.overscaledZ-m.overscaledZ)),c=a[a.length-1].overscaledZ,p=a[0].overscaledZ-c+1;if(p>1){this.currentStencilSource=void 0,this.nextStencilID+p>256&&this.clearStencil();const m={};for(let v=0;v<p;v++)m[v+c]=new Hr({func:n.GEQUAL,mask:255},v+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=p,[m,a]}return[{[c]:Hr.disabled},a]}stencilConfigForOverlapTwoPass(t){const n=this.context.gl,a=t.sort(((m,v)=>v.overscaledZ-m.overscaledZ)),c=a[a.length-1].overscaledZ,p=a[0].overscaledZ-c+1;if(this.clearStencil(),p>1){const m={},v={};for(let x=0;x<p;x++)m[x+c]=new Hr({func:n.GREATER,mask:255},p+1+x,255,n.KEEP,n.KEEP,n.REPLACE),v[x+c]=new Hr({func:n.GREATER,mask:255},1+x,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID=2*p+1,[m,v,a]}return this.nextStencilID=3,[{[c]:new Hr({func:n.GREATER,mask:255},2,255,n.KEEP,n.KEEP,n.REPLACE)},{[c]:new Hr({func:n.GREATER,mask:255},1,255,n.KEEP,n.KEEP,n.REPLACE)},a]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new ti([t.CONSTANT_COLOR,t.ONE],new l.bp(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ti.unblended:ti.alphaBlended}getDepthModeForSublayer(t,n,a){if(!this.opaquePassEnabledForLayer())return kr.disabled;const c=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new kr(a||this.context.gl.LEQUAL,n,[c,c])}getDepthModeFor3D(){return new kr(this.context.gl.LEQUAL,kr.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,n){var a,c;this.style=t,this.options=n,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(Ee()),this.imageManager.beginFrame();const p=this.style._order,m=this.style.tileManagers,v={},x={},T={},P={isRenderingToTexture:!1,isRenderingGlobe:((a=t.projection)===null||a===void 0?void 0:a.transitionState)>0};for(const A in m){const L=m[A];L.used&&L.prepare(this.context),v[A]=L.getVisibleCoordinates(!1),x[A]=v[A].slice().reverse(),T[A]=L.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let A=0;A<p.length;A++)if(this.style._layers[p[A]].is3D()){this.opaquePassCutoff=A;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const A of p){const L=this.style._layers[A];if(!L.hasOffscreenPass()||L.isHidden(this.transform.zoom))continue;const N=x[L.source];(L.type==="custom"||N.length)&&this.renderLayer(this,m[L.source],L,N,P)}if((c=this.style.projection)===null||c===void 0||c.updateGPUdependent({context:this.context,useProgram:A=>this.useProgram(A)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?l.bp.black:l.bp.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(A,L){const N=A.context,W=N.gl,Y=((ve,le,Me)=>{const $e=Math.cos(le.rollInRadians),Ze=Math.sin(le.rollInRadians),We=ke(le),Ye=le.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:ve.properties.get("sky-color"),u_horizon_color:ve.properties.get("horizon-color"),u_horizon:[(le.width/2-We*Ze)*Me,(le.height/2+We*$e)*Me],u_horizon_normal:[-Ze,$e],u_sky_horizon_blend:ve.properties.get("sky-horizon-blend")*le.height/2*Me,u_sky_blend:Ye}})(L,A.style.map.transform,A.pixelRatio),X=new kr(W.LEQUAL,kr.ReadWrite,[0,1]),te=Hr.disabled,fe=A.colorModeForRenderPass(),$=A.useProgram("sky"),he=Ic(N,L);$.draw(N,W.TRIANGLES,X,te,fe,Gr.disabled,Y,null,void 0,"sky",he.vertexBuffer,he.indexBuffer,he.segments)})(this,this.style.sky),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const A=this.style._layers[p[this.currentLayer]],L=m[A.source],N=v[A.source];this._renderTileClippingMasks(A,N,!1),this.renderLayer(this,L,A,N,P)}this.renderPass="translucent";let k=!1;for(this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const A=this.style._layers[p[this.currentLayer]],L=m[A.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(A,P))continue;this.opaquePassEnabledForLayer()||k||(k=!0,P.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const N=(A.type==="symbol"?T:x)[A.source];this._renderTileClippingMasks(A,v[A.source],!!this.renderToTexture),this.renderLayer(this,L,A,N,P)}if(P.isRenderingGlobe&&(function(A,L,N){const W=A.context,Y=W.gl,X=A.useProgram("atmosphere"),te=new kr(Y.LEQUAL,kr.ReadOnly,[0,1]),fe=A.transform,$=(function(Ye,At){const kt=Ye.properties.get("position"),yt=[-kt.x,-kt.y,-kt.z],Nt=l.ar(new Float64Array(16));return Ye.properties.get("anchor")==="map"&&(l.bg(Nt,Nt,At.rollInRadians),l.bh(Nt,Nt,-At.pitchInRadians),l.bg(Nt,Nt,At.bearingInRadians),l.bh(Nt,Nt,At.center.lat*Math.PI/180),l.bJ(Nt,Nt,-At.center.lng*Math.PI/180)),l.cg(yt,yt,Nt),yt})(N,A.transform),he=fe.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ve=L.properties.get("atmosphere-blend")*he.projectionTransition;if(ve===0)return;const le=Ro(fe.worldSize,fe.center.lat),Me=fe.inverseProjectionMatrix,$e=new Float64Array(4);$e[3]=1,l.aH($e,$e,fe.modelViewProjectionMatrix),$e[0]/=$e[3],$e[1]/=$e[3],$e[2]/=$e[3],$e[3]=1,l.aH($e,$e,Me),$e[0]/=$e[3],$e[1]/=$e[3],$e[2]/=$e[3],$e[3]=1;const Ze=((Ye,At,kt,yt,Nt)=>({u_sun_pos:Ye,u_atmosphere_blend:At,u_globe_position:kt,u_globe_radius:yt,u_inv_proj_matrix:Nt}))($,ve,[$e[0],$e[1],$e[2]],le,Me),We=Ic(W,L);X.draw(W,Y.TRIANGLES,te,Hr.disabled,ti.alphaBlended,Gr.disabled,Ze,null,null,"atmosphere",We.vertexBuffer,We.indexBuffer,We.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const A=(function(L,N){let W=null;const Y=Object.values(L._layers).flatMap(($=>$.source&&!$.isHidden(N)?[L.tileManagers[$.source]]:[])),X=Y.filter(($=>$.getSource().type==="vector")),te=Y.filter(($=>$.getSource().type!=="vector")),fe=$=>{(!W||W.getSource().maxzoom<$.getSource().maxzoom)&&(W=$)};return X.forEach(($=>fe($))),W||te.forEach(($=>fe($))),W})(this.style,this.transform.zoom);A&&(function(L,N,W){for(let Y=0;Y<W.length;Y++)sh(L,N,W[Y])})(this,A,A.getVisibleCoordinates())}this.options.showPadding&&(function(A){const L=A.transform.padding;Cc(A,A.transform.height-(L.top||0),3,ih),Cc(A,L.bottom||0,3,nh),Sc(A,L.left||0,3,oh),Sc(A,A.transform.width-(L.right||0),3,ah);const N=A.transform.centerPoint;(function(W,Y,X,te){us(W,Y-1,X-10,2,20,te),us(W,Y-10,X-1,20,2,te)})(A,N.x,A.transform.height-N.y,xo)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const n=this.terrainFacilitator.matrix,a=this.transform.modelViewProjectionMatrix;let c=this.terrainFacilitator.dirty;c||(c=t?!l.cj(n,a):!l.ck(n,a)),c||(c=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),c&&(l.cl(n,a),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(p,m){const v=p.context,x=v.gl,T=p.transform,P=ti.unblended,k=new kr(x.LEQUAL,kr.ReadWrite,[0,1]),A=m.tileManager.getRenderableTiles(),L=p.useProgram("terrainDepth");v.bindFramebuffer.set(m.getFramebuffer("depth").framebuffer),v.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),v.clear({color:l.bp.transparent,depth:1});for(const N of A){const W=m.getTerrainMesh(N.tileID),Y=m.getTerrainData(N.tileID),X=T.getProjectionData({overscaledTileID:N.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),te={u_ele_delta:m.getMeshFrameDelta(T.zoom)};L.draw(v,x.TRIANGLES,k,Hr.disabled,P,Gr.backCCW,te,Y,X,"terrain",W.vertexBuffer,W.indexBuffer,W.segments)}v.bindFramebuffer.set(null),v.viewport.set([0,0,p.width,p.height])})(this,this.style.map.terrain),(function(p,m){const v=p.context,x=v.gl,T=p.transform,P=ti.unblended,k=new kr(x.LEQUAL,kr.ReadWrite,[0,1]),A=m.getCoordsTexture(),L=m.tileManager.getRenderableTiles(),N=p.useProgram("terrainCoords");v.bindFramebuffer.set(m.getFramebuffer("coords").framebuffer),v.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),v.clear({color:l.bp.transparent,depth:1}),m.coordsIndex=[];for(const W of L){const Y=m.getTerrainMesh(W.tileID),X=m.getTerrainData(W.tileID);v.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,A.texture);const te={u_terrain_coords_id:(255-m.coordsIndex.length)/255,u_texture:0,u_ele_delta:m.getMeshFrameDelta(T.zoom)},fe=T.getProjectionData({overscaledTileID:W.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});N.draw(v,x.TRIANGLES,k,Hr.disabled,P,Gr.backCCW,te,X,fe,"terrain",Y.vertexBuffer,Y.indexBuffer,Y.segments),m.coordsIndex.push(W.tileID.key)}v.bindFramebuffer.set(null),v.viewport.set([0,0,p.width,p.height])})(this,this.style.map.terrain))}renderLayer(t,n,a,c,p){a.isHidden(this.transform.zoom)||(a.type==="background"||a.type==="custom"||(c||[]).length)&&(this.id=a.id,l.cm(a)?(function(m,v,x,T,P,k){if(m.renderPass!=="translucent")return;const{isRenderingToTexture:A}=k,L=Hr.disabled,N=m.colorModeForRenderPass();(x._unevaluatedLayout.hasValue("text-variable-anchor")||x._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(W,Y,X,te,fe,$,he,ve,le){const Me=Y.transform,$e=Y.style.map.terrain,Ze=fe==="map",We=$==="map";for(const Ye of W){const At=te.getTile(Ye),kt=At.getBucket(X);if(!kt||!kt.text||!kt.text.segments.get().length)continue;const yt=l.ay(kt.textSizeData,Me.zoom),Nt=l.aN(At,1,Y.transform.zoom),Mr=oi(Ze,Y.transform,Nt),Qr=X.layout.get("icon-text-fit")!=="none"&&kt.hasIconData();if(yt){const ci=Math.pow(2,Me.zoom-At.tileID.overscaledZ),ri=$e?(pi,ii)=>$e.getElevation(Ye,pi,ii):null;Sd(kt,Ze,We,le,Me,Mr,ci,yt,Qr,l.aO(Me,At,he,ve),Ye.toUnwrapped(),ri)}}})(T,m,x,v,x.layout.get("text-rotation-alignment"),x.layout.get("text-pitch-alignment"),x.paint.get("text-translate"),x.paint.get("text-translate-anchor"),P),x.paint.get("icon-opacity").constantOr(1)!==0&&as(m,v,x,T,!1,x.paint.get("icon-translate"),x.paint.get("icon-translate-anchor"),x.layout.get("icon-rotation-alignment"),x.layout.get("icon-pitch-alignment"),x.layout.get("icon-keep-upright"),L,N,A),x.paint.get("text-opacity").constantOr(1)!==0&&as(m,v,x,T,!0,x.paint.get("text-translate"),x.paint.get("text-translate-anchor"),x.layout.get("text-rotation-alignment"),x.layout.get("text-pitch-alignment"),x.layout.get("text-keep-upright"),L,N,A),v.map.showCollisionBoxes&&(jo(m,v,x,T,!0),jo(m,v,x,T,!1))})(t,n,a,c,this.style.placement.variableOffsets,p):l.cn(a)?(function(m,v,x,T,P){if(m.renderPass!=="translucent")return;const{isRenderingToTexture:k}=P,A=x.paint.get("circle-opacity"),L=x.paint.get("circle-stroke-width"),N=x.paint.get("circle-stroke-opacity"),W=!x.layout.get("circle-sort-key").isConstant();if(A.constantOr(1)===0&&(L.constantOr(1)===0||N.constantOr(1)===0))return;const Y=m.context,X=Y.gl,te=m.transform,fe=m.getDepthModeForSublayer(0,kr.ReadOnly),$=Hr.disabled,he=m.colorModeForRenderPass(),ve=[],le=te.getCircleRadiusCorrection();for(let Me=0;Me<T.length;Me++){const $e=T[Me],Ze=v.getTile($e),We=Ze.getBucket(x);if(!We)continue;const Ye=x.paint.get("circle-translate"),At=x.paint.get("circle-translate-anchor"),kt=l.aO(te,Ze,Ye,At),yt=We.programConfigurations.get(x.id),Nt=m.useProgram("circle",yt),Mr=We.layoutVertexBuffer,Qr=We.indexBuffer,ci=m.style.map.terrain&&m.style.map.terrain.getTerrainData($e),ri={programConfiguration:yt,program:Nt,layoutVertexBuffer:Mr,indexBuffer:Qr,uniformValues:Ou(m,Ze,x,kt,le),terrainData:ci,projectionData:te.getProjectionData({overscaledTileID:$e,applyGlobeMatrix:!k,applyTerrainMatrix:!0})};if(W){const pi=We.segments.get();for(const ii of pi)ve.push({segments:new l.aX([ii]),sortKey:ii.sortKey,state:ri})}else ve.push({segments:We.segments,sortKey:0,state:ri})}W&&ve.sort(((Me,$e)=>Me.sortKey-$e.sortKey));for(const Me of ve){const{programConfiguration:$e,program:Ze,layoutVertexBuffer:We,indexBuffer:Ye,uniformValues:At,terrainData:kt,projectionData:yt}=Me.state;Ze.draw(Y,X.TRIANGLES,fe,$,he,Gr.backCCW,At,kt,yt,x.id,We,Ye,Me.segments,x.paint,m.transform.zoom,$e)}})(t,n,a,c,p):l.co(a)?(function(m,v,x,T,P){if(x.paint.get("heatmap-opacity")===0)return;const k=m.context,{isRenderingToTexture:A,isRenderingGlobe:L}=P;if(m.style.map.terrain){for(const N of T){const W=v.getTile(N);v.hasRenderableParent(N)||(m.renderPass==="offscreen"?Ju(m,W,x,N,L):m.renderPass==="translucent"&&$u(m,x,N,A,L))}k.viewport.set([0,0,m.width,m.height])}else m.renderPass==="offscreen"?(function(N,W,Y,X){const te=N.context,fe=te.gl,$=N.transform,he=Hr.disabled,ve=new ti([fe.ONE,fe.ONE],l.bp.transparent,[!0,!0,!0,!0]);(function(le,Me,$e){const Ze=le.gl;le.activeTexture.set(Ze.TEXTURE1),le.viewport.set([0,0,Me.width/4,Me.height/4]);let We=$e.heatmapFbos.get(l.cd);We?(Ze.bindTexture(Ze.TEXTURE_2D,We.colorAttachment.get()),le.bindFramebuffer.set(We.framebuffer)):(We=ss(le,Me.width/4,Me.height/4),$e.heatmapFbos.set(l.cd,We))})(te,N,Y),te.clear({color:l.bp.transparent});for(let le=0;le<X.length;le++){const Me=X[le];if(W.hasRenderableParent(Me))continue;const $e=W.getTile(Me),Ze=$e.getBucket(Y);if(!Ze)continue;const We=Ze.programConfigurations.get(Y.id),Ye=N.useProgram("heatmap",We),At=$.getProjectionData({overscaledTileID:Me,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),kt=$.getCircleRadiusCorrection();Ye.draw(te,fe.TRIANGLES,kr.disabled,he,ve,Gr.backCCW,ya($e,$.zoom,Y.paint.get("heatmap-intensity"),kt),null,At,Y.id,Ze.layoutVertexBuffer,Ze.indexBuffer,Ze.segments,Y.paint,$.zoom,We)}te.viewport.set([0,0,N.width,N.height])})(m,v,x,T):m.renderPass==="translucent"&&(function(N,W){const Y=N.context,X=Y.gl;Y.setColorMode(N.colorModeForRenderPass());const te=W.heatmapFbos.get(l.cd);te&&(Y.activeTexture.set(X.TEXTURE0),X.bindTexture(X.TEXTURE_2D,te.colorAttachment.get()),Y.activeTexture.set(X.TEXTURE1),al(Y,W).bind(X.LINEAR,X.CLAMP_TO_EDGE),N.useProgram("heatmapTexture").draw(Y,X.TRIANGLES,kr.disabled,Hr.disabled,N.colorModeForRenderPass(),Gr.disabled,Nu(N,W,0,1),null,null,W.id,N.viewportBuffer,N.quadTriangleIndexBuffer,N.viewportSegments,W.paint,N.transform.zoom))})(m,x)})(t,n,a,c,p):l.cp(a)?(function(m,v,x,T,P){if(m.renderPass!=="translucent")return;const{isRenderingToTexture:k}=P,A=x.paint.get("line-opacity"),L=x.paint.get("line-width");if(A.constantOr(1)===0||L.constantOr(1)===0)return;const N=m.getDepthModeForSublayer(0,kr.ReadOnly),W=m.colorModeForRenderPass(),Y=x.paint.get("line-dasharray"),X=Y.constantOr(1),te=x.paint.get("line-pattern"),fe=te.constantOr(1),$=x.paint.get("line-gradient"),he=x.getCrossfadeParameters();let ve;ve=fe?"linePattern":X&&$?"lineGradientSDF":X?"lineSDF":$?"lineGradient":"line";const le=m.context,Me=le.gl,$e=m.transform;let Ze=!0;for(const We of T){const Ye=v.getTile(We);if(fe&&!Ye.patternsLoaded())continue;const At=Ye.getBucket(x);if(!At)continue;const kt=At.programConfigurations.get(x.id),yt=m.context.program.get(),Nt=m.useProgram(ve,kt),Mr=Ze||Nt.program!==yt,Qr=m.style.map.terrain&&m.style.map.terrain.getTerrainData(We),ci=te.constantOr(null),ri=Y&&Y.constantOr(null);if(ci&&Ye.imageAtlas){const ji=Ye.imageAtlas,Di=ji.patternPositions[ci.to.toString()],Ai=ji.patternPositions[ci.from.toString()];Di&&Ai&&kt.setConstantPatternPositions(Di,Ai)}else if(ri){const ji=x.layout.get("line-cap")==="round",Di=m.lineAtlas.getDash(ri.to,ji),Ai=m.lineAtlas.getDash(ri.from,ji);kt.setConstantDashPositions(Di,Ai)}const pi=$e.getProjectionData({overscaledTileID:We,applyGlobeMatrix:!k,applyTerrainMatrix:!0}),ii=$e.getPixelScale();let Ci;fe?(Ci=dc(m,Ye,x,ii,he),th(le,Me,Ye,kt,he)):X&&$?(Ci=Hs(m,Ye,x,ii,he,At.lineClipsArray.length),bn(m,v,le,Me,x,At,We,kt,he)):X?(Ci=Uu(m,Ye,x,ii,he),Mi(m,le,Me,kt,Mr,he)):$?(Ci=ju(m,Ye,x,ii,At.lineClipsArray.length),Uo(m,v,le,Me,x,At,We)):Ci=es(m,Ye,x,ii);const fi=m.stencilModeForClipping(We);Nt.draw(le,Me.TRIANGLES,N,fi,W,Gr.disabled,Ci,Qr,pi,x.id,At.layoutVertexBuffer,At.indexBuffer,At.segments,x.paint,m.transform.zoom,kt,At.layoutVertexBuffer2),Ze=!1}})(t,n,a,c,p):l.cq(a)?(function(m,v,x,T,P){const k=x.paint.get("fill-color"),A=x.paint.get("fill-opacity");if(A.constantOr(1)===0)return;const{isRenderingToTexture:L}=P,N=m.colorModeForRenderPass(),W=x.paint.get("fill-pattern"),Y=m.opaquePassEnabledForLayer()&&!W.constantOr(1)&&k.constantOr(l.bp.transparent).a===1&&A.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===Y){const X=m.getDepthModeForSublayer(1,m.renderPass==="opaque"?kr.ReadWrite:kr.ReadOnly);ls(m,v,x,T,X,N,!1,L)}if(m.renderPass==="translucent"&&x.paint.get("fill-antialias")){const X=m.getDepthModeForSublayer(x.getPaintProperty("fill-outline-color")?2:0,kr.ReadOnly);ls(m,v,x,T,X,N,!0,L)}})(t,n,a,c,p):l.cr(a)?(function(m,v,x,T,P){const k=x.paint.get("fill-extrusion-opacity");if(k===0)return;const{isRenderingToTexture:A}=P;if(m.renderPass==="translucent"){const L=new kr(m.context.gl.LEQUAL,kr.ReadWrite,m.depthRangeFor3D);if(k!==1||x.paint.get("fill-extrusion-pattern").constantOr(1))ll(m,v,x,T,L,Hr.disabled,ti.disabled,A),ll(m,v,x,T,L,m.stencilModeFor3D(),m.colorModeForRenderPass(),A);else{const N=m.colorModeForRenderPass();ll(m,v,x,T,L,Hr.disabled,N,A)}}})(t,n,a,c,p):l.cs(a)?(function(m,v,x,T,P){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent")return;const{isRenderingToTexture:k}=P,A=m.context,L=m.style.projection.useSubdivision,N=m.getDepthModeForSublayer(0,kr.ReadOnly),W=m.colorModeForRenderPass();if(m.renderPass==="offscreen")(function(Y,X,te,fe,$,he,ve){const le=Y.context,Me=le.gl;for(const $e of te){const Ze=X.getTile($e),We=Ze.dem;if(!We||!We.data||!Ze.needsHillshadePrepare)continue;const Ye=We.dim,At=We.stride,kt=We.getPixels();if(le.activeTexture.set(Me.TEXTURE1),le.pixelStoreUnpackPremultiplyAlpha.set(!1),Ze.demTexture=Ze.demTexture||Y.getTileTexture(At),Ze.demTexture){const Nt=Ze.demTexture;Nt.update(kt,{premultiply:!1}),Nt.bind(Me.NEAREST,Me.CLAMP_TO_EDGE)}else Ze.demTexture=new l.T(le,kt,Me.RGBA,{premultiply:!1}),Ze.demTexture.bind(Me.NEAREST,Me.CLAMP_TO_EDGE);le.activeTexture.set(Me.TEXTURE0);let yt=Ze.fbo;if(!yt){const Nt=new l.T(le,{width:Ye,height:Ye,data:null},Me.RGBA);Nt.bind(Me.LINEAR,Me.CLAMP_TO_EDGE),yt=Ze.fbo=le.createFramebuffer(Ye,Ye,!0,!1),yt.colorAttachment.set(Nt.texture)}le.bindFramebuffer.set(yt.framebuffer),le.viewport.set([0,0,Ye,Ye]),Y.useProgram("hillshadePrepare").draw(le,Me.TRIANGLES,$,he,ve,Gr.disabled,fd(Ze.tileID,We),null,null,fe.id,Y.rasterBoundsBuffer,Y.quadTriangleIndexBuffer,Y.rasterBoundsSegments),Ze.needsHillshadePrepare=!1}})(m,v,T,x,N,Hr.disabled,W),A.viewport.set([0,0,m.width,m.height]);else if(m.renderPass==="translucent")if(L){const[Y,X,te]=m.stencilConfigForOverlapTwoPass(T);yo(m,v,x,te,Y,N,W,!1,k),yo(m,v,x,te,X,N,W,!0,k)}else{const[Y,X]=m.getStencilConfigForOverlapAndUpdateStencilID(T);yo(m,v,x,X,Y,N,W,!1,k)}})(t,n,a,c,p):l.ct(a)?(function(m,v,x,T,P){if(m.renderPass!=="translucent"||!T.length)return;const{isRenderingToTexture:k}=P,A=m.style.projection.useSubdivision,L=m.getDepthModeForSublayer(0,kr.ReadOnly),N=m.colorModeForRenderPass();if(A){const[W,Y,X]=m.stencilConfigForOverlapTwoPass(T);cs(m,v,x,X,W,L,N,!1,k),cs(m,v,x,X,Y,L,N,!0,k)}else{const[W,Y]=m.getStencilConfigForOverlapAndUpdateStencilID(T);cs(m,v,x,Y,W,L,N,!1,k)}})(t,n,a,c,p):l.bU(a)?(function(m,v,x,T,P){if(m.renderPass!=="translucent"||x.paint.get("raster-opacity")===0||!T.length)return;const{isRenderingToTexture:k}=P,A=v.getSource(),L=m.style.projection.useSubdivision;if(A instanceof Cr)Ca(m,v,x,T,null,!1,!1,A.tileCoords,A.flippedWindingOrder,k);else if(L){const[N,W,Y]=m.stencilConfigForOverlapTwoPass(T);Ca(m,v,x,Y,N,!1,!0,Go,!1,k),Ca(m,v,x,Y,W,!0,!0,Go,!1,k)}else{const[N,W]=m.getStencilConfigForOverlapAndUpdateStencilID(T);Ca(m,v,x,W,N,!1,!0,Go,!1,k)}})(t,n,a,c,p):l.cu(a)?(function(m,v,x,T,P){const k=x.paint.get("background-color"),A=x.paint.get("background-opacity");if(A===0)return;const{isRenderingToTexture:L}=P,N=m.context,W=N.gl,Y=m.style.projection,X=m.transform,te=X.tileSize,fe=x.paint.get("background-pattern");if(m.isPatternMissing(fe))return;const $=!fe&&k.a===1&&A===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==$)return;const he=Hr.disabled,ve=m.getDepthModeForSublayer(0,$==="opaque"?kr.ReadWrite:kr.ReadOnly),le=m.colorModeForRenderPass(),Me=m.useProgram(fe?"backgroundPattern":"background"),$e=T||Ir(X,{tileSize:te,terrain:m.style.map.terrain});fe&&(N.activeTexture.set(W.TEXTURE0),m.imageManager.bind(m.context));const Ze=x.getCrossfadeParameters();for(const We of $e){const Ye=X.getProjectionData({overscaledTileID:We,applyGlobeMatrix:!L,applyTerrainMatrix:!0}),At=fe?gd(A,m,fe,{tileID:We,tileSize:te},Ze):gc(A,k),kt=m.style.map.terrain&&m.style.map.terrain.getTerrainData(We),yt=Y.getMeshFromTileID(N,We.canonical,!1,!0,"raster");Me.draw(N,W.TRIANGLES,ve,he,le,Gr.backCCW,At,kt,Ye,x.id,yt.vertexBuffer,yt.indexBuffer,yt.segments)}})(t,0,a,c,p):l.cv(a)&&(function(m,v,x,T){const{isRenderingGlobe:P}=T,k=m.context,A=x.implementation,L=m.style.projection,N=m.transform,W=N.getProjectionDataForCustomLayer(P),Y={farZ:N.farZ,nearZ:N.nearZ,fov:N.fov*Math.PI/180,modelViewProjectionMatrix:N.modelViewProjectionMatrix,projectionMatrix:N.projectionMatrix,shaderData:{variantName:L.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${L.shaderPreludeCode.vertexSource}`,define:L.shaderDefine},defaultProjectionData:W},X=A.renderingMode?A.renderingMode:"2d";if(m.renderPass==="offscreen"){const te=A.prerender;te&&(m.setCustomLayerDefaults(),k.setColorMode(m.colorModeForRenderPass()),te.call(A,k.gl,Y),k.setDirty(),m.setBaseState())}else if(m.renderPass==="translucent"){m.setCustomLayerDefaults(),k.setColorMode(m.colorModeForRenderPass()),k.setStencilMode(Hr.disabled);const te=X==="3d"?m.getDepthModeFor3D():m.getDepthModeForSublayer(0,kr.ReadOnly);k.setDepthMode(te),A.render(k.gl,Y),k.setDirty(),m.setBaseState(),k.bindFramebuffer.set(null)}})(t,0,a,p))}saveTileTexture(t){const n=this._tileTextures[t.size[0]];n?n.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const n=this._tileTextures[t];return n&&n.length>0?n.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const n=this.imageManager.getPattern(t.from.toString()),a=this.imageManager.getPattern(t.to.toString());return!n||!a}useProgram(t,n,a=!1,c=[]){this.cache=this.cache||{};const p=!!this.style.map.terrain,m=this.style.projection,v=a?yi.projectionMercator:m.shaderPreludeCode,x=a?sn:m.shaderDefine,T=t+(n?n.cacheKey:"")+`/${a?xn:m.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(p?"/terrain":"")+(c?`/${c.join("/")}`:"");return this.cache[T]||(this.cache[T]=new Du(this.context,yi[t],n,_d[t],this._showOverdrawInspector,p,v,x,c)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new l.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var t,n;if(this._tileTextures){for(const a in this._tileTextures){const c=this._tileTextures[a];if(c)for(const p of c)p.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((t=this.tileExtentMesh.vertexBuffer)===null||t===void 0||t.destroy()),this.tileExtentMesh&&((n=this.tileExtentMesh.indexBuffer)===null||n===void 0||n.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const a in this.cache){const c=this.cache[a];c&&c.program&&this.context.gl.deleteProgram(c.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:n}=this.context.gl;return this.width!==t||this.height!==n}}function Mc(d,t){let n,a=!1,c=null,p=null;const m=()=>{c=null,a&&(d.apply(p,n),c=setTimeout(m,t),a=!1)};return(...v)=>(a=!0,p=this,n=v,c||m(),c)}class Ec{constructor(t){this._getCurrentHash=()=>{const n=window.location.hash.replace("#","");if(this._hashName){let a;return n.split("&").map((c=>c.split("="))).forEach((c=>{c[0]===this._hashName&&(a=c)})),(a&&a[1]||"").split("/")}return n.split("/")},this._onHashChange=()=>{const n=this._getCurrentHash();if(!this._isValidHash(n))return!1;const a=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:a,pitch:+(n[4]||0)}),!0},this._updateHashUnthrottled=()=>{const n=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,n)},this._removeHash=()=>{const n=this._getCurrentHash();if(n.length===0)return;const a=n.join("/");let c=a;c.split("&").length>0&&(c=c.split("&")[0]),this._hashName&&(c=`${this._hashName}=${a}`);let p=window.location.hash.replace(c,"");p.startsWith("#&")?p=p.slice(0,1)+p.slice(2):p==="#"&&(p="");let m=window.location.href.replace(/(#.+)?$/,p);m=m.replace("&&","&"),window.history.replaceState(window.history.state,null,m)},this._updateHash=Mc(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const n=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,c=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),p=Math.pow(10,c),m=Math.round(n.lng*p)/p,v=Math.round(n.lat*p)/p,x=this._map.getBearing(),T=this._map.getPitch();let P="";if(P+=t?`/${m}/${v}/${a}`:`${a}/${v}/${m}`,(x||T)&&(P+="/"+Math.round(10*x)/10),T&&(P+=`/${Math.round(T)}`),this._hashName){const k=this._hashName;let A=!1;const L=window.location.hash.slice(1).split("&").map((N=>{const W=N.split("=")[0];return W===k?(A=!0,`${W}=${P}`):N})).filter((N=>N));return A||L.push(`${k}=${P}`),`#${L.join("&")}`}return`#${P}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new l.V(+t[2],+t[1])}catch{return!1}const n=+t[0],a=+(t[3]||0),c=+(t[4]||0);return n>=this._map.getMinZoom()&&n<=this._map.getMaxZoom()&&a>=-180&&a<=180&&c>=this._map.getMinPitch()&&c<=this._map.getMaxPitch()}}const bo={linearity:.3,easing:l.cw(0,0,.3,1)},ch=l.e({deceleration:2500,maxSpeed:1400},bo),En=l.e({deceleration:20,maxSpeed:1400},bo),On=l.e({deceleration:1e3,maxSpeed:360},bo),uh=l.e({deceleration:1e3,maxSpeed:90},bo),Bn=l.e({deceleration:1e3,maxSpeed:360},bo);class Pd{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Ee(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=Ee();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,roll:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:p}of this._inertiaBuffer)n.zoom+=p.zoomDelta||0,n.bearing+=p.bearingDelta||0,n.pitch+=p.pitchDelta||0,n.roll+=p.rollDelta||0,p.panDelta&&n.pan._add(p.panDelta),p.around&&(n.around=p.around),p.pinchAround&&(n.pinchAround=p.pinchAround);const a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,c={};if(n.pan.mag()){const p=ds(n.pan.mag(),a,l.e({},ch,t||{})),m=n.pan.mult(p.amount/n.pan.mag()),v=this._map.cameraHelper.handlePanInertia(m,this._map.transform);c.center=v.easingCenter,c.offset=v.easingOffset,hs(c,p)}if(n.zoom){const p=ds(n.zoom,a,En),m=l.cx(this._map.transform.zoom+p.amount,this._map.getZoomSnap(),p.amount);c.zoom=m,hs(c,p)}if(n.bearing){const p=ds(n.bearing,a,On);c.bearing=this._map.transform.bearing+l.an(p.amount,-179,179),hs(c,p)}if(n.pitch){const p=ds(n.pitch,a,uh);c.pitch=this._map.transform.pitch+p.amount,hs(c,p)}if(n.roll){const p=ds(n.roll,a,Bn);c.roll=this._map.transform.roll+l.an(p.amount,-179,179),hs(c,p)}if(c.zoom||c.bearing){const p=n.pinchAround===void 0?n.around:n.pinchAround;c.around=p?this._map.unproject(p):this._map.getCenter()}return this.clear(),l.e(c,{noMoveStart:!0})}}function hs(d,t){(!d.duration||d.duration<t.duration)&&(d.duration=t.duration,d.easing=t.easing)}function ds(d,t,n){const{maxSpeed:a,linearity:c,deceleration:p}=n,m=l.an(d*c/(t/1e3),-a,a),v=Math.abs(m)/(p*c);return{easing:n.easing,duration:1e3*v,amount:m*(v/2)}}class Vi extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,a,c={}){a=a instanceof MouseEvent?a:new MouseEvent(t,a);const p=Z.mousePos(n.getCanvas(),a),m=n.unproject(p);super(t,l.e({point:p,lngLat:m,originalEvent:a},c)),this._defaultPrevented=!1,this.target=n}}class ps extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,a){const c=t==="touchend"?a.changedTouches:a.touches,p=Z.touchPos(n.getCanvasContainer(),c),m=p.map((x=>n.unproject(x))),v=p.reduce(((x,T,P,k)=>x.add(T.div(k.length))),new l.P(0,0));super(t,{points:p,point:v,lngLats:m,lngLat:n.unproject(v),originalEvent:a}),this._defaultPrevented=!1}}class hh extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,a){super(t,{originalEvent:a}),this._defaultPrevented=!1}}class Id{constructor(t,n){this._map=t,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new hh(t.type,this._map,t))}mousedown(t,n){return this._mousedownPos=n,this._firePreventable(new Vi(t.type,this._map,t))}mouseup(t){this._map.fire(new Vi(t.type,this._map,t))}click(t,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new Vi(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Vi(t.type,this._map,t))}mouseover(t){this._map.fire(new Vi(t.type,this._map,t))}mouseout(t){this._map.fire(new Vi(t.type,this._map,t))}touchstart(t){return this._firePreventable(new ps(t.type,this._map,t))}touchmove(t){this._map.fire(new ps(t.type,this._map,t))}touchend(t){this._map.fire(new ps(t.type,this._map,t))}touchcancel(t){this._map.fire(new ps(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Md{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Vi(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Vi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Vi(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Sa{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(l.P.convert(t),this._map.terrain)}}class Pa{constructor(t,n){this._map=t,this._tr=new Sa(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,n){this.isEnabled()&&t.shiftKey&&t.button===0&&(Z.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(t,n){if(!this._active)return;const a=n;if(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)return;const c=this._startPos;this._lastPos=a,this._box||(this._box=Z.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const p=Math.min(c.x,a.x),m=Math.max(c.x,a.x),v=Math.min(c.y,a.y),x=Math.max(c.y,a.y);Z.setTransform(this._box,`translate(${p}px,${v}px)`),this._box.style.width=m-p+"px",this._box.style.height=x-v+"px"}mouseupWindow(t,n){if(!this._active||t.button!==0)return;const a=this._startPos,c=n;if(this.reset(),Z.suppressClick(),a.x!==c.x||a.y!==c.y)return this._map.fire(new l.l("boxzoomend",{originalEvent:t})),{cameraAnimation:p=>p.fitScreenCoordinates(a,c,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(Z.remove(this._box),this._box=null),Z.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new l.l(t,{originalEvent:n}))}}function Nn(d,t){if(d.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${d.length}, points ${t.length}`);const n={};for(let a=0;a<d.length;a++)n[d[a].identifier]=t[a];return n}class Zt{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,n,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),a.length===this.numTouches&&(this.centroid=(function(c){const p=new l.P(0,0);for(const m of c)p._add(m);return p.div(c.length)})(n),this.touches=Nn(a,n)))}touchmove(t,n,a){if(this.aborted||!this.centroid)return;const c=Nn(a,n);for(const p in this.touches){const m=c[p];(!m||m.dist(this.touches[p])>30)&&(this.aborted=!0)}}touchend(t,n,a){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){const c=!this.aborted&&this.centroid;if(this.reset(),c)return c}}}class cl{constructor(t){this.singleTap=new Zt(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,n,a){this.singleTap.touchstart(t,n,a)}touchmove(t,n,a){this.singleTap.touchmove(t,n,a)}touchend(t,n,a){const c=this.singleTap.touchend(t,n,a);if(c){const p=t.timeStamp-this.lastTime<500,m=!this.lastTap||this.lastTap.dist(c)<30;if(p&&m||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=c,this.count===this.numTaps)return this.reset(),c}}}class Ac{constructor(t){this._tr=new Sa(t),this._zoomIn=new cl({numTouches:1,numTaps:2}),this._zoomOut=new cl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,n,a){this._zoomIn.touchstart(t,n,a),this._zoomOut.touchstart(t,n,a)}touchmove(t,n,a){this._zoomIn.touchmove(t,n,a),this._zoomOut.touchmove(t,n,a)}touchend(t,n,a){const c=this._zoomIn.touchend(t,n,a),p=this._zoomOut.touchend(t,n,a),m=this._tr;return c?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:l.cx(m.zoom+1,v.getZoomSnap()),around:m.unproject(c)},{originalEvent:t})}):p?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:l.cx(m.zoom-1,v.getZoomSnap()),around:m.unproject(p)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ia{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const n=this._moveFunction(...t);if(n.bearingDelta||n.pitchDelta||n.rollDelta||n.around||n.panDelta)return this._active=!0,n}dragStart(t,n){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(n)?n[0]:n,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,n){if(!this.isEnabled())return;const a=this._lastPoint;if(!a)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const c=Array.isArray(n)?n[0]:n;return!this._moved&&c.dist(a)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=c,this._move(a,c))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&Z.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const fs=0,ms=2,kc={[fs]:1,[ms]:2};class gs{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const n=Z.mouseButton(t);this._eventButton=n}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!(function(n,a){const c=kc[a];return n.buttons===void 0||(n.buttons&c)!==c})(t,this._eventButton)}isValidEndEvent(t){return Z.mouseButton(t)===this._eventButton}}class zc{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class dh{constructor(t=new gs({checkCorrectEvent:()=>!0}),n=new zc){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=n}_executeRelevantHandler(t,n,a){return t instanceof MouseEvent?n(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?a(t):void 0}startMove(t){this._executeRelevantHandler(t,(n=>this.mouseMoveStateManager.startMove(n)),(n=>this.oneFingerTouchMoveStateManager.startMove(n)))}endMove(t){this._executeRelevantHandler(t,(n=>this.mouseMoveStateManager.endMove(n)),(n=>this.oneFingerTouchMoveStateManager.endMove(n)))}isValidStartEvent(t){return this._executeRelevantHandler(t,(n=>this.mouseMoveStateManager.isValidStartEvent(n)),(n=>this.oneFingerTouchMoveStateManager.isValidStartEvent(n)))}isValidMoveEvent(t){return this._executeRelevantHandler(t,(n=>this.mouseMoveStateManager.isValidMoveEvent(n)),(n=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(n)))}isValidEndEvent(t){return this._executeRelevantHandler(t,(n=>this.mouseMoveStateManager.isValidEndEvent(n)),(n=>this.oneFingerTouchMoveStateManager.isValidEndEvent(n)))}}const Ma=d=>{d.mousedown=d.dragStart,d.mousemoveWindow=d.dragMove,d.mouseup=d.dragEnd,d.contextmenu=t=>{t.preventDefault()}};class Ed{constructor(t,n){this._clickTolerance=t.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,n,a){return this._calculateTransform(t,n,a)}touchmove(t,n,a){if(this._active){if(!this._shouldBePrevented(a.length))return t.preventDefault(),this._calculateTransform(t,n,a);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,n,a){this._calculateTransform(t,n,a),this._active&&this._shouldBePrevented(a.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,a){a.length>0&&(this._active=!0);const c=Nn(a,n),p=new l.P(0,0),m=new l.P(0,0);let v=0;for(const T in c){const P=c[T],k=this._touches[T];k&&(p._add(P),m._add(P.sub(k)),v++,c[T]=P)}if(this._touches=c,this._shouldBePrevented(v)||!m.mag())return;const x=m.div(v);return this._sum._add(x),this._sum.mag()<this._clickTolerance?void 0:{around:p.div(v),panDelta:x}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ul{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,n,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([n[0],n[1]]))}touchmove(t,n,a){if(!this._firstTwoTouches)return;t.preventDefault();const[c,p]=this._firstTwoTouches,m=hl(a,n,c),v=hl(a,n,p);if(!m||!v)return;const x=this._aroundCenter?null:m.add(v).div(2);return this._move([m,v],x,t)}touchend(t,n,a){if(!this._firstTwoTouches)return;const[c,p]=this._firstTwoTouches,m=hl(a,n,c),v=hl(a,n,p);m&&v||(this._active&&Z.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function hl(d,t,n){for(let a=0;a<d.length;a++)if(d[a].identifier===n)return t[a]}function ph(d,t){return Math.log(d/t)/Math.LN2}class Dc extends ul{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,n){const a=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(ph(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ph(this._distance,a),pinchAround:n}}}function fh(d,t){return 180*d.angleWith(t)/Math.PI}class Lc extends ul{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,n,a){const c=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:fh(this._vector,c),pinchAround:n}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const n=25/(Math.PI*this._minDiameter)*360,a=fh(t,this._startVector);return Math.abs(a)<n}}function Rc(d){return Math.abs(d.y)>Math.abs(d.x)}class mh extends ul{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,n,a){super.touchstart(t,n,a),this._currentTouchCount=a.length}_start(t){this._lastPoints=t,Rc(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,n,a){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const c=t[0].sub(this._lastPoints[0]),p=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(c,p,a.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(c.y+p.y)/2*-.5}):void 0}gestureBeginsVertically(t,n,a){if(this._valid!==void 0)return this._valid;const c=t.mag()>=2,p=n.mag()>=2;if(!c&&!p)return;if(!c||!p)return this._firstMove===void 0&&(this._firstMove=a),a-this._firstMove<100&&void 0;const m=t.y>0==n.y>0;return Rc(t)&&Rc(n)&&m}}const wo={panStep:100,bearingStep:15,pitchStep:10};class $r{constructor(t){this._tr=new Sa(t);const n=wo;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let n=0,a=0,c=0,p=0,m=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?a=-1:(t.preventDefault(),p=-1);break;case 39:t.shiftKey?a=1:(t.preventDefault(),p=1);break;case 38:t.shiftKey?c=1:(t.preventDefault(),m=-1);break;case 40:t.shiftKey?c=-1:(t.preventDefault(),m=1);break;default:return}return this._rotationDisabled&&(a=0,c=0),{cameraAnimation:v=>{const x=this._tr;v.easeTo({duration:300,easeId:"keyboardHandler",easing:Ad,zoom:n?l.cx(x.zoom+n*(t.shiftKey?2:1),v.getZoomSnap()):x.zoom,bearing:x.bearing+a*this._bearingStep,pitch:x.pitch+c*this._pitchStep,offset:[-p*this._panStep,-m*this._panStep],center:x.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ad(d){return d*(2-d)}const _s=4.000244140625,dl=1/450;class pl{constructor(t,n){this._onTimeout=a=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)},this._map=t,this._tr=new Sa(t),this._triggerRenderFrame=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=dl}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const a=Ee(),c=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,n!==0&&n%_s==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":c>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(c*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=Z.mousePos(this._map.getCanvas(),t),a=this._tr;this._aroundPoint=this._aroundCenter?a.transform.locationToScreenPoint(l.V.convert(a.center)):n,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const v=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=v),typeof this._targetZoom=="number"&&(this._targetZoom+=v)}if(this._delta!==0){const v=this._type==="wheel"&&Math.abs(this._delta)>_s?this._wheelZoomRate:this._defaultZoomRate;let x=2/(1+Math.exp(-Math.abs(this._delta*v)));this._delta<0&&x!==0&&(x=1/x);const T=typeof this._targetZoom!="number"?t.scale:l.aq(this._targetZoom),P=t.applyConstrain(t.getCameraLngLat(),l.at(T*x)).zoom,k=this._map.getZoomSnap();if(this._type==="wheel"&&k>0){const A=l.cx(t.zoom,k);this._targetZoom=l.cx(P,k,P-A)}else this._targetZoom=P;this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,a=this._startZoom,c=this._easing;let p,m=!1;if(this._type==="wheel"&&a&&c){const v=Ee()-this._lastWheelEventTime,x=Math.min((v+5)/200,1),T=c(x);p=l.G.number(a,n,T),x<1?this._frameId||(this._frameId=!0):m=!0}else p=n,m=!0;return this._active=!0,m&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=p,{noInertia:!0,needsRenderFrame:!m,zoomDelta:p-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=l.cz;if(this._prevEase){const a=this._prevEase,c=(Ee()-a.start)/a.duration,p=a.easing(c+.01)-a.easing(c),m=.27/Math.sqrt(p*p+1e-4)*.01,v=Math.sqrt(.0729-m*m);n=l.cw(m,v,.25,1)}return this._prevEase={start:Ee(),duration:t,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Fc{constructor(t,n){this._clickZoom=t,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class gh{constructor(t){this._tr=new Sa(t),this.reset()}reset(){this._active=!1}dblclick(t,n){return t.preventDefault(),{cameraAnimation:a=>{a.easeTo({duration:300,zoom:l.cx(this._tr.zoom+(t.shiftKey?-1:1),a.getZoomSnap()),around:this._tr.unproject(n)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _h{constructor(){this._tap=new cl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,n,a){if(!this._swipePoint)if(this._tapTime){const c=n[0],p=t.timeStamp-this._tapTime<500,m=this._tapPoint.dist(c)<30;p&&m?a.length>0&&(this._swipePoint=c,this._swipeTouch=a[0].identifier):this.reset()}else this._tap.touchstart(t,n,a)}touchmove(t,n,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;const c=n[0],p=c.y-this._swipePoint.y;return this._swipePoint=c,t.preventDefault(),this._active=!0,{zoomDelta:p/128}}}else this._tap.touchmove(t,n,a)}touchend(t,n,a){if(this._tapTime)this._swipePoint&&a.length===0&&this.reset();else{const c=this._tap.touchend(t,n,a);c&&(this._tapTime=t.timeStamp,this._tapPoint=c)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vh{constructor(t,n,a){this._el=t,this._mousePan=n,this._touchPan=a}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Vn{constructor(t,n,a,c){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=n,this._mousePitch=a,this._mouseRoll=c}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class vs{constructor(t,n,a,c){this._el=t,this._touchZoom=n,this._touchRotate=a,this._tapDragZoom=c,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Jt{constructor(t,n){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=n,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=Z.create("div","maplibregl-cooperative-gesture-screen",t);let n=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(n=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const a=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),c=document.createElement("div");c.className="maplibregl-desktop-message",c.textContent=n,this._container.appendChild(c);const p=document.createElement("div");p.className="maplibregl-mobile-message",p.textContent=a,this._container.appendChild(p),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(Z.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,n){this._enabled&&(this._map.fire(new l.l("cooperativegestureprevented",{gestureType:t,originalEvent:n})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const sr=d=>d.zoom||d.drag||d.roll||d.pitch||d.rotate;class ys extends l.l{}function fl(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta||d.rollDelta}class ml{get _ownerDocument(){var t;return((t=this._el)===null||t===void 0?void 0:t.ownerDocument)||document}get _ownerWindow(){var t,n;return((n=(t=this._el)===null||t===void 0?void 0:t.ownerDocument)===null||n===void 0?void 0:n.defaultView)||window}constructor(t,n){this.handleWindowEvent=c=>{this.handleEvent(c,`${c.type}Window`)},this.handleEvent=(c,p)=>{if(c.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const m=c.type==="renderFrame"?void 0:c,v={needsRenderFrame:!1},x={},T={};for(const{handlerName:A,handler:L,allowed:N}of this._handlers){if(!L.isEnabled())continue;let W;if(this._blockedByActive(T,N,A))L.reset();else if(L[p||c.type]){if(l.cA(c,p||c.type)){const Y=Z.mousePos(this._map.getCanvas(),c);W=L[p||c.type](c,Y)}else if(l.cB(c,p||c.type)){const Y=this._getMapTouches(c.touches),X=Z.touchPos(this._map.getCanvas(),Y);W=L[p||c.type](c,X,Y)}else l.cC(p||c.type)||(W=L[p||c.type](c));this.mergeHandlerResult(v,x,W,A,m),W&&W.needsRenderFrame&&this._triggerRenderFrame()}(W||L.isActive())&&(T[A]=L)}const P={};for(const A in this._previousActiveHandlers)T[A]||(P[A]=m);this._previousActiveHandlers=T,(Object.keys(P).length||fl(v))&&(this._changes.push([v,x,P]),this._triggerRenderFrame()),(Object.keys(T).length||fl(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:k}=v;k&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],k(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Pd(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);const a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[this._ownerDocument,"mousemove",{capture:!0}],[this._ownerDocument,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[this._ownerWindow,"blur",void 0]];for(const[c,p,m]of this._listeners)Z.addEventListener(c,p,c===this._ownerDocument?this.handleWindowEvent:this.handleEvent,m)}destroy(){for(const[t,n,a]of this._listeners)Z.removeEventListener(t,n,t===this._ownerDocument?this.handleWindowEvent:this.handleEvent,a)}_addDefaultHandlers(t){const n=this._map,a=n.getCanvasContainer();this._add("mapEvent",new Id(n,t));const c=n.boxZoom=new Pa(n,t);this._add("boxZoom",c),t.interactive&&t.boxZoom&&c.enable();const p=n.cooperativeGestures=new Jt(n,t.cooperativeGestures);this._add("cooperativeGestures",p),t.cooperativeGestures&&p.enable();const m=new Ac(n),v=new gh(n);n.doubleClickZoom=new Fc(v,m),this._add("tapZoom",m),this._add("clickZoom",v),t.interactive&&t.doubleClickZoom&&n.doubleClickZoom.enable();const x=new _h;this._add("tapDragZoom",x);const T=n.touchPitch=new mh(n);this._add("touchPitch",T),t.interactive&&t.touchPitch&&n.touchPitch.enable(t.touchPitch);const P=()=>n.project(n.getCenter()),k=(function({enable:$,clickTolerance:he,aroundCenter:ve=!0,minPixelCenterThreshold:le=100,rotateDegreesPerPixelMoved:Me=.8},$e){const Ze=new gs({checkCorrectEvent:We=>Z.mouseButton(We)===0&&We.ctrlKey||Z.mouseButton(We)===2&&!We.ctrlKey});return new Ia({clickTolerance:he,move:(We,Ye)=>{const At=$e();if(ve&&Math.abs(At.y-We.y)>le)return{bearingDelta:l.cy(new l.P(We.x,Ye.y),Ye,At)};let kt=(Ye.x-We.x)*Me;return ve&&Ye.y<At.y&&(kt=-kt),{bearingDelta:kt}},moveStateManager:Ze,enable:$,assignEvents:Ma})})(t,P),A=(function({enable:$,clickTolerance:he,pitchDegreesPerPixelMoved:ve=-.5}){const le=new gs({checkCorrectEvent:Me=>Z.mouseButton(Me)===0&&Me.ctrlKey||Z.mouseButton(Me)===2});return new Ia({clickTolerance:he,move:(Me,$e)=>({pitchDelta:($e.y-Me.y)*ve}),moveStateManager:le,enable:$,assignEvents:Ma})})(t),L=(function({enable:$,clickTolerance:he,rollDegreesPerPixelMoved:ve=.3},le){const Me=new gs({checkCorrectEvent:$e=>Z.mouseButton($e)===2&&$e.ctrlKey});return new Ia({clickTolerance:he,move:($e,Ze)=>{const We=le();let Ye=(Ze.x-$e.x)*ve;return Ze.y<We.y&&(Ye=-Ye),{rollDelta:Ye}},moveStateManager:Me,enable:$,assignEvents:Ma})})(t,P);n.dragRotate=new Vn(t,k,A,L),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",A,["mouseRotate","mouseRoll"]),this._add("mouseRoll",L,["mousePitch"]),t.interactive&&t.dragRotate&&n.dragRotate.enable();const N=(function({enable:$,clickTolerance:he}){const ve=new gs({checkCorrectEvent:le=>Z.mouseButton(le)===0&&!le.ctrlKey});return new Ia({clickTolerance:he,move:(le,Me)=>({around:Me,panDelta:Me.sub(le)}),activateOnStart:!0,moveStateManager:ve,enable:$,assignEvents:Ma})})(t),W=new Ed(t,n);n.dragPan=new vh(a,N,W),this._add("mousePan",N),this._add("touchPan",W,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&n.dragPan.enable(t.dragPan);const Y=new Lc,X=new Dc;n.touchZoomRotate=new vs(a,X,Y,x),this._add("touchRotate",Y,["touchPan","touchZoom"]),this._add("touchZoom",X,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&n.touchZoomRotate.enable(t.touchZoomRotate),this._add("blockableMapEvent",new Md(n));const te=n.scrollZoom=new pl(n,(()=>this._triggerRenderFrame()));this._add("scrollZoom",te,["mousePan"]),t.interactive&&t.scrollZoom&&n.scrollZoom.enable(t.scrollZoom);const fe=n.keyboard=new $r(n);this._add("keyboard",fe),t.interactive&&t.keyboard&&n.keyboard.enable()}_add(t,n,a){this._handlers.push({handlerName:t,handler:n,allowed:a}),this._handlersById[t]=n}stop(t){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!sr(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,n,a){for(const c in t)if(c!==a&&(!n||n.indexOf(c)<0))return!0;return!1}_getMapTouches(t){const n=[];for(const a of t)this._el.contains(a.target)&&n.push(a);return n}mergeHandlerResult(t,n,a,c,p){if(!a)return;l.e(t,a);const m={handlerName:c,originalEvent:a.originalEvent||p};a.zoomDelta!==void 0&&(n.zoom=m),a.panDelta!==void 0&&(n.drag=m),a.rollDelta!==void 0&&(n.roll=m),a.pitchDelta!==void 0&&(n.pitch=m),a.bearingDelta!==void 0&&(n.rotate=m)}_applyChanges(){const t={},n={},a={};for(const[c,p,m]of this._changes)c.panDelta&&(t.panDelta=(t.panDelta||new l.P(0,0))._add(c.panDelta)),c.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+c.zoomDelta),c.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+c.bearingDelta),c.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+c.pitchDelta),c.rollDelta&&(t.rollDelta=(t.rollDelta||0)+c.rollDelta),c.around!==void 0&&(t.around=c.around),c.pinchAround!==void 0&&(t.pinchAround=c.pinchAround),c.noInertia&&(t.noInertia=c.noInertia),l.e(n,p),l.e(a,m);this._updateMapTransform(t,n,a),this._changes=[]}_updateMapTransform(t,n,a){const c=this._map,p=c._getTransformForUpdate(),m=c.terrain;if(!(fl(t)||m&&this._terrainMovement))return this._fireEvents(n,a,!0);c._stop(!0);let{panDelta:v,zoomDelta:x,bearingDelta:T,pitchDelta:P,rollDelta:k,around:A,pinchAround:L}=t;L!==void 0&&(A=L),A=A||c.transform.centerPoint,m&&!p.isPointOnMapSurface(A)&&(A=p.centerPoint);const N={panDelta:v,zoomDelta:x,rollDelta:k,pitchDelta:P,bearingDelta:T,around:A};this._map.cameraHelper.useGlobeControls&&!p.isPointOnMapSurface(A)&&(A=p.centerPoint);const W=A.distSqr(p.centerPoint)<.01?p.center:p.screenPointToLocation(v?A.sub(v):A);this._handleMapControls({terrain:m,tr:p,deltasForHelper:N,preZoomAroundLoc:W,combinedEventsInProgress:n,panDelta:v}),c._applyUpdatedTransform(p),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,a,!0)}_handleMapControls({terrain:t,tr:n,deltasForHelper:a,preZoomAroundLoc:c,combinedEventsInProgress:p,panDelta:m}){const v=this._map.cameraHelper;if(v.handleMapControlsRollPitchBearingZoom(a,n),t)return v.useGlobeControls?(this._terrainMovement||!p.drag&&!p.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void v.handleMapControlsPan(a,n,c)):this._terrainMovement||!p.drag&&!p.zoom?void(p.drag&&this._terrainMovement&&m?n.setCenter(n.screenPointToLocation(n.centerPoint.sub(m))):v.handleMapControlsPan(a,n,c)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void v.handleMapControlsPan(a,n,c));v.handleMapControlsPan(a,n,c)}_fireEvents(t,n,a){const c=sr(this._eventsInProgress),p=sr(t),m={};for(const k in t){const{originalEvent:A}=t[k];this._eventsInProgress[k]||(m[`${k}start`]=A),this._eventsInProgress[k]=t[k]}!c&&p&&this._fireEvent("movestart",p.originalEvent);for(const k in m)this._fireEvent(k,m[k]);p&&this._fireEvent("move",p.originalEvent);for(const k in t){const{originalEvent:A}=t[k];this._fireEvent(k,A)}const v={};let x;for(const k in this._eventsInProgress){const{handlerName:A,originalEvent:L}=this._eventsInProgress[k];this._handlersById[A].isActive()||(delete this._eventsInProgress[k],x=n[A]||L,v[`${k}end`]=x)}for(const k in v)this._fireEvent(k,v[k]);const T=sr(this._eventsInProgress),P=(c||p)&&!T;if(P&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const k=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&k.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(k)}if(a&&P){this._updatingCamera=!0;const k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),A=L=>L!==0&&-this._bearingSnap<L&&L<this._bearingSnap;!k||!k.essential&&Xe.prefersReducedMotion?(this._map.fire(new l.l("moveend",{originalEvent:x})),A(this._map.getBearing())&&this._map.resetNorth()):(A(k.bearing||this._map.getBearing())&&(k.bearing=0),k.freezeElevation=!0,this._map.easeTo(k,{originalEvent:x})),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new l.l(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{delete this._frameId,this.handleEvent(new ys("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class un extends l.E{constructor(t,n,a){super(),this._renderFrameCallback=()=>{const c=Math.min((Ee()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=a.bearingSnap,this._zoomSnap=a.zoomSnap,this.cameraHelper=n,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(t,n){t.apply(this.transform,!0),this.transform=t,this.cameraHelper=n}getCenter(){return new l.V(this.transform.center.lng,this.transform.center.lat)}setCenter(t,n){return this.jumpTo({center:t},n)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,n){return this.jumpTo({elevation:t},n),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,n,a){return t=l.P.convert(t).mult(-1),this.panTo(this.transform.center,l.e({offset:t},n),a)}panTo(t,n,a){return this.easeTo(l.e({center:t},n),a)}getZoom(){return this.transform.zoom}setZoom(t,n){return this.jumpTo({zoom:t},n),this}zoomTo(t,n,a){return this.easeTo(l.e({zoom:t},n),a)}zoomIn(t,n){return this.zoomTo(l.cx(this.getZoom()+1,this._zoomSnap),t,n),this}zoomOut(t,n){return this.zoomTo(l.cx(this.getZoom()-1,this._zoomSnap),t,n),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,n){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new l.l("movestart",n)).fire(new l.l("move",n)).fire(new l.l("moveend",n))),this}getBearing(){return this.transform.bearing}setZoomSnap(t){return this._zoomSnap=t,this}getZoomSnap(){return this._zoomSnap}setBearing(t,n){return this.jumpTo({bearing:t},n),this}getPadding(){return this.transform.padding}setPadding(t,n){return this.jumpTo({padding:t},n),this}rotateTo(t,n,a){return this.easeTo(l.e({bearing:t},n),a)}resetNorth(t,n){return this.rotateTo(0,l.e({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(l.e({bearing:0,pitch:0,roll:0,duration:1e3},t),n),this}snapToNorth(t,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,n):this}getPitch(){return this.transform.pitch}setPitch(t,n){return this.jumpTo({pitch:t},n),this}getRoll(){return this.transform.roll}setRoll(t,n){return this.jumpTo({roll:t},n),this}cameraForBounds(t,n){t=Mt.convert(t).adjustAntiMeridian();const a=n&&n.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),a,n)}_cameraForBoxAndBearing(t,n,a,c){const p={top:0,bottom:0,right:0,left:0};if(typeof(c=l.e({padding:p,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=="number"){const T=c.padding;c.padding={top:T,bottom:T,right:T,left:T}}const m=l.e(p,c.padding);c.padding=m;const v=this.transform,x=new Mt(t,n);return this.cameraHelper.cameraForBoxAndBearing(c,m,x,a,v)}fitBounds(t,n,a){return this._fitInternal(this.cameraForBounds(t,n),n,a)}fitScreenCoordinates(t,n,a,c,p){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(l.P.convert(t)),this.transform.screenPointToLocation(l.P.convert(n)),a,c),c,p)}_fitInternal(t,n,a){return t?(delete(n=l.e(t,n)).padding,n.linear?this.easeTo(n,a):this.flyTo(n,a)):this}jumpTo(t,n){this.stop();const a=this._getTransformForUpdate();let c=!1,p=!1,m=!1;const v=a.zoom;this.cameraHelper.handleJumpToCenterZoom(a,t);const x=a.zoom!==v;return"elevation"in t&&a.elevation!==+t.elevation&&a.setElevation(+t.elevation),"bearing"in t&&a.bearing!==+t.bearing&&(c=!0,a.setBearing(+t.bearing)),"pitch"in t&&a.pitch!==+t.pitch&&(p=!0,a.setPitch(+t.pitch)),"roll"in t&&a.roll!==+t.roll&&(m=!0,a.setRoll(+t.roll)),t.padding==null||a.isPaddingEqual(t.padding)||a.setPadding(t.padding),this._applyUpdatedTransform(a),this.fire(new l.l("movestart",n)).fire(new l.l("move",n)),x&&this.fire(new l.l("zoomstart",n)).fire(new l.l("zoom",n)).fire(new l.l("zoomend",n)),c&&this.fire(new l.l("rotatestart",n)).fire(new l.l("rotate",n)).fire(new l.l("rotateend",n)),p&&this.fire(new l.l("pitchstart",n)).fire(new l.l("pitch",n)).fire(new l.l("pitchend",n)),m&&this.fire(new l.l("rollstart",n)).fire(new l.l("roll",n)).fire(new l.l("rollend",n)),this.fire(new l.l("moveend",n))}calculateCameraOptionsFromTo(t,n,a,c=0){const p=l.a9.fromLngLat(t,n),m=l.a9.fromLngLat(a,c),v=m.x-p.x,x=m.y-p.y,T=m.z-p.z,P=Math.hypot(v,x,T);if(P===0)throw new Error("Can't calculate camera options with same From and To");const k=Math.hypot(v,x),A=l.at(this.transform.cameraToCenterDistance/P/this.transform.tileSize),L=180*Math.atan2(v,-x)/Math.PI;let N=180*Math.acos(k/P)/Math.PI;return N=T<0?90-N:90+N,{center:m.toLngLat(),elevation:c,zoom:A,pitch:N,bearing:L}}calculateCameraOptionsFromCameraLngLatAltRotation(t,n,a,c,p){const m=this.transform.calculateCenterFromCameraLngLatAlt(t,n,a,c);return{center:m.center,elevation:m.elevation,zoom:m.zoom,bearing:a,pitch:c,roll:p}}easeTo(t,n){this._stop(!1,t.easeId),((t=l.e({offset:[0,0],duration:500,easing:l.cz},t)).animate===!1||!t.essential&&Xe.prefersReducedMotion)&&(t.duration=0);const a=this._getTransformForUpdate(),c=this.getBearing(),p=a.pitch,m=a.roll,v="bearing"in t?this._normalizeBearing(t.bearing,c):c,x="pitch"in t?+t.pitch:p,T="roll"in t?this._normalizeBearing(t.roll,m):m,P="padding"in t?t.padding:a.padding,k=l.P.convert(t.offset);let A,L;t.around&&(A=l.V.convert(t.around),L=a.locationToScreenPoint(A));const N={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},W=this.cameraHelper.handleEaseTo(a,{bearing:v,pitch:x,roll:T,padding:P,around:A,aroundPoint:L,offsetAsPoint:k,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||c!==v,this._pitching=this._pitching||x!==p,this._rolling=this._rolling||T!==m,this._padding=!a.isPaddingEqual(P),this._zooming=this._zooming||W.isZooming,this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,N),this.terrain&&this._prepareElevation(W.elevationCenter),this._ease((Y=>{W.easeFunc(Y),this.terrain&&!t.freezeElevation&&this._updateElevation(Y),this._applyUpdatedTransform(a),this._fireMoveEvents(n)}),(Y=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(n,Y)}),t),this}_prepareEase(t,n,a={}){this._moving=!0,n||a.moving||this.fire(new l.l("movestart",t)),this._zooming&&!a.zooming&&this.fire(new l.l("zoomstart",t)),this._rotating&&!a.rotating&&this.fire(new l.l("rotatestart",t)),this._pitching&&!a.pitching&&this.fire(new l.l("pitchstart",t)),this._rolling&&!a.rolling&&this.fire(new l.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&n!==this._elevationTarget){const a=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(a-(n-(a*t+this._elevationStart))/(1-t)),this._elevationTarget=n}this.transform.setElevation(l.G.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const n=t.getCameraLngLat(),a=t.getCameraAltitude(),c=this.terrain?this.terrain.getElevationForLngLatZoom(n,t.zoom):0;if(a<c){const p=this.calculateCameraOptionsFromTo(n,c,t.center,t.elevation);return{pitch:p.pitch,zoom:p.zoom}}return{}}_applyUpdatedTransform(t){const n=[];if(n.push((c=>this._elevateCameraIfInsideTerrain(c))),this.transformCameraUpdate&&n.push((c=>this.transformCameraUpdate(c))),!n.length)return;const a=t.clone();for(const c of n){const p=a.clone(),{center:m,zoom:v,roll:x,pitch:T,bearing:P,elevation:k}=c(p);m&&p.setCenter(m),k!==void 0&&p.setElevation(k),v!==void 0&&p.setZoom(v),x!==void 0&&p.setRoll(x),T!==void 0&&p.setPitch(T),P!==void 0&&p.setBearing(P),a.apply(p,!1)}this.transform.apply(a,!1)}_fireMoveEvents(t){this.fire(new l.l("move",t)),this._zooming&&this.fire(new l.l("zoom",t)),this._rotating&&this.fire(new l.l("rotate",t)),this._pitching&&this.fire(new l.l("pitch",t)),this._rolling&&this.fire(new l.l("roll",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const a=this._zooming,c=this._rotating,p=this._pitching,m=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,a&&this.fire(new l.l("zoomend",t)),c&&this.fire(new l.l("rotateend",t)),p&&this.fire(new l.l("pitchend",t)),m&&this.fire(new l.l("rollend",t)),this.fire(new l.l("moveend",t))}flyTo(t,n){if(!t.essential&&Xe.prefersReducedMotion){const Ye=l.U(t,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(Ye,n)}this.stop(),t=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.cz},t);const a=this._getTransformForUpdate(),c=a.bearing,p=a.pitch,m=a.roll,v=a.padding,x="bearing"in t?this._normalizeBearing(t.bearing,c):c,T="pitch"in t?+t.pitch:p,P="roll"in t?this._normalizeBearing(t.roll,m):m,k="padding"in t?t.padding:a.padding,A=l.P.convert(t.offset);let L=a.centerPoint.add(A);const N=a.screenPointToLocation(L),W=this.cameraHelper.handleFlyTo(a,{bearing:x,pitch:T,roll:P,padding:k,locationAtOffset:N,offsetAsPoint:A,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let Y=t.curve;const X=Math.max(a.width,a.height),te=X/W.scaleOfZoom,fe=W.pixelPathLength;typeof W.scaleOfMinZoom=="number"&&(Y=Math.sqrt(X/W.scaleOfMinZoom/fe*2));const $=Y*Y;function he(Ye){const At=(te*te-X*X+(Ye?-1:1)*$*$*fe*fe)/(2*(Ye?te:X)*$*fe);return Math.log(Math.sqrt(At*At+1)-At)}function ve(Ye){return(Math.exp(Ye)-Math.exp(-Ye))/2}function le(Ye){return(Math.exp(Ye)+Math.exp(-Ye))/2}const Me=he(!1);let $e=function(Ye){return le(Me)/le(Me+Y*Ye)},Ze=function(Ye){return X*((le(Me)*(ve(At=Me+Y*Ye)/le(At))-ve(Me))/$)/fe;var At},We=(he(!0)-Me)/Y;if(Math.abs(fe)<2e-6||!isFinite(We)){if(Math.abs(X-te)<1e-6)return this.easeTo(t,n);const Ye=te<X?-1:1;We=Math.abs(Math.log(te/X))/Y,Ze=()=>0,$e=At=>Math.exp(Ye*Y*At)}return t.duration="duration"in t?+t.duration:1e3*We/("screenSpeed"in t?+t.screenSpeed/Y:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=c!==x,this._pitching=T!==p,this._rolling=P!==m,this._padding=!a.isPaddingEqual(k),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(W.targetCenter),this._ease((Ye=>{const At=Ye*We,kt=1/$e(At),yt=Ze(At);this._rotating&&a.setBearing(l.G.number(c,x,Ye)),this._pitching&&a.setPitch(l.G.number(p,T,Ye)),this._rolling&&a.setRoll(l.G.number(m,P,Ye)),this._padding&&(a.interpolatePadding(v,k,Ye),L=a.centerPoint.add(A)),W.easeFunc(Ye,kt,yt,L),this.terrain&&!t.freezeElevation&&this._updateElevation(Ye),this._applyUpdatedTransform(a),this._fireMoveEvents(n)}),(()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(n)}),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,n){var a;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const c=this._onEaseEnd;delete this._onEaseEnd,c.call(this,n)}return t||(a=this.handlers)===null||a===void 0||a.stop(!1),this}_ease(t,n,a){a.animate===!1||a.duration===0?(t(1),n()):(this._easeStart=Ee(),this._easeOptions=a,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,n){t=l.W(t,-180,180);const a=Math.abs(t-n);return Math.abs(t-360-n)<a&&(t-=360),Math.abs(t+360-n)<a&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLat(l.V.convert(t),this.transform):null}}const An={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Oc{constructor(t=An){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=n=>{!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"&&n.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=Z.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=Z.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Z.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Z.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,n){const a=this._map._getUIString(`AttributionControl.${n}`);t.title=a,t.setAttribute("aria-label",a)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((c=>typeof c!="string"?"":c))):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const c=this._map.style.stylesheet;this.styleOwner=c.owner,this.styleId=c.id}const n=this._map.style.tileManagers;for(const c in n){const p=n[c];if(p.used||p.usedForTerrain){const m=p.getSource();m.attribution&&t.indexOf(m.attribution)<0&&t.push(m.attribution)}}t=t.filter((c=>String(c).trim())),t.sort(((c,p)=>c.length-p.length)),t=t.filter(((c,p)=>{for(let m=p+1;m<t.length;m++)if(t[m].indexOf(c)>=0)return!1;return!0}));const a=t.join(" | ");a!==this._attribHTML&&(this._attribHTML=a,t.length?(this._innerContainer.innerHTML=Z.sanitize(a),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class yh{constructor(t={}){this._updateCompact=()=>{const n=this._container.children;if(n.length){const a=n[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&a.classList.add("maplibregl-compact"):a.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=Z.create("div","maplibregl-ctrl");const n=Z.create("a","maplibregl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Z.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class kd{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const n=++this._id;return this._queue.push({callback:t,id:n,cancelled:!1}),n}remove(t){const n=this._currentlyRunning,a=n?this._queue.concat(n):this._queue;for(const c of a)if(c.id===t)return void(c.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const n=this._currentlyRunning=this._queue;this._queue=[];for(const a of n)if(!a.cancelled&&(a.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var zd=l.aU([{name:"a_pos3d",type:"Int16",components:3}]);class xs extends l.E{constructor(t){super(),this._lastTilesetChange=Ee(),this.tileManager=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(t,n){this.tileManager.update(t,n),this._renderableTilesKeys=[];const a={};for(const c of Ir(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n,calculateTileZoom:this.tileManager._source.calculateTileZoom}))a[c.key]=!0,this._renderableTilesKeys.push(c.key),this._tiles[c.key]||(c.terrainRttPosMatrix32f=new Float64Array(16),l.c7(c.terrainRttPosMatrix32f,0,l.a5,l.a5,0,0,1),this._tiles[c.key]=new Le(c,this.tileSize),this._lastTilesetChange=Ee());for(const c in this._tiles)a[c]||delete this._tiles[c]}freeRtt(t){for(const n in this._tiles){const a=this._tiles[n];(!t||a.tileID.equals(t)||a.tileID.isChildOf(t)||t.isChildOf(a.tileID))&&(a.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((t=>this.getTileByID(t)))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,n){return n?this._getTerrainCoordsForTileRanges(t,n):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const n={};for(const a of this._renderableTilesKeys){const c=this._tiles[a].tileID,p=t.clone(),m=l.bk();if(c.canonical.equals(t.canonical))l.c7(m,0,l.a5,l.a5,0,0,1);else if(c.canonical.isChildOf(t.canonical)){const v=c.canonical.z-t.canonical.z,x=c.canonical.x-(c.canonical.x>>v<<v),T=c.canonical.y-(c.canonical.y>>v<<v),P=l.a5>>v;l.c7(m,0,P,P,0,0,1),l.O(m,m,[-x*P,-T*P,0])}else{if(!t.canonical.isChildOf(c.canonical))continue;{const v=t.canonical.z-c.canonical.z,x=t.canonical.x-(t.canonical.x>>v<<v),T=t.canonical.y-(t.canonical.y>>v<<v),P=l.a5>>v;l.c7(m,0,l.a5,l.a5,0,0,1),l.O(m,m,[x*P,T*P,0]),l.Q(m,m,[1/2**v,1/2**v,0])}}p.terrainRttPosMatrix32f=new Float32Array(m),n[a]=p}return n}_getTerrainCoordsForTileRanges(t,n){const a={};for(const c of this._renderableTilesKeys){const p=this._tiles[c].tileID;if(!this._isWithinTileRanges(p,n))continue;const m=t.clone(),v=l.bk();if(p.canonical.z===t.canonical.z){const x=t.canonical.x-p.canonical.x+t.wrap*(1<<t.canonical.z),T=t.canonical.y-p.canonical.y;l.c7(v,0,l.a5,l.a5,0,0,1),l.O(v,v,[x*l.a5,T*l.a5,0])}else if(p.canonical.z>t.canonical.z){const x=p.canonical.z-t.canonical.z,T=p.canonical.x-(p.canonical.x>>x<<x)+t.wrap*(1<<p.canonical.z),P=p.canonical.y-(p.canonical.y>>x<<x),k=t.canonical.x-(p.canonical.x>>x),A=t.canonical.y-(p.canonical.y>>x),L=l.a5>>x;l.c7(v,0,L,L,0,0,1),l.O(v,v,[-T*L+k*l.a5,-P*L+A*l.a5,0])}else{const x=t.canonical.z-p.canonical.z,T=t.canonical.x-(t.canonical.x>>x<<x)+t.wrap*(1<<t.canonical.z),P=t.canonical.y-(t.canonical.y>>x<<x),k=(t.canonical.x>>x)-p.canonical.x,A=(t.canonical.y>>x)-p.canonical.y,L=l.a5<<x;l.c7(v,0,L,L,0,0,1),l.O(v,v,[T*l.a5+k*L,P*l.a5+A*L,0])}m.terrainRttPosMatrix32f=new Float32Array(v),a[c]=m}return a}getSourceTile(t,n){const a=this.tileManager._source;let c=t.overscaledZ-this.deltaZoom;if(c>a.maxzoom&&(c=a.maxzoom),c<a.minzoom)return;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(c).key);let p=this.findTileInCaches(this._sourceTileCache[t.key]);if(!p?.dem&&n)for(;c>=a.minzoom&&!p?.dem;)p=this.findTileInCaches(t.scaledTo(c--).key);return p}findTileInCaches(t){let n=this.tileManager.getTileByID(t);return n||(n=this.tileManager._outOfViewCache.getByKey(t),n)}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,n){const a=n[t.canonical.z];return!!a&&(t.wrap>a.minWrap||t.wrap<a.maxWrap||t.canonical.x>=a.minTileXWrapped&&t.canonical.x<=a.maxTileXWrapped&&t.canonical.y>=a.minTileY&&t.canonical.y<=a.maxTileY)}}class xi{constructor(t,n,a){this._meshCache={},this.painter=t,this.tileManager=new xs(n),this.options=a,this.exaggeration=typeof a.exaggeration=="number"?a.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,n,a,c=l.a5){var p;if(!(n>=0&&n<c&&a>=0&&a<c))return 0;const m=this.getTerrainData(t),v=(p=m.tile)===null||p===void 0?void 0:p.dem;if(!v)return 0;const x=l.cD([],[n/c*l.a5,a/c*l.a5],m.u_terrain_matrix),T=[x[0]*v.dim,x[1]*v.dim],P=Math.floor(T[0]),k=Math.floor(T[1]),A=T[0]-P,L=T[1]-k;return v.get(P,k)*(1-A)*(1-L)+v.get(P+1,k)*A*(1-L)+v.get(P,k+1)*(1-A)*L+v.get(P+1,k+1)*A*L}getElevationForLngLatZoom(t,n){if(!l.cE(n,t.wrap()))return 0;const{tileID:a,mercatorX:c,mercatorY:p}=this._getOverscaledTileIDFromLngLatZoom(t,n);return this.getElevation(a,c%l.a5,p%l.a5,l.a5)}getElevationForLngLat(t,n){const a=Ir(n,{maxzoom:this.tileManager.maxzoom,minzoom:this.tileManager.minzoom,tileSize:512,terrain:this});let c=0;for(const p of a)p.canonical.z>c&&(c=Math.min(p.canonical.z,this.tileManager.maxzoom));return this.getElevationForLngLatZoom(t,c)}getElevation(t,n,a,c=l.a5){return this.getDEMElevation(t,n,a,c)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const c=this.painter.context,p=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new l.T(c,p,c.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new l.T(c,new l.R({width:1,height:1}),c.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.ar([])}const n=this.tileManager.getSourceTile(t,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const c=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new l.T(c,n.dem.getPixels(),c.gl.RGBA,{premultiply:!1}),n.demTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const a=n&&n.toString()+n.tileID.key+t.key;if(a&&!this._demMatrixCache[a]){const c=this.tileManager.getSource().maxzoom;let p=t.canonical.z-n.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=c?p=t.canonical.z-c:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const m=t.canonical.x-(t.canonical.x>>p<<p),v=t.canonical.y-(t.canonical.y>>p<<p),x=l.cF(new Float64Array(16),[1/(l.a5<<p),1/(l.a5<<p),0]);l.O(x,x,[m*l.a5,v*l.a5,0]),this._demMatrixCache[t.key]={matrix:x,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:a?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(t){const n=this.painter,a=n.width/devicePixelRatio,c=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===a&&this._fbo.height===c||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new l.T(n.context,{width:a,height:c,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new l.T(n.context,{width:a,height:c,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(a,c,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,a,c))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let p=0,m=0;p<this._coordsTextureSize;p++)for(let v=0;v<this._coordsTextureSize;v++,m+=4)n[m+0]=255&v,n[m+1]=255&p,n[m+2]=v>>8<<4|p>>8,n[m+3]=0;const a=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),c=new l.T(t,a,t.gl.RGBA,{premultiply:!1});return c.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=c,c}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const n=new Uint8Array(4),a=this.painter.context,c=a.gl,p=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),m=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),v=Math.round(this.painter.height/devicePixelRatio);a.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),c.readPixels(p,v-m-1,1,1,c.RGBA,c.UNSIGNED_BYTE,n),a.bindFramebuffer.set(null);const x=n[0]+(n[2]>>4<<8),T=n[1]+((15&n[2])<<8),P=this.coordsIndex[255-n[3]],k=P&&this.tileManager.getTileByID(P);if(!k)return null;const A=this._coordsTextureSize,L=(1<<k.tileID.canonical.z)*A;return new l.a9((k.tileID.canonical.x*A+x)/L+k.tileID.wrap,(k.tileID.canonical.y*A+T)/L,this.getElevation(k.tileID,x,T,A))}depthAtPoint(t){const n=new Uint8Array(4),a=this.painter.context,c=a.gl;return a.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),c.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,c.RGBA,c.UNSIGNED_BYTE,n),a.bindFramebuffer.set(null),(n[0]/16777216+n[1]/65536+n[2]/256+n[3])/256}getTerrainMesh(t){var n;const a=((n=this.painter.style.projection)===null||n===void 0?void 0:n.transitionState)>0,c=a&&t.canonical.y===0,p=a&&t.canonical.y===(1<<t.canonical.z)-1,m=`m_${c?"n":""}_${p?"s":""}`;if(this._meshCache[m])return this._meshCache[m];const v=this.painter.context,x=new l.cG,T=new l.aY,P=this.meshSize,k=l.a5/P,A=P*P;for(let le=0;le<=P;le++)for(let Me=0;Me<=P;Me++)x.emplaceBack(Me*k,le*k,0);for(let le=0;le<A;le+=P+1)for(let Me=0;Me<P;Me++)T.emplaceBack(Me+le,P+Me+le+1,P+Me+le+2),T.emplaceBack(Me+le,P+Me+le+2,Me+le+1);const L=x.length,N=L+(P+1),W=(P+1)*P,Y=c?l.br:0,X=c?0:1,te=p?l.bs:l.a5,fe=p?0:1;for(let le=0;le<=P;le++)x.emplaceBack(le*k,Y,X);for(let le=0;le<=P;le++)x.emplaceBack(le*k,te,fe);for(let le=0;le<P;le++)T.emplaceBack(W+le,N+le,N+le+1),T.emplaceBack(W+le,N+le+1,W+le+1),T.emplaceBack(0+le,L+le+1,L+le),T.emplaceBack(0+le,0+le+1,L+le+1);const $=x.length,he=$+2*(P+1);for(const le of[0,1])for(let Me=0;Me<=P;Me++)for(const $e of[0,1])x.emplaceBack(le*l.a5,Me*k,$e);for(let le=0;le<2*P;le+=2)T.emplaceBack($+le,$+le+1,$+le+3),T.emplaceBack($+le,$+le+3,$+le+2),T.emplaceBack(he+le,he+le+3,he+le+1),T.emplaceBack(he+le,he+le+2,he+le+3);const ve=new ei(v.createVertexBuffer(x,zd.members),v.createIndexBuffer(T),l.aX.simpleSegment(0,0,x.length,T.length));return this._meshCache[m]=ve,ve}getMeshFrameDelta(t){return 2*Math.PI*l.bE/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,n){var a;if(!l.cE(n,t.wrap()))return 0;const{tileID:c}=this._getOverscaledTileIDFromLngLatZoom(t,n);return(a=this.getMinMaxElevation(c).minElevation)!==null&&a!==void 0?a:0}getMinMaxElevation(t){const n=this.getTerrainData(t).tile,a={minElevation:null,maxElevation:null};return n&&n.dem&&(a.minElevation=n.dem.min*this.exaggeration,a.maxElevation=n.dem.max*this.exaggeration),a}_getOverscaledTileIDFromLngLatZoom(t,n){const a=l.a9.fromLngLat(t.wrap()),c=(1<<n)*l.a5,p=a.x*c,m=a.y*c,v=Math.floor(p/l.a5),x=Math.floor(m/l.a5);return{tileID:new l.a2(n,0,n,v,x),mercatorX:p,mercatorY:m}}}class Ei{constructor(t,n,a){this._context=t,this._size=n,this._tileSize=a,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),a=new l.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return a.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(a.texture),{id:t,fbo:n,texture:a,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((n=>t.id!==n)),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const n of this._recentlyUsed)if(!this._objects[n].inUse)return this._objects[n];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((t=>!t.inUse))===!1}}const qo={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class bs{constructor(t,n){this.painter=t,this.terrain=n,this.pool=new Ei(t.context,30,n.tileManager.tileSize*n.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,n){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=t._order.filter((a=>!t._layers[a].isHidden(n))),this._coordsAscending={};for(const a in t.tileManagers){this._coordsAscending[a]={};const c=t.tileManagers[a].getVisibleCoordinates(),p=t.tileManagers[a].getSource(),m=p instanceof Cr?p.terrainTileRanges:null;for(const v of c){const x=this.terrain.tileManager.getTerrainCoords(v,m);for(const T in x)this._coordsAscending[a][T]||(this._coordsAscending[a][T]=[]),this._coordsAscending[a][T].push(x[T])}}this._coordsAscendingStr={};for(const a of t._order){const c=t._layers[a],p=c.source;if(qo[c.type]&&!this._coordsAscendingStr[p]){this._coordsAscendingStr[p]={};for(const m in this._coordsAscending[p])this._coordsAscendingStr[p][m]=this._coordsAscending[p][m].map((v=>v.key)).sort().join()}}for(const a of this._renderableTiles)for(const c in this._coordsAscendingStr){const p=this._coordsAscendingStr[c][a.tileID.key];p&&p!==a.rttCoords[c]&&(a.rtt=[])}}renderLayer(t,n){if(t.isHidden(this.painter.transform.zoom))return!1;const a=Object.assign(Object.assign({},n),{isRenderingToTexture:!0}),c=t.type,p=this.painter,m=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(qo[c]&&(this._prevType&&qo[this._prevType]||this._stacks.push([]),this._prevType=c,this._stacks[this._stacks.length-1].push(t.id),!m))return!0;if(qo[this._prevType]||qo[c]&&m){this._prevType=c;const v=this._stacks.length-1,x=this._stacks[v]||[];for(const T of this._renderableTiles){if(this.pool.isFull()&&(Pc(this.painter,this.terrain,this._rttTiles,a),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(T),T.rtt[v]){const k=this.pool.getObjectForId(T.rtt[v].id);if(k.stamp===T.rtt[v].stamp){this.pool.useObject(k);continue}}const P=this.pool.getOrCreateFreeObject();this.pool.useObject(P),this.pool.stampObject(P),T.rtt[v]={id:P.id,stamp:P.stamp},p.context.bindFramebuffer.set(P.fbo.framebuffer),p.context.clear({color:l.bp.transparent,stencil:0}),p.currentStencilSource=void 0;for(let k=0;k<x.length;k++){const A=p.style._layers[x[k]],L=A.source?this._coordsAscending[A.source][T.tileID.key]:[T.tileID];p.context.viewport.set([0,0,P.fbo.width,P.fbo.height]),p._renderTileClippingMasks(A,L,!0),p.renderLayer(p,p.style.tileManagers[A.source],A,L,a),A.source&&(T.rttCoords[A.source]=this._coordsAscendingStr[A.source][T.tileID.key])}}return Pc(this.painter,this.terrain,this._rttTiles,a),this._rttTiles=[],this.pool.freeAllObjects(),qo[c]}return!1}}const gl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Bc=q,_l={hash:!1,interactive:!0,bearingSnap:7,zoomSnap:0,attributionControl:An,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},Nc={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class ws{constructor(t,n,a=!1){this.mousedown=p=>{this.startMove(p,Z.mousePos(this.element,p)),Z.addEventListener(window,"mousemove",this.mousemove),Z.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=p=>{this.move(p,Z.mousePos(this.element,p))},this.mouseup=p=>{this._rotatePitchHandler.dragEnd(p),this.offTemp()},this.touchstart=p=>{p.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Z.touchPos(this.element,p.targetTouches)[0],this.startMove(p,this._startPos),Z.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),Z.addEventListener(window,"touchend",this.touchend))},this.touchmove=p=>{p.targetTouches.length!==1?this.reset():(this._lastPos=Z.touchPos(this.element,p.targetTouches)[0],this.move(p,this._lastPos))},this.touchend=p=>{p.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=n;const c=new dh;this._rotatePitchHandler=new Ia({clickTolerance:3,move:(p,m)=>{const v=n.getBoundingClientRect(),x=new l.P((v.bottom-v.top)/2,(v.right-v.left)/2);return{bearingDelta:l.cy(new l.P(p.x,m.y),m,x),pitchDelta:a?-.5*(m.y-p.y):void 0}},moveStateManager:c,enable:!0,assignEvents:()=>{}}),this.map=t,Z.addEventListener(n,"mousedown",this.mousedown),Z.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),Z.addEventListener(n,"touchcancel",this.reset)}startMove(t,n){this._rotatePitchHandler.dragStart(t,n),Z.disableDrag()}move(t,n){const a=this.map,{bearingDelta:c,pitchDelta:p}=this._rotatePitchHandler.dragMove(t,n)||{};c&&a.setBearing(a.getBearing()+c),p&&a.setPitch(a.getPitch()+p)}off(){const t=this.element;Z.removeEventListener(t,"mousedown",this.mousedown),Z.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),Z.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Z.removeEventListener(window,"touchend",this.touchend),Z.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){Z.enableDrag(),Z.removeEventListener(window,"mousemove",this.mousemove),Z.removeEventListener(window,"mouseup",this.mouseup),Z.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Z.removeEventListener(window,"touchend",this.touchend)}}let to;function vl(d,t,n,a=!1){if(a||!n.getCoveringTilesDetailsProvider().allowWorldCopies())return d?.wrap();const c=new l.V(d.lng,d.lat);if(d=new l.V(d.lng,d.lat),t){const p=new l.V(d.lng-360,d.lat),m=new l.V(d.lng+360,d.lat),v=n.locationToScreenPoint(d).distSqr(t);n.locationToScreenPoint(p).distSqr(t)<v?d=p:n.locationToScreenPoint(m).distSqr(t)<v&&(d=m)}for(;Math.abs(d.lng-n.center.lng)>180;){const p=n.locationToScreenPoint(d);if(p.x>=0&&p.y>=0&&p.x<=n.width&&p.y<=n.height)break;d.lng>n.center.lng?d.lng-=360:d.lng+=360}return d.lng!==c.lng&&n.isPointOnMapSurface(n.locationToScreenPoint(d))?d:c}const Ts={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function yl(d,t,n){const a=d.classList;for(const c in Ts)a.remove(`maplibregl-${n}-anchor-${c}`);a.add(`maplibregl-${n}-anchor-${t}`)}class Cs extends l.E{constructor(t){if(super(),this._onKeyPress=n=>{const a=n.code,c=n.charCode||n.keyCode;a!=="Space"&&a!=="Enter"&&c!==32&&c!==13||this.togglePopup()},this._onMapClick=n=>{const a=n.originalEvent.target,c=this._element;this._popup&&(a===c||c.contains(a))&&this.togglePopup()},this._update=n=>{if(!this._map)return;const a=this._map.loaded()&&!this._map.isMoving();(n?.type==="terrain"||n?.type==="render"&&!a)&&this._map.once("render",this._update),this._lngLat=vl(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let c="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?c=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(c=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let p="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?p="rotateX(0deg)":this._pitchAlignment==="map"&&(p=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||n&&n.type!=="moveend"||(this._pos=this._pos.round()),Z.setTransform(this._element,`${Ts[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${p} ${c}`),Xe.frameAsync(new AbortController,this._map._ownerWindow).then((()=>{this._updateOpacity(n&&n.type==="moveend")})).catch((()=>{}))},this._onMove=n=>{if(!this._isDragging){const a=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=a}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.l("dragstart"))),this.fire(new l.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.l("dragend")),this._state="inactive"},this._addDragHandler=n=>{this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t?.opacity,t?.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=l.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=Z.create("div");const n=Z.createNS("http://www.w3.org/2000/svg","svg"),a=41,c=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${a}px`),n.setAttributeNS(null,"width",`${c}px`),n.setAttributeNS(null,"viewBox",`0 0 ${c} ${a}`);const p=Z.createNS("http://www.w3.org/2000/svg","g");p.setAttributeNS(null,"stroke","none"),p.setAttributeNS(null,"stroke-width","1"),p.setAttributeNS(null,"fill","none"),p.setAttributeNS(null,"fill-rule","evenodd");const m=Z.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"fill-rule","nonzero");const v=Z.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"transform","translate(3.0, 29.0)"),v.setAttributeNS(null,"fill","#000000");const x=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const X of x){const te=Z.createNS("http://www.w3.org/2000/svg","ellipse");te.setAttributeNS(null,"opacity","0.04"),te.setAttributeNS(null,"cx","10.5"),te.setAttributeNS(null,"cy","5.80029008"),te.setAttributeNS(null,"rx",X.rx),te.setAttributeNS(null,"ry",X.ry),v.appendChild(te)}const T=Z.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill",this._color);const P=Z.createNS("http://www.w3.org/2000/svg","path");P.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),T.appendChild(P);const k=Z.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"opacity","0.25"),k.setAttributeNS(null,"fill","#000000");const A=Z.createNS("http://www.w3.org/2000/svg","path");A.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),k.appendChild(A);const L=Z.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"transform","translate(6.0, 7.0)"),L.setAttributeNS(null,"fill","#FFFFFF");const N=Z.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"transform","translate(8.0, 8.0)");const W=Z.createNS("http://www.w3.org/2000/svg","circle");W.setAttributeNS(null,"fill","#000000"),W.setAttributeNS(null,"opacity","0.25"),W.setAttributeNS(null,"cx","5.5"),W.setAttributeNS(null,"cy","5.5"),W.setAttributeNS(null,"r","5.4999962");const Y=Z.createNS("http://www.w3.org/2000/svg","circle");Y.setAttributeNS(null,"fill","#FFFFFF"),Y.setAttributeNS(null,"cx","5.5"),Y.setAttributeNS(null,"cy","5.5"),Y.setAttributeNS(null,"r","5.4999962"),N.appendChild(W),N.appendChild(Y),m.appendChild(v),m.appendChild(T),m.appendChild(k),m.appendChild(L),m.appendChild(N),n.appendChild(m),n.setAttributeNS(null,"height",a*this._scale+"px"),n.setAttributeNS(null,"width",c*this._scale+"px"),this._element.appendChild(n),this._offset=l.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(n=>{n.preventDefault()})),this._element.addEventListener("mousedown",(n=>{n.preventDefault()})),yl(this._element,this._anchor,"marker"),t&&t.className)for(const n of t.className.split(" "))this._element.classList.add(n);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Z.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=l.V.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const c=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[c,-1*(38.1-13.5+c)],"bottom-right":[-c,-1*(38.1-13.5+c)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var n,a;const c=(n=this._map)===null||n===void 0?void 0:n.terrain,p=this._map.transform.isLocationOccluded(this._lngLat);if(!c||p){const L=p?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==L&&(this._element.style.opacity=L))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const m=this._map,v=m.terrain.depthAtPoint(this._pos),x=m.terrain.getElevationForLngLat(this._lngLat,m.transform);if(m.transform.lngLatToCameraDepth(this._lngLat,x)-v<.006)return void(this._element.style.opacity=this._opacity);const T=-this._offset.y/m.transform.pixelsPerMeter,P=Math.sin(m.getPitch()*Math.PI/180)*T,k=m.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),A=m.transform.lngLatToCameraDepth(this._lngLat,x+P)-k>.006;!((a=this._popup)===null||a===void 0)&&a.isOpen()&&A&&this._popup.remove(),this._element.style.opacity=A?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=l.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,n){return(this._opacity===void 0||t===void 0&&n===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),n!==void 0&&(this._opacityWhenCovered=n),this._map&&this._updateOpacity(!0),this}}const Vc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ea=0,Zo=!1;const jc={maxWidth:100,unit:"metric"};function Ss(d,t,n){const a=n&&n.maxWidth||100,c=d._container.clientHeight/2,p=d._container.clientWidth/2,m=d.unproject([p-a/2,c]),v=d.unproject([p+a/2,c]),x=Math.round(d.project(v).x-d.project(m).x),T=Math.min(a,x,d._container.clientWidth),P=m.distanceTo(v);if(n&&n.unit==="imperial"){const k=3.2808*P;k>5280?Ho(t,T,k/5280,d._getUIString("ScaleControl.Miles")):Ho(t,T,k,d._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?Ho(t,T,P/1852,d._getUIString("ScaleControl.NauticalMiles")):P>=1e3?Ho(t,T,P/1e3,d._getUIString("ScaleControl.Kilometers")):Ho(t,T,P,d._getUIString("ScaleControl.Meters"))}function Ho(d,t,n,a){const c=(function(p){const m=Math.pow(10,`${Math.floor(p)}`.length-1);let v=p/m;return v=v>=10?10:v>=5?5:v>=3?3:v>=2?2:v>=1?1:(function(x){const T=Math.pow(10,Math.ceil(-Math.log(x)/Math.LN10));return Math.round(x*T)/T})(v),m*v})(n);d.style.width=t*(c/n)+"px",d.innerHTML=`${c}&nbsp;${a}`}const Uc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0,padding:void 0},xl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function bl(d){if(d){if(typeof d=="number"){const t=Math.round(Math.abs(d)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,d),"top-left":new l.P(t,t),"top-right":new l.P(-t,t),bottom:new l.P(0,-d),"bottom-left":new l.P(t,-t),"bottom-right":new l.P(-t,-t),left:new l.P(d,0),right:new l.P(-d,0)}}if(d instanceof l.P||Array.isArray(d)){const t=l.P.convert(d);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:l.P.convert(d.center||[0,0]),top:l.P.convert(d.top||[0,0]),"top-left":l.P.convert(d["top-left"]||[0,0]),"top-right":l.P.convert(d["top-right"]||[0,0]),bottom:l.P.convert(d.bottom||[0,0]),"bottom-left":l.P.convert(d["bottom-left"]||[0,0]),"bottom-right":l.P.convert(d["bottom-right"]||[0,0]),left:l.P.convert(d.left||[0,0]),right:l.P.convert(d.right||[0,0])}}return bl(new l.P(0,0))}const Gc=q;S.AJAXError=l.cJ,S.Event=l.l,S.Evented=l.E,S.LngLat=l.V,S.MercatorCoordinate=l.a9,S.Point=l.P,S.addProtocol=l.cK,S.config=l.c,S.removeProtocol=l.cL,S.AttributionControl=Oc,S.BoxZoomHandler=Pa,S.CanvasSource=Rr,S.CooperativeGesturesHandler=Jt,S.DoubleClickZoomHandler=Fc,S.DragPanHandler=vh,S.DragRotateHandler=Vn,S.EdgeInsets=ca,S.FullscreenControl=class extends l.E{constructor(d={}){super(),this._onFullscreenChange=()=>{var t;let n=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=n?.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)n=n.shadowRoot.fullscreenElement;n===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=Z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){Z.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const d=this._fullscreenButton=Z.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);Z.create("span","maplibregl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.title=d}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},S.GeoJSONSource=Ar,S.GeolocateControl=class extends l.E{constructor(d){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new l.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const n=new l.V(t.coords.longitude,t.coords.latitude),a=t.coords.accuracy,c=this._map.getBearing(),p=l.e({bearing:c},this.options.fitBoundsOptions),m=Mt.fromLngLat(n,a);this._map.fitBounds(m,p,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const n=new l.V(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=t.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=t=>{if(this._map){if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Zo)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=Z.create("button","maplibregl-ctrl-geolocate",this._container),Z.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Z.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Cs({element:this._dotElement}),this._circleElement=Z.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Cs({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(n=>{const a=n?.[0]instanceof ResizeObserverEntry;n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.l("trackuserlocationend")),this.fire(new l.l("userlocationlostfocus")))}))}},this.options=l.e({},Vc,d)}onAdd(d){return this._map=d,this._container=Z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return l._(this,arguments,void 0,(function*(t=!1){if(to!==void 0&&!t)return to;if(window.navigator.permissions===void 0)return to=!!window.navigator.geolocation,to;try{to=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{to=!!window.navigator.geolocation}return to}))})().then((t=>this._finishSetupUI(t))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Z.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,Ea=0,Zo=!1}_isOutOfMapMaxBounds(d){const t=this._map.getMaxBounds(),n=d.coords;return t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const d=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&d))return;const t=this._map.project(d),n=this._map.unproject([t.x+100,t.y]),a=d.distanceTo(n)/100,c=2*this._accuracy/a;this._circleElement.style.width=`${c.toFixed(2)}px`,this._circleElement.style.height=`${c.toFixed(2)}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ea--,Zo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.l("trackuserlocationstart")),this.fire(new l.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ea++,Ea>1?(d={maximumAge:6e5,timeout:0},Zo=!0):(d=this.options.positionOptions,Zo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,d)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},S.GlobeControl=class{constructor(){this._toggleProjection=()=>{var d;const t=(d=this._map.getProjection())===null||d===void 0?void 0:d.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var d;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((d=this._map.getProjection())===null||d===void 0?void 0:d.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(d){return this._map=d,this._container=Z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=Z.create("button","maplibregl-ctrl-globe",this._container),Z.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){Z.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},S.Hash=Ec,S.ImageSource=Cr,S.KeyboardHandler=$r,S.LngLatBounds=Mt,S.LogoControl=yh,S.Map=class extends un{get _ownerWindow(){var d,t;return((t=(d=this._container)===null||d===void 0?void 0:d.ownerDocument)===null||t===void 0?void 0:t.defaultView)||window}constructor(d){var t,n;l.cH.mark(l.cI.create);const a=Object.assign(Object.assign(Object.assign({},_l),d),{canvasContextAttributes:Object.assign(Object.assign({},_l.canvasContextAttributes),d.canvasContextAttributes)});if(a.minZoom!=null&&a.maxZoom!=null&&a.minZoom>a.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(a.minPitch!=null&&a.maxPitch!=null&&a.minPitch>a.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(a.minPitch!=null&&a.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(a.maxPitch!=null&&a.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const c=new Do,p=new Lo;a.minZoom!==void 0&&c.setMinZoom(a.minZoom),a.maxZoom!==void 0&&c.setMaxZoom(a.maxZoom),a.minPitch!==void 0&&c.setMinPitch(a.minPitch),a.maxPitch!==void 0&&c.setMaxPitch(a.maxPitch),a.renderWorldCopies!==void 0&&c.setRenderWorldCopies(a.renderWorldCopies),a.transformConstrain!==null&&c.setConstrainOverride(a.transformConstrain),super(c,p,{bearingSnap:a.bearingSnap,zoomSnap:a.zoomSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new kd,this._controls=[],this._mapId=l.af(),this._lostContextStyle={style:null,images:null},this._contextLost=v=>{v.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const x of Object.values(this.style._layers))if(x.type==="custom"&&console.warn(`Custom layer with id '${x.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),x._listeners)for(const[T]of Object.entries(x._listeners))console.warn(`Custom layer with id '${x.id}' had event listeners for event '${T}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new l.l("webglcontextlost",{originalEvent:v}))},this._contextRestored=v=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._lostContextStyle={style:null,images:null},this._setupPainter(),this.resize(),this._update(),this._resizeInternal(),this.fire(new l.l("webglcontextrestored",{originalEvent:v}))},this._onMapScroll=v=>{if(v.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=a.interactive,this._maxTileCacheSize=a.maxTileCacheSize,this._maxTileCacheZoomLevels=a.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},a.canvasContextAttributes),this._trackResize=a.trackResize===!0,this._bearingSnap=a.bearingSnap,this._zoomSnap=a.zoomSnap,this._centerClampedToGround=a.centerClampedToGround,this._refreshExpiredTiles=a.refreshExpiredTiles===!0,this._fadeDuration=a.fadeDuration,this._crossSourceCollisions=a.crossSourceCollisions===!0,this._collectResourceTiming=a.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},gl),a.locale),this._clickTolerance=a.clickTolerance,this._overridePixelRatio=a.pixelRatio,this._maxCanvasSize=a.maxCanvasSize,this._zoomLevelsToOverscale=a.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=a.transformCameraUpdate,this.transformConstrain=a.transformConstrain,this.cancelPendingTileRequestsWhileZooming=a.cancelPendingTileRequestsWhileZooming===!0,a.reduceMotion!==void 0&&(Xe.prefersReducedMotion=a.reduceMotion),this._imageQueueHandle=Oe.addThrottleControl((()=>this.isMoving())),this._requestManager=new Fe(a.transformRequest),this._container=this._resolveContainer(a.container),a.maxBounds&&this.setMaxBounds(a.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"&&(this._ownerWindow.addEventListener("online",this._onWindowOnline,!1),this._setupResizeObserver()),this.handlers=new ml(this,a),this._hash=a.hash&&new Ec(typeof a.hash=="string"&&a.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:a.center,elevation:a.elevation,zoom:a.zoom,bearing:a.bearing,pitch:a.pitch,roll:a.roll}),a.bounds&&(this.resize(),this.fitBounds(a.bounds,l.e({},a.fitBoundsOptions,{duration:0}))));const m=typeof a.style=="string"||((n=(t=a.style)===null||t===void 0?void 0:t.projection)===null||n===void 0?void 0:n.type)!=="globe";this.resize(null,m),this._localIdeographFontFamily=a.localIdeographFontFamily,this._validateStyle=a.validateStyle,a.style&&this.setStyle(a.style,{localIdeographFontFamily:a.localIdeographFontFamily}),a.attributionControl&&this.addControl(new Oc(typeof a.attributionControl=="boolean"?void 0:a.attributionControl)),a.maplibreLogo&&this.addControl(new yh,a.logoPosition),this.on("style.load",(()=>{if(m||this._resizeTransform(),this.transform.unmodified){const v=l.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(v)}})),this.on("data",(v=>{this._update(v.dataType==="style"),this.fire(new l.l(`${v.dataType}data`,v))})),this.on("dataloading",(v=>{this.fire(new l.l(`${v.dataType}dataloading`,v))})),this.on("dataabort",(v=>{this.fire(new l.l("sourcedataabort",v))}))}_getMapId(){return this._mapId}setGlobalStateProperty(d,t){return this.style.setGlobalStateProperty(d,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(d,t){if(t===void 0&&(t=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new l.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=d.onAdd(this);this._controls.push(d);const a=this._controlPositions[t];return t.indexOf("bottom")!==-1?a.insertBefore(n,a.firstChild):a.appendChild(n),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new l.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(d);return t>-1&&this._controls.splice(t,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}coveringTiles(d){return Ir(this.transform,d)}calculateCameraOptionsFromTo(d,t,n,a){return a==null&&this.terrain&&(a=this.terrain.getElevationForLngLat(n,this.transform)),super.calculateCameraOptionsFromTo(d,t,n,a)}resize(d,t=!0){if(this._lostContextStyle.style!==null)return this;this._resizeInternal(t);const n=!this._moving;return n&&(this.stop(),this.fire(new l.l("movestart",d)).fire(new l.l("move",d))),this.fire(new l.l("resize",d)),n&&this.fire(new l.l("moveend",d)),this}_resizeInternal(d=!0){const[t,n]=this._containerDimensions(),a=this._getClampedPixelRatio(t,n);if(this._resizeCanvas(t,n,a),this.painter.resize(t,n,a),this.painter.overLimit()){const c=this.painter.context.gl;this._maxCanvasSize=[c.drawingBufferWidth,c.drawingBufferHeight];const p=this._getClampedPixelRatio(t,n);this._resizeCanvas(t,n,p),this.painter.resize(t,n,p)}this._resizeTransform(d)}_resizeTransform(d=!0){var t;const[n,a]=this._containerDimensions();this.transform.resize(n,a,d),(t=this._requestedCameraState)===null||t===void 0||t.resize(n,a,d)}_getClampedPixelRatio(d,t){const{0:n,1:a}=this._maxCanvasSize,c=this.getPixelRatio(),p=d*c,m=t*c;return Math.min(p>n?n/p:1,m>a?a/m:1)*c}getPixelRatio(){var d;return(d=this._overridePixelRatio)!==null&&d!==void 0?d:devicePixelRatio}setPixelRatio(d){this._overridePixelRatio=d,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(d){return this.transform.setMaxBounds(Mt.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom){const t=this.transform.zoom,n=this._getTransformForUpdate();return n.setMinZoom(d),this._applyUpdatedTransform(n),this._update(),t!==this.transform.zoom&&this.fire(new l.l("zoomstart")).fire(new l.l("zoom")).fire(new l.l("zoomend")).fire(new l.l("movestart")).fire(new l.l("move")).fire(new l.l("moveend")),this}throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom){const t=this.transform.zoom,n=this._getTransformForUpdate();return n.setMaxZoom(d),this._applyUpdatedTransform(n),this._update(),t!==this.transform.zoom&&this.fire(new l.l("zoomstart")).fire(new l.l("zoom")).fire(new l.l("zoomend")).fire(new l.l("movestart")).fire(new l.l("move")).fire(new l.l("moveend")),this}throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch){const t=this.transform.pitch,n=this._getTransformForUpdate();return n.setMinPitch(d),this._applyUpdatedTransform(n),this._update(),t!==this.transform.pitch&&this.fire(new l.l("pitchstart")).fire(new l.l("pitch")).fire(new l.l("pitchend")).fire(new l.l("movestart")).fire(new l.l("move")).fire(new l.l("moveend")),this}throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(d>=this.transform.minPitch){const t=this.transform.pitch,n=this._getTransformForUpdate();return n.setMaxPitch(d),this._applyUpdatedTransform(n),this._update(),t!==this.transform.pitch&&this.fire(new l.l("pitchstart")).fire(new l.l("pitch")).fire(new l.l("pitchend")).fire(new l.l("movestart")).fire(new l.l("move")).fire(new l.l("moveend")),this}throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.setRenderWorldCopies(d),this._update()}setTransformConstrain(d){return this.transform.setConstrainOverride(d),this._update()}project(d){return this.transform.locationToScreenPoint(l.V.convert(d),this.style&&this.terrain)}unproject(d){return this.transform.screenPointToLocation(l.P.convert(d),this.terrain)}isMoving(){var d;return this._moving||((d=this.handlers)===null||d===void 0?void 0:d.isMoving())}isZooming(){var d;return this._zooming||((d=this.handlers)===null||d===void 0?void 0:d.isZooming())}isRotating(){var d;return this._rotating||((d=this.handlers)===null||d===void 0?void 0:d.isRotating())}_createDelegatedListener(d,t,n){if(d==="mouseenter"||d==="mouseover"){let a=!1;return{layers:t,listener:n,delegates:{mousemove:p=>{const m=t.filter((x=>this.getLayer(x))),v=m.length!==0?this.queryRenderedFeatures(p.point,{layers:m}):[];v.length?a||(a=!0,n.call(this,new Vi(d,this,p.originalEvent,{features:v}))):a=!1},mouseout:()=>{a=!1}}}}if(d==="mouseleave"||d==="mouseout"){let a=!1;return{layers:t,listener:n,delegates:{mousemove:m=>{const v=t.filter((x=>this.getLayer(x)));(v.length!==0?this.queryRenderedFeatures(m.point,{layers:v}):[]).length?a=!0:a&&(a=!1,n.call(this,new Vi(d,this,m.originalEvent)))},mouseout:m=>{a&&(a=!1,n.call(this,new Vi(d,this,m.originalEvent)))}}}}{const a=c=>{const p=t.filter((v=>this.getLayer(v))),m=p.length!==0?this.queryRenderedFeatures(c.point,{layers:p}):[];m.length&&(c.features=m,n.call(this,c),delete c.features)};return{layers:t,listener:n,delegates:{[d]:a}}}}_saveDelegatedListener(d,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(t)}_removeDelegatedListener(d,t,n){if(!this._delegatedListeners||!this._delegatedListeners[d])return;const a=this._delegatedListeners[d];for(let c=0;c<a.length;c++){const p=a[c];if(p.listener===n&&p.layers.length===t.length&&p.layers.every((m=>t.includes(m)))){for(const m in p.delegates)this.off(m,p.delegates[m]);return void a.splice(c,1)}}}on(d,t,n){if(n===void 0)return super.on(d,t);const a=typeof t=="string"?[t]:t,c=this._createDelegatedListener(d,a,n);this._saveDelegatedListener(d,c);for(const p in c.delegates)this.on(p,c.delegates[p]);return{unsubscribe:()=>{this._removeDelegatedListener(d,a,n)}}}once(d,t,n){if(n===void 0)return super.once(d,t);const a=typeof t=="string"?[t]:t,c=this._createDelegatedListener(d,a,n);for(const p in c.delegates){const m=c.delegates[p];c.delegates[p]=(...v)=>{this._removeDelegatedListener(d,a,n),m(...v)}}this._saveDelegatedListener(d,c);for(const p in c.delegates)this.once(p,c.delegates[p]);return this}off(d,t,n){return n===void 0?super.off(d,t):(this._removeDelegatedListener(d,typeof t=="string"?[t]:t,n),this)}queryRenderedFeatures(d,t){if(!this.style)return[];let n;const a=d instanceof l.P||Array.isArray(d),c=a?d:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(a?{}:d)||{},c instanceof l.P||typeof c[0]=="number")n=[l.P.convert(c)];else{const p=l.P.convert(c[0]),m=l.P.convert(c[1]);n=[p,new l.P(m.x,p.y),m,new l.P(p.x,m.y),p]}return this.style.queryRenderedFeatures(n,t,this.transform)}querySourceFeatures(d,t){return this.style.querySourceFeatures(d,t)}setStyle(d,t){return(t=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(d,t))}setTransformRequest(d){return this._requestManager.setTransformRequest(d),this}_getUIString(d){const t=this._locale[d];if(t==null)throw new Error(`Missing UI string '${d}'`);return t}_updateStyle(d,t){var n,a;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(d,t)));const c=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!d)),d?(this.style=new Fo(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d,t,c):this.style.loadJSON(d,t,c),this):((a=(n=this.style)===null||n===void 0?void 0:n.projection)===null||a===void 0||a.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Fo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,t){if(typeof d=="string"){const n=this._requestManager.transformRequest(d,"Style");l.j(n,new AbortController).then((a=>{this._updateDiff(a.data,t)})).catch((a=>{a&&this.fire(new l.k(a))}))}else typeof d=="object"&&this._updateDiff(d,t)}_updateDiff(d,t){try{this.style.setState(d,t)&&this._update(!0)}catch(n){l.w(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(d,t)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(d,t){return this._lazyInitEmptyStyle(),this.style.addSource(d,t),this._update(!0)}isSourceLoaded(d){const t=this.style&&this.style.tileManagers[d];if(t!==void 0)return t.loaded();this.fire(new l.k(new Error(`There is no tile manager with ID '${d}'`)))}setTerrain(d){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),d){const t=this.style.tileManagers[d.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${d.source}`);this.terrain===null&&t.reload();for(const n in this.style._layers){const a=this.style._layers[n];a.type==="hillshade"&&a.source===d.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),a.type==="color-relief"&&a.source===d.source&&l.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new xi(this.painter,t,d),this.painter.renderToTexture=new bs(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=n=>{var a;n.dataType==="style"?this.terrain.tileManager.freeRtt():n.dataType==="source"&&n.tile&&(n.sourceId!==d.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((a=n.source)===null||a===void 0?void 0:a.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(n.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new l.l("terrain",{terrain:d})),this}getTerrain(){var d,t;return(t=(d=this.terrain)===null||d===void 0?void 0:d.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const d=this.style&&this.style.tileManagers;for(const t of Object.values(d))if(!t.areTilesLoaded())return!1;return!0}removeSource(d){return this.style.removeSource(d),this._update(!0)}getSource(d){return this.style.getSource(d)}setSourceTileLodParams(d,t,n){if(n){const a=this.getSource(n);if(!a)throw new Error(`There is no source with ID "${n}", cannot set LOD parameters`);a.calculateTileZoom=qt(Math.max(1,d),Math.max(1,t))}else for(const a in this.style.tileManagers)this.style.tileManagers[a].getSource().calculateTileZoom=qt(Math.max(1,d),Math.max(1,t));return this._update(!0),this}refreshTiles(d,t){const n=this.style.tileManagers[d];if(!n)throw new Error(`There is no tile manager with ID "${d}", cannot refresh tile`);t===void 0?n.reload(!0):n.refreshTiles(t.map((a=>new l.ac(a.z,a.x,a.y))))}addImage(d,t,n={}){const{pixelRatio:a=1,sdf:c=!1,stretchX:p,stretchY:m,content:v,textFitWidth:x,textFitHeight:T}=n;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||l.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new l.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:P,height:k,data:A}=t,L=t;return this.style.addImage(d,{data:new l.R({width:P,height:k},new Uint8Array(A)),pixelRatio:a,stretchX:p,stretchY:m,content:v,textFitWidth:x,textFitHeight:T,sdf:c,version:0,userImage:L}),L.onAdd&&L.onAdd(this,d),this}}{const{width:P,height:k,data:A}=Xe.getImageData(t);this.style.addImage(d,{data:new l.R({width:P,height:k},A),pixelRatio:a,stretchX:p,stretchY:m,content:v,textFitWidth:x,textFitHeight:T,sdf:c,version:0})}}updateImage(d,t){const n=this.style.getImage(d);if(!n)return this.fire(new l.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const a=t instanceof HTMLImageElement||l.b(t)?Xe.getImageData(t):t,{width:c,height:p,data:m}=a;if(c===void 0||p===void 0)return this.fire(new l.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(c!==n.data.width||p!==n.data.height)return this.fire(new l.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const v=!(t instanceof HTMLImageElement||l.b(t));return n.data.replace(m,v),this.style.updateImage(d,n),this}getImage(d){return this.style.getImage(d)}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new l.k(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d){return Oe.getImage(this._requestManager.transformRequest(d,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(d,t){return this._lazyInitEmptyStyle(),this.style.addLayer(d,t),this._update(!0)}moveLayer(d,t){return this.style.moveLayer(d,t),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(d,t,n){return this.style.setLayerZoomRange(d,t,n),this._update(!0)}setFilter(d,t,n={}){return this.style.setFilter(d,t,n),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,t,n,a={}){return this.style.setPaintProperty(d,t,n,a),this._update(!0)}getPaintProperty(d,t){return this.style.getPaintProperty(d,t)}setLayoutProperty(d,t,n,a={}){return this.style.setLayoutProperty(d,t,n,a),this._update(!0)}getLayoutProperty(d,t){return this.style.getLayoutProperty(d,t)}setGlyphs(d,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(d,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(d,t,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(d,t,n,(a=>{a||this._update(!0)})),this}removeSprite(d){return this._lazyInitEmptyStyle(),this.style.removeSprite(d),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(d,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(d,t,(n=>{n||this._update(!0)})),this}setLight(d,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(d,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(d,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(d,t){return this.style.setFeatureState(d,t),this._update()}removeFeatureState(d,t){return this.style.removeFeatureState(d,t),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let d=0,t=0;return this._container&&(d=this._container.clientWidth||400,t=this._container.clientHeight||300),[d,t]}_setupResizeObserver(){var d;let t=!1;const n=Mc((c=>{this._trackResize&&!this._removed&&(this.resize(c),this.redraw())}),50),a=(d=this._ownerWindow.ResizeObserver)!==null&&d!==void 0?d:ResizeObserver;this._resizeObserver=new a((c=>{t?n(c):t=!0})),this._resizeObserver.observe(this._container)}_resolveContainer(d){if(typeof d=="string"){const t=document.getElementById(d);if(!t)throw new Error(`Container '${d}' not found.`);return t}if(d instanceof HTMLElement||d&&typeof d=="object"&&d.nodeType===1)return d;throw new Error("Invalid type: 'container' must be a String or HTMLElement.")}_setupContainer(){const d=this._container;d.classList.add("maplibregl-map");const t=this._canvasContainer=Z.create("div","maplibregl-canvas-container",d);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=Z.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const n=this._containerDimensions(),a=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],a);const c=this._controlContainer=Z.create("div","maplibregl-control-container",d),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((m=>{p[m]=Z.create("div",`maplibregl-ctrl-${m} `,c)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,t,n){this._canvas.width=Math.floor(n*d),this._canvas.height=Math.floor(n*t),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const d=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",(a=>{t={requestedAttributes:d},a&&(t.statusMessage=a.statusMessage,t.type=a.type)}),{once:!0});let n=null;if(n=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,d):this._canvas.getContext("webgl2",d)||this._canvas.getContext("webgl",d),!n){const a="Failed to initialize WebGL";throw t?(t.message=a,new Error(JSON.stringify(t))):new Error(a)}this.painter=new lh(n,this.transform),Ve.testSupport(n)}migrateProjection(d,t){super.migrateProjection(d,t),this.painter.transform=d,this.fire(new l.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_render(d){var t,n,a,c,p;const m=this._idleTriggered?this._fadeDuration:0,v=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),this._removed)return;let x=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const k=this.transform.zoom,A=Ee();this.style.zoomHistory.update(k,A);const L=new l.H(k,{now:A,fadeDuration:m,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),N=L.crossFadingFactor();N===1&&N===this._crossFadingFactor||(x=!0,this._crossFadingFactor=N),this.style.update(L)}const T=((n=this.style.projection)===null||n===void 0?void 0:n.transitionState)>0!==v;(a=this.style.projection)===null||a===void 0||a.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((c=this.style.projection)===null||c===void 0?void 0:c.transitionState,(p=this.style.projection)===null||p===void 0?void 0:p.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||T)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,m,this._crossSourceCollisions,T),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:m,showPadding:this.showPadding}),this.fire(new l.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.cH.mark(l.cI.load),this.fire(new l.l("load"))),this.style&&(this.style.hasTransitions()||x)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const P=this._sourcesDirty||this._styleDirty||this._placementDirty;return P||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.l("idle")),!this._loaded||this._fullyLoaded||P||(this._fullyLoaded=!0,l.cH.mark(l.cI.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var d;this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&this._ownerWindow.removeEventListener("online",this._onWindowOnline,!1),Oe.removeThrottleControl(this._imageQueueHandle),(d=this._resizeObserver)===null||d===void 0||d.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t?.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Z.remove(this._canvasContainer),Z.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),l.cH.clearMetrics(),this._removed=!0,this.fire(new l.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Xe.frame(this._frameRequest,(d=>{l.cH.frame(d),this._frameRequest=null;try{this._render(d)}catch(t){if(!l.Z(t)&&!(function(n){return n.message===wc})(t))throw t}}),(()=>{}),this._ownerWindow))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get version(){return Bc}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(d){return this._lazyInitEmptyStyle(),this.style.setProjection(d),this._update(!0)}},S.MapMouseEvent=Vi,S.MapTouchEvent=ps,S.MapWheelEvent=hh,S.Marker=Cs,S.NavigationControl=class{constructor(d){this._updateZoomButtons=()=>{const t=this._map.getZoom(),n=t===this._map.getMaxZoom(),a=t===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,n)=>{const a=this._map._getUIString(`NavigationControl.${n}`);t.title=a,t.setAttribute("aria-label",a)},this.options=l.e({},Nc,d),this._container=Z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(t=>this._map.zoomIn({},{originalEvent:t}))),Z.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(t=>this._map.zoomOut({},{originalEvent:t}))),Z.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})),this._compassIcon=Z.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ws(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Z.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(d,t){const n=Z.create("button",d,this._container);return n.type="button",n.addEventListener("click",t),n}},S.Popup=class extends l.E{constructor(d){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&Z.remove(this._content),this._container&&(Z.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=Z.create("div","maplibregl-popup",this._map.getContainer()),this._tip=Z.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const m of this.options.className.split(" "))this._container.classList.add(m);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=vl(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const n=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let a=this.options.anchor;const c=bl(this.options.offset);if(!a){const m=this._container.offsetWidth,v=this._container.offsetHeight,x=(function(P){var k,A,L,N;return P?{top:(k=P.top)!==null&&k!==void 0?k:0,right:(A=P.right)!==null&&A!==void 0?A:0,bottom:(L=P.bottom)!==null&&L!==void 0?L:0,left:(N=P.left)!==null&&N!==void 0?N:0}:{top:0,right:0,bottom:0,left:0}})(this.options.padding);let T;T=n.y+c.bottom.y<v+x.top?["top"]:n.y>this._map.transform.height-v-x.bottom?["bottom"]:[],n.x<m/2+x.left?T.push("left"):n.x>this._map.transform.width-m/2-x.right&&T.push("right"),a=T.length===0?"bottom":T.join("-")}let p=n.add(c[a]);this.options.subpixelPositioning||(p=p.round()),Z.setTransform(this._container,`${Ts[a]} translate(${p.x}px,${p.y}px)`),yl(this._container,a,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(Uc),d)}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(d){return this._lngLat=l.V.convert(d),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){const t=document.createDocumentFragment(),n=document.createElement("body");let a;for(n.innerHTML=d;a=n.firstChild,a;)t.appendChild(a);return this.setDOMContent(t)}getMaxWidth(){var d;return(d=this._container)===null||d===void 0?void 0:d.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Z.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(d),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(d){return this._container&&this._container.classList.add(d),this}removeClassName(d){return this._container&&this._container.classList.remove(d),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){if(this._container)return this._container.classList.toggle(d)}setSubpixelPositioning(d){this.options.subpixelPositioning=d}setPadding(d){this.options.padding=d,this._update()}_createCloseButton(){this.options.closeButton&&(this._closeButton=Z.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(xl);d&&d.focus()}},S.RasterDEMTileSource=Ot,S.RasterTileSource=Et,S.ScaleControl=class{constructor(d){this._onMove=()=>{Ss(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Ss(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},jc),d)}getDefaultPosition(){return"bottom-left"}onAdd(d){return this._map=d,this._container=Z.create("div","maplibregl-ctrl maplibregl-ctrl-scale",d.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Z.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},S.ScrollZoomHandler=pl,S.Style=Fo,S.TerrainControl=class{constructor(d){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=d}onAdd(d){return this._map=d,this._container=Z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Z.create("button","maplibregl-ctrl-terrain",this._container),Z.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Z.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},S.TwoFingersTouchPitchHandler=mh,S.TwoFingersTouchRotateHandler=Lc,S.TwoFingersTouchZoomHandler=Dc,S.TwoFingersTouchZoomRotateHandler=vs,S.VectorTileSource=Sr,S.VideoSource=pr,S.addSourceType=(d,t)=>l._(void 0,void 0,void 0,(function*(){if(yr(d))throw new Error(`A source type called "${d}" already exists.`);((n,a)=>{Pr[n]=a})(d,t)})),S.clearPrewarmedResources=function(){const d=Ge;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(Q),Ge=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},S.createTileMesh=Mu,S.getMaxParallelImageRequests=function(){return l.c.MAX_PARALLEL_IMAGE_REQUESTS},S.getRTLTextPluginStatus=function(){return V().getRTLTextPluginStatus()},S.getVersion=function(){return Gc},S.getWorkerCount=function(){return ue.workerCount},S.getWorkerUrl=function(){return l.c.WORKER_URL},S.importScriptInWorkers=function(d){return Rt().broadcast("IS",d)},S.isTimeFrozen=function(){return He.isFrozen()},S.now=Ee,S.prewarm=function(){it().acquire(Q)},S.restoreNow=function(){He.restoreNow()},S.setMaxParallelImageRequests=function(d){l.c.MAX_PARALLEL_IMAGE_REQUESTS=d},S.setNow=function(d){He.setNow(d)},S.setRTLTextPlugin=function(d,t){return V().setRTLTextPlugin(d,t)},S.setWorkerCount=function(d){ue.workerCount=d},S.setWorkerUrl=function(d){l.c.WORKER_URL=d}}));var ae=G;return ae}))})(rd)),rd.exports}var eb=$x();const ja=Qx(eb),n_=Symbol("MapLibre map context"),o_=Symbol("MapLibre marker context");class tb{#e=Vr(null);get _map(){return w(this.#e)}set _map(_){St(this.#e,_)}_listener=void 0;_pending=[];userLayers=new Set;userSources=new Set;baseTerrain;userTerrain;baseSky;userSky;baseLight;userLight;baseProjection;userProjection;get map(){return this._map}set map(_){this._listener&&(this._map?.off("styledata",this._listener),this._listener=void 0),this._map=_,this._map&&(this._listener=this._onstyledata.bind(this),this._map.on("styledata",this._listener))}addLayer(_,G){if(!this.map)throw new Error("Map is not initialized");this.userLayers.add(_.id),this.waitForStyleLoaded(B=>{B.addLayer(_,G)})}removeLayer(_){if(!this.map)throw new Error("Map is not initialized");this.userLayers.delete(_),this.waitForStyleLoaded(G=>{G.removeLayer(_)})}addSource(_,G){this.userSources.add(_),this.waitForStyleLoaded(B=>{B.addSource(_,G)})}removeSource(_){this.userSources.delete(_),this.waitForStyleLoaded(G=>{G.removeSource(_)})}waitForStyleLoaded(_){this.map&&(this.map.style._loaded?_(this.map):this._pending.push(_))}_onstyledata(_){const G=_.target;if(G?.style._loaded){for(const B of this._pending)B(G);this._pending=[]}}setStyle(_){const{userSources:G,userLayers:B}=this;if(!_){this.map?.setStyle(null);return}this.map?.setStyle(od(_),{transformStyle:(me,ae)=>{if(this.baseLight=ae.light,this.baseProjection=ae.projection,this.baseSky=ae.sky,this.baseTerrain=ae.terrain,!me)return ae;const S=ae.sources;for(const[xe,Ie]of Object.entries(me.sources))G.has(xe)&&(S[xe]=Ie);const l=me.layers.filter(xe=>B.has(xe.id)),q=[...ae.layers,...l];return{...ae,light:this.userLight||this.baseLight,projection:this.userProjection||this.baseProjection,sky:this.userSky||this.baseSky,terrain:this.userTerrain||this.baseTerrain,sources:S,layers:q}}})}}function rb(){const I=new tb;return Vg(n_,I),I}function Fs(){const I=yu(n_);if(!I)throw new Error("Map context not found");return I}class ib{#e=Vr(null);get marker(){return w(this.#e)}set marker(_){St(this.#e,_)}}function nb(){const I=new ib;return Vg(o_,I),I}function ob(){const I=yu(o_);return I||null}var ab=Qe("<div><!></div>");function sb(I,_){_i(_,!0);let G=Pt(_,"class",3,""),B=Pt(_,"style",19,()=>({version:8,sources:{},layers:[]})),me=Pt(_,"zoom",11,void 0),ae=Pt(_,"center",11,void 0);if(globalThis.window&&!document.querySelector('link[href$="/maplibre-gl.css"]')){const Ne=document.createElement("link");Ne.rel="stylesheet",Ne.href=`https://unpkg.com/maplibre-gl@${ja.getVersion()}/dist/maplibre-gl.css`,document.head.appendChild(Ne)}let S=Vr(void 0),l=Vr(void 0);const q=rb();vr(()=>{w(l)||!w(S)||(St(l,new ja.Map({container:w(S),style:B(),zoom:me(),center:ae()}),!0),q.map=w(l))}),vr(()=>{w(l)&&B()&&q.setStyle(B())}),Ua(()=>{q.map=null,w(l)?.remove(),St(l,void 0)});var xe=ab(),Ie=oe(xe);{var qe=Ne=>{var Xe=wr(),He=$t(Xe);co(He,()=>_.children??Wn,()=>w(l)),ye(Ne,Xe)};xt(Ie,Ne=>{w(l)&&Ne(qe)})}K(xe),Zl(xe,Ne=>St(S,Ne),()=>w(S)),zt(()=>Gt(xe,1,Zr(G()))),ye(I,xe),vi()}function lb(I,_){_i(_,!0);let G=Hl(_,["$$slots","$$events","$$legacy","position"]);const B=Fs();if(!B.map)throw new Error("Map instance is not initialized.");let me=null;vr(()=>{me&&B.map?.removeControl(me),me=new ja.NavigationControl(od(G)),B.map?.addControl(me,_.position)}),Ua(()=>{me&&B.map?.removeControl(me)}),vi()}function cb(I,_){_i(_,!0);let G=Hl(_,["$$slots","$$events","$$legacy","position"]);const B=Fs();if(!B.map)throw new Error("Map instance is not initialized.");let me=null;vr(()=>{me&&B.map?.removeControl(me),me=new ja.ScaleControl(od(G)),B.map?.addControl(me,_.position)}),Ua(()=>{me&&B.map?.removeControl(me)}),vi()}function lo(I,_,G){G&&I?.on(_,G);const B=G;return()=>{B&&I?.off(_,B)}}function ub(I,_){return Array.isArray(I)?[_.lng,_.lat]:"lon"in I?{lon:_.lng,lat:_.lat}:{lng:_.lng,lat:_.lat}}function hb(I,_){_i(_,!0);let G=Pt(_,"control",15),B=Pt(_,"autoTrigger",3,!1),me=Hl(_,["$$slots","$$events","$$legacy","position","control","autoTrigger","ontrackuserlocationend","ontrackuserlocationstart","onuserlocationlostfocus","onuserlocationfocus","ongeolocate","onerror","onoutofmaxbounds"]);const ae=Fs();if(!ae.map)throw new Error("Map instance is not initialized.");vr(()=>{id(()=>G()&&ae.map?.removeControl(G())),G(new ja.GeolocateControl(me)),ae.map?.addControl(id(()=>G()),_.position)}),vr(()=>{B()&&(ae.map?.loaded()?G()?.trigger():ae.map?.once("load",()=>{G()?.trigger()}))}),vr(()=>lo(G(),"trackuserlocationstart",_.ontrackuserlocationstart)),vr(()=>lo(G(),"trackuserlocationend",_.ontrackuserlocationend)),vr(()=>lo(G(),"userlocationlostfocus",_.onuserlocationlostfocus)),vr(()=>lo(G(),"userlocationfocus",_.onuserlocationfocus)),vr(()=>lo(G(),"geolocate",_.ongeolocate)),vr(()=>lo(G(),"error",_.onerror)),vr(()=>lo(G(),"outofmaxbounds",_.onoutofmaxbounds)),Ua(()=>{G()&&ae.map?.removeControl(G())}),vi()}function db(I,_){_i(_,!0);let G=Hl(_,["$$slots","$$events","$$legacy","position","onfullscreenstart","onfullscreenend"]);const B=Fs();if(!B.map)throw new Error("Map instance is not initialized.");let me=null;vr(()=>{me&&B.map?.removeControl(me),me=new ja.FullscreenControl(G),B.map?.addControl(me,_.position)}),vr(()=>lo(me,"fullscreenstart",_.onfullscreenstart)),vr(()=>lo(me,"fullscreenend",_.onfullscreenend)),Ua(()=>{me&&B.map?.removeControl(me)}),vi()}var pb=Qe("<div><!></div>"),fb=Qe("<!> <!>",1);function mb(I,_){_i(_,!0);let G=Vr(null),B=Pt(_,"lnglat",15),me=Pt(_,"class",3,void 0),ae=Hl(_,["$$slots","$$events","$$legacy","lnglat","class","draggable","rotation","rotationAlignment","pitchAlignment","opacity","color","opacityWhenCovered","offset","subpixelPositioning","content","children","ondrag","ondragstart","ondragend"]);const S=Fs();if(!S.map)throw new Error("Map instance is not initialized.");let l=Vr(null);const q=nb();vr(()=>{if(w(l))return;if(!S.map)throw new Error("MapLibre is not initialized");const He={draggable:_.draggable,offset:_.offset,opacity:_.opacity,className:me(),opacityWhenCovered:_.opacityWhenCovered,rotation:_.rotation,color:_.color,rotationAlignment:_.rotationAlignment,pitchAlignment:_.pitchAlignment,subpixelPositioning:_.subpixelPositioning,...ae};if(_.content){if(!w(G))throw new Error("Marker container is not initialized");He.element=w(G)}St(l,new ja.Marker(He)),q.marker=w(l),w(l).setLngLat(od(B())).addTo(S.map),w(l).on("drag",Ee=>{w(l)&&B(ub(B(),w(l).getLngLat())),_.ondrag?.(Ee)})});let xe=!0;vr(()=>lo(w(l),"dragstart",_.ondragstart)),vr(()=>lo(w(l),"dragend",_.ondragend)),vr(()=>{_.draggable,xe||w(l)?.setDraggable(_.draggable)}),vr(()=>{B()&&!xe&&w(l)?.setLngLat(B())}),vr(()=>{_.rotation,xe||w(l)?.setRotation(_.rotation)}),vr(()=>{_.offset&&!xe&&w(l)?.setOffset(_.offset)}),vr(()=>{_.opacity,_.opacityWhenCovered,xe||w(l)?.setOpacity(_.opacity,_.opacityWhenCovered)}),vr(()=>{_.rotationAlignment&&!xe&&w(l)?.setRotationAlignment(_.rotationAlignment)}),vr(()=>{_.pitchAlignment&&!xe&&w(l)?.setPitchAlignment(_.pitchAlignment)}),vr(()=>{_.subpixelPositioning!==void 0&&!xe&&w(l)?.setSubpixelPositioning(_.subpixelPositioning)}),vr(()=>{const He=(me()??"")?.split(/\s/).filter(Boolean);if(w(l)&&!xe)for(const Ee of He)w(l).addClassName(Ee);return()=>{if(w(l))for(const Ee of He)w(l).removeClassName(Ee)}}),vr(()=>{xe=!1}),Ua(()=>{w(l)?.remove()});var Ie=fb(),qe=$t(Ie);{var Ne=He=>{var Ee=pb(),Z=oe(Ee);co(Z,()=>_.content),K(Ee),Zl(Ee,Ve=>St(G,Ve),()=>w(G)),ye(He,Ee)};xt(qe,He=>{_.content&&He(Ne)})}var Xe=de(qe,2);co(Xe,()=>_.children??Wn),ye(I,Ie),vi()}var gb=Qe("<div><!></div>");function _b(I,_){_i(_,!0);let G=Pt(_,"class",3,void 0),B=Pt(_,"open",15),me=Hl(_,["$$slots","$$events","$$legacy","lnglat","class","open","offset","maxWidth","subpixelPositioning","closeButton","closeOnClick","closeOnMove","focusAfterOpen","onopen","onclose","children"]),ae=Vr(null);const S=Fs();if(!S.map)throw new Error("Map instance is not initialized.");let l=Vr(null);const q=ob();vr(()=>{if(w(l))return;if(!S.map)throw new Error("MapLibre is not initialized");const Xe={className:G(),offset:_.offset,subpixelPositioning:_.subpixelPositioning,...me};if(_.maxWidth!==void 0&&(Xe.maxWidth=_.maxWidth),_.closeButton!==void 0&&(Xe.closeButton=_.closeButton),_.closeOnClick!==void 0&&(Xe.closeOnClick=_.closeOnClick),_.closeOnMove!==void 0&&(Xe.closeOnMove=_.closeOnMove),_.focusAfterOpen!==void 0&&(Xe.focusAfterOpen=_.focusAfterOpen),!w(ae))throw new Error("Popup content container is not initialized");St(l,new ja.Popup(Xe)),w(l).setDOMContent(w(ae)),_.lnglat&&(w(l).setLngLat(_.lnglat),B()===void 0&&B(!0))}),vr(()=>{q?.marker&&q.marker.setPopup(w(l))});let xe=!0,Ie=!1;vr(()=>{if(B()===!0){if(S.map&&!Ie){if(!w(l)?.getLngLat()){const Xe=q?.marker?.getLngLat();if(!Xe)return;w(l)?.setLngLat(Xe)}w(l)?.addTo(S.map),Ie=!0}}else B()===!1&&Ie&&(w(l)?.remove(),Ie=!1)}),vr(()=>{function Xe(He){B(!0),Ie=!0,_.onopen?.(He)}return w(l)?.on("open",Xe),()=>{w(l)?.off("open",Xe)}}),vr(()=>{function Xe(He){B(!1),Ie=!1,_.onclose?.(He)}return w(l)?.on("close",Xe),()=>{w(l)?.off("close",Xe)}}),vr(()=>{_.lnglat&&!xe&&w(l)?.setLngLat(_.lnglat)}),vr(()=>{_.maxWidth,xe||w(l)?.setMaxWidth(_.maxWidth??"none")}),vr(()=>{_.offset&&!xe&&w(l)?.setOffset(_.offset)}),vr(()=>{_.subpixelPositioning!==void 0&&!xe&&w(l)?.setSubpixelPositioning(_.subpixelPositioning)}),vr(()=>{const Xe=(G()??"")?.split(/\s/).filter(Boolean);if(w(l)&&!xe)for(const He of Xe)w(l).addClassName(He);return()=>{if(w(l))for(const He of Xe)w(l).removeClassName(He)}}),vr(()=>{xe=!1}),Ua(()=>{w(l)?.remove(),q?.marker?.setPopup(null)});var qe=gb(),Ne=oe(qe);co(Ne,()=>_.children??Wn),K(qe),Zl(qe,Xe=>St(ae,Xe),()=>w(ae)),ye(I,qe),vi()}var vb=Qe("<div><!></div>");function yb(I,_){_i(_,!0);let G=Pt(_,"group",3,!0);vr(()=>{if(!_.control&&!_.children)throw new Error("You must provide either control or children.")});const B=Fs();if(!B.map)throw new Error("Map instance is not initialized.");let me=Vr(void 0),ae=ne(()=>_.control?_.control:{onAdd:()=>w(me),onRemove:()=>{w(me)?.parentNode?.removeChild(w(me))}});vr(()=>(w(ae)&&B.map?.addControl(w(ae),_.position),()=>{w(ae)&&B.map?.removeControl(w(ae))}));var S=wr(),l=$t(S);{var q=xe=>{var Ie=vb();let qe;var Ne=oe(Ie);co(Ne,()=>_.children??Wn),K(Ie),Zl(Ie,Xe=>St(me,Xe),()=>w(me)),zt(()=>qe=Gt(Ie,1,`maplibregl-ctrl ${_.class}`,null,qe,{"maplibregl-ctrl-group":G()})),ye(xe,Ie)};xt(l,xe=>{_.control||xe(q)})}ye(I,S),vi()}var xb=Qe("<h5> </h5>"),bb=Qe("<option> </option>"),wb=Qe('<div class="flex items-center gap-2 px-2 py-1 text-black"><label for="timeout" class="text-sm font-medium"> </label> <select id="timeout" class="rounded px-2 py-1 text-sm"></select></div>'),Tb=Qe('<div class="rotate-270"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M14.76 12H6.832m0 0c0-.275-.057-.55-.17-.808L4.285 5.814c-.76-1.72 1.058-3.442 2.734-2.591L20.8 10.217c1.46.74 1.46 2.826 0 3.566L7.02 20.777c-1.677.851-3.495-.872-2.735-2.591l2.375-5.378A2 2 0 0 0 6.83 12"></path></svg></div>'),Cb=Qe('<div class="flex flex-col items-center justify-center leading-none"><div><!></div> <p class="font-bold"> </p></div>'),Sb=Qe('<div class="absolute top-1/2 right-0 -translate-y-1/2 transform rounded-md bg-(--green-color) px-1.5 py-1 text-sm shadow-lg">✓</div>'),Pb=Qe('<p> </p> <p> </p> <p> </p> <div class="relative flex justify-between"><button class="absolute right-0 flex cursor-pointer border-none bg-transparent" aria-label="Копировать текст"><svg xmlns="http://www.w3.org/2000/svg" width="1.5rem" height="1.5rem" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M6 11c0-2.828 0-4.243.879-5.121C7.757 5 9.172 5 12 5h3c2.828 0 4.243 0 5.121.879C21 6.757 21 8.172 21 11v5c0 2.828 0 4.243-.879 5.121C19.243 22 17.828 22 15 22h-3c-2.828 0-4.243 0-5.121-.879C6 20.243 6 18.828 6 16z"></path><path d="M6 19a3 3 0 0 1-3-3v-6c0-3.771 0-5.657 1.172-6.828S7.229 2 11 2h4a3 3 0 0 1 3 3"></path></g></svg></button> <!> <button class="size-6 cursor-pointer" aria-label="Удалить"><svg xmlns="http://www.w3.org/2000/svg" width="1.5rem" height="1.5rem" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="m19.5 5.5l-.62 10.025c-.158 2.561-.237 3.842-.88 4.763a4 4 0 0 1-1.2 1.128c-.957.584-2.24.584-4.806.584c-2.57 0-3.855 0-4.814-.585a4 4 0 0 1-1.2-1.13c-.642-.922-.72-2.205-.874-4.77L4.5 5.5M3 5.5h18m-4.944 0l-.683-1.408c-.453-.936-.68-1.403-1.071-1.695a2 2 0 0 0-.275-.172C13.594 2 13.074 2 12.035 2c-1.066 0-1.599 0-2.04.234a2 2 0 0 0-.278.18c-.395.303-.616.788-1.058 1.757L8.053 5.5m1.447 11v-6m5 6v-6" color="currentColor"></path></svg></button></div>',1),Ib=Qe("<!> <!> <!> <!> <!> <!>",1),Mb=Qe('<div class="h-full min-h-50"><!> <!></div>');function hw(I,_){_i(_,!0);const G=()=>vn(po,"$t",B),[B,me]=Mo();let ae=Pt(_,"id",19,()=>crypto.randomUUID()),S=Pt(_,"label",19,()=>({name:"",class:""})),l=Pt(_,"data",15),q=Vr(Na([])),xe=Vr(!1),Ie=Vr(!1),qe=Vr(3e4);const Ne=Ke=>{const nt=w(q)[Ke];nt.timeoutId!==null&&clearTimeout(nt.timeoutId);const rt=setTimeout(()=>{Ke<w(q).length&&w(q)[Ke].DevSN===nt.DevSN&&(w(q)[Ke].isFresh=!1,w(q)[Ke].timeoutId=null)},w(qe));w(q)[Ke].timeoutId=rt,w(q)[Ke].isFresh=!0};vr(()=>{if(l()){const Ke=w(q).findIndex(nt=>nt.DevSN===l()?.DevSN);if(Ke!==-1)w(q)[Ke]={...w(q)[Ke],...l()},Ne(Ke);else{const nt={...l(),isFresh:!0,timeoutId:null};w(q).push(nt),Ne(w(q).length-1)}l(null)}});const Xe=Ke=>{St(Ie,!Ke.detail.currentTheme)};vu(()=>{typeof window<"u"&&(St(Ie,localStorage.getItem("AppTheme")!=="light"),window.addEventListener("ThemeChange",Xe))}),Ua(()=>{typeof window<"u"&&window.addEventListener("ThemeChange",Xe);for(const Ke of w(q))Ke.timeoutId!==null&&clearTimeout(Ke.timeoutId)});const He=[{label:"30 sec",value:3e4},{label:"1 min",value:6e4},{label:"3 min",value:18e4},{label:"5 min",value:3e5},{label:"10 min",value:6e5},{label:"30 min",value:18e5},{label:"1 h",value:36e5}],Ee=Ke=>{St(qe,Ke,!0),w(q).forEach((nt,rt)=>Ne(rt))};var Z=Mb(),Ve=oe(Z);{var ut=Ke=>{var nt=xb(),rt=oe(nt,!0);K(nt),zt(Oe=>{Gt(nt,1,Oe),lr(rt,S().name)},[()=>Zr(ir(" w-full px-4 text-center",S().class))]),ye(Ke,nt)};xt(Ve,Ke=>{S().name&&Ke(ut)})}var vt=de(Ve,2);{let Ke=ne(()=>w(Ie)?"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json":"https://basemaps.cartocdn.com/gl/voyager-gl-style/style.json");sb(vt,{class:"h-[calc(100%-2rem)] min-h-50 overflow-hidden rounded-2xl shadow-sm transition duration-200 hover:shadow-md",get style(){return w(Ke)},zoom:1.5,center:{lat:30,lng:0},children:(nt,rt)=>{var Oe=Ib(),Fe=$t(Oe);lb(Fe,{});var lt=de(Fe,2);cb(lt,{});var Re=de(lt,2);hb(Re,{});var pt=de(Re,2);db(pt,{});var ft=de(pt,2);yb(ft,{position:"top-left",children:(bt,Ue)=>{var Be=wb(),Se=oe(Be),Te=oe(Se,!0);K(Se);var Ce=de(Se,2);Ce.__change=we=>Ee(parseInt(we.target.value)),Er(Ce,21,()=>He,Ur,(we,be)=>{var ie=bb(),ee=oe(ie,!0);K(ie);var Q={};zt(()=>{lr(ee,w(be).label),Q!==(Q=w(be).value)&&(ie.value=(ie.__value=w(be).value)??"")}),ye(we,ie)}),K(Ce),K(Be),zt(we=>lr(Te,we),[()=>G()("constructor.props.map.timeout")]),Ty(Ce,()=>w(qe),we=>St(qe,we)),ye(bt,Be)},$$slots:{default:!0}});var gt=de(ft,2);Er(gt,17,()=>w(q),Ur,(bt,Ue)=>{{const Be=Te=>{var Ce=Cb(),we=oe(Ce),be=oe(we);{var ie=De=>{var Ge=wr(),ot=$t(Ge);{var it=Rt=>{var Ft=wr(),Kt=$t(Ft);Wi(Kt,()=>_.markerIcon),ye(Rt,Ft)},It=Rt=>{const Ft=ne(()=>_.markerIcon);var Kt=wr(),Yt=$t(Kt);st(Yt,()=>w(Ft),(Tr,Qt)=>{Qt(Tr,{})}),ye(Rt,Kt)};xt(ot,Rt=>{typeof _.markerIcon=="string"?Rt(it):Rt(It,!1)})}ye(De,Ge)},ee=De=>{var Ge=Tb();ye(De,Ge)};xt(be,De=>{_.markerIcon?De(ie):De(ee,!1)})}K(we);var Q=de(we,2),ue=oe(Q,!0);K(Q),K(Ce),zt(()=>{Gt(we,1,`flex size-8 shrink-0 items-center justify-center [&_svg]:h-full [&_svg]:max-h-full [&_svg]:w-full [&_svg]:max-w-full
            ${w(Ue).isFresh?"text-green-500":"text-red-500"}`),hi(we,`rotate: ${w(Ue).NavHeading??""}deg;`),lr(ue,w(Ue).DevName)}),ye(Te,Ce)};let Se=ne(()=>({lng:w(Ue).NavLon,lat:w(Ue).NavLat}));mb(bt,{get lnglat(){return w(Se)},content:Be,children:(Te,Ce)=>{_b(Te,{closeButton:!1,class:"rounded-2xl text-left",children:(we,be)=>{var ie=Pb(),ee=$t(ie),Q=oe(ee);K(ee);var ue=de(ee,2),De=oe(ue);K(ue);var Ge=de(ue,2),ot=oe(Ge);K(Ge);var it=de(Ge,2),It=oe(it);It.__click=Yt=>{Yt.preventDefault(),navigator.clipboard.writeText(`DevName: ${w(Ue).DevName}
DevSN: ${w(Ue).DevSN}
Lat: ${w(Ue).NavLat.toFixed(3)} | Lon: ${w(Ue).NavLon.toFixed(3)} | Alt: ${w(Ue).NavAlt}
Heading: ${w(Ue).NavHeading} | Sat Use: ${w(Ue).NavSatUse}`),St(xe,!0),setTimeout(()=>St(xe,!1),1e3)};var Rt=de(It,2);{var Ft=Yt=>{var Tr=Sb();Dn(3,Tr,()=>ad,()=>({duration:200})),ye(Yt,Tr)};xt(Rt,Yt=>{w(xe)&&Yt(Ft)})}var Kt=de(Rt,2);Kt.__click=()=>St(q,w(q).filter(Yt=>Yt.DevSN!==w(Ue).DevSN),!0),K(it),zt(Yt=>{lr(Q,`DevSN: ${w(Ue).DevSN??""}`),lr(De,`Lat: ${Yt??""}`),lr(ot,`Heading: ${w(Ue).NavHeading??""} | Sat Use: ${w(Ue).NavSatUse??""}`)},[()=>`${w(Ue).NavLat.toFixed(3)} | Lon: ${w(Ue).NavLon.toFixed(3)} | Alt: ${w(Ue).NavAlt}`]),ye(we,ie)},$$slots:{default:!0}})},$$slots:{content:!0,default:!0}})}}),ye(nt,Oe)},$$slots:{default:!0}})}K(Z),zt(Ke=>tr(Z,"id",Ke),[()=>`${ae()}-${crypto.randomUUID().slice(0,6)}`]),ye(I,Z),vi(),me()}Xi(["change","click"]);var Eb=Qe('<button class="h-8 w-8 cursor-pointer [&amp;_svg]:h-full [&amp;_svg]:max-h-full [&amp;_svg]:w-full [&amp;_svg]:max-w-full"><!></button>'),Ab=Qe('<div class="relative m-1.5 rounded-xl border-2 border-(--border-color) p-3"><div class="absolute -top-3.5 bg-(--back-color) px-1"> </div> <div class="grid grid-cols-3 place-items-center gap-2"></div></div>'),kb=Qe('<div class="grid grid-cols-3"></div>'),zb=Qe('<div class="relative flex flex-row items-start justify-center"><div class="flex w-1/3 flex-col items-center px-2"><!></div> <div class="flex w-1/3 flex-col px-2"><!> <!></div> <div class="flex w-1/3 flex-col px-2"><div class="mt-6 flex gap-2"><!> <!> <!></div></div></div>'),Db=Qe('<button class="h-8 w-8 cursor-pointer [&amp;_svg]:h-full [&amp;_svg]:max-h-full [&amp;_svg]:w-full [&amp;_svg]:max-w-full"><!></button>'),Lb=Qe('<div class="relative m-1.5 rounded-xl border-2 border-(--border-color) p-3"><div class="absolute -top-3.5 bg-(--back-color) px-1"> </div> <div class="grid grid-cols-3 place-items-center gap-2"></div></div>'),Rb=Qe('<div class="grid grid-cols-3"></div>'),Fb=Qe('<div class="relative mb-2 flex flex-row items-start justify-center"><div class="flex w-1/3 flex-col items-center px-2"><!></div> <div class="flex w-1/3 flex-col px-2"><!> <!></div> <div class="flex w-1/3 flex-col px-2"><div class="mt-6 flex gap-2"><!> <!> <!></div></div></div>');function dw(I,_){_i(_,!0);const G=()=>vn(Yl,"$optionsStore",me),B=()=>vn(po,"$t",me),[me,ae]=Mo(),S=Pt(_,"forConstructor",3,!0);let l=Vr(!1);const q=yu("DeviceVariables");let xe=ne(()=>q&&Array.isArray(q)?q:[]);const Ie=ne(()=>G().TEXT_ALIGN_OPTIONS.find(Ee=>Ee.value.includes(_.component.properties.label?.class?.split(" ").find(Z=>Z.startsWith("text-")))));var qe=wr(),Ne=$t(qe);{var Xe=Ee=>{var Z=zb(),Ve=oe(Z),ut=oe(Ve);{let gt=ne(()=>({name:B()("constructor.props.variable")})),bt=ne(()=>w(xe).find(Ue=>Ue.value===_.component.properties.id));st(ut,()=>Nr,(Ue,Be)=>{Be(Ue,{get label(){return w(gt)},get options(){return w(xe)},get value(){return w(bt)},onUpdate:Se=>{Tt("id",Se.value,_.component,_.onPropertyChange),_.onPropertyChange({name:Se.name?.split("—")[1].trim(),eventHandler:{Variables:[Se.value]}})}})})}K(Ve);var vt=de(Ve,2),Ke=oe(vt);{let gt=ne(()=>({name:B()("constructor.props.label")}));st(Ke,()=>_r,(bt,Ue)=>{Ue(bt,{get label(){return w(gt)},get value(){return _.component.properties.label.name},onUpdate:Be=>Tt("label.name",Be,_.component,_.onPropertyChange)})})}var nt=de(Ke,2);{let gt=ne(()=>({name:B()("constructor.props.align")}));st(nt,()=>Nr,(bt,Ue)=>{Ue(bt,{get label(){return w(gt)},type:"buttons",get value(){return w(Ie)},get options(){return G().TEXT_ALIGN_OPTIONS},onUpdate:Be=>Tt("label.class",ir(_.component.properties.label.class,Be.value),_.component,_.onPropertyChange)})})}K(vt);var rt=de(vt,2),Oe=oe(rt),Fe=oe(Oe);{let gt=ne(()=>({name:B()("constructor.props.markerIcon")}));st(Fe,()=>jr,(bt,Ue)=>{Ue(bt,{get content(){return w(gt)},onClick:()=>St(l,!0)})})}var lt=de(Fe,2);{var Re=gt=>{ho(gt,{wrapperClass:"w-130",get isOpen(){return w(l)},set isOpen(Ue){St(l,Ue,!0)},main:Ue=>{var Be=kb();Er(Be,21,()=>uo,Ur,(Se,Te)=>{var Ce=Ab(),we=oe(Ce),be=oe(we,!0);K(we);var ie=de(we,2);Er(ie,21,()=>w(Te)[1],Ur,(ee,Q)=>{var ue=Eb();ue.__click=()=>{Tt("markerIcon",w(Q),_.component,_.onPropertyChange)};var De=oe(ue);Wi(De,()=>w(Q)),K(ue),ye(ee,ue)}),K(ie),K(Ce),zt(ee=>lr(be,ee),[()=>B()(`constructor.props.icon.${w(Te)[0]}`)]),ye(Se,Ce)}),K(Be),ye(Ue,Be)},$$slots:{main:!0}})};xt(lt,gt=>{w(l)&&gt(Re)})}var pt=de(lt,2);{var ft=gt=>{{let bt=ne(()=>({icon:_n}));jr(gt,{wrapperClass:"w-8.5 ",componentClass:"p-0.5 bg-red",get content(){return w(bt)},onClick:()=>{Tt("markerIcon","",_.component,_.onPropertyChange)}})}};xt(pt,gt=>{_.component.properties.markerIcon&&gt(ft)})}K(Oe),K(rt),K(Z),ye(Ee,Z)},He=Ee=>{var Z=Fb(),Ve=oe(Z),ut=oe(Ve);{let gt=ne(()=>({name:B()("constructor.props.id")}));st(ut,()=>_r,(bt,Ue)=>{Ue(bt,{get label(){return w(gt)},get value(){return _.component.properties.id},onUpdate:Be=>Tt("id",Be,_.component,_.onPropertyChange)})})}K(Ve);var vt=de(Ve,2),Ke=oe(vt);{let gt=ne(()=>({name:B()("constructor.props.label")}));st(Ke,()=>_r,(bt,Ue)=>{Ue(bt,{get label(){return w(gt)},get value(){return _.component.properties.label.name},onUpdate:Be=>Tt("label.name",Be,_.component,_.onPropertyChange)})})}var nt=de(Ke,2);{let gt=ne(()=>({name:B()("constructor.props.label.class")}));st(nt,()=>_r,(bt,Ue)=>{Ue(bt,{get label(){return w(gt)},get value(){return _.component.properties.label.class},onUpdate:Be=>Tt("label.class",Be,_.component,_.onPropertyChange)})})}K(vt);var rt=de(vt,2),Oe=oe(rt),Fe=oe(Oe);{let gt=ne(()=>({name:B()("constructor.props.markerIcon")}));st(Fe,()=>jr,(bt,Ue)=>{Ue(bt,{get content(){return w(gt)},onClick:()=>St(l,!0)})})}var lt=de(Fe,2);{var Re=gt=>{ho(gt,{wrapperClass:"w-130",get isOpen(){return w(l)},set isOpen(Ue){St(l,Ue,!0)},main:Ue=>{var Be=Rb();Er(Be,21,()=>uo,Ur,(Se,Te)=>{var Ce=Lb(),we=oe(Ce),be=oe(we,!0);K(we);var ie=de(we,2);Er(ie,21,()=>w(Te)[1],Ur,(ee,Q)=>{var ue=Db();ue.__click=()=>{Tt("markerIcon",w(Q),_.component,_.onPropertyChange)};var De=oe(ue);Wi(De,()=>w(Q)),K(ue),ye(ee,ue)}),K(ie),K(Ce),zt(ee=>lr(be,ee),[()=>B()(`constructor.props.icon.${w(Te)[0]}`)]),ye(Se,Ce)}),K(Be),ye(Ue,Be)},$$slots:{main:!0}})};xt(lt,gt=>{w(l)&&gt(Re)})}var pt=de(lt,2);{var ft=gt=>{{let bt=ne(()=>({icon:_n}));jr(gt,{wrapperClass:"w-8.5 ",componentClass:"p-0.5 bg-red",get content(){return w(bt)},onClick:()=>{Tt("markerIcon","",_.component,_.onPropertyChange)}})}};xt(pt,gt=>{_.component.properties.markerIcon&&gt(ft)})}K(Oe),K(rt),K(Z),ye(Ee,Z)};xt(Ne,Ee=>{S()?Ee(Xe):Ee(He,!1)})}ye(I,qe),vi(),ae()}Xi(["click"]);var Ob=$n('<svg xmlns="http://www.w3.org/2000/svg" width="1.5em" height="1.5em" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="m19.5 5.5l-.62 10.025c-.158 2.561-.237 3.842-.88 4.763a4 4 0 0 1-1.2 1.128c-.957.584-2.24.584-4.806.584c-2.57 0-3.855 0-4.814-.585a4 4 0 0 1-1.2-1.13c-.642-.922-.72-2.205-.874-4.77L4.5 5.5M3 5.5h18m-4.944 0l-.683-1.408c-.453-.936-.68-1.403-1.071-1.695a2 2 0 0 0-.275-.172C13.594 2 13.074 2 12.035 2c-1.066 0-1.599 0-2.04.234a2 2 0 0 0-.278.18c-.395.303-.616.788-1.058 1.757L8.053 5.5m1.447 11v-6m5 6v-6" color="currentColor"></path></svg>');function Gl(I){var _=Ob();ye(I,_)}var Bb=$n('<svg xmlns="http://www.w3.org/2000/svg" width="1.5em" height="1.5em" viewBox="0 0 24 24"><path fill="currentColor" d="M12.75 9a.75.75 0 0 0-1.5 0v2.25H9a.75.75 0 0 0 0 1.5h2.25V15a.75.75 0 0 0 1.5 0v-2.25H15a.75.75 0 0 0 0-1.5h-2.25z"></path><path fill="currentColor" fill-rule="evenodd" d="M12.057 1.25h-.114c-2.309 0-4.118 0-5.53.19c-1.444.194-2.584.6-3.479 1.494c-.895.895-1.3 2.035-1.494 3.48c-.19 1.411-.19 3.22-.19 5.529v.114c0 2.309 0 4.118.19 5.53c.194 1.444.6 2.584 1.494 3.479c.895.895 2.035 1.3 3.48 1.494c1.411.19 3.22.19 5.529.19h.114c2.309 0 4.118 0 5.53-.19c1.444-.194 2.584-.6 3.479-1.494c.895-.895 1.3-2.035 1.494-3.48c.19-1.411.19-3.22.19-5.529v-.114c0-2.309 0-4.118-.19-5.53c-.194-1.444-.6-2.584-1.494-3.479c-.895-.895-2.035-1.3-3.48-1.494c-1.411-.19-3.22-.19-5.529-.19M3.995 3.995c.57-.57 1.34-.897 2.619-1.069c1.3-.174 3.008-.176 5.386-.176s4.086.002 5.386.176c1.279.172 2.05.5 2.62 1.069c.569.57.896 1.34 1.068 2.619c.174 1.3.176 3.008.176 5.386s-.002 4.086-.176 5.386c-.172 1.279-.5 2.05-1.069 2.62c-.57.569-1.34.896-2.619 1.068c-1.3.174-3.008.176-5.386.176s-4.086-.002-5.386-.176c-1.279-.172-2.05-.5-2.62-1.069c-.569-.57-.896-1.34-1.068-2.619c-.174-1.3-.176-3.008-.176-5.386s.002-4.086.176-5.386c.172-1.279.5-2.05 1.069-2.62" clip-rule="evenodd"></path></svg>');function Ba(I){var _=Bb();ye(I,_)}var Nb=Qe("<h5> </h5>"),Vb=Qe('<div class="flex w-full"><input type="range"/> <input type="range"/></div>'),jb=Qe('<div class="absolute h-full w-full"><input type="range" style="color: var(--bg-color);"/></div>'),Ub=Qe('<div style="background-color: var(--bg-color)"><button>−</button> <span class="inline-block text-center tabular-nums"> </span> <button>+</button></div>'),Gb=Qe('<div style="background-color: var(--bg-color)"><button>−</button> <span class="inline-block text-center tabular-nums"> </span> <button>+</button></div>'),qb=Qe("<div><!> <div><!></div> <div><!></div></div>");function Sg(I,_){_i(_,!0);let G=Pt(_,"id",19,()=>crypto.randomUUID()),B=Pt(_,"wrapperClass",3,""),me=Pt(_,"label",19,()=>({name:"",class:""})),ae=Pt(_,"type",3,"single"),S=Pt(_,"value",7,0),l=Pt(_,"number",19,()=>({minNum:0,maxNum:10,step:1})),q=Pt(_,"disabled",3,!1),xe=Pt(_,"onUpdate",3,()=>{});const Ie=ne(()=>ae()==="range"||Array.isArray(S())&&S().length===2),qe=ne(()=>String(l().maxNum??100).length),Ne=ne(()=>`${w(qe)+1}ch`);let Xe=ne(()=>!w(Ie)&&typeof S()=="number"?S():l().minNum),He=ne(()=>w(Ie)&&Array.isArray(S())?S()[0]:l().minNum),Ee=ne(()=>w(Ie)&&Array.isArray(S())?S()[1]:l().maxNum),Z=Vr("floor"),Ve=ne(()=>w(He)+Math[w(Z)](Math.abs(w(Ee)-w(He))/2/l().step)*l().step);vr(()=>{(S()===void 0||S()===null)&&(ae()==="single"&&!S()&&S(l().minNum),ae()==="range"&&!S()&&S([l().minNum,l().maxNum]))});const ut=(Ue,Be)=>{const Se=Be==="increment"?l().step:-l().step;w(Ie)&&Ue!=="single"?(Ue==="lower"?(St(He,vt(Math.max(l().minNum,Math.min(w(He)+Se,w(Ee))))),St(He,vt(w(He)==w(Ee)?w(Ee)-l().step:w(He)))):(St(Ee,vt(Math.min(l().maxNum,Math.max(w(Ee)+Se,w(He))))),St(Ee,vt(w(Ee)==w(He)?w(Ee)+l().step:w(Ee)))),xe()([w(He),w(Ee)])):(St(Xe,vt(Math.max(l().minNum,Math.min(w(Xe)+Se,l().maxNum)))),xe()(w(Xe)))};vr(()=>{Array.isArray(S())?(St(He,S()[0]),St(Ee,S()[1])):typeof S()=="number"&&St(Xe,S())});const vt=Ue=>{if(Number.isInteger(Ue))return Ue;const Be=Number(Ue.toFixed(1));if(Math.abs(Be-Ue)<1e-10)return Be;const Se=Number(Ue.toFixed(2));return Math.abs(Se-Ue)<1e-10,Se};var Ke=qb(),nt=oe(Ke);{var rt=Ue=>{var Be=Nb(),Se=oe(Be,!0);K(Be),zt(Te=>{Gt(Be,1,Te),lr(Se,me().name)},[()=>Zr(ir("w-full px-4 text-center",me().class))]),ye(Ue,Be)};xt(nt,Ue=>{me().name&&Ue(rt)})}var Oe=de(nt,2),Fe=oe(Oe);{var lt=Ue=>{const Be=ne(()=>navigator.userAgent);var Se=Vb(),Te=oe(Se);Va(Te),Te.__input=function(...we){(q()?void 0:be=>{const ie=Math.min(Number(be.target.value),w(Ee));St(He,vt(ie==w(Ee)?w(Ee)-l().step:ie)),xe()([w(He),w(Ee)])})?.apply(this,we)},Te.__mousedown=()=>St(Z,"ceil");var Ce=de(Te,2);Va(Ce),Ce.__input=function(...we){(q()?void 0:be=>{const ie=Math.max(Number(be.target.value),w(He));St(Ee,vt(ie==w(He)?ie+l().step:w(Ee))),xe()([w(He),w(Ee)])})?.apply(this,we)},Ce.__mousedown=()=>St(Z,"floor"),K(Se),zt((we,be,ie,ee)=>{tr(Te,"min",l().minNum),tr(Te,"max",w(Ve)),tr(Te,"step",l().step),Te.disabled=q(),Gt(Te,1,we),hi(Te,`color: var(--bg-color); flex-basis: ${be??""};`),tr(Ce,"min",w(Ve)),tr(Ce,"max",l().maxNum),tr(Ce,"step",l().step),Ce.disabled=q(),Gt(Ce,1,ie),hi(Ce,`color: var(--bg-color); flex-basis: ${ee??""};`)},[()=>Zr(ir(`basis-[calc(${Math.abs(w(Ve)-l().minNum)/Math.abs(l().maxNum-l().minNum)*100}%+2rem+5px)] h-8 w-full appearance-none overflow-hidden 
              accent-(--back-color) 
              [&::-webkit-slider-runnable-track]:rounded-l-full
              [&::-webkit-slider-runnable-track]:bg-(--gray-color)
              [&::-webkit-slider-runnable-track]:px-2
              [&::-webkit-slider-runnable-track]:shadow-sm
              [&::-webkit-slider-thumb]:relative
              [&::-webkit-slider-thumb]:size-4
              [&::-webkit-slider-thumb]:cursor-pointer
              [&::-webkit-slider-thumb]:rounded-full
              [&::-webkit-slider-thumb]:shadow-[var(--focus-shadow),]
            ${w(Be).includes("iOS")||w(Be).includes("iPhone")||w(Be).includes("iPad")?"[&::-webkit-slider-thumb]:ring-[6.5px]":"[&::-webkit-slider-thumb]:ring-[5px] "}
            [&::-moz-range-thumb]:relative 
            [&::-moz-range-thumb]:ml-[-0.4rem]
            [&::-moz-range-thumb]:size-4 
            [&::-moz-range-thumb]:cursor-pointer 
            [&::-moz-range-thumb]:rounded-full
            [&::-moz-range-thumb]:shadow-[var(--focus-shadow),] 
            [&::-moz-range-thumb]:ring-[6px] 
            [&::-moz-range-track]:rounded-full
            [&::-moz-range-track]:bg-(--gray-color)
             `,`[&::-moz-range-thumb]:shadow-[calc(100rem+0.5rem)_0_0_100rem] 
              [&::-webkit-slider-thumb]:shadow-[calc(100rem+0.5rem)_0_0_100rem]`)),()=>`calc(${Math.abs(w(Ve)-l().minNum)/Math.abs(l().maxNum-l().minNum)*100}% + 2rem + 5px)`,()=>Zr(ir(`basis-[calc(${100-Math.abs(w(Ve)-l().minNum)/Math.abs(l().maxNum-l().minNum)*100}%+2rem+5px)] h-8 w-full  appearance-none overflow-hidden  
              accent-(--back-color) 
              [&::-webkit-slider-runnable-track]:rounded-r-full
              [&::-webkit-slider-runnable-track]:bg-(--gray-color)
              [&::-webkit-slider-runnable-track]:px-2
              [&::-webkit-slider-runnable-track]:shadow-sm
              [&::-webkit-slider-thumb]:relative
              [&::-webkit-slider-thumb]:size-4
              [&::-webkit-slider-thumb]:cursor-pointer
              [&::-webkit-slider-thumb]:rounded-full
              [&::-webkit-slider-thumb]:shadow-[var(--focus-shadow),]
            ${w(Be).includes("iOS")||w(Be).includes("iPhone")||w(Be).includes("iPad")?"[&::-webkit-slider-thumb]:ring-[6.5px]":"[&::-webkit-slider-thumb]:ring-[5px] "}
            [&::-moz-range-thumb]:relative 
            [&::-moz-range-thumb]:ml-[-0.4rem]
            [&::-moz-range-thumb]:size-4 
            [&::-moz-range-thumb]:cursor-pointer 
            [&::-moz-range-thumb]:rounded-full
            [&::-moz-range-thumb]:shadow-[var(--focus-shadow),] 
            [&::-moz-range-thumb]:ring-[6px] 
            [&::-moz-range-track]:rounded-full
            [&::-moz-range-track]:bg-(--gray-color)
             `,`[&::-moz-range-thumb]:shadow-[calc(100rem*-1-0.5rem)_0_0_100rem] 
              [&::-webkit-slider-thumb]:shadow-[calc(100rem*-1-0.5rem)_0_0_100rem]`)),()=>`calc(${(1-Math.abs(w(Ve)-l().minNum)/Math.abs(l().maxNum-l().minNum))*100}% + 2rem + 5px)`]),ql(Te,()=>w(He),we=>St(He,we)),ql(Ce,()=>w(Ee),we=>St(Ee,we)),ye(Ue,Se)},Re=Ue=>{const Be=ne(()=>navigator.userAgent);var Se=jb(),Te=oe(Se);Va(Te),Te.__input=()=>xe()(w(Xe)),K(Se),zt(Ce=>{tr(Te,"min",l().minNum),tr(Te,"max",l().maxNum),tr(Te,"step",l().step),Gt(Te,1,Ce)},[()=>Zr(ir(`h-8 w-full appearance-none overflow-hidden rounded-full accent-(--back-color) 
              [&::-webkit-slider-runnable-track]:rounded-full
              [&::-webkit-slider-runnable-track]:bg-(--gray-color)
              [&::-webkit-slider-runnable-track]:shadow-sm
              [&::-webkit-slider-thumb]:relative 

              [&::-webkit-slider-thumb]:ml-[-0.4rem] 
              [&::-webkit-slider-thumb]:h-4
              [&::-webkit-slider-thumb]:w-4
              [&::-webkit-slider-thumb]:cursor-pointer
              [&::-webkit-slider-thumb]:rounded-full
            [&::-webkit-slider-thumb]:shadow-[var(--focus-shadow),]
            ${w(Be).includes("iOS")||w(Be).includes("iPhone")||w(Be).includes("iPad")?"pl-3.5 [&::-webkit-slider-thumb]:ring-[6.5px]":"pl-3 [&::-webkit-slider-thumb]:ring-[5px]"}
            [&::-moz-range-thumb]:relative 
            [&::-moz-range-thumb]:ml-[-0.4rem]
            [&::-moz-range-thumb]:size-4 
            [&::-moz-range-thumb]:cursor-pointer 
            [&::-moz-range-thumb]:rounded-full
            [&::-moz-range-thumb]:shadow-[var(--focus-shadow),] 
            [&::-moz-range-thumb]:ring-[6px] 
            [&::-moz-range-track]:rounded-full
            [&::-moz-range-track]:bg-(--gray-color)
             `,`[&::-moz-range-thumb]:shadow-[calc(100rem*-1-0.5rem)_0_0_100rem] 
              [&::-webkit-slider-thumb]:shadow-[calc(100rem*-1-0.5rem)_0_0_100rem]`))]),ql(Te,()=>w(Xe),Ce=>St(Xe,Ce)),ye(Ue,Se)};xt(Fe,Ue=>{w(Ie)?Ue(lt):Ue(Re,!1)})}K(Oe);var pt=de(Oe,2),ft=oe(pt);{var gt=Ue=>{var Be=wr(),Se=$t(Be);Er(Se,16,()=>["lower","upper"],Te=>Te,(Te,Ce,we,be)=>{var ie=Ub(),ee=oe(ie);ee.__click=function(...Ge){(q()?void 0:()=>ut(Ce,"decrement"))?.apply(this,Ge)};var Q=de(ee,2),ue=oe(Q,!0);K(Q);var De=de(Q,2);De.__click=function(...Ge){(q()?void 0:()=>ut(Ce,"increment"))?.apply(this,Ge)},K(ie),zt(()=>{Gt(ie,1,`flex items-center justify-center gap-2 rounded-full px-2 ${q()?"opacity-70":""}`),Gt(ee,1,`h-full w-4 ${q()?"":"cursor-pointer"}`),ee.disabled=q()||(Ce==="lower"?w(He)<=l().minNum:w(Ee)<=w(He)),hi(Q,`width: ${w(Ne)}`),lr(ue,Ce==="lower"?w(He):w(Ee)),Gt(De,1,`h-full w-4 ${q()?"":"cursor-pointer"}`),De.disabled=q()||(Ce==="lower"?w(He)>=w(Ee):w(Ee)>=l().maxNum)}),ye(Te,ie)}),ye(Ue,Be)},bt=Ue=>{var Be=Gb(),Se=oe(Be);Se.__click=function(...be){(q()?void 0:()=>ut("single","decrement"))?.apply(this,be)};var Te=de(Se,2),Ce=oe(Te,!0);K(Te);var we=de(Te,2);we.__click=function(...be){(q()?void 0:()=>ut("single","increment"))?.apply(this,be)},K(Be),zt(()=>{Gt(Be,1,`flex items-center justify-center gap-2 rounded-full px-2 ${q()?"opacity-70":""}`),Gt(Se,1,`h-full w-4 ${q()?"":"cursor-pointer"}`),Se.disabled=q()||w(Xe)<=l().minNum,hi(Te,`width: ${w(Ne)}`),lr(Ce,w(Xe)),Gt(we,1,`h-full w-4 ${q()?"":"cursor-pointer"}`),we.disabled=q()||w(Xe)>=l().maxNum}),ye(Ue,Be)};xt(ft,Ue=>{w(Ie)?Ue(gt):Ue(bt,!1)})}K(pt),K(Ke),zt((Ue,Be)=>{Gt(Ke,1,Ue),tr(Oe,"id",Be),Gt(Oe,1,`relative flex h-8 w-full items-center justify-center rounded-full ${q()?"cursor-not-allowed opacity-50":""}`),Gt(pt,1,`mt-3 flex w-full ${w(Ie)?"justify-between":"justify-center"} gap-2`)},[()=>Zr(ir("bg-blue relative flex w-full flex-col items-center ",B())),()=>`${G()}-${crypto.randomUUID().slice(0,6)}`]),ye(I,Ke),vi()}Xi(["input","mousedown","click"]);var Zb=Qe("<h5> </h5>"),Hb=Qe("<span> </span>"),Wb=Qe("<button> </button>"),Xb=Qe("<button> </button>"),Yb=Qe('<div><!> <div class="relative flex w-full grow items-center justify-center bg-transparent"><!> <label><input type="checkbox" class="absolute left-1/2 h-full w-full -translate-x-1/2 cursor-pointer appearance-none rounded-md"/> <span><span></span></span></label> <!></div></div>'),Kb=Qe('<div><!> <div class="flex w-full flex-wrap items-end justify-around gap-5"></div></div>'),Qb=Qe('<div class="absolute bottom-full left-1/2 z-50 mb-2 w-max max-w-xs rounded-md bg-(--container-color) px-3 py-1 text-sm shadow-lg" style="transform: translateX(-50%);"> <div class="absolute top-full left-1/2 h-2 w-2 -translate-x-1/2 -translate-y-1/2 rotate-45 transform bg-(--container-color)"></div></div>'),Jb=Qe("<label> </label>"),$b=Qe(`<div><input type="checkbox" class="
      relative size-8 cursor-pointer appearance-none rounded-2xl border border-(--bg-color)
      bg-white shadow-sm transition duration-200 after:origin-bottom-left after:opacity-0
      checked:border-(--bg-color)
      checked:bg-(--bg-color) checked:after:absolute checked:after:-top-px checked:after:left-[5px]
      checked:after:h-[13.5px] checked:after:w-[7.5px] checked:after:rotate-43
      checked:after:border-2 checked:after:border-t-0
      checked:after:border-l-0 checked:after:border-solid
      checked:after:border-white checked:after:opacity-100
      checked:after:content-[''] hover:shadow-md
      disabled:cursor-not-allowed disabled:opacity-70
    "/> <!> <!></div>`);function Hn(I,_){_i(_,!0);let G=Pt(_,"id",19,()=>crypto.randomUUID()),B=Pt(_,"wrapperClass",3,""),me=Pt(_,"label",19,()=>({name:"",class:"",captionLeft:"",captionRight:""})),ae=Pt(_,"hiddenInfo",3,""),S=Pt(_,"height",3,"2rem"),l=Pt(_,"type",3,"horizontal"),q=Pt(_,"options",19,()=>[]),xe=Pt(_,"bitMode",3,!1),Ie=Pt(_,"value",15),qe=Pt(_,"onChange",3,()=>{}),Ne=Vr(!1),Xe=ne(()=>xe()?q():q().slice(0,1)),He=ne(()=>xe()?w(Xe).map(Oe=>((Ie()??0)&1<<(Oe?.value??0))==Math.pow(2,Oe.value??0)):[Ie()==1]),Ee=ne(()=>`${G()}-${crypto.randomUUID().slice(0,6)}`);vr(()=>{(Ie()===void 0||Ie()===null)&&Ie(0)});const Z=Oe=>{w(Xe)[Oe].disabled||(Ie((Ie()??0)^1<<(w(Xe)[Oe].value??0)),qe()(Ie()))},Ve=Oe=>{w(Xe)[0].disabled||Ie()===Oe||(Ie(Oe),qe()(Oe))},ut=ne(()=>Math.max(me().captionLeft?.length??0,me().captionRight?.length??0)>0?`${Math.max(me().captionLeft?.length??0,me().captionRight?.length??0)}ch`:"auto");var vt=wr(),Ke=$t(vt);{var nt=Oe=>{var Fe=Kb(),lt=oe(Fe);{var Re=ft=>{var gt=Zb(),bt=oe(gt,!0);K(gt),zt(Ue=>{Gt(gt,1,Ue),lr(bt,me().name)},[()=>Zr(ir("w-full px-4 text-center",me().class))]),ye(ft,gt)};xt(lt,ft=>{me().name&&ft(Re)})}var pt=de(lt,2);Er(pt,21,()=>w(Xe),Ur,(ft,gt,bt)=>{var Ue=Yb(),Be=oe(Ue);{var Se=Ge=>{var ot=Hb(),it=oe(ot,!0);K(ot),zt(()=>lr(it,w(gt).name)),ye(Ge,ot)};xt(Be,Ge=>{w(gt).name&&xe()&&Ge(Se)})}var Te=de(Be,2),Ce=oe(Te);{var we=Ge=>{var ot=Wb();ot.__click=()=>Ve(0);var it=oe(ot,!0);K(ot),zt(()=>{Gt(ot,1,`mr-2 ${w(gt).disabled?"opacity-60":"cursor-pointer"}`),hi(ot,`width: ${w(ut)??""}; text-align: end;`),lr(it,me().captionLeft)}),ye(Ge,ot)};xt(Ce,Ge=>{l()==="horizontal"&&me().captionLeft&&Ge(we)})}var be=de(Ce,2),ie=oe(be);Va(ie),ie.__change=()=>Z(bt);var ee=de(ie,2),Q=oe(ee);K(ee),K(be);var ue=de(be,2);{var De=Ge=>{var ot=Xb();ot.__click=()=>Ve(1);var it=oe(ot,!0);K(ot),zt(()=>{Gt(ot,1,`ml-2 ${w(gt).disabled?"opacity-60":"cursor-pointer"}`),hi(ot,`width: ${w(ut)??""}; text-align: start;`),lr(it,me().captionRight)}),ye(Ge,ot)};xt(ue,Ge=>{l()==="horizontal"&&me().captionRight&&Ge(De)})}K(Te),K(Ue),zt((Ge,ot)=>{Gt(Ue,1,Ge),Gt(be,1,`relative flex items-center justify-between rounded-full shadow-sm transition duration-200
      border-(--bg-color)
      ${w(gt).disabled?"opacity-60":"hover:shadow-md"}`),tr(ie,"id",ot),mg(ie,w(He)[bt]),ie.disabled=w(gt).disabled,Gt(ee,1,`relative flex items-center rounded-full border-(--bg-color) transition-all duration-250
        ${w(He)[bt]?"bg-(--bg-color)":"bg-(--back-color)"}
        ${w(gt).disabled?"":"cursor-pointer"}`),hi(ee,`${l()==="horizontal"?"width":"height"}: ${`calc(${S()} * 2)`}; ${l()==="horizontal"?"height":"width"}: ${S()??""};`),Gt(Q,1,`absolute rounded-full transition-all duration-250
                  ${w(He)[bt]?"bg-(--back-color)":"bg-(--bg-color)"}
          ${w(gt).disabled?"opacity-60":"cursor-pointer"}`),hi(Q,`width: ${`calc(${S()} * 0.8)`}; height: ${`calc(${S()} * 0.8)`}; margin: 0 ${`calc(${S()} * 0.1)`}; transform: ${w(He)[bt]?`${l()==="horizontal"?`translateX(calc(${S()}))`:`translateY(calc(-${S()}/2))`}`:`${l()==="horizontal"?"translateX(0)":`translateY(calc(${S()}/2))`}`};`)},[()=>Zr(ir("bg-blue flex flex-col",w(gt).class)),()=>`${G()}-${crypto.randomUUID().slice(0,6)}`]),ye(ft,Ue)}),K(pt),K(Fe),zt(ft=>Gt(Fe,1,ft),[()=>Zr(ir("relative flex w-full flex-col items-center justify-center",B()))]),ye(Oe,Fe)},rt=Oe=>{var Fe=$b(),lt=oe(Fe);Va(lt),lt.__change=()=>Z(0);var Re=de(lt,2);{var pt=bt=>{var Ue=Qb(),Be=oe(Ue);jg(),K(Ue),zt(()=>lr(Be,`${ae()??""} `)),Dn(3,Ue,()=>sd,()=>({y:-15,duration:300})),ye(bt,Ue)};xt(Re,bt=>{w(Ne)&&ae()&&bt(pt)})}var ft=de(Re,2);{var gt=bt=>{var Ue=Jb(),Be=oe(Ue,!0);K(Ue),zt(Se=>{tr(Ue,"for",w(Ee)),Gt(Ue,1,Se),lr(Be,me().name)},[()=>Zr(ir("{disabled ? 'cursor-not-allowed opacity-70' : 'cursor-pointer'} ml-1 select-none",me().class))]),ye(bt,Ue)};xt(ft,bt=>{me().name&&bt(gt)})}K(Fe),zt(bt=>{Gt(Fe,1,bt),tr(lt,"id",w(Ee)),mg(lt,w(He)[0]),lt.disabled=w(Xe)[0].disabled??!1},[()=>Zr(ir(" relative bg-blue m-1 flex items-center justify-center gap-2",B()))]),Sn("mouseenter",lt,()=>{ae()&&St(Ne,!0)}),Sn("mouseleave",lt,()=>{ae()&&St(Ne,!1)}),ye(Oe,Fe)};xt(Ke,Oe=>{l()!=="checkbox"?Oe(nt):Oe(rt,!1)})}ye(I,vt),vi()}Xi(["click","change"]);var e2=$n('<svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="1.5"><path stroke-linecap="round" d="m12 13l3 2m-3-2c-4.48 2.746-7.118 1.78-9 .85c0 2.08.681 3.82 1.696 5.15M12 13l3-4.586M15 15c-.219 2.037-1.573 6.185-4.844 7c-1.815 0-3.988-1.07-5.46-3M15 15l2.598-5m0 0l3.278-6.31a1.166 1.166 0 0 0-.524-1.567a1.174 1.174 0 0 0-1.544.47L15 8.414M17.598 10L15 8.414M4.696 19c1.038.167 3.584.2 5.46-1"></path><path d="m6 4l.221.597c.29.784.435 1.176.72 1.461c.286.286.678.431 1.462.72L9 7l-.597.221c-.784.29-1.176.435-1.461.72c-.286.286-.431.678-.72 1.462L6 10l-.221-.597c-.29-.784-.435-1.176-.72-1.461c-.286-.286-.678-.431-1.462-.72L3 7l.597-.221c.784-.29 1.176-.435 1.461-.72c.286-.286.431-.678.72-1.462z"></path></g></svg>');function t2(I){var _=e2();ye(I,_)}var r2=Qe("<h5> </h5>"),i2=Qe('<div class="flex-1"> </div>'),n2=Qe('<button><span class="flex flex-row items-center justify-center gap-4"><!></span></button>'),o2=Qe('<div class="flex w-[50%] justify-center rounded-full"></div>'),a2=Qe('<button class="inline-block cursor-pointer font-bold transition-transform duration-75 hover:scale-110 active:scale-95">↑↓</button>'),s2=Qe("<div><span> </span> <!></div>"),l2=Qe("<button><!></button>"),c2=Qe("<button> </button>"),u2=Qe('<div class="flex w-full flex-col gap-1"></div>'),h2=Qe("<button> </button>"),d2=Qe('<div class="absolute top-full left-1/2 z-50 -translate-x-1/2 rounded-b-2xl shadow-[0_0_3px_rgb(0_0_0_/0.25)]" style="width: calc(100% - 1.8rem);"></div>'),p2=Qe(`<div class="relative w-full"><button class="w-full rounded-2xl border border-(--blue-color) bg-(--back-color) p-1 text-center shadow-[0_0_3px_rgb(0_0_0_/0.25)] transition duration-200
        cursor-pointer hover:shadow-[0_0_6px_rgb(0_0_0_/0.25)]"> </button> <!></div>`),f2=Qe('<img loading="lazy"/>'),m2=Qe('<div class="flex items-center justify-center"><!></div>'),g2=Qe('<button class="w-full cursor-pointer overflow-hidden text-left text-ellipsis whitespace-nowrap"><!></button>'),_2=Qe('<div class="absolute top-1/2 right-3.5 -translate-y-1/2 transform rounded-md bg-(--green-color) px-1.5 py-1 shadow-lg">✓</div>'),v2=$n('<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M6 11c0-2.828 0-4.243.879-5.121C7.757 5 9.172 5 12 5h3c2.828 0 4.243 0 5.121.879C21 6.757 21 8.172 21 11v5c0 2.828 0 4.243-.879 5.121C19.243 22 17.828 22 15 22h-3c-2.828 0-4.243 0-5.121-.879C6 20.243 6 18.828 6 16z"></path><path d="M6 19a3 3 0 0 1-3-3v-6c0-3.771 0-5.657 1.172-6.828S7.229 2 11 2h4a3 3 0 0 1 3 3"></path></g></svg>'),y2=Qe('<button class="mx-2 flex cursor-pointer border-none bg-transparent text-2xl" aria-label="Копировать текст"><div class="size-5 text-sm [&amp;_svg]:h-full [&amp;_svg]:max-h-full [&amp;_svg]:w-full [&amp;_svg]:max-w-full"><!></div></button>'),x2=Qe('<div role="columnheader"><!></div> <!>',1),b2=Qe("<div><!></div>"),w2=Qe('<div class="flex-1 overflow-y-auto bg-(--container-color)/50 relative"><div class="grid min-w-0"></div></div>'),T2=Qe('<div class="fixed z-50 w-max max-w-[30%] break-all rounded-md px-2 py-1 text-left text-sm whitespace-pre-wrap shadow-lg" role="tooltip"><!></div>'),C2=Qe('<div class="flex h-8 items-center justify-center bg-(--bg-color)"><h5> </h5></div>'),S2=Qe("<div><!> <!> <div><div></div> <!> <!> <!> <!></div></div>");function pw(I,_){_i(_,!0);const G=()=>vn(po,"$t",B),[B,me]=Mo();let ae=Pt(_,"id",19,()=>crypto.randomUUID()),S=Pt(_,"wrapperClass",3,""),l=Pt(_,"label",19,()=>({name:"",class:""})),q=Pt(_,"body",15),xe=Pt(_,"header",23,()=>[]),Ie=Pt(_,"footer",3,""),qe=Pt(_,"dataBuffer",19,()=>({stashData:!1,rowsAmmount:10,clearButton:!1,clearClass:""})),Ne=Pt(_,"type",3,"table"),Xe=Pt(_,"outline",3,!1),He=Pt(_,"cursor",3,null),Ee=Pt(_,"autoscroll",3,!1),Z=Pt(_,"getData",3,()=>{}),Ve=Pt(_,"modalData",15),ut={key:null,direction:null},vt=Vr(!1),Ke=Vr(null),nt=Vr(Na([]));const rt=[{id:crypto.randomUUID(),name:"Error",value:"error",color:"bg-(--red-color)"},{id:crypto.randomUUID(),name:"Warning",value:"warning",color:"bg-(--yellow-color)"},{id:crypto.randomUUID(),name:"Info",value:"info",color:"bg-(--gray-color)"}];let Oe=Vr(Na(["error","warning"])),Fe=Vr(null),lt=Vr(null),Re=Vr(Na({show:!1,text:"",x:0,y:0})),pt=ne(()=>w(Ke)?w(Ke).scrollHeight>w(Ke).clientHeight:!1);const ft=async()=>{St(nt,[],!0)},gt=Et=>{ut.key===Et?ut.direction=ut.direction==="asc"?"desc":"asc":(ut.key=Et,ut.direction="asc"),q([...q()].sort((Ot,ar)=>{const ur=Ot[Et],Ar=ar[Et];if(typeof ur=="number"&&typeof Ar=="number")return ut.direction==="asc"?ur-Ar:Ar-ur;if(ur instanceof Date&&Ar instanceof Date)return ut.direction==="asc"?ur.getTime()-Ar.getTime():Ar.getTime()-ur.getTime();const Cr=String(ur).toLowerCase(),pr=String(Ar).toLowerCase(),Rr=Cr.match(/\d+/g)?.[0]||"",Pr=pr.match(/\d+/g)?.[0]||"";if(Rr&&Pr){const ce=parseInt(Rr,10)-parseInt(Pr,10);if(ce!==0)return ut.direction==="asc"?ce:-ce}const yr=Cr.localeCompare(pr);return ut.direction==="asc"?yr:-yr}))},bt=()=>{if(!w(Ke))return;const{scrollTop:Et,clientHeight:Ot,scrollHeight:ar}=w(Ke);Et+Ot>=ar-50&&He()!==null&&_.loader&&!cy(_.loader)&&Z()()},Ue=()=>{w(Ke)&&St(vt,!(w(Ke).scrollHeight-w(Ke).scrollTop<=w(Ke).clientHeight+50))},Be=()=>{!w(vt)&&w(Ke)&&(w(Ke).scrollTop=w(Ke).scrollHeight)};vr(()=>{Ee()&&w(nt)&&w(nt).length>0&&Be()});const Se=(Et,Ot)=>{if(Ot.onClick)Ot.onClick(Et);else if(Ot.eventHandler&&_.onClick){let ar={};Ot.eventHandler.Variables.forEach(ur=>{xe().some(Ar=>Ar.key===ur&&Ar.action?.type==="select")?ar[ur]=Et[ur][0]:ar[ur]=Et[ur]}),Ot.eventHandler.Value=JSON.stringify(ar),_.onClick(Ot.eventHandler)}},Te=(Et,Ot,ar,ur)=>{ur.stopPropagation();let Ar=q()[Et][Ot];St(Fe,null),Ar&&q([...q()].map((Cr,pr)=>pr===Et?Cr={...Cr,[Ot]:[ar.value,...Ar.filter(Rr=>Rr!==ar.value)]}:Cr))},Ce=async(Et,Ot)=>{Ve({isOpen:!0,rawData:Et,formattedData:Ot?Ot(Et):Et??""})},we=(Et,Ot,ar)=>{St(Re,{show:!0,text:ar?ar(Ot):Ot??"",x:Et.clientX,y:Et.clientY},!0)},be=()=>{w(Re).show=!1},ie=(Et,Ot)=>!!(typeof Et.image?.src=="function"?Et.image.src(Ot):Et.image?.src);vr(()=>{(async()=>(Ne()==="logger"&&xe([{key:"color",label:{name:"Type"},width:"3rem"},{key:"data",label:{name:"Data"},width:"calc(100% - 3rem)"}]),await $h(),St(pt,w(Ke)?w(Ke).scrollHeight>w(Ke).clientHeight:!1),()=>St(nt,[],!0)))()}),vr(()=>{(async()=>{if(q()&&Ne()=="logger"){if(Array.isArray(q()))for(let Et=0;Et<q().length;Et++)St(nt,[...w(nt),{type:Object.entries(q()[Et])[0][1],color:`<div class='size-6 rounded-full ${rt.find(Ot=>Ot.value==Object.entries(q()[Et])[0][1])?.color}'></div>`,data:Object.entries(q()[Et])[1][1]}],!0);else St(nt,[...w(nt),{type:Object.entries(q())[0][1],color:`<div class='size-6 rounded-full ${rt.find(Et=>Et.value==Object.entries(q())[0][1])?.color}'></div>`,data:Object.entries(q())[1][1]}],!0);qe()&&w(nt).length>(qe().rowsAmmount??10)&&St(nt,w(nt).slice(-(qe().rowsAmmount??10)),!0),q(null),await $h(),St(pt,w(Ke)?w(Ke).scrollHeight>w(Ke).clientHeight:!1)}})()}),vr(()=>{(async()=>{if(q()&&qe().stashData&&Ne()=="table"){if(Array.isArray(q()))for(let Et=0;Et<q().length;Et++)St(nt,[...w(nt),q()[Et]],!0);else St(nt,[...w(nt),q()],!0);w(nt).length>(qe().rowsAmmount??10)&&St(nt,w(nt).slice(-(qe().rowsAmmount??10)),!0),q(null),await $h(),St(pt,w(Ke)?w(Ke).scrollHeight>w(Ke).clientHeight:!1)}})()}),vu(()=>(Ee()&&(w(Ke)?.addEventListener("scroll",Ue),Be()),St(pt,w(Ke)?w(Ke).scrollHeight>w(Ke).clientHeight:!1),Ne()==="logger"&&xe([{key:"color",label:{name:"Type"},width:"3rem"},{key:"data",label:{name:"Data"},width:"calc(100% - 3rem)"}]),()=>{Ee()&&w(Ke)?.removeEventListener("scroll",Ue)}));var ee={clearBuffer:ft},Q=S2(),ue=oe(Q);{var De=Et=>{var Ot=r2(),ar=oe(Ot,!0);K(Ot),zt(ur=>{Gt(Ot,1,ur),lr(ar,l().name)},[()=>Zr(ir("w-full px-4 text-center",l().class))]),ye(Et,Ot)};xt(ue,Et=>{l().name&&Et(De)})}var Ge=de(ue,2);{var ot=Et=>{var Ot=o2();Er(Ot,21,()=>rt,Ur,(ar,ur,Ar)=>{var Cr=n2();tr(Cr,"id",crypto.randomUUID()),Cr.__click=()=>{w(Oe).includes(w(ur).value)?St(Oe,w(Oe).filter(yr=>yr!==w(ur).value),!0):w(Oe).push(w(ur).value)};var pr=oe(Cr),Rr=oe(pr);{var Pr=yr=>{var ce=i2(),R=oe(ce,!0);K(ce),zt(()=>lr(R,w(ur).name)),ye(yr,ce)};xt(Rr,yr=>{w(ur)&&yr(Pr)})}K(pr),K(Cr),zt(yr=>Gt(Cr,1,yr),[()=>Zr(ir(`m-0 inline-block min-w-0 flex-1 cursor-pointer items-center px-2 py-1 font-semibold shadow-sm transition-all duration-300
            select-none hover:shadow-md
            ${w(Oe).includes(w(ur).value)&&w(Oe)!==null?"z-10 py-1 shadow-[0_0_10px_var(--shadow-color)] hover:shadow-[0_0_15px_var(--shadow-color)]":""}  
            ${rt.length>0&&Ar===0?"rounded-l-2xl":""} ${Ar===rt.length-1?"rounded-r-2xl":""} ${w(ur).color}`))]),ye(ar,Cr)}),K(Ot),zt(ar=>tr(Ot,"id",ar),[()=>`${ae()}-${crypto.randomUUID().slice(0,6)}`]),ye(Et,Ot)};xt(Ge,Et=>{Ne()=="logger"&&Et(ot)})}var it=de(Ge,2),It=oe(it);Er(It,22,xe,Et=>Et,(Et,Ot,ar)=>{var ur=s2(),Ar=oe(ur),Cr=oe(Ar,!0);K(Ar);var pr=de(Ar,2);{var Rr=Pr=>{var yr=a2();yr.__click=()=>gt(Ot.key),ye(Pr,yr)};xt(pr,Pr=>{Ot.sortable&&Pr(Rr)})}K(ur),zt(Pr=>{Gt(ur,1,Pr),lr(Cr,Ot.label?.name)},[()=>Zr(ir(`items-center justify-center flex border-l ${Xe()&&w(ar)!==0?" border-(--border-color)":"border-transparent"} 
            ${Ot.align==="center"?"justify-center text-center":Ot.align==="right"?"justify-end text-right":"justify-start text-left"} gap-1 bg-(--bg-color) p-2 text-left`,Ot.label?.class))]),ye(Et,ur)}),K(It);var Rt=de(It,2);{var Ft=Et=>{var Ot=l2();Ot.__click=ft;var ar=oe(Ot);t2(ar),K(Ot),zt(ur=>Gt(Ot,1,ur),[()=>Zr(ir("absolute right-2 bg-(--back-color) rounded-full p-1 cursor-pointer [&_svg]:h-full [&_svg]:max-h-full [&_svg]:w-full [&_svg]:max-w-full",qe().clearClass))]),ye(Et,Ot)};xt(Rt,Et=>{qe().clearButton&&Et(Ft)})}var Kt=de(Rt,2);{var Yt=Et=>{const Ot=ne(()=>Ne()=="logger"?w(nt).filter(Ar=>w(Oe).includes(Ar.type)).slice(-(qe().rowsAmmount??10)):qe().stashData?w(nt).slice(-(qe().rowsAmmount??10)):q());var ar=w2(),ur=oe(ar);Er(ur,22,()=>w(Ot),Ar=>Ar,(Ar,Cr,pr)=>{var Rr=wr(),Pr=$t(Rr);Er(Pr,18,xe,yr=>yr,(yr,ce,R)=>{var O=b2(),V=oe(O);{var se=Le=>{var Ae=u2();Er(Ae,20,()=>ce.action?.buttons,Pe=>Pe,(Pe,ze)=>{var dt=c2();dt.__click=()=>Se(Cr,ze);var ke=oe(dt,!0);K(dt),zt((et,pe)=>{Gt(dt,1,`${et??""} bg-(--bg-color)`),lr(ke,pe)},[()=>ir(`cursor-pointer rounded-full 
                           px-4 py-1 font-semibold shadow-sm transition-shadow duration-200 outline-none select-none hover:shadow-md
                          ${typeof ze.class=="function"?ze.class(Cr):ze.class}`),()=>typeof ze.name=="function"?ze.name(Cr):ze.name]),ye(Pe,dt)}),K(Ae),ye(Le,Ae)},_e=Le=>{var Ae=wr(),Pe=$t(Ae);{var ze=ke=>{const et=ne(()=>Array.isArray(Cr[ce.key])?Cr[ce.key].map(Ht=>({id:crypto.randomUUID(),value:Ht,name:Ht})):[]);var pe=p2(),Lt=oe(pe);Lt.__click=()=>St(Fe,w(Fe)?.x===w(R)&&w(Fe).y===w(pr)?null:{x:w(R),y:w(pr)},!0);var cr=oe(Lt,!0);K(Lt);var Bt=de(Lt,2);{var qt=Ht=>{var zr=d2();Er(zr,23,()=>w(et),Ir=>Ir.id,(Ir,hr,xr)=>{var dr=h2();dr.__click=Je=>Te(w(pr),ce.key,w(hr),Je);var fr=oe(dr,!0);K(dr),zt((Je,Dr)=>{tr(dr,"id",w(hr).id),gu(dr,Je),Gt(dr,1,Dr),lr(fr,w(hr).name)},[()=>w(hr)?.value?String(w(hr).value):"",()=>Zr(ir(`flex h-full w-full cursor-pointer items-center justify-center p-1 inset-shadow-[0_10px_10px_-15px_rgb(0_0_0_/0.5)] duration-250 hover:bg-(--field-color)! bg-(--back-color)
              ${w(xr)===w(et).length-1?"rounded-b-2xl":""}`,w(hr).class))]),ye(Ir,dr)}),K(zr),Dn(3,zr,()=>_u,()=>({duration:250})),ye(Ht,zr)};xt(Bt,Ht=>{w(Fe)?.x===w(R)&&w(Fe).y===w(pr)&&Ht(qt)})}K(pe),zt(Ht=>lr(cr,Ht),[()=>w(et)[0]?.name||G()("common.select_tag")]),ye(ke,pe)},dt=ke=>{var et=wr(),pe=$t(et);{var Lt=Bt=>{var qt=m2(),Ht=oe(qt);{var zr=hr=>{var xr=f2();zt((dr,fr)=>{tr(xr,"src",dr),tr(xr,"alt",ce.image.alt??"Image"),Gt(xr,1,fr)},[()=>typeof ce.image?.src=="function"?ce.image.src(Cr):ce.image?.src||"",()=>Zr(ir(`h-full w-full object-cover ${ce.image.class||""}`))]),ye(hr,xr)},Ir=hr=>{var xr=wr(),dr=$t(xr);{var fr=Je=>{var Dr=wr(),li=$t(Dr);{var Ji=wt=>{var rr=wr(),br=$t(rr);Wi(br,()=>ce.image.defaultIcon),ye(wt,rr)},Kr=wt=>{var rr=wr(),br=$t(rr);st(br,()=>ce.image.defaultIcon,(oi,$i)=>{$i(oi,{})}),ye(wt,rr)};xt(li,wt=>{typeof ce.image.defaultIcon=="string"?wt(Ji):wt(Kr,!1)})}ye(Je,Dr)};xt(dr,Je=>{ce.image.defaultIcon&&Je(fr)},!0)}ye(hr,xr)};xt(Ht,hr=>{ie(ce,Cr)?hr(zr):hr(Ir,!1)})}K(qt),zt(()=>hi(qt,`width: ${ce.image.width||"5rem"}; height: ${ce.image.height||"5rem"};`)),ye(Bt,qt)},cr=Bt=>{var qt=x2(),Ht=$t(qt);Ht.__mousemove=function(...fr){(ce.overflow?.truncated?Je=>{w(Re).x=Je.clientX,w(Re).y=Je.clientY}:void 0)?.apply(this,fr)},tr(Ht,"tabindex",null);var zr=oe(Ht);{var Ir=fr=>{var Je=g2();Je.__click=li=>{li.stopPropagation(),Ce(Cr[ce.key],ce.overflow?.formatting)};var Dr=oe(Je);Wi(Dr,()=>Cr[ce.key]),K(Je),ye(fr,Je)},hr=fr=>{var Je=wr(),Dr=$t(Je);Wi(Dr,()=>Cr[ce.key]),ye(fr,Je)};xt(zr,fr=>{ce.overflow?.modal?fr(Ir):fr(hr,!1)})}K(Ht);var xr=de(Ht,2);{var dr=fr=>{var Je=y2();Je.__click=wt=>{wt.preventDefault(),navigator.clipboard.writeText(Cr[ce.key]),St(lt,{x:w(R),y:w(pr)},!0),setTimeout(()=>St(lt,null),1e3)};var Dr=oe(Je),li=oe(Dr);{var Ji=wt=>{var rr=_2();Dn(3,rr,()=>ad,()=>({duration:200})),ye(wt,rr)},Kr=wt=>{var rr=v2();ye(wt,rr)};xt(li,wt=>{w(lt)?.y===w(pr)&&w(lt).x===w(R)?wt(Ji):wt(Kr,!1)})}K(Dr),K(Je),ye(fr,Je)};xt(xr,fr=>{ce.overflow?.copy&&fr(dr)})}zt(()=>Gt(Ht,1,` w-full max-w-full wrap-break-word ${ce.overflow?.truncated?"truncate":" whitespace-normal"}`)),Sn("mouseenter",Ht,function(...fr){(ce.overflow?.truncated?Je=>we(Je,Cr[ce.key],ce.overflow?.formatting):void 0)?.apply(this,fr)}),Sn("mouseleave",Ht,function(...fr){(ce.overflow?.truncated?be:void 0)?.apply(this,fr)}),ye(Bt,qt)};xt(pe,Bt=>{ce.image?.src||ce.image?.defaultIcon?Bt(Lt):Bt(cr,!1)},!0)}ye(ke,et)};xt(Pe,ke=>{ce.action?.type=="select"&&ce.action?.select?ke(ze):ke(dt,!1)},!0)}ye(Le,Ae)};xt(V,Le=>{ce.action?.type=="buttons"&&ce.action?.buttons?Le(se):Le(_e,!1)})}K(O),zt(()=>Gt(O,1,`relative flex w-full min-w-0 items-center px-2 py-1 wrap-break-word
              ${w(pr)%2?"bg-(--back-color)/40":"bg-[#edeef3] dark:bg-[#1f2a3a]"}
              ${ce.align==="center"?"justify-center text-center":ce.align==="right"?"justify-end text-right":"justify-start text-left"}
              border-t ${w(R)!==0?" border-l ":""} ${Xe()?"border-(--border-color)":"border-transparent"}`)),ye(yr,O)}),ye(Ar,Rr)}),K(ur),K(ar),Zl(ar,Ar=>St(Ke,Ar),()=>w(Ke)),zt(Ar=>hi(ur,Ar),[()=>`grid-template-columns: ${xe().map(Ar=>Ar.width||"minmax(0, 1fr)").join(" ")};`]),Sn("scroll",ar,bt),ye(Et,ar)};xt(Kt,Et=>{(q()||w(nt))&&Et(Yt)})}var Tr=de(Kt,2);{var Qt=Et=>{var Ot=T2(),ar=oe(Ot);Wi(ar,()=>w(Re).text),K(Ot),zt(()=>hi(Ot,`background: color-mix(in srgb, var(--yellow-color) 30%, var(--back-color)); transform: translateX(-50%); 
        left: ${w(Re).x+10}px; top: ${w(Re).y+10}px;`)),Dn(3,Ot,()=>sd,()=>({y:10,duration:200})),ye(Et,Ot)};xt(Tr,Et=>{w(Re).show&&Et(Qt)})}var Mt=de(Tr,2);{var Xt=Et=>{var Ot=C2(),ar=oe(Ot),ur=oe(ar,!0);K(ar),K(Ot),zt(()=>lr(ur,Ie())),ye(Et,Ot)};xt(Mt,Et=>{Ie()&&Et(Xt)})}K(it),K(Q),zt((Et,Ot,ar)=>{tr(Q,"id",Et),Gt(Q,1,Ot),Gt(it,1,`relative flex h-full w-full flex-col overflow-hidden rounded-xl border shadow-sm transition duration-200 hover:shadow-md
    ${Xe()?" border-(--border-color)":"border-transparent"} `),Gt(It,1,`grid font-semibold ${w(pt)?"border-r-8 border-(--bg-color)":""}`),hi(It,ar)},[()=>`${ae()}-${crypto.randomUUID().slice(0,6)}`,()=>Zr(ir(`bg-blue flex h-full w-full items-center ${Ne()=="logger"?"gap-2":""} flex-col overflow-hidden`,S())),()=>`grid-template-columns: ${xe().map(Et=>Et.width||"minmax(0, 1fr)").join(" ")};`]),ye(I,Q);var Sr=vi(ee);return me(),Sr}Xi(["click","mousemove"]);var P2=Qe('<div class="ml-14 flex items-end justify-between gap-2"><!> <!> <!> <!> <!></div>'),I2=Qe('<div class="flex items-end justify-between gap-2"><!></div>'),M2=Qe('<hr class="border-(--border-color) py-2"/> <div class="relative flex w-full justify-center"><!> <!> <!></div> <div class="mb-5 rounded-lg p-1"><!></div> <hr class="border-(--border-color) py-2"/>',1),E2=Qe('<div class="mr-2 grid grid-cols-[minmax(5rem,10rem)_1fr_minmax(5rem,10rem)_minmax(10rem,21rem)_6rem_6rem_2rem_2rem] items-end gap-6"><!> <!> <!> <!> <!> <!> <!> <!></div> <!>',1),A2=Qe('<hr class="border-(--border-color)"/> <div><div class=" flex items-center justify-center gap-2"><h4> </h4> <!></div> <!></div>',1),k2=Qe('<div class="relative flex flex-row items-start justify-center pb-4"><div class="flex w-1/3 flex-col px-2"><!> <!> <!></div> <div class="flex w-1/3 flex-col px-2"><!> <!></div> <div class="flex w-1/3 flex-col px-2"><!> <!> <!></div></div> <!>',1),z2=Qe('<div class="ml-14 flex items-end justify-between gap-2"><!> <!> <!> <!> <!></div>'),D2=Qe('<div class="flex items-end justify-between gap-2"><!></div>'),L2=Qe('<hr class="border-(--border-color) py-2"/> <div class="relative flex w-full justify-center"><!> <!> <!></div> <div class="mb-5 rounded-lg p-1"><!></div>',1),R2=Qe('<div class="rounded-2xl border border-(--border-color) p-2"><div class="mb-5"><div class="mr-2 grid grid-cols-[minmax(5rem,10rem)_1fr_minmax(5rem,10rem)_minmax(10rem,21rem)_6rem_6rem_2rem_2rem] items-end gap-6"><!> <!> <!> <!> <!> <!> <!> <!></div> <div class="mr-2 grid grid-cols-[5rem_minmax(8rem,16rem)_1fr_minmax(8rem,12rem)_minmax(8rem,12rem)] items-end justify-between gap-6"><!> <div class="relative mt-6 flex items-center w-full gap-2"><!> <!></div> <!> <!> <!></div></div> <!></div>'),F2=Qe('<button class="h-8 w-8 cursor-pointer [&amp;_svg]:h-full [&amp;_svg]:max-h-full [&amp;_svg]:w-full [&amp;_svg]:max-w-full"><!></button>'),O2=Qe('<div class="relative m-1.5 rounded-xl border-2 border-(--border-color) p-3"><div class="absolute -top-3.5 bg-(--back-color) px-1"> </div> <div class="grid grid-cols-3 place-items-center gap-2"></div></div>'),B2=Qe('<div class="grid grid-cols-3"></div>'),N2=Qe('<div class="relative flex flex-row items-start justify-center pb-4"><div class="flex w-1/3 flex-col px-2"><!> <!> <!> <!></div> <div class="flex w-1/3 flex-col px-2"><!> <!> <!> <!></div> <div class="flex w-1/3 flex-col px-2"><!> <div class="flex"><!> <!></div> <!></div></div> <hr class="border-(--border-color)"/> <div><div class=" flex items-center justify-center gap-2"><h4> </h4> <!></div> <div class="flex flex-col gap-2"><!> <!></div></div>',1);function fw(I,_){_i(_,!0);const G=()=>vn(Yl,"$optionsStore",me),B=()=>vn(po,"$t",me),[me,ae]=Mo(),S=Pt(_,"forConstructor",3,!0),l=yu("DeviceVariables");let q=ne(()=>l&&Array.isArray(l)?l:[]),xe=ne(()=>({isModalOpen:!1,columnIndex:0,column:_.component.properties.header?_.component.properties.header[0]:""}));const Ie=ne(()=>G().COLOR_OPTIONS.find(rt=>rt.value.includes(_.component.properties.wrapperClass?.split(" ").find(Oe=>Oe.startsWith("bg-"))))),qe=ne(()=>G().TEXT_ALIGN_OPTIONS.find(rt=>rt.value.includes(_.component.properties.label?.class?.split(" ").find(Oe=>Oe.startsWith("text-"))))),Ne=(rt,Oe,Fe)=>{const lt=[..._.component.properties.header];lt[rt]={...lt[rt],[Oe]:Fe},Tt("header",lt,_.component,_.onPropertyChange)},Xe=(rt,Oe)=>{let Fe;if(rt)if(Fe=[],Oe)Fe.push({loglevel:"error",payload:"error log"}),Fe.push({loglevel:"warning",payload:"warning log"}),Fe.push({loglevel:"info",payload:"info log"});else{const lt={};_.component.properties.header.forEach(Re=>{const pt=Re.key;lt[pt]=`Value of ${pt}`}),Fe.push(lt),Fe.push(lt)}else Fe=_.component.properties.body.map(lt=>{const Re={};return _.component.properties.header.forEach(pt=>{const ft=pt.key;Re[ft]=lt[ft]??`Value of ${ft}`}),Re});Tt("body",Fe,_.component,_.onPropertyChange)},He=(rt,Oe,Fe,lt)=>{const Re=[..._.component.properties.header],pt=[...Re[rt].action.buttons];pt[Oe]={...pt[Oe],[Fe]:lt},Re[rt].action.buttons=pt,Tt("header",Re,_.component,_.onPropertyChange)},Ee=(rt,Oe,Fe)=>{const lt=[..._.component.properties.header];let Re=lt[rt].action.select;Re={...Re,[Oe]:Fe},lt[rt].action.select=Re,Tt("header",lt,_.component,_.onPropertyChange)},Z=(rt,Oe)=>{const Fe=[..._.component.properties.header],lt=[...Fe[rt].action.buttons];lt.splice(Oe,1),Fe[rt].action.buttons=lt.length?lt:void 0,Tt("header",Fe,_.component,_.onPropertyChange)},Ve=rt=>{const Oe={name:`button${(_.component.properties.header[rt].action.buttons?_.component.properties.header[rt].action.buttons.length:0)+1}`,class:"bg-blue",eventHandler:{Header:"SET",Argument:"Save",Variables:[]},onClick:()=>{}};let Fe={..._.component.properties.header[rt].action};if(!Fe)Fe={type:"buttons",buttons:[Oe],select:{key:"",onChange:()=>{}}};else if(Fe.type==="buttons"){const lt=[...Fe.buttons||[],Oe];Fe={...Fe,buttons:lt}}else Fe={type:"buttons",buttons:[Oe],select:Fe.select};Ne(rt,"action",Fe)};var ut=wr(),vt=$t(ut);{var Ke=rt=>{var Oe=k2(),Fe=$t(Oe),lt=oe(Fe),Re=oe(lt);{let ee=ne(()=>({name:B()("constructor.props.variable")})),Q=ne(()=>w(q).find(ue=>ue.value===_.component.properties.id));st(Re,()=>Nr,(ue,De)=>{De(ue,{get label(){return w(ee)},get options(){return w(q)},get value(){return w(Q)},onUpdate:Ge=>{Tt("id",Ge.value,_.component,_.onPropertyChange),_.onPropertyChange({name:Ge.name?.split("—")[1].trim(),eventHandler:{Variables:[Ge.value]}})}})})}var pt=de(Re,2);{let ee=ne(()=>({name:B()("constructor.props.access")})),Q=ne(()=>G().ACCESS_OPTION.find(ue=>ue.value===_.component.access));st(pt,()=>Nr,(ue,De)=>{De(ue,{get label(){return w(ee)},type:"buttons",get options(){return G().ACCESS_OPTION},get value(){return w(Q)},onUpdate:Ge=>_.onPropertyChange({access:Ge.value})})})}var ft=de(pt,2);{let ee=ne(()=>({name:B()("constructor.props.table.type")})),Q=ne(()=>G().TABLE_TYPE_OPTIONS.find(ue=>ue.value===_.component.properties.type));st(ft,()=>Nr,(ue,De)=>{De(ue,{get label(){return w(ee)},type:"buttons",get options(){return G().TABLE_TYPE_OPTIONS},get value(){return w(Q)},onUpdate:Ge=>{Ge.value==="logger"?(Tt("dataBuffer.stashData",!0,_.component,_.onPropertyChange),Tt("dataBuffer.clearButton",!0,_.component,_.onPropertyChange),Tt("header",[{key:"color",label:{name:"Type"},width:"3rem"},{key:"data",label:{name:"Data"},width:"calc(100% - 3rem)"}],_.component,_.onPropertyChange),Xe(!0,!0)):(Tt("dataBuffer.stashData",!1,_.component,_.onPropertyChange),Tt("dataBuffer.clearButton",!1,_.component,_.onPropertyChange),Tt("header",[{key:"id",label:{name:"ID"},width:"40%",sortable:!0,image:{width:"0rem",height:"0rem"},align:"left"},{key:"device",label:{name:"Device"},width:"60%",sortable:!1,image:{width:"0rem",height:"0rem"},align:"left",overflow:{truncated:!0}}],_.component,_.onPropertyChange),Xe(!0,!1)),Tt("type",Ge.value,_.component,_.onPropertyChange)}})})}K(lt);var gt=de(lt,2),bt=oe(gt);{let ee=ne(()=>({name:B()("constructor.props.colors")}));st(bt,()=>Nr,(Q,ue)=>{ue(Q,{wrapperClass:"!h-14",get label(){return w(ee)},type:"buttons",get options(){return G().COLOR_OPTIONS},get value(){return w(Ie)},onUpdate:De=>Tt("wrapperClass",ir(_.component.properties.wrapperClass,De.value),_.component,_.onPropertyChange)})})}var Ue=de(bt,2);{let ee=ne(()=>({name:B()("constructor.props.outline")}));st(Ue,()=>Hn,(Q,ue)=>{ue(Q,{get label(){return w(ee)},get value(){return _.component.properties.outline},options:[{id:crypto.randomUUID(),value:0,class:""}],onChange:De=>Tt("outline",De,_.component,_.onPropertyChange)})})}K(gt);var Be=de(gt,2),Se=oe(Be);{let ee=ne(()=>({name:B()("constructor.props.label")}));st(Se,()=>_r,(Q,ue)=>{ue(Q,{get label(){return w(ee)},get value(){return _.component.properties.label.name},onUpdate:De=>Tt("label.name",De,_.component,_.onPropertyChange)})})}var Te=de(Se,2);{let ee=ne(()=>({name:B()("constructor.props.align")}));st(Te,()=>Nr,(Q,ue)=>{ue(Q,{get label(){return w(ee)},type:"buttons",get value(){return w(qe)},get options(){return G().TEXT_ALIGN_OPTIONS},onUpdate:De=>Tt("label.class",ir(_.component.properties.label.class,De.value),_.component,_.onPropertyChange)})})}var Ce=de(Te,2);{var we=ee=>{var Q=wr(),ue=$t(Q);{let De=ne(()=>({name:B()("constructor.props.table.buffersize")})),Ge=ne(()=>G().BUFFER_SIFE_OPTIONS.find(ot=>ot.value===_.component.properties.dataBuffer.rowsAmmount));st(ue,()=>Nr,(ot,it)=>{it(ot,{get label(){return w(De)},type:"buttons",get options(){return G().BUFFER_SIFE_OPTIONS},get value(){return w(Ge)},onUpdate:It=>Tt("dataBuffer.rowsAmmount",It.value,_.component,_.onPropertyChange)})})}ye(ee,Q)};xt(Ce,ee=>{_.component.properties.dataBuffer.stashData&&ee(we)})}K(Be),K(Fe);var be=de(Fe,2);{var ie=ee=>{var Q=A2(),ue=de($t(Q),2),De=oe(ue),Ge=oe(De),ot=oe(Ge,!0);K(Ge);var it=de(Ge,2);{let Rt=ne(()=>({icon:Ba}));st(it,()=>jr,(Ft,Kt)=>{Kt(Ft,{wrapperClass:"w-8",get content(){return w(Rt)},onClick:()=>{const Yt={key:`column${(_.component.properties.header?.length||0)+1}`,label:{name:`Column ${(_.component.properties.header?.length||0)+1}`,class:""},width:"10%",sortable:!1},Tr=[..._.component.properties.header||[],Yt];Tt("header",Tr,_.component,_.onPropertyChange),Tr.forEach(Qt=>{Ne(Tr.indexOf(Qt),"width",`${(100/Tr.length).toFixed(2)}%`)}),Xe()}})})}K(De);var It=de(De,2);Er(It,17,()=>_.component.properties.header,Ur,(Rt,Ft,Kt)=>{var Yt=E2(),Tr=$t(Yt),Qt=oe(Tr);{let pr=ne(()=>({name:B()("constructor.props.table.columns.key")}));st(Qt,()=>_r,(Rr,Pr)=>{Pr(Rr,{get label(){return w(pr)},get value(){return w(Ft).key},help:{regExp:/^[0-9a-zA-Z_-]{0,16}$/},onUpdate:yr=>{Ne(Kt,"key",yr),Xe()}})})}var Mt=de(Qt,2);{let pr=ne(()=>({name:B()("constructor.props.table.columns.label")}));st(Mt,()=>_r,(Rr,Pr)=>{Pr(Rr,{get label(){return w(pr)},get value(){return w(Ft).label.name},onUpdate:yr=>{Ne(Kt,"label",{name:yr})}})})}var Xt=de(Mt,2);{let pr=ne(()=>({name:B()("constructor.props.table.columns.width")})),Rr=ne(()=>Number(w(Ft).width.replace("%","")));st(Xt,()=>_r,(Pr,yr)=>{yr(Pr,{get label(){return w(pr)},type:"number",get value(){return w(Rr)},onUpdate:ce=>Ne(Kt,"width",`${ce}%`)})})}var Sr=de(Xt,2);{let pr=ne(()=>({name:B()("constructor.props.align.content")})),Rr=ne(()=>G().ALIGN_OPTIONS.find(Pr=>Pr.value.includes(w(Ft).align)));st(Sr,()=>Nr,(Pr,yr)=>{yr(Pr,{get label(){return w(pr)},type:"buttons",get value(){return w(Rr)},get options(){return G().ALIGN_OPTIONS},onUpdate:ce=>Ne(Kt,"align",ce.value)})})}var Et=de(Sr,2);{let pr=ne(()=>({name:B()("constructor.props.table.columns.sortable"),class:"px-0"}));st(Et,()=>Hn,(Rr,Pr)=>{Pr(Rr,{get label(){return w(pr)},options:[{id:crypto.randomUUID(),value:0,class:""}],get value(){return w(Ft).sortable},onChange:yr=>Ne(Kt,"sortable",yr)})})}var Ot=de(Et,2);{let pr=ne(()=>({name:B()("constructor.props.copy"),class:"px-0"})),Rr=ne(()=>w(Ft).overflow?.copy);st(Ot,()=>Hn,(Pr,yr)=>{yr(Pr,{get label(){return w(pr)},options:[{id:crypto.randomUUID(),value:0,class:""}],get value(){return w(Rr)},onChange:ce=>Ne(Kt,"overflow",{copy:ce})})})}var ar=de(Ot,2);{let pr=ne(()=>w(Ft).action&&w(Ft).action.type!="none"?"invisible":""),Rr=ne(()=>({icon:Ba,info:{text:B()("constructor.props.table.addaction"),side:"top"}}));st(ar,()=>jr,(Pr,yr)=>{yr(Pr,{get wrapperClass(){return`w-8 ${w(pr)??""}`},get content(){return w(Rr)},onClick:()=>{Ne(Kt,"action",{type:"buttons",select:{key:""}}),(!w(Ft).action||w(Ft).action.buttons.length==0)&&Ve(Kt)}})})}var ur=de(ar,2);{let pr=ne(()=>({icon:Gl}));st(ur,()=>jr,(Rr,Pr)=>{Pr(Rr,{wrapperClass:"w-8",get content(){return w(pr)},onClick:()=>{const yr=[..._.component.properties.header||[]];yr.splice(Kt,1),Tt("header",yr,_.component,_.onPropertyChange),yr.forEach(ce=>{Ne(yr.indexOf(ce),"width",`${(100/yr.length).toFixed(2)}%`)})}})})}K(Tr);var Ar=de(Tr,2);{var Cr=pr=>{var Rr=M2(),Pr=de($t(Rr),2),yr=oe(Pr);{let Le=ne(()=>G().ACTION_TYPE_OPTIONS.find(Ae=>Ae.value===w(Ft).action?.type)||G().ACTION_TYPE_OPTIONS[0]);st(yr,()=>Nr,(Ae,Pe)=>{Pe(Ae,{type:"buttons",wrapperClass:"w-[50%]",get options(){return G().ACTION_TYPE_OPTIONS},get value(){return w(Le)},onUpdate:ze=>{w(Ft).action.type=ze.value}})})}var ce=de(yr,2);{let Le=ne(()=>w(Ft).action.type=="select"?"invisible":""),Ae=ne(()=>({icon:Ba,info:{text:B()("constructor.props.table.addbutton"),side:"top"}}));st(ce,()=>jr,(Pe,ze)=>{ze(Pe,{get wrapperClass(){return`w-8 ${w(Le)??""}`},get content(){return w(Ae)},onClick:()=>{Ve(Kt)}})})}var R=de(ce,2);{let Le=ne(()=>({icon:_n}));st(R,()=>jr,(Ae,Pe)=>{Pe(Ae,{wrapperClass:"w-8 absolute right-0",get content(){return w(Le)},onClick:()=>{w(Ft).action.type="none"}})})}K(Pr);var O=de(Pr,2),V=oe(O);{var se=Le=>{var Ae=wr(),Pe=$t(Ae);Er(Pe,17,()=>w(Ft).action.buttons,Ur,(ze,dt,ke)=>{var et=P2(),pe=oe(et);{let Ht=ne(()=>({name:B()("constructor.props.name")}));st(pe,()=>_r,(zr,Ir)=>{Ir(zr,{get label(){return w(Ht)},wrapperClass:"!w-3/10",get value(){return w(dt).name},onUpdate:hr=>He(Kt,ke,"name",hr)})})}var Lt=de(pe,2);{let Ht=ne(()=>({name:B()("constructor.props.header")})),zr=ne(()=>G().HEADER_OPTIONS.find(Ir=>Ir.value===w(dt).eventHandler?.Header));st(Lt,()=>Nr,(Ir,hr)=>{hr(Ir,{wrapperClass:"!w-2/10",get label(){return w(Ht)},type:"buttons",get value(){return w(zr)},get options(){return G().HEADER_OPTIONS},onUpdate:xr=>{const dr=w(dt).eventHandler;dr.Header=xr.value,He(Kt,ke,"eventHandler",dr)}})})}var cr=de(Lt,2);{let Ht=ne(()=>({name:B()("constructor.props.argument")})),zr=ne(()=>w(dt).eventHandler?.Argument);st(cr,()=>_r,(Ir,hr)=>{hr(Ir,{wrapperClass:"!w-2/10",get label(){return w(Ht)},get value(){return w(zr)},onUpdate:xr=>{const dr=w(dt).eventHandler;dr.Argument=xr,He(Kt,ke,"eventHandler",dr)}})})}var Bt=de(cr,2);{let Ht=ne(()=>({name:B()("constructor.props.table.keys")})),zr=ne(()=>w(dt).eventHandler?.Variables.join(" ")),Ir=ne(()=>({info:B()("constructor.props.table.keys.info"),regExp:/^[a-zA-Z0-9\-_ ]{0,500}$/}));st(Bt,()=>_r,(hr,xr)=>{xr(hr,{wrapperClass:"!w-2/10",get label(){return w(Ht)},get value(){return w(zr)},maxlength:500,get help(){return w(Ir)},onUpdate:dr=>{const fr={...w(dt).eventHandler};fr.Variables=dr.trim().split(/\s+/),He(Kt,ke,"eventHandler",fr)}})})}var qt=de(Bt,2);{let Ht=ne(()=>({icon:Gl}));st(qt,()=>jr,(zr,Ir)=>{Ir(zr,{wrapperClass:"w-8",get content(){return w(Ht)},onClick:()=>Z(Kt,ke)})})}K(et),ye(ze,et)}),ye(Le,Ae)},_e=Le=>{var Ae=wr(),Pe=$t(Ae);{var ze=dt=>{var ke=I2(),et=oe(ke);{let pe=ne(()=>({name:B()("constructor.props.table.select.keys")})),Lt=ne(()=>w(Ft).action.select.key??""),cr=ne(()=>({info:B()("constructor.props.table.select.keys.info"),regExp:/^[a-zA-Z0-9\-_ ]{0,500}$/}));st(et,()=>_r,(Bt,qt)=>{qt(Bt,{get label(){return w(pe)},get value(){return w(Lt)},maxlength:500,get help(){return w(cr)},onUpdate:Ht=>{Ee(Kt,"key",Ht)}})})}K(ke),ye(dt,ke)};xt(Pe,dt=>{w(Ft).action.type=="select"&&dt(ze)},!0)}ye(Le,Ae)};xt(V,Le=>{w(Ft).action.type=="buttons"?Le(se):Le(_e,!1)})}K(O),jg(2),ye(pr,Rr)};xt(Ar,pr=>{w(Ft).action&&w(Ft).action.type!="none"&&pr(Cr)})}ye(Rt,Yt)}),K(ue),zt(Rt=>lr(ot,Rt),[()=>B()("constructor.props.table.columns")]),ye(ee,Q)};xt(be,ee=>{_.component.properties.type==="table"&&ee(ie)})}ye(rt,Oe)},nt=rt=>{var Oe=N2(),Fe=$t(Oe),lt=oe(Fe),Re=oe(lt);{let Qt=ne(()=>({name:B()("constructor.props.id")}));st(Re,()=>_r,(Mt,Xt)=>{Xt(Mt,{get label(){return w(Qt)},get value(){return _.component.properties.id},onUpdate:Sr=>Tt("id",Sr,_.component,_.onPropertyChange)})})}var pt=de(Re,2);{let Qt=ne(()=>({name:B()("constructor.props.wrapperclass")}));st(pt,()=>_r,(Mt,Xt)=>{Xt(Mt,{get label(){return w(Qt)},get value(){return _.component.properties.wrapperClass},onUpdate:Sr=>Tt("wrapperClass",Sr,_.component,_.onPropertyChange)})})}var ft=de(pt,2);{let Qt=ne(()=>({name:B()("constructor.props.colors")}));st(ft,()=>Nr,(Mt,Xt)=>{Xt(Mt,{wrapperClass:" h-14",get label(){return w(Qt)},type:"buttons",get options(){return G().COLOR_OPTIONS},get value(){return w(Ie)},onUpdate:Sr=>{Tt("wrapperClass",ir(_.component.properties.wrapperClass,Sr.value),_.component,_.onPropertyChange);const Et=[..._.component.properties?.options||[]];Et.forEach(Ot=>{Ot.class=Sr.value}),Tt("options",Et,_.component,_.onPropertyChange)}})})}var gt=de(ft,2);{let Qt=ne(()=>({name:B()("constructor.props.outline")}));st(gt,()=>Hn,(Mt,Xt)=>{Xt(Mt,{get label(){return w(Qt)},get value(){return _.component.properties.outline},options:[{id:crypto.randomUUID(),value:0,class:""}],onChange:Sr=>Tt("outline",Sr,_.component,_.onPropertyChange)})})}K(lt);var bt=de(lt,2),Ue=oe(bt);{let Qt=ne(()=>({name:B()("constructor.props.access")})),Mt=ne(()=>G().ACCESS_OPTION.find(Xt=>Xt.value===_.component.access));st(Ue,()=>Nr,(Xt,Sr)=>{Sr(Xt,{get label(){return w(Qt)},type:"buttons",get options(){return G().ACCESS_OPTION},get value(){return w(Mt)},onUpdate:Et=>_.onPropertyChange({access:Et.value})})})}var Be=de(Ue,2);{let Qt=ne(()=>({name:B()("constructor.props.label")}));st(Be,()=>_r,(Mt,Xt)=>{Xt(Mt,{get label(){return w(Qt)},get value(){return _.component.properties.label.name},onUpdate:Sr=>Tt("label.name",Sr,_.component,_.onPropertyChange)})})}var Se=de(Be,2);{let Qt=ne(()=>({name:B()("constructor.props.label.class")}));st(Se,()=>_r,(Mt,Xt)=>{Xt(Mt,{get label(){return w(Qt)},get value(){return _.component.properties.label.class},onUpdate:Sr=>Tt("label.class",Sr,_.component,_.onPropertyChange)})})}var Te=de(Se,2);{let Qt=ne(()=>({name:B()("constructor.props.footer")}));st(Te,()=>_r,(Mt,Xt)=>{Xt(Mt,{get label(){return w(Qt)},get value(){return _.component.properties.footer},onUpdate:Sr=>Tt("footer",Sr,_.component,_.onPropertyChange)})})}K(bt);var Ce=de(bt,2),we=oe(Ce);{let Qt=ne(()=>({name:B()("constructor.props.table.type")})),Mt=ne(()=>G().TABLE_TYPE_OPTIONS.find(Xt=>Xt.value===_.component.properties.type));st(we,()=>Nr,(Xt,Sr)=>{Sr(Xt,{get label(){return w(Qt)},type:"buttons",get options(){return G().TABLE_TYPE_OPTIONS},get value(){return w(Mt)},onUpdate:Et=>{Tt("type",Et.value,_.component,_.onPropertyChange),Et.value==="logger"?(Tt("dataBuffer.stashData",!0,_.component,_.onPropertyChange),Tt("dataBuffer.clearButton",!0,_.component,_.onPropertyChange)):(Tt("dataBuffer.stashData",!1,_.component,_.onPropertyChange),Tt("dataBuffer.clearButton",!1,_.component,_.onPropertyChange),Tt("header",[{key:"id",label:{name:"ID"},width:"40%",sortable:!0,image:{width:"0rem",height:"0rem"},align:"left"},{key:"device",label:{name:"Device"},width:"60%",sortable:!1,image:{width:"0rem",height:"0rem"},align:"left",overflow:{truncated:!0}}],_.component,_.onPropertyChange))}})})}var be=de(we,2),ie=oe(be);{let Qt=ne(()=>({name:B()("constructor.props.table.stashData")})),Mt=ne(()=>[{id:crypto.randomUUID(),value:0,class:"",disabled:_.component.properties.type==="logger"}]);st(ie,()=>Hn,(Xt,Sr)=>{Sr(Xt,{get label(){return w(Qt)},get value(){return _.component.properties.dataBuffer.stashData},get options(){return w(Mt)},onChange:Et=>{Tt("dataBuffer.stashData",Et,_.component,_.onPropertyChange)}})})}var ee=de(ie,2);{var Q=Qt=>{var Mt=wr(),Xt=$t(Mt);{let Sr=ne(()=>({name:B()("constructor.props.table.clearButton")}));st(Xt,()=>Hn,(Et,Ot)=>{Ot(Et,{get label(){return w(Sr)},get value(){return _.component.properties.dataBuffer.clearButton},options:[{id:crypto.randomUUID(),value:0,class:""}],onChange:ar=>{Tt("dataBuffer.clearButton",ar,_.component,_.onPropertyChange)}})})}ye(Qt,Mt)};xt(ee,Qt=>{_.component.properties.type==="logger"&&Qt(Q)})}K(be);var ue=de(be,2);{var De=Qt=>{var Mt=wr(),Xt=$t(Mt);{let Sr=ne(()=>({name:B()("constructor.props.table.buffersize")})),Et=ne(()=>G().BUFFER_SIFE_OPTIONS.find(Ot=>Ot.value===_.component.properties.dataBuffer.rowsAmmount));st(Xt,()=>Nr,(Ot,ar)=>{ar(Ot,{get label(){return w(Sr)},type:"buttons",get options(){return G().BUFFER_SIFE_OPTIONS},get value(){return w(Et)},onUpdate:ur=>Tt("dataBuffer.rowsAmmount",ur.value,_.component,_.onPropertyChange)})})}ye(Qt,Mt)};xt(ue,Qt=>{_.component.properties.dataBuffer.stashData&&Qt(De)})}K(Ce),K(Fe);var Ge=de(Fe,4),ot=oe(Ge),it=oe(ot),It=oe(it,!0);K(it);var Rt=de(it,2);{let Qt=ne(()=>({icon:Ba}));st(Rt,()=>jr,(Mt,Xt)=>{Xt(Mt,{wrapperClass:"w-8",get content(){return w(Qt)},onClick:()=>{const Sr={key:`column${(_.component.properties.header?.length||0)+1}`,label:{name:`Column ${(_.component.properties.header?.length||0)+1}`,class:""},width:"10%",sortable:!1,image:{width:"0rem",height:"0rem"}},Et=[..._.component.properties.header||[],Sr];Tt("header",Et,_.component,_.onPropertyChange),Et.forEach(Ot=>{Ne(Et.indexOf(Ot),"width",`${(100/Et.length).toFixed(2)}%`)}),Xe()}})})}K(ot);var Ft=de(ot,2),Kt=oe(Ft);Er(Kt,17,()=>_.component.properties.header,Ur,(Qt,Mt,Xt)=>{var Sr=R2(),Et=oe(Sr),Ot=oe(Et),ar=oe(Ot);{let ke=ne(()=>({name:B()("constructor.props.table.columns.key")}));st(ar,()=>_r,(et,pe)=>{pe(et,{get label(){return w(ke)},get value(){return w(Mt).key},help:{regExp:/^[0-9a-zA-Z_-]{0,16}$/},onUpdate:Lt=>{Ne(Xt,"key",Lt),Xe()}})})}var ur=de(ar,2);{let ke=ne(()=>({name:B()("constructor.props.table.columns.label")}));st(ur,()=>_r,(et,pe)=>{pe(et,{get label(){return w(ke)},get value(){return w(Mt).label.name},onUpdate:Lt=>{Ne(Xt,"label",{name:Lt})}})})}var Ar=de(ur,2);{let ke=ne(()=>({name:B()("constructor.props.table.columns.width"),class:"px-0"})),et=ne(()=>Number(w(Mt).width.replace("%","")));st(Ar,()=>_r,(pe,Lt)=>{Lt(pe,{get label(){return w(ke)},type:"number",get value(){return w(et)},onUpdate:cr=>Ne(Xt,"width",`${cr}%`)})})}var Cr=de(Ar,2);{let ke=ne(()=>({name:B()("constructor.props.align.content")})),et=ne(()=>G().ALIGN_OPTIONS.find(pe=>pe.value.includes(w(Mt).align)));st(Cr,()=>Nr,(pe,Lt)=>{Lt(pe,{get label(){return w(ke)},type:"buttons",get value(){return w(et)},get options(){return G().ALIGN_OPTIONS},onUpdate:cr=>Ne(Xt,"align",cr.value)})})}var pr=de(Cr,2);{let ke=ne(()=>({name:B()("constructor.props.table.columns.sortable"),class:"px-0"}));st(pr,()=>Hn,(et,pe)=>{pe(et,{get label(){return w(ke)},options:[{id:crypto.randomUUID(),value:0,class:""}],get value(){return w(Mt).sortable},onChange:Lt=>Ne(Xt,"sortable",Lt)})})}var Rr=de(pr,2);{let ke=ne(()=>({name:B()("constructor.props.copy"),class:"px-0"})),et=ne(()=>w(Mt).overflow?.copy);st(Rr,()=>Hn,(pe,Lt)=>{Lt(pe,{get label(){return w(ke)},options:[{id:crypto.randomUUID(),value:0,class:""}],get value(){return w(et)},onChange:cr=>Ne(Xt,"overflow",{copy:cr,truncated:w(Mt).overflow?.truncated})})})}var Pr=de(Rr,2);{let ke=ne(()=>w(Mt).action&&w(Mt).action.type!="none"?"invisible":""),et=ne(()=>({icon:Ba,info:{text:B()("constructor.props.table.addaction"),side:"top"}}));st(Pr,()=>jr,(pe,Lt)=>{Lt(pe,{get wrapperClass(){return`w-8 ${w(ke)??""}`},get content(){return w(et)},onClick:()=>{Ne(Xt,"action",{type:"buttons",select:{key:""}}),(!w(Mt).action||w(Mt).action.buttons.length==0)&&Ve(Xt)}})})}var yr=de(Pr,2);{let ke=ne(()=>({icon:Gl}));st(yr,()=>jr,(et,pe)=>{pe(et,{wrapperClass:"w-8",get content(){return w(ke)},onClick:()=>{const Lt=[..._.component.properties.header||[]];Lt.splice(Xt,1),Tt("header",Lt,_.component,_.onPropertyChange),Lt.forEach(cr=>{Ne(Lt.indexOf(cr),"width",`${(100/Lt.length).toFixed(2)}%`)})}})})}K(Ot);var ce=de(Ot,2),R=oe(ce);{let ke=ne(()=>({name:B()("constructor.props.table.columns.truncated"),class:"px-0"})),et=ne(()=>w(Mt).overflow?.truncated);st(R,()=>Hn,(pe,Lt)=>{Lt(pe,{get label(){return w(ke)},options:[{id:crypto.randomUUID(),value:0,class:""}],get value(){return w(et)},onChange:cr=>Ne(Xt,"overflow",{truncated:cr,copy:w(Mt).overflow?.copy})})})}var O=de(R,2),V=oe(O);{let ke=ne(()=>({name:B()("constructor.props.table.columns.defaultIcon")}));st(V,()=>jr,(et,pe)=>{pe(et,{get content(){return w(ke)},onClick:()=>St(xe,{isModalOpen:!0,columnIndex:Xt,column:w(Mt)})})})}var se=de(V,2);{var _e=ke=>{var et=wr(),pe=$t(et);{let Lt=ne(()=>({icon:_n}));st(pe,()=>jr,(cr,Bt)=>{Bt(cr,{wrapperClass:"w-8.5 ",componentClass:"p-0.5 bg-red",get content(){return w(Lt)},onClick:()=>{Ne(Xt,"image",{class:w(Mt).image?.class,width:w(Mt).image?.width,height:w(Mt).image?.height,defaultIcon:""})}})})}ye(ke,et)};xt(se,ke=>{w(Mt).image?.defaultIcon&&ke(_e)})}K(O);var Le=de(O,2);{let ke=ne(()=>({name:B()("constructor.props.table.columns.class")})),et=ne(()=>w(Mt).image?.class);st(Le,()=>_r,(pe,Lt)=>{Lt(pe,{get label(){return w(ke)},get value(){return w(et)},onUpdate:cr=>{Ne(Xt,"image",{class:cr,width:w(Mt).image?.width,height:w(Mt).image?.height,defaultIcon:w(Mt).image.defaultIcon})}})})}var Ae=de(Le,2);{let ke=ne(()=>({name:B()("constructor.props.table.columns.image.width"),class:"px-0"})),et=ne(()=>Number(w(Mt).image?.width.replace("rem",""))??0);st(Ae,()=>_r,(pe,Lt)=>{Lt(pe,{get label(){return w(ke)},type:"number",number:{minNum:0,maxNum:1e3,step:1},get value(){return w(et)},onUpdate:cr=>{Ne(Xt,"image",{class:w(Mt).image?.class,width:`${cr??0}rem`,height:w(Mt).image?.height,defaultIcon:w(Mt).image.defaultIcon})}})})}var Pe=de(Ae,2);{let ke=ne(()=>({name:B()("constructor.props.table.columns.image.height"),class:"px-0"})),et=ne(()=>Number(w(Mt).image?.height.replace("rem","")));st(Pe,()=>_r,(pe,Lt)=>{Lt(pe,{get label(){return w(ke)},type:"number",number:{minNum:0,maxNum:1e3,step:1},get value(){return w(et)},onUpdate:cr=>{Ne(Xt,"image",{class:w(Mt).image?.class,width:w(Mt).image?.width,height:`${cr}rem`,defaultIcon:w(Mt).image.defaultIcon})}})})}K(ce),K(Et);var ze=de(Et,2);{var dt=ke=>{var et=L2(),pe=de($t(et),2),Lt=oe(pe);{let hr=ne(()=>G().ACTION_TYPE_OPTIONS.find(xr=>xr.value===w(Mt).action?.type)||G().ACTION_TYPE_OPTIONS[0]);st(Lt,()=>Nr,(xr,dr)=>{dr(xr,{type:"buttons",wrapperClass:"w-[50%]",get options(){return G().ACTION_TYPE_OPTIONS},get value(){return w(hr)},onUpdate:fr=>{w(Mt).action.type=fr.value}})})}var cr=de(Lt,2);{let hr=ne(()=>w(Mt).action.type=="select"?"invisible":""),xr=ne(()=>({icon:Ba,info:{text:B()("constructor.props.table.addbutton"),side:"top"}}));st(cr,()=>jr,(dr,fr)=>{fr(dr,{get wrapperClass(){return`w-8 ${w(hr)??""}`},get content(){return w(xr)},onClick:()=>{Ve(Xt)}})})}var Bt=de(cr,2);{let hr=ne(()=>({icon:_n}));st(Bt,()=>jr,(xr,dr)=>{dr(xr,{wrapperClass:"w-8 absolute right-0",get content(){return w(hr)},onClick:()=>{w(Mt).action.type="none"}})})}K(pe);var qt=de(pe,2),Ht=oe(qt);{var zr=hr=>{var xr=wr(),dr=$t(xr);Er(dr,17,()=>w(Mt).action.buttons,Ur,(fr,Je,Dr)=>{var li=z2(),Ji=oe(li);{let oi=ne(()=>({name:B()("constructor.props.name")}));st(Ji,()=>_r,($i,zi)=>{zi($i,{get label(){return w(oi)},wrapperClass:"!w-3/10",get value(){return w(Je).name},onUpdate:mr=>He(Xt,Dr,"name",mr)})})}var Kr=de(Ji,2);{let oi=ne(()=>({name:B()("constructor.props.header")})),$i=ne(()=>G().HEADER_OPTIONS.find(zi=>zi.value===w(Je).eventHandler?.Header));st(Kr,()=>Nr,(zi,mr)=>{mr(zi,{wrapperClass:"!w-2/10",get label(){return w(oi)},type:"buttons",get value(){return w($i)},get options(){return G().HEADER_OPTIONS},onUpdate:Ln=>{const yn=w(Je).eventHandler;yn.Header=Ln.value,He(Xt,Dr,"eventHandler",yn)}})})}var wt=de(Kr,2);{let oi=ne(()=>({name:B()("constructor.props.argument")})),$i=ne(()=>w(Je).eventHandler?.Argument);st(wt,()=>_r,(zi,mr)=>{mr(zi,{wrapperClass:"!w-2/10",get label(){return w(oi)},get value(){return w($i)},onUpdate:Ln=>{const yn=w(Je).eventHandler;yn.Argument=Ln,He(Xt,Dr,"eventHandler",yn)}})})}var rr=de(wt,2);{let oi=ne(()=>({name:B()("constructor.props.table.keys")})),$i=ne(()=>w(Je).eventHandler?.Variables.join(" ")),zi=ne(()=>({info:B()("constructor.props.table.keys.info"),regExp:/^[a-zA-Z0-9\-_ ]{0,500}$/}));st(rr,()=>_r,(mr,Ln)=>{Ln(mr,{wrapperClass:"!w-2/10",get label(){return w(oi)},get value(){return w($i)},maxlength:500,get help(){return w(zi)},onUpdate:yn=>{const Eo={...w(Je).eventHandler};Eo.Variables=yn.trim().split(/\s+/),He(Xt,Dr,"eventHandler",Eo)}})})}var br=de(rr,2);{let oi=ne(()=>({icon:Gl}));st(br,()=>jr,($i,zi)=>{zi($i,{wrapperClass:"w-8",get content(){return w(oi)},onClick:()=>Z(Xt,Dr)})})}K(li),ye(fr,li)}),ye(hr,xr)},Ir=hr=>{var xr=wr(),dr=$t(xr);{var fr=Je=>{var Dr=D2(),li=oe(Dr);{let Ji=ne(()=>({name:B()("constructor.props.table.select.keys")})),Kr=ne(()=>w(Mt).action.select.key??""),wt=ne(()=>({info:B()("constructor.props.table.select.keys.info"),regExp:/^[a-zA-Z0-9\-_ ]{0,500}$/}));st(li,()=>_r,(rr,br)=>{br(rr,{get label(){return w(Ji)},get value(){return w(Kr)},maxlength:500,get help(){return w(wt)},onUpdate:oi=>{Ee(Xt,"key",oi)}})})}K(Dr),ye(Je,Dr)};xt(dr,Je=>{w(Mt).action.type=="select"&&Je(fr)},!0)}ye(hr,xr)};xt(Ht,hr=>{w(Mt).action.type=="buttons"?hr(zr):hr(Ir,!1)})}K(qt),ye(ke,et)};xt(ze,ke=>{w(Mt).action&&w(Mt).action.type!="none"&&ke(dt)})}K(Sr),ye(Qt,Sr)});var Yt=de(Kt,2);{var Tr=Qt=>{ho(Qt,{wrapperClass:"w-130",get isOpen(){return w(xe).isModalOpen},set isOpen(Xt){w(xe).isModalOpen=Xt},main:Xt=>{var Sr=B2();Er(Sr,21,()=>uo,Ur,(Et,Ot)=>{var ar=O2(),ur=oe(ar),Ar=oe(ur,!0);K(ur);var Cr=de(ur,2);Er(Cr,21,()=>w(Ot)[1],Ur,(pr,Rr)=>{var Pr=F2();Pr.__click=()=>{Ne(w(xe).columnIndex,"image",{class:w(xe).column.image?.class,width:w(xe).column.image?.width,height:w(xe).column.image?.height,defaultIcon:w(Rr)})};var yr=oe(Pr);Wi(yr,()=>w(Rr)),K(Pr),ye(pr,Pr)}),K(Cr),K(ar),zt(pr=>lr(Ar,pr),[()=>B()(`constructor.props.icon.${w(Ot)[0]}`)]),ye(Et,ar)}),K(Sr),ye(Xt,Sr)},$$slots:{main:!0}})};xt(Yt,Qt=>{w(xe).isModalOpen&&Qt(Tr)})}K(Ft),K(Ge),zt(Qt=>lr(It,Qt),[()=>B()("constructor.props.table.columns")]),ye(rt,Oe)};xt(vt,rt=>{S()?rt(Ke):rt(nt,!1)})}ye(I,ut),vi(),ae()}Xi(["click"]);var V2=Qe('<span class="flex h-7 w-7 items-center justify-center overflow-visible [&amp;_svg]:h-full [&amp;_svg]:max-h-full [&amp;_svg]:w-full [&amp;_svg]:max-w-full svelte-18eaq6o"><!></span>'),j2=Qe('<span class="text-lg font-semibold svelte-18eaq6o"> </span>'),U2=Qe("<button><!> <!></button> <span></span>",1),G2=Qe('<div class="w-full h-full flex flex-col rounded-2xl bg-(--back-color) overflow-hidden svelte-18eaq6o"><div></div> <div class="grid flex-1 overflow-y-scroll w-full gap-2 rounded-2xl bg-(--back-color) p-4 svelte-18eaq6o"><!></div></div>');function mw(I,_){_i(_,!0);let G=Pt(_,"id",19,()=>crypto.randomUUID()),B=Pt(_,"wrapperClass",3,"bg-blue"),me=Pt(_,"size",19,()=>({width:12,height:6})),ae=Pt(_,"activeTab",3,0),S=Pt(_,"items",19,()=>[{name:"tab 1",icon:"",class:""},{name:"tab 2",icon:"",class:""}]),l=Pt(_,"apiArray",19,()=>[]);const q=ne(()=>!!S().find(Z=>Z.class?.startsWith("flex-col")));let xe=ne(ae);var Ie=G2(),qe=oe(Ie);Er(qe,21,S,Ur,(Z,Ve,ut)=>{var vt=U2(),Ke=$t(vt);Ke.__click=()=>St(xe,ut);var nt=oe(Ke);{var rt=Re=>{var pt=V2(),ft=oe(pt);{var gt=Ue=>{var Be=wr(),Se=$t(Be);Wi(Se,()=>w(Ve).icon),ye(Ue,Be)},bt=Ue=>{const Be=ne(()=>w(Ve).icon);var Se=wr(),Te=$t(Se);st(Te,()=>w(Be),(Ce,we)=>{we(Ce,{})}),ye(Ue,Se)};xt(ft,Ue=>{typeof w(Ve).icon=="string"?Ue(gt):Ue(bt,!1)})}K(pt),ye(Re,pt)};xt(nt,Re=>{w(Ve)?.icon&&Re(rt)})}var Oe=de(nt,2);{var Fe=Re=>{var pt=j2(),ft=oe(pt,!0);K(pt),zt(()=>lr(ft,w(Ve).name)),ye(Re,pt)};xt(Oe,Re=>{w(Ve)?.name&&Re(Fe)})}K(Ke);var lt=de(Ke,2);zt((Re,pt,ft)=>{Gt(Ke,1,Re,"svelte-18eaq6o"),hi(Ke,`width: ${pt??""};`),Gt(lt,1,`${ft??""} w-0 border border-l ${ut!==S().length-1&&ut!==w(xe)&&ut!==w(xe)-1?"border-gray-500":"opacity-0"}`,"svelte-18eaq6o")},[()=>Zr(ir(`tab mt-1 flex min-w-fit cursor-pointer items-center justify-center gap-0 self-end rounded-t-2xl px-5 py-2.5 ${w(q)&&S().find(Re=>Re.icon)?"h-20":"gap-2"}`,w(Ve).class,ut===w(xe)?ir("bg-(--back-color) text-blue-500",`text-${B()?.split(" ").find(Re=>Re.startsWith("bg-"))?.slice(3).split("-")[0]}-500`):"bg-(--bg-color) text-gray-500")),()=>w(Ve).class?.split(" ").find(Re=>Re.startsWith("w-"))?.replace("w-[","").slice(0,-1),()=>w(q)&&S().find(Re=>Re.icon)?"h-9":"h-4"]),ye(Z,vt)}),K(qe);var Ne=de(qe,2),Xe=oe(Ne);{var He=Z=>{var Ve=wr(),ut=$t(Ve);Er(ut,17,()=>(l()??[]).filter(vt=>vt.id.endsWith(`${w(xe)}`)),Ur,(vt,Ke)=>{var nt=wr(),rt=$t(nt);co(rt,()=>_.Components,()=>w(Ke),()=>!1),ye(vt,nt)}),ye(Z,Ve)},Ee=Z=>{var Ve=wr(),ut=$t(Ve);{var vt=nt=>{var rt=wr(),Oe=$t(rt);co(Oe,()=>_.children,()=>S()[w(xe)]),ye(nt,rt)},Ke=nt=>{var rt=wr(),Oe=$t(rt);co(Oe,()=>S()[w(xe)]?.children??Wn),ye(nt,rt)};xt(ut,nt=>{_.children?nt(vt):nt(Ke,!1)},!0)}ye(Z,Ve)};xt(Xe,Z=>{_.Components?Z(He):Z(Ee,!1)})}K(Ne),K(Ie),zt((Z,Ve)=>{tr(Ie,"id",Z),Gt(qe,1,`${Ve??""} 
     bg-(--bg-color)`,"svelte-18eaq6o"),hi(Ne,`grid-template-columns: repeat(${me().width||1}, minmax(0, 1fr)); grid-template-rows: repeat(${me().height||1}, auto);`)},[()=>`${G()}-${crypto.randomUUID().slice(0,6)}`,()=>ir("z-40 flex h-fit items-center rounded-t-2xl overflow-x-auto px-1",B())]),ye(I,Ie),vi()}Xi(["click"]);var q2=Qe('<div class="m-0 flex items-end justify-around gap-2 border-gray-400"><!> <div class="relative mt-5 flex w-3/10 gap-2"><!> <!></div> <!></div>'),Z2=Qe('<button class="h-8 w-8 cursor-pointer [&amp;_svg]:h-full [&amp;_svg]:max-h-full [&amp;_svg]:w-full [&amp;_svg]:max-w-full"><!></button>'),H2=Qe('<div class="relative m-1.5 rounded-xl border-2 border-(--border-color) p-3"><div class="absolute -top-3.5 bg-(--back-color) px-1"> </div> <div class="grid grid-cols-3 place-items-center gap-2"></div></div>'),W2=Qe('<div class="grid grid-cols-3"></div>'),X2=Qe('<div class="flex items-center justify-center gap-8"><div class="flex w-1/3 flex-col items-center px-2"><!> <!></div> <div class="flex w-1/3 flex-col items-center px-2"><!> <!></div></div> <div class="space-y-4"><div class="m-0 flex items-center justify-center gap-2"><h4> </h4> <!></div> <!> <!></div>',1),Y2=Qe('<div class="m-0 flex items-end justify-around gap-2 border-gray-400"><!> <div class="relative mt-5 flex w-3/10 gap-2"><!> <!></div> <!></div>'),K2=Qe('<button class="h-8 w-8 cursor-pointer [&amp;_svg]:h-full [&amp;_svg]:max-h-full [&amp;_svg]:w-full [&amp;_svg]:max-w-full"><!></button>'),Q2=Qe('<div class="relative m-1.5 rounded-xl border-2 border-(--border-color) p-3"><div class="absolute -top-3.5 bg-(--back-color) px-1"> </div> <div class="grid grid-cols-3 place-items-center gap-2"></div></div>'),J2=Qe('<div class="grid grid-cols-3"></div>'),$2=Qe('<div class="flex items-center justify-center gap-8"><div class="flex w-1/3 flex-col items-center px-2"><!> <!> <div class="flex w-full gap-4"><!> <!></div></div> <div class="flex w-1/3 flex-col items-center px-2"><!> <!></div> <div class="flex w-1/3 flex-col items-center px-2"><!> <!></div></div> <div class="space-y-4"><div class="m-0 flex items-center justify-center gap-2"><h4> </h4> <!></div> <!> <!></div>',1);function gw(I,_){_i(_,!0);const G=()=>vn(Yl,"$optionsStore",me),B=()=>vn(po,"$t",me),[me,ae]=Mo(),S=Pt(_,"forConstructor",3,!0);let l=Vr(Na({index:0,isModalOpen:!1}));const q=ne(()=>G().COLOR_OPTIONS.find(Ee=>Ee.value.includes(_.component.properties.wrapperClass?.split(" ").find(Z=>Z.startsWith("bg-"))))),xe=ne(()=>G().ICON_TEXT_POSITION_OPTIONS.find(Ee=>Ee.value.includes(_.component.properties.items.find(Z=>Z.class?.includes("flex-")).class.split(" ").find(Z=>Z.startsWith("flex-"))))),Ie=ne(()=>()=>{let Ee=_.component.properties.items.find(Z=>Z.class?.split(" ").find(Ve=>Ve.startsWith("w-")));return Ee?Ee.class.includes("w-auto")?0:1:0});var qe=wr(),Ne=$t(qe);{var Xe=Ee=>{var Z=X2(),Ve=$t(Z),ut=oe(Ve),vt=oe(ut);{let Se=ne(()=>({name:B()("constructor.props.access")})),Te=ne(()=>G().ACCESS_OPTION.find(Ce=>Ce.value===_.component.access));st(vt,()=>Nr,(Ce,we)=>{we(Ce,{get label(){return w(Se)},type:"buttons",get options(){return G().ACCESS_OPTION},get value(){return w(Te)},onUpdate:be=>_.onPropertyChange({access:be.value})})})}var Ke=de(vt,2);{let Se=ne(()=>({name:B()("constructor.props.colors")})),Te=ne(()=>G().COLOR_OPTIONS.slice(1));st(Ke,()=>Nr,(Ce,we)=>{we(Ce,{wrapperClass:"h-14",get label(){return w(Se)},type:"buttons",get options(){return w(Te)},get value(){return w(q)},onUpdate:be=>{Tt("wrapperClass",ir(_.component.properties.wrapperClass,be.value),_.component,_.onPropertyChange)}})})}K(ut);var nt=de(ut,2),rt=oe(nt);{let Se=ne(()=>({name:B()("constructor.props.icon.text.position")}));st(rt,()=>Nr,(Te,Ce)=>{Ce(Te,{wrapperClass:"h-14",get label(){return w(Se)},type:"buttons",get options(){return G().ICON_TEXT_POSITION_OPTIONS},get value(){return w(xe)},onUpdate:we=>{_.component.properties.items.forEach((be,ie)=>{const ee=[..._.component.properties?.items||[]];ee[ie].class=ir(ee[ie].class,we.value),Tt("items",ee,_.component,_.onPropertyChange)})}})})}var Oe=de(rt,2);{let Se=ne(()=>({name:B()("constructor.props.widthMode"),captionLeft:B()("constructor.props.height.small"),captionRight:B()("constructor.props.equal")})),Te=ne(()=>w(Ie)());st(Oe,()=>Hn,(Ce,we)=>{we(Ce,{get label(){return w(Se)},get value(){return w(Te)},options:[{id:crypto.randomUUID(),value:0,class:""}],onChange:be=>{_.component.properties.items.forEach((ie,ee)=>{const Q=[..._.component.properties?.items||[]];Q[ee].class=ir(Q[ee].class,be?`w-[${1/Q.length*100}%]`:"w-auto"),Tt("items",Q,_.component,_.onPropertyChange)})}})})}K(nt),K(Ve);var Fe=de(Ve,2),lt=oe(Fe),Re=oe(lt),pt=oe(Re,!0);K(Re);var ft=de(Re,2);{var gt=Se=>{var Te=wr(),Ce=$t(Te);{let we=ne(()=>({icon:Ba}));st(Ce,()=>jr,(be,ie)=>{ie(be,{wrapperClass:"w-8",get content(){return w(we)},onClick:()=>{const ee={name:`Tab ${_.component.properties?.items.length+1}`,class:`text-${w(q)?.value.slice(3)}-500 ${w(xe)?.value}`,icon:""},Q=[..._.component.properties?.items||[],ee];Q.forEach((ue,De)=>{Q[De].class=ir(Q[De].class,w(Ie)()?`w-[${1/Q.length*100}%]`:"w-auto"),Tt("items",Q,_.component,_.onPropertyChange)})}})})}ye(Se,Te)};xt(ft,Se=>{_.component.properties?.items.length<10&&Se(gt)})}K(lt);var bt=de(lt,2);Er(bt,17,()=>_.component.properties.items||[],Ur,(Se,Te,Ce)=>{var we=q2(),be=oe(we);{let ot=ne(()=>({name:B()("constructor.props.optionname")}));st(be,()=>_r,(it,It)=>{It(it,{get label(){return w(ot)},wrapperClass:"w-5/10",get value(){return w(Te).name},onUpdate:Rt=>{const Ft=[..._.component.properties?.items||[]];Ft[Ce].name=Rt,Tt("items",Ft,_.component,_.onPropertyChange)}})})}var ie=de(be,2),ee=oe(ie);{let ot=ne(()=>({name:B()("constructor.props.labelicon")}));st(ee,()=>jr,(it,It)=>{It(it,{get content(){return w(ot)},onClick:()=>St(l,{index:Ce,isModalOpen:!0},!0)})})}var Q=de(ee,2);{var ue=ot=>{{let it=ne(()=>({icon:_n}));jr(ot,{wrapperClass:"w-8.5 ",componentClass:"p-0.5 bg-red",get content(){return w(it)},onClick:()=>{const It=[..._.component.properties?.items||[]];It[Ce].icon="",Tt("items",It,_.component,_.onPropertyChange)}})}};xt(Q,ot=>{w(Te).icon&&ot(ue)})}K(ie);var De=de(ie,2);{var Ge=ot=>{var it=wr(),It=$t(it);{let Rt=ne(()=>({icon:Gl}));st(It,()=>jr,(Ft,Kt)=>{Kt(Ft,{wrapperClass:"w-8",get content(){return w(Rt)},onClick:()=>{const Yt=[..._.component.properties?.items||[]];Yt.splice(Ce,1),Yt.forEach((Tr,Qt)=>{Yt[Qt].class=ir(Yt[Qt].class,w(Ie)()?`w-[${1/Yt.length*100}%]`:"w-auto"),Tt("items",Yt,_.component,_.onPropertyChange)}),Tt("items",Yt,_.component,_.onPropertyChange)}})})}ye(ot,it)};xt(De,ot=>{_.component.properties.items.length>1&&ot(Ge)})}K(we),ye(Se,we)});var Ue=de(bt,2);{var Be=Se=>{ho(Se,{wrapperClass:"w-130",get isOpen(){return w(l).isModalOpen},set isOpen(Ce){w(l).isModalOpen=Ce},main:Ce=>{var we=W2();Er(we,21,()=>uo,Ur,(be,ie)=>{var ee=H2(),Q=oe(ee),ue=oe(Q,!0);K(Q);var De=de(Q,2);Er(De,21,()=>w(ie)[1],Ur,(Ge,ot)=>{var it=Z2();it.__click=()=>{const Rt=[..._.component.properties?.items||[]];Rt[w(l).index].icon=w(ot),Tt("items",Rt,_.component,_.onPropertyChange)};var It=oe(it);Wi(It,()=>w(ot)),K(it),ye(Ge,it)}),K(De),K(ee),zt(Ge=>lr(ue,Ge),[()=>B()(`constructor.props.icon.${w(ie)[0]}`)]),ye(be,ee)}),K(we),ye(Ce,we)},$$slots:{main:!0}})};xt(Ue,Se=>{w(l).isModalOpen&&Se(Be)})}K(Fe),zt(Se=>lr(pt,Se),[()=>B()("constructor.props.tabs.title")]),ye(Ee,Z)},He=Ee=>{var Z=$2(),Ve=$t(Z),ut=oe(Ve),vt=oe(ut);{let ie=ne(()=>({name:B()("constructor.props.id")}));st(vt,()=>_r,(ee,Q)=>{Q(ee,{get label(){return w(ie)},get value(){return _.component.properties.id},onUpdate:ue=>Tt("id",ue,_.component,_.onPropertyChange)})})}var Ke=de(vt,2);{let ie=ne(()=>({name:B()("constructor.props.wrapperclass")}));st(Ke,()=>_r,(ee,Q)=>{Q(ee,{get label(){return w(ie)},get value(){return _.component.properties.wrapperClass},onUpdate:ue=>Tt("wrapperClass",ue,_.component,_.onPropertyChange)})})}var nt=de(Ke,2),rt=oe(nt);{let ie=ne(()=>({name:B()("constructor.props.size.height")}));st(rt,()=>_r,(ee,Q)=>{Q(ee,{get label(){return w(ie)},get value(){return _.component.properties.size.height},onUpdate:ue=>Tt("size.height",ue,_.component,_.onPropertyChange),number:{minNum:1,maxNum:1e3,step:1},type:"number"})})}var Oe=de(rt,2);{let ie=ne(()=>({name:B()("constructor.props.size.width")}));st(Oe,()=>_r,(ee,Q)=>{Q(ee,{get label(){return w(ie)},get value(){return _.component.properties.size.width},onUpdate:ue=>Tt("size.width",ue,_.component,_.onPropertyChange),number:{minNum:1,maxNum:1e3,step:1},type:"number"})})}K(nt),K(ut);var Fe=de(ut,2),lt=oe(Fe);{let ie=ne(()=>({name:B()("constructor.props.access")})),ee=ne(()=>G().ACCESS_OPTION.find(Q=>Q.value===_.component.access));st(lt,()=>Nr,(Q,ue)=>{ue(Q,{get label(){return w(ie)},type:"buttons",get options(){return G().ACCESS_OPTION},get value(){return w(ee)},onUpdate:De=>_.onPropertyChange({access:De.value})})})}var Re=de(lt,2);{let ie=ne(()=>({name:B()("constructor.props.colors")})),ee=ne(()=>G().COLOR_OPTIONS.slice(1));st(Re,()=>Nr,(Q,ue)=>{ue(Q,{wrapperClass:"h-14",get label(){return w(ie)},type:"buttons",get options(){return w(ee)},get value(){return w(q)},onUpdate:De=>{Tt("wrapperClass",ir(_.component.properties.wrapperClass,De.value),_.component,_.onPropertyChange)}})})}K(Fe);var pt=de(Fe,2),ft=oe(pt);{let ie=ne(()=>({name:B()("constructor.props.icon.text.position")}));st(ft,()=>Nr,(ee,Q)=>{Q(ee,{wrapperClass:"h-14",get label(){return w(ie)},type:"buttons",get options(){return G().ICON_TEXT_POSITION_OPTIONS},get value(){return w(xe)},onUpdate:ue=>{_.component.properties.items.forEach((De,Ge)=>{const ot=[..._.component.properties?.items||[]];ot[Ge].class=ir(ot[Ge].class,ue.value),Tt("items",ot,_.component,_.onPropertyChange)})}})})}var gt=de(ft,2);{let ie=ne(()=>({name:B()("constructor.props.widthMode"),captionLeft:B()("constructor.props.height.small"),captionRight:B()("constructor.props.equal")})),ee=ne(()=>w(Ie)());st(gt,()=>Hn,(Q,ue)=>{ue(Q,{get label(){return w(ie)},get value(){return w(ee)},options:[{id:crypto.randomUUID(),value:0,class:""}],onChange:De=>{_.component.properties.items.forEach((Ge,ot)=>{const it=[..._.component.properties?.items||[]];it[ot].class=ir(it[ot].class,De?`w-[${1/it.length*100}%]`:"w-auto"),Tt("items",it,_.component,_.onPropertyChange)})}})})}K(pt),K(Ve);var bt=de(Ve,2),Ue=oe(bt),Be=oe(Ue),Se=oe(Be,!0);K(Be);var Te=de(Be,2);{let ie=ne(()=>({icon:Ba}));st(Te,()=>jr,(ee,Q)=>{Q(ee,{wrapperClass:"w-8",get content(){return w(ie)},onClick:()=>{let ue=Math.max(...Array.from(document.body.querySelectorAll(".tab")).map(ot=>ot.offsetWidth));const De={name:`Tab ${_.component.properties?.items.length+1}`,class:`w-${w(Ie)()?`[${ue}px]`:"auto"} text-${w(q)?.value.slice(3)}-500 ${w(xe)?.value}`,icon:""},Ge=[..._.component.properties?.items||[],De];Tt("items",Ge,_.component,_.onPropertyChange)}})})}K(Ue);var Ce=de(Ue,2);Er(Ce,17,()=>_.component.properties.items||[],Ur,(ie,ee,Q)=>{var ue=Y2(),De=oe(ue);{let Kt=ne(()=>({name:B()("constructor.props.optionname")}));st(De,()=>_r,(Yt,Tr)=>{Tr(Yt,{get label(){return w(Kt)},wrapperClass:"w-5/10",get value(){return w(ee).name},onUpdate:Qt=>{const Mt=[..._.component.properties?.items||[]];Mt[Q].name=Qt,Tt("items",Mt,_.component,_.onPropertyChange)}})})}var Ge=de(De,2),ot=oe(Ge);{let Kt=ne(()=>({name:B()("constructor.props.labelicon")}));st(ot,()=>jr,(Yt,Tr)=>{Tr(Yt,{get content(){return w(Kt)},onClick:()=>St(l,{index:Q,isModalOpen:!0},!0)})})}var it=de(ot,2);{var It=Kt=>{{let Yt=ne(()=>({icon:_n}));jr(Kt,{wrapperClass:"w-8.5 ",componentClass:"p-0.5 bg-red",get content(){return w(Yt)},onClick:()=>{const Tr=[..._.component.properties?.items||[]];Tr[Q].icon="",Tt("items",Tr,_.component,_.onPropertyChange)}})}};xt(it,Kt=>{w(ee).icon&&Kt(It)})}K(Ge);var Rt=de(Ge,2);{var Ft=Kt=>{var Yt=wr(),Tr=$t(Yt);{let Qt=ne(()=>({icon:Gl}));st(Tr,()=>jr,(Mt,Xt)=>{Xt(Mt,{wrapperClass:"w-8",get content(){return w(Qt)},onClick:()=>{const Sr=[..._.component.properties?.items||[]];Sr.splice(Q,1),Tt("items",Sr,_.component,_.onPropertyChange)}})})}ye(Kt,Yt)};xt(Rt,Kt=>{_.component.properties.items.length>1&&Kt(Ft)})}K(ue),ye(ie,ue)});var we=de(Ce,2);{var be=ie=>{ho(ie,{wrapperClass:"w-130",get isOpen(){return w(l).isModalOpen},set isOpen(Q){w(l).isModalOpen=Q},main:Q=>{var ue=J2();Er(ue,21,()=>uo,Ur,(De,Ge)=>{var ot=Q2(),it=oe(ot),It=oe(it,!0);K(it);var Rt=de(it,2);Er(Rt,21,()=>w(Ge)[1],Ur,(Ft,Kt)=>{var Yt=K2();Yt.__click=()=>{const Qt=[..._.component.properties?.items||[]];Qt[w(l).index].icon=w(Kt),Tt("items",Qt,_.component,_.onPropertyChange)};var Tr=oe(Yt);Wi(Tr,()=>w(Kt)),K(Yt),ye(Ft,Yt)}),K(Rt),K(ot),zt(Ft=>lr(It,Ft),[()=>B()(`constructor.props.icon.${w(Ge)[0]}`)]),ye(De,ot)}),K(ue),ye(Q,ue)},$$slots:{main:!0}})};xt(we,ie=>{w(l).isModalOpen&&ie(be)})}K(bt),zt(ie=>lr(Se,ie),[()=>B()("constructor.props.tabs.title")]),ye(Ee,Z)};xt(Ne,Ee=>{S()?Ee(Xe):Ee(He,!1)})}ye(I,qe),vi(),ae()}Xi(["click"]);export{iw as A,jr as B,lw as C,S1 as D,ho as E,Tg as F,_r as I,cw as J,nw as L,hw as M,Nr as S,pw as T,aw as a,sw as b,Gt as c,hi as d,Er as e,uw as f,dw as g,Zr as h,Ur as i,fw as j,mw as k,gw as l,Tt as m,po as n,Yl as o,Hn as p,Ba as q,Sg as r,tr as s,ir as t,ow as u,Gl as v,Wi as w,co as x,Dn as y,ad as z};
